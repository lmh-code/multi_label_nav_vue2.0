webpackJsonp([156],{HJeR:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("Dd8w"),i=s.n(a),r=s("oAV5"),n=s("cIv3"),d=s("zme4"),m="/member/erp/prom/batchAddProm",o={data:function(){return{isDisabled:!1,addParamMesg:{triggerType:1,triggerTypeName:"直接发放",cardType:2,title:"",beginTime:"",endTime:"",newRegister:""},setDisableTime:{disabledDate:function(e){return e.getTime()<Date.now()-864e5}}}},created:function(){},mounted:function(){},components:{"store-template":n.a,"prom-type-template":d.a},methods:{changeStore:function(e){if(e)for(var t in e)this.addParamMesg[t]=e[t]},changePromType:function(e){this.addParamMesg.promReqs=e},formattData:function(){var e=this,t=/^\+?[1-9][0-9]*$/,s=/(^[1-9]{1}[0-9]*$)|(^[0-9]*\.[0-9]{1}$)|(^[0-9]*\.[0-9]{2}$)/;if(!this.addParamMesg.title)return this.$message("请输入活动名称"),!1;if(this.addParamMesg.title.length>30)return this.$message("活动名称限制30个汉字"),!1;if(""==this.addParamMesg.beginTime)return this.$message("请选择活动开始日期"),!1;if(this.addParamMesg.beginTime=r.u(new Date(this.addParamMesg.beginTime).getTime())+" 00:00:00",""==this.addParamMesg.endTime)return this.$message("请选择活动结束日期"),!1;if(this.addParamMesg.endTime=r.u(new Date(this.addParamMesg.endTime).getTime())+" 23:59:59",new Date(this.addParamMesg.endTime).getTime()<=new Date(this.addParamMesg.beginTime).getTime())return this.$message("活动结束日期不能早于或等于开始日期"),!1;if(this.addParamMesg.newRegister=!0===this.addParamMesg.newRegister?1:null,""===this.addParamMesg.useType||void 0===this.addParamMesg.useType)return this.$message("请选择卡券有效时间"),!1;if(1===this.addParamMesg.useType){if(""==this.addParamMesg.useBeginTime)return this.$message("请选择卡券有效开始日期"),!1;if(this.addParamMesg.useBeginTime=r.u(new Date(this.addParamMesg.useBeginTime).getTime())+" 00:00:00",""==this.addParamMesg.useEndTime)return this.$message("请选择卡券有效结束日期"),!1;if(this.addParamMesg.useEndTime=r.u(new Date(this.addParamMesg.useEndTime).getTime())+" 23:59:59",new Date(this.addParamMesg.useEndTime).getTime()<=new Date(this.addParamMesg.useBeginTime).getTime())return this.$message("卡券有效结束日期不能早于或等于开始日期"),!1;if(new Date(this.addParamMesg.useEndTime).getTime()<new Date(this.addParamMesg.endTime).getTime())return this.$message("卡券有效结束日期不能早于活动结束时间"),!1;delete this.addParamMesg.useDayCount}else if(2===this.addParamMesg.useType){if(""==this.addParamMesg.useDayCount)return this.$message("卡券有效使用天数不能为空"),!1;if(0==t.test(this.addParamMesg.useDayCount))return this.$message("卡券有效使用天数为大于零的整数"),!1;delete this.addParamMesg.useBeginTime,delete this.addParamMesg.useEndTime}var a=this.addParamMesg.promReqs[0],i=!0;a&&a.promDiscounts&&a.promDiscounts.length>0&&a.promDiscounts.forEach(function(e){for(var t in e)"discAmount"!=t&&"meetAmount"!=t&&"sendPromCount"!=t||""==e[t]||(i=!1)});var n=this.addParamMesg.promReqs[1],d=!0;if(n&&n.promDiscounts&&n.promDiscounts.length>0&&n.promDiscounts.forEach(function(e){for(var t in e)"range"!=t&&"goodsType"!=t&&"needPayAmount"!=t&&"goodsNo"!=t&&"sendPromCount"!=t||""==e[t]||(d=!1)}),i&&d)return this.$message("请设置满减券卡券奖励"),!1;if(0==i&&0==(!(!a||!a.promDiscounts)&&a.promDiscounts.every(function(a){return""==a.meetAmount||""==a.discAmount||""==a.sendPromCount?(e.$message("满减券卡券奖励-满减金额或张数不能为空"),!1):!1===s.test(a.meetAmount)||!1===s.test(a.discAmount)?(e.$message("满减券卡券奖励-满减金额大于零的数字，允许输入两位小数"),!1):!1===t.test(a.sendPromCount)?(e.$message("满减券卡券奖励-满减金额或张数为大于零的整数"),!1):!(parseInt(a.meetAmount)<parseInt(a.discAmount))||(e.$message("满减券卡券奖励-减金额不能大于满金额"),!1)})))return!1;if(0==d&&0==(!(!n||!n.promDiscounts)&&n.promDiscounts.every(function(a){return""==a.needPayAmount||void 0==a.needPayAmount?(e.$message("商品券卡券奖励-商品应付价格不能为空"),!1):0==a.needPayAmount||s.test(a.needPayAmount)?""==a.goodsNo||void 0==a.goodsNo?(e.$message("商品券卡券奖励-请选择商品"),!1):""==a.productQtyLimit||void 0==a.productQtyLimit?(e.$message("商品券卡券奖励-请输入选择商品数量小于等于的值"),!1):t.test(a.productQtyLimit)?""===a.sendPromCount||void 0==a.sendPromCount?(e.$message("商品券卡券奖励-请输入发放优惠券数量"),!1):!!t.test(a.sendPromCount)||(e.$message("商品券卡券奖励-发放优惠券数量为大于零的整数"),!1):(e.$message("商品券卡券奖励-选择商品数量小于等于的值格式不对，为大于零的整数"),!1):(e.$message("商品券卡券奖励-商品应付价格输入大于等于0的数字，允许输入一位小数。"),!1)})))return!1;return 1==i&&this.addParamMesg.promReqs.splice(0,1),1==d&&this.addParamMesg.promReqs.splice(1,1),!0},doSaveHandel:function(){var e=this;!1!==this.formattData()&&(this.addParamMesg.promReqs[0]&&this.$set(this.addParamMesg.promReqs[0],"onlineGoodsType","3;4;5"),this.addParamMesg.promReqs[1]&&this.$set(this.addParamMesg.promReqs[1],"onlineGoodsType","3;4;5"),this.isDisabled=!0,this.$http.post(m,i()({},this.addParamMesg)).then(function(t){if(setTimeout(function(){e.isDisabled=!1},800),0===t.code)return e.$message.success("保存成功"),void e.$router.push("/discount_coupon");throw new Error(t.msg)}).catch(function(t){e.isDisabled=!1,e.$notify.error({title:"提示",message:t.message})}))},doCancelHandel:function(){var e=this;this.$confirm("确定取消吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$router.push("/discount_coupon")}).catch(function(){})}}},g={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"add-form-wraper"},[s("el-form",{ref:"form",attrs:{model:e.addParamMesg,"label-width":"140px"}},[s("el-form-item",{attrs:{label:"活动类型",required:""}},[s("p",{staticStyle:{color:"#222","font-size":"16px","font-weight":"bold"}},[e._v(e._s(e.addParamMesg.triggerTypeName))])]),e._v(" "),s("el-form-item",{attrs:{label:"活动名称",required:""}},[s("el-input",{staticClass:"add-input",attrs:{size:"small",placeholder:"请输入活动名称",clearable:""},model:{value:e.addParamMesg.title,callback:function(t){e.$set(e.addParamMesg,"title",t)},expression:"addParamMesg.title"}}),e._v(" "),s("span",[e._v("活动名称,限制30个汉字")])],1),e._v(" "),s("el-form-item",{attrs:{label:"活动开始日期",required:""}},[s("el-date-picker",{staticClass:"add-input",attrs:{type:"date",placeholder:"请选择活动开始日期","picker-options":e.setDisableTime,size:"small"},model:{value:e.addParamMesg.beginTime,callback:function(t){e.$set(e.addParamMesg,"beginTime",t)},expression:"addParamMesg.beginTime"}}),e._v(" "),s("span",[e._v("活动开始日期")])],1),e._v(" "),s("el-form-item",{attrs:{label:"活动结束日期",required:""}},[s("el-date-picker",{staticClass:"add-input",attrs:{type:"date",placeholder:"请选择活动结束日期","picker-options":e.setDisableTime,size:"small"},model:{value:e.addParamMesg.endTime,callback:function(t){e.$set(e.addParamMesg,"endTime",t)},expression:"addParamMesg.endTime"}}),e._v(" "),s("span",[e._v("活动结束日期")])],1),e._v(" "),s("el-form-item",{attrs:{label:"设置条件"}},[s("el-checkbox",{model:{value:e.addParamMesg.newRegister,callback:function(t){e.$set(e.addParamMesg,"newRegister",t)},expression:"addParamMesg.newRegister"}},[e._v("新注册会员")])],1),e._v(" "),s("store-template",{on:{changeStore:e.changeStore}}),e._v(" "),s("prom-type-template",{attrs:{triggerType:e.addParamMesg.triggerType},on:{changePromType:e.changePromType}}),e._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary",size:"small",disabled:e.isDisabled},on:{click:e.doSaveHandel}},[e._v("保存")]),e._v(" "),s("el-button",{attrs:{size:"small"},on:{click:e.doCancelHandel}},[e._v("取消")])],1)],1)],1)])},staticRenderFns:[]},u=s("VU/8")(o,g,!1,null,null,null);t.default=u.exports}});
//# sourceMappingURL=156.c32964026205e9722586.js.map