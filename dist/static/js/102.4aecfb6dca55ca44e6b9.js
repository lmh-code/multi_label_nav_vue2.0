webpackJsonp([102],{"4LeH":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("Gu7T"),o=a.n(r),n=a("Dd8w"),s=a.n(n),l=a("ssT3"),i=a("bzuE"),c=a("8uth"),u=a("oAV5"),d=a("XfvZ"),p=a("pvT1"),h=a("32kd"),m="/plateform/a/order/store/summary",g="/plateform/a/order/store/export",f="/foundation/p/apply/leader/queryList",v="/newretail-shop/a/order/vendorlist",y={data:function(){return{pageSizes:i.a.pageSizes10,exportLoading:!1,loading:!1,pageNum:1,pageSize:10,total:0,searchContent:{DIFFCITY:!0,regionCode:l.a.get("regionCode")||"",storeLeaderId:"",storeGroupTypeNo:"",storeGroupNo:"",platformId:5,defaultRange:[],startPayTime:"",endPayTime:"",pickUpTime:u.u(Date.parse(new Date)+864e5),searchValue:"",storeNo:"",businessType:"",sfInStock:"",vendorCode:""},tableData:[],exportConfig:{cityName:"城市",storeNo:"门店编码",storeName:"门店名称",storeLeaderId:"团长店编号",virtualStoreName:"团长店名",userName:"团长姓名",goodsNo:"SKU编码",skuNo:"ERP编码",goodsName:"商品名称",spec:"商品规格",businessTypeStr:"销售类型",quantity:"销售量",amount:"销售额",completeQty:"已核销",refundQty:"已退",awaitQty:"待核销"},businessTypeOptions:[{label:"全部",value:""},{label:"预售",value:3},{label:"及时达",value:4},{label:"拼团",value:5},{label:"虚拟订单",value:6}],platformIdOptions:[{code:5,value:"本来鲜"},{code:6,value:"顺丰优选"}],storeGroupTypeNoOptions:[],defaultProps:{children:"storeGroupList",label:"labelName",value:"valueName"},storeLeaderOptions:[],totalSum:{},sfInStockOptions:[{label:"全部",value:""},{label:"是",value:!0},{label:"否",value:!1}],vendorList:[]}},created:function(){this.getVendorlist(),this.getStoreLeaderList();var e=l.a.get("searchContent");this.$route.meta.keepAlive&&e&&(this.pageNum=e.pageNum,this.searchContent=e.searchContent,l.a.remove("searchContent")),this.doSearchHandel()},components:{"date-picker-range":d.a,"store-group":p.a,"region-city-store":h.a},methods:{StoreGroupChange:function(e){this.searchContent.regionCode=e.regionCode,this.searchContent.cityId=e.cityId,this.searchContent.storeNo=e.storeNo,this.searchContent.storeGroupTypeNo=e.storeGroupTypeNoList[0],this.searchContent.storeGroupNo=e.storeGroupTypeNoList[1],this.doSearchHandel(!0)},emptyFormatter:function(e,t,a){return a||0==a?a:"--"},changeSize:function(e){this.pageSize=e,this.doSearchHandel()},changeCurrent:function(e){this.pageNum=e,this.doSearchHandel()},doSearchHandel:function(e){var t=this,a=this.searchContent.startPayTime?new Date(this.searchContent.startPayTime.replace(/-/g,"/")).getTime():0,r=this.searchContent.endPayTime?new Date(this.searchContent.endPayTime.replace(/-/g,"/")).getTime():0;this.searchContent.startPayTime&&this.searchContent.endPayTime&&!isNaN(a)&&!isNaN(r)&&a>r?this.$message("结束日期不能早于开始日期"):(this.loading=!0,!0===e&&(this.pageNum=1),this.$http.post(m,s()({},this.searchContent,{pageNum:this.pageNum,pageSize:this.pageSize})).then(function(e){if(t.loading=!1,0===e.code)return e.data&&e.data.result&&e.data.result.length?t.tableData=e.data.result:t.tableData=[],t.totalSum=s()({},e.data.summary),void(t.total=e.data.total);throw new Error(e.msg)}).catch(function(e){t.loading=!1,t.$notify.error({title:"提示",message:e.message})}))},exportData:function(){var e=this,t=this.searchContent.startPayTime?new Date(this.searchContent.startPayTime.replace(/-/g,"/")).getTime():0,a=this.searchContent.endPayTime?new Date(this.searchContent.endPayTime.replace(/-/g,"/")).getTime():0;this.searchContent.startPayTime&&this.searchContent.endPayTime&&!isNaN(t)&&!isNaN(a)&&t>a?this.$message("结束日期不能早于开始日期"):(this.exportLoading=!0,this.$http.post(g,s()({},this.searchContent)).then(function(t){if(e.exportLoading=!1,0!==t.code)throw new Error(t.msg);if(t.data&&t.data.length){var a=t.data,r=u.o(e.exportConfig,!1),o=u.o(e.exportConfig,!0);c.a.ExportJsonToExcel({header:r,filterVal:o,data:a,filename:u.u(Date.parse(new Date))+"_门店商品汇总"}),setTimeout(function(){e.$message.success("导出成功")},500)}else e.$notify.warning({title:"温馨提示",message:"没有查询到要导出的数据"})}).catch(function(t){e.exportLoading=!1,e.$notify.error({title:"提示",message:t.message})}))},summarizeQtyHeader:function(){var e=this.$createElement;return e("el-popover",{attrs:{placement:"top-start",width:"260",trigger:"hover",content:"说明：已订货为昨晚线上汇总提交的订货数量，正常等于销售量，如果为0则为异常，提交订货失败。"}},[e("span",{slot:"reference"},["已订货",e("i",{class:"el-icon-question"})])])},receiveQtyHeader:function(){var e=this.$createElement;return e("el-popover",{attrs:{placement:"top-start",width:"260",trigger:"hover",content:"说明：已收货为开始提货日期当日门店线上线下收货总数量，已转化成线上份数；正常应该大于销售量，小于则异常，缺量导致订单无法正常履约。"}},[e("span",{slot:"reference"},["已收货",e("i",{class:"el-icon-question"})])])},sortChange:function(e){var t="";if("ascending"===e.order?t="asc":"descending"===e.order&&(t="desc"),e.prop&&t){var a=e.prop+" "+t;this.searchContent.orderBy=a,this.doSearchHandel(!0)}},goSearchRes:function(e,t){var a={from:"storeSum",pageNum:this.pageNum,searchContent:this.searchContent};l.a.set("searchContent",a);var r="/search_result?from=storeSum&searchType="+t+"&searchValue="+e.goodsNo+"&storeNo="+e.storeNo;e.storeLeaderId&&(r=r+"&storeLeaderId="+e.storeLeaderId),this.$router.push(r)},getStoreLeaderList:function(){var e=this;this.$http.post(f,{pageNum:1,pageSize:-1,DIFFCITY:!0}).then(function(t){if(0!==t.code)throw new Error(t.msg);var a=t.data&&t.data.result&&t.data.result.length?t.data.result:[];e.storeLeaderOptions=a.filter(function(e){return 2===e.applyStatus&&0===e.userStatus}).map(function(e){return{id:e.id,applyStatus:e.applyStatus,virtualStoreName:e.virtualStoreName,userName:e.userName,actualStoreNo:e.actualStoreNo,value:e.id,label:e.id+"_"+e.virtualStoreName+"_"+e.userName}})}).catch(function(e){console.log("提示(获取所属团长店信息):",e.message)})},datePickerRangeChange:function(e){this.searchContent.defaultRange=e?[].concat(o()(e)):e,this.searchContent.startPayTime=e?e[0]:"",this.searchContent.endPayTime=e?e[1]:"",this.doSearchHandel(!0)},getSummaries:function(e){var t=this,a=[],r=[];return e.columns.forEach(function(e){t.totalSum[e.property]||0===t.totalSum[e.property]?r.push(t.totalSum[e.property]):r.push("")}),(a=r)[0]="合计",a},getVendorlist:function(){var e=this;this.$http.post(v,{regionCode:this.searchContent.regionCode,DIFFCITY:this.searchContent.DIFFCITY}).then(function(t){if(0!==t.code)throw new Error(t.msg);e.vendorList=t.data&&t.data.length?[{vendorNo:"",vendorName:"全部"}].concat(o()(t.data)):[]}).catch(function(e){console.log("获取供应商编码及名称（编码[vendorCode]，名称[vendorName]）报错：",e.message)})}}},C={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"search-form-wraper"},[a("el-form",{attrs:{model:e.searchContent,"label-position":"top"}},[a("region-city-store",{on:{StoreGroupChange:e.StoreGroupChange}}),e._v(" "),a("el-form-item",{attrs:{label:"订单来源"}},[a("el-select",{staticClass:"search-input",attrs:{placeholder:"请选择订单来源",size:"small"},on:{change:function(t){return e.doSearchHandel(!0)}},model:{value:e.searchContent.platformId,callback:function(t){e.$set(e.searchContent,"platformId",t)},expression:"searchContent.platformId"}},e._l(e.platformIdOptions,function(e){return a("el-option",{key:e.code,attrs:{label:e.value,value:e.code}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"所属团长店"}},[a("el-select",{staticClass:"search-input",attrs:{filterable:"",placeholder:"请选择所属团长店",clearable:"",size:"small"},on:{change:function(t){return e.doSearchHandel(!0)}},model:{value:e.searchContent.storeLeaderId,callback:function(t){e.$set(e.searchContent,"storeLeaderId",t)},expression:"searchContent.storeLeaderId"}},e._l(e.storeLeaderOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"业务类型"}},[a("el-select",{staticClass:"search-input",attrs:{placeholder:"请选择销业务类型",size:"small"},on:{change:function(t){return e.doSearchHandel(!0)}},model:{value:e.searchContent.businessType,callback:function(t){e.$set(e.searchContent,"businessType",t)},expression:"searchContent.businessType"}},e._l(e.businessTypeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"下单时间"}},[a("date-picker-range",{attrs:{defaultRange:e.searchContent.defaultRange},on:{datePickerRangeChange:e.datePickerRangeChange}})],1),e._v(" "),a("el-form-item",{attrs:{label:"开始提货日期"}},[a("el-date-picker",{staticClass:"search-input",attrs:{type:"date",placeholder:"请选择下单结束时间",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",size:"small"},on:{change:function(t){return e.doSearchHandel(!0)}},model:{value:e.searchContent.pickUpTime,callback:function(t){e.$set(e.searchContent,"pickUpTime",t)},expression:"searchContent.pickUpTime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"SKU编码/商品名称"}},[a("el-input",{staticClass:"search-input",attrs:{placeholder:"SKU编码/商品名称",size:"small",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.doSearchHandel(!0)}},model:{value:e.searchContent.searchValue,callback:function(t){e.$set(e.searchContent,"searchValue","string"==typeof t?t.trim():t)},expression:"searchContent.searchValue"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"是否顺丰仓现货"}},[a("el-select",{staticClass:"search-input",attrs:{filterable:"",placeholder:"请选择状态",size:"small",clearable:""},on:{change:function(t){return e.doSearchHandel(!0)}},model:{value:e.searchContent.sfInStock,callback:function(t){e.$set(e.searchContent,"sfInStock",t)},expression:"searchContent.sfInStock"}},e._l(e.sfInStockOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"供应商专供"}},[a("el-select",{staticClass:"search-input",attrs:{filterable:"",placeholder:"供应商专供",size:"small",clearable:""},on:{change:function(t){return e.doSearchHandel(!0)}},model:{value:e.searchContent.vendorCode,callback:function(t){e.$set(e.searchContent,"vendorCode",t)},expression:"searchContent.vendorCode"}},e._l(e.vendorList,function(e){return a("el-option",{key:e.vendorNo,attrs:{label:e.vendorName,value:e.vendorNo}})}),1)],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.doSearchHandel(!0)}}},[e._v("搜索")]),e._v(" "),a("el-button",{attrs:{size:"mini",loading:e.exportLoading},on:{click:e.exportData}},[e._v("导出")])],1)],1)],1),e._v(" "),a("div",{staticClass:"table-wraper"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"fixed-height",staticStyle:{width:"100%"},attrs:{data:e.tableData,"empty-text":"没有查询到您想要的数据",size:"small","show-summary":"","summary-method":e.getSummaries},on:{"sort-change":e.sortChange}},[a("el-table-column",{attrs:{"min-width":"80px",prop:"cityName",label:"城市"}}),e._v(" "),a("el-table-column",{attrs:{label:"门店","min-width":"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("p",[e._v(e._s(t.row.storeName))]),e._v(" "),a("p",{staticClass:"erp-p-no"},[e._v("ERP编码："+e._s(t.row.storeNo))])])]}}])}),e._v(" "),a("el-table-column",{attrs:{"min-width":"130px",label:"所属团长店"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.storeLeaderId?a("p",[e._v(e._s(t.row.storeLeaderId)+"_"+e._s(t.row.virtualStoreName)+"_"+e._s(t.row.userName))]):a("p",[e._v("-")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"商品信息","min-width":"236px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"p-m-w"},[a("div",{staticClass:"img-w"},[t.row.imgUrl&&""!=t.row.imgUrl?a("img",{attrs:{src:t.row.imgUrl,alt:"",onerror:"onerror=null;src='/shop/static/img_error.png'"}}):a("img",{attrs:{src:"/shop/static/img_error.png",alt:""}})]),e._v(" "),a("div",{staticClass:"p-m-c-r"},[a("div",[e._v(e._s(t.row.goodsName))]),e._v(" "),a("div",{staticClass:"erp-p-no"},[e._v("SKU编码："+e._s(t.row.goodsNo||"--"))]),e._v(" "),t.row.vendorName?a("el-tag",{attrs:{type:"warning",size:"mini"}},[e._v(e._s(t.row.vendorName))]):e._e()],1)])]}}])}),e._v(" "),a("el-table-column",{attrs:{"min-width":"120px",prop:"spec",label:"规格"}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"120px",prop:"businessTypeStr",label:"业务类型",formatter:e.emptyFormatter}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"90px",label:"销售量",prop:"quantity",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"order-id",on:{click:function(a){return e.goSearchRes(t.row,"QUANTITY")}}},[e._v("\n            "+e._s(t.row.quantity)+"\n          ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{"min-width":"120px",prop:"amount",label:"销售额"}}),e._v(" "),5!==e.searchContent.platformId?a("el-table-column",{attrs:{"min-width":"90px",prop:"summarizeQty",formatter:e.emptyFormatter,"render-header":e.summarizeQtyHeader}}):e._e(),e._v(" "),5!==e.searchContent.platformId?a("el-table-column",{attrs:{"min-width":"90px",prop:"receiveQty",formatter:e.emptyFormatter,"render-header":e.receiveQtyHeader}}):e._e(),e._v(" "),a("el-table-column",{attrs:{"min-width":"90px",label:"已核销",prop:"completeQty",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"order-id",on:{click:function(a){return e.goSearchRes(t.row,"COMPLETEQTY")}}},[e._v("\n            "+e._s(t.row.completeQty)+"\n          ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{"min-width":"90px",label:"已退",prop:"refundQty",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"order-id",on:{click:function(a){return e.goSearchRes(t.row,"REFUNDQTY")}}},[e._v("\n            "+e._s(t.row.refundQty)+"\n          ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{"min-width":"90px",label:"待核销",prop:"awaitQty",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"order-id",on:{click:function(a){return e.goSearchRes(t.row,"AWAITQTY")}}},[e._v("\n            "+e._s(t.row.awaitQty)+"\n          ")])]}}])})],1),e._v(" "),e.tableData.length>0?a("el-pagination",{staticClass:"tc mt20",attrs:{background:"","current-page":e.pageNum,"page-sizes":e.pageSizes,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.changeSize,"current-change":e.changeCurrent,"update:currentPage":function(t){e.pageNum=t},"update:current-page":function(t){e.pageNum=t}}}):e._e()],1)])},staticRenderFns:[]};var b=a("VU/8")(y,C,!1,function(e){a("eyb8")},null,null);t.default=b.exports},eyb8:function(e,t){}});
//# sourceMappingURL=102.4aecfb6dca55ca44e6b9.js.map