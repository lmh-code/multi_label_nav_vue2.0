webpackJsonp([96],{ZTxe:function(e,a){},bnWS:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=t("Dd8w"),s=t.n(i),r=(t("ssT3"),t("u4Bf")),o=t.n(r),d=t("oAV5"),l=t("cpGA"),n="/foundation/qiniu/auth/file",m="/plateform/a/platformCityGoods/presale/showDetail",g="/plateform/a/platformCityGoods/presale/save",p={data:function(){return{imageUploadLoading:!1,isDisabled:!1,addParamMesg:{DIFFCITY:!0,goodsId:"",goodsName:"",price:"",saleType:4,platformId:5,spec:"",bigImageUrl:"",regionCode:"",regionName:"",cityGoodsImgReqs:[],vendorType:""},goodsQueryVal:"",queryGoodsAsyncLoading:!1,queryGoodsSearchAsyncList:[],imageListArr:[{imgType:22,imgUrl:"",sortNum:""}],detailImageUploadLoading:!1,currentUpFileIdx:-1,vendorTypeOptions:[{label:"是",value:1},{label:"否",value:2}]}},components:{draggable:o.a},created:function(){var e=this.$route.params.pcgId;this.getDetailMesg(e)},methods:{getDetailMesg:function(e){var a=this,t=e;d.r(),this.$http.post(m,{platformCityGoodsId:t,DIFFCITY:!0}).then(function(e){if(d.c(),0!==e.code)throw new Error(e.msg);if(e.data){a.addParamMesg.platformCityGoodsId=e.data.platformCityGoodsId,a.addParamMesg.goodsId=e.data.goodsId,a.addParamMesg.goodsName=e.data.goodsName,a.addParamMesg.goodsNametemp=e.data.goodsNo+"-"+e.data.skuName+"-"+e.data.spec,a.addParamMesg.price=e.data.price,a.addParamMesg.spec=e.data.spec,a.addParamMesg.bigImageUrl=e.data.bigImageUrl||"",a.addParamMesg.regionCode=e.data.regionCode||"",a.addParamMesg.regionName=e.data.regionName||"",a.addParamMesg.vendorType=e.data.vendorType||2,a.imageListArr=e.data.cityGoodsImgVos||[];a.imageListArr.push({imgType:22,imgUrl:"",sortNum:""})}}).catch(function(e){d.c(),a.$notify.error({title:"提示",message:e.message})})},doSaveHandel:function(){var e=this;""!==this.addParamMesg.goodsId&&""!==this.addParamMesg.goodsName?""!==this.addParamMesg.goodsName?this.addParamMesg.goodsName.length>30?this.$message("商品名称,限制30个汉字"):""!=this.addParamMesg.price?/((^[1-9]\d*)|^0)(\.\d{0,2}){0,1}$/.test(this.addParamMesg.price)?(this.addParamMesg.cityGoodsImgReqs=this.imageListArr.filter(function(e){return e.imgUrl}),this.isDisabled=!0,this.$http.post(g,s()({},this.addParamMesg)).then(function(a){if(setTimeout(function(){e.isDisabled=!1},800),0!==a.code)throw new Error(a.msg);e.$router.push("/timely_goods")}).catch(function(a){e.isDisabled=!1,e.$notify.error({title:"提示",message:a.message})})):this.$message("售价是大于0，小数保留小数点后2位"):this.$message("请输入售价"):this.$message("请输入商品名称"):this.$message("请选择商品")},doCancelHandel:function(){this.$router.push("/timely_goods")},getToken:function(){var e=this;return this.$http.post(n,{}).then(function(e){if(0==e.code){var a=e.data.token;return{fileName:e.data.key,token:a}}throw new Error(e.msg)}).catch(function(a){e.imageUploadLoading=!1,e.$notify.error({title:"获取七牛token提示",message:a.message})})},imageUploadReg:function(e){var a=-1!==e.type.indexOf("image/"),t="image/jpeg"===e.type||"image/png",i=e.size<=307200;return a&&t&&i||this.$message.error("商品大图建议上传大小不超过300K的710*420像素的jpg或png图片"),a&&t&&i},emitUpload:function(e){var a=this;this.imageUploadLoading=!0,this.getToken().then(function(t){l.upload(e.file,t.fileName,t.token).subscribe({error:function(){a.imageUploadLoading=!1},complete:function(e){var t="http://retailimg01.benlailife.com/"+e.key;a.imageUploadLoading=!1,a.addParamMesg.bigImageUrl=t},next:function(e){}})})},setItemIdx:function(e){this.detailImageUploadLoading||(this.currentUpFileIdx=e)},deleteUpFile:function(e){this.imageListArr=this.imageListArr.filter(function(a,t){return t!=e})},datadragEnd:function(e){this.imageListArr.forEach(function(e,a){e.sortNum=a+1}),this.imageListArr=this.imageListArr.filter(function(e){return""!=e.imgUrl});this.imageListArr.push({imgType:22,imgUrl:"",sortNum:""})},imageUploadRegForMore:function(e){var a=-1!==e.type.indexOf("image/"),t="image/jpeg"===e.type||"image/png",i=e.size<=1048576;return a&&t&&i?a&&t&&i:(this.$message.error("建议上传宽度为750像素的jpg或png图片，大小不能超过1M，最多可上传6张"),!1)},emitUploadForMore:function(e){var a=this;this.imageListArr.length>6&&-1!=this.currentUpFileIdx?this.$message.error("商品检测报告，最多可添加6张"):(this.detailImageUploadLoading=!0,this.getToken().then(function(t){l.upload(e.file,t.fileName,t.token).subscribe({error:function(){a.detailImageUploadLoading=!1},complete:function(e){var t="http://retailimg01.benlailife.com/"+e.key;if(a.detailImageUploadLoading=!1,a.setImgUrl(a.currentUpFileIdx,t),-1!=a.currentUpFileIdx){var i={};a.imageListArr.push({imgType:22,imgUrl:"",sortNum:""}),a.imageListArr=a.imageListArr.reduceRight(function(e,a){return!i[a.imgUrl]&&(i[a.imgUrl]=e.push(a)),e},[]),a.imageListArr.reverse()}},next:function(e){}})}))},setImgUrl:function(e,a){var t=this,i=a,s=e;this.imageListArr.forEach(function(e,a){a===s&&(t.imageListArr[a].imgUrl=i,t.imageListArr[a].sortNum=parseInt(s)+1)})}},beforeRouteLeave:function(e,a,t){e.meta.keepAlive=!0,t()}},c={render:function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"add-form-wraper"},[t("el-form",{ref:"form",attrs:{model:e.addParamMesg,"label-width":"160px"}},[t("el-form-item",{attrs:{label:"选择区域",required:""}},[t("el-input",{staticClass:"add-input",attrs:{size:"small",disabled:""},model:{value:e.addParamMesg.regionName,callback:function(a){e.$set(e.addParamMesg,"regionName",a)},expression:"addParamMesg.regionName"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"是否为供应商专供"}},[t("el-select",{staticClass:"add-input",attrs:{filterable:"",disabled:"",placeholder:"是否为供应商专供",size:"small"},model:{value:e.addParamMesg.vendorType,callback:function(a){e.$set(e.addParamMesg,"vendorType",a)},expression:"addParamMesg.vendorType"}},e._l(e.vendorTypeOptions,function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),t("el-form-item",{attrs:{label:"选择商品",required:""}},[t("el-input",{staticClass:"add-input",attrs:{size:"small",disabled:""},model:{value:e.addParamMesg.goodsNametemp,callback:function(a){e.$set(e.addParamMesg,"goodsNametemp",a)},expression:"addParamMesg.goodsNametemp"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"商品名称",required:""}},[t("el-input",{staticClass:"add-input",attrs:{size:"small",placeholder:"请输入商品名称"},model:{value:e.addParamMesg.goodsName,callback:function(a){e.$set(e.addParamMesg,"goodsName",a)},expression:"addParamMesg.goodsName"}}),e._v(" "),t("span",[e._v("商品名称,限制30个汉字")])],1),e._v(" "),t("el-form-item",{attrs:{label:"规格"}},[t("el-input",{staticClass:"add-input",attrs:{size:"small",disabled:""},model:{value:e.addParamMesg.spec,callback:function(a){e.$set(e.addParamMesg,"spec",a)},expression:"addParamMesg.spec"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"区域售价",required:""}},[t("el-input",{staticClass:"add-input",attrs:{size:"small",placeholder:"请输入区域售价",disabled:""},model:{value:e.addParamMesg.price,callback:function(a){e.$set(e.addParamMesg,"price",a)},expression:"addParamMesg.price"}},[t("el-button",{attrs:{slot:"append"},slot:"append"},[e._v("元")])],1),e._v(" "),t("span",[e._v("区域售价仅为初始售价，不可修改，商品售价以门店售价为准")])],1),e._v(" "),t("el-form-item",{attrs:{label:"商品大图"}},[t("el-upload",{staticClass:"add-sf-goods-img",attrs:{action:"","show-file-list":!1,"before-upload":e.imageUploadReg,"http-request":e.emitUpload}},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.imageUploadLoading,expression:"imageUploadLoading"}]},[e.addParamMesg.bigImageUrl?t("img",{staticClass:"add-avatar-sf-goods",attrs:{src:e.addParamMesg.bigImageUrl}}):t("i",{staticClass:"el-icon-plus add-sf-goods-icon"})])]),e._v(" "),t("span",[e._v("建议上传大小不超过300K的710*420像素的jpg或png图片")])],1),e._v(" "),t("el-form-item",{attrs:{label:"商品检测报告"}},[t("div",[t("draggable",{on:{update:e.datadragEnd},model:{value:e.imageListArr,callback:function(a){e.imageListArr=a},expression:"imageListArr"}},[t("transition-group",e._l(e.imageListArr,function(a,i){return t("div",{key:a.imgUrl,staticClass:"mh-up-w",on:{click:function(a){return e.setItemIdx(i)}}},[t("el-upload",{staticClass:"avatar-uploader",attrs:{action:"","show-file-list":!1,"before-upload":e.imageUploadRegForMore,"http-request":e.emitUploadForMore}},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.detailImageUploadLoading&&e.currentUpFileIdx==i,expression:"detailImageUploadLoading && currentUpFileIdx == idx"}]},[a.imgUrl?t("img",{staticClass:"avatar",attrs:{src:a.imgUrl}}):t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])]),e._v(" "),a.imgUrl&&""!=a.imgUrl?t("div",{staticClass:"mh-up-h-w"},[t("span",{staticClass:"up-h-i",on:{click:function(a){return e.deleteUpFile(i)}}},[t("i",{staticClass:"el-icon-delete"})]),e._v(" "),t("span",{staticClass:"up-h-i"},[t("i",{staticClass:"el-icon-rank"})])]):e._e()],1)}),0)],1),e._v(" "),t("div",{staticClass:"tip-txt-w"},[t("span",[e._v("建议上传宽度为750像素的jpg或png图片，大小不能超过1M，最多可上传6张")])])],1)]),e._v(" "),t("hr",{staticClass:"s-slip-tb"}),e._v(" "),t("el-form-item",[t("el-button",{attrs:{type:"primary",size:"small",disabled:e.isDisabled,icon:e.isDisabled?"el-icon-loading":""},on:{click:e.doSaveHandel}},[e._v("保存")]),e._v(" "),t("el-button",{attrs:{size:"small"},on:{click:e.doCancelHandel}},[e._v("取消")])],1)],1)],1)},staticRenderFns:[]};var u=t("VU/8")(p,c,!1,function(e){t("ZTxe")},null,null);a.default=u.exports}});
//# sourceMappingURL=96.f67585cf11babfd0fd01.js.map