webpackJsonp([78],{"9u+d":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("Dd8w"),a=i.n(s),o=i("mvHQ"),r=i.n(o),l=i("BO1k"),c=i.n(l),d=i("Gu7T"),n=i.n(d),u=i("oAV5"),m=i("ssT3"),h=i("hR2Z"),v=i("yi9+"),p=i("ylbZ"),f="/plateform/a/activityRule/add",y={data:function(){return{pickerOptions:{disabledDate:function(e){return e.getTime()<Date.now()-864e5}},isDisabled:!1,addParamMesg:{DIFFCITY:!0,platformId:5,regionCode:m.a.get("regionCode")||"",activityType:"",activityTypeName:"",activityName:"",activityStartDate:"",activityEndDate:"",activityCode:"",activityStoreList:[],platCityGoodsInfos:[],deliveryType:0,pickSelf:0},activityStoresCheckedList:[],activityGoodsCheckedList:[],checkedList:[],discount:"",canDelivery:!0,deliveryTypeTemp:1,canPickSelf:!1}},created:function(){var e=this.$route.params.activityType;11==e?(this.addParamMesg.activityType=e,this.addParamMesg.activityTypeName="拼团"):21==e&&(this.addParamMesg.activityType=e,this.addParamMesg.activityTypeName="秒杀")},mounted:function(){},components:{"choose-store":h.a,"choose-goods":v.a,region:p.a},methods:{chooseStoreOpen:function(){var e={title:"选择门店",platformId:this.addParamMesg.platformId,regionCode:this.addParamMesg.regionCode,checkedList:this.activityStoresCheckedList};this.$refs.chooseStore.setDefault(e)},chooseGoodsOpen:function(){var e={title:"选择商品",regionCode:this.addParamMesg.regionCode,checkedList:this.activityGoodsCheckedList,searchSupplierGoods:0};this.$refs.chooseGoods.setDefault(e)},handleSelect:function(e,t){var i={},s=[];if(u.m(t.platformCityGoodsId,"platformCityGoodsId",this.checkedList))this.checkedList=u.q("platformCityGoodsId",t.platformCityGoodsId,this.checkedList);else{s.push(t);var a=[].concat(s,n()(this.checkedList));this.checkedList=a.reduceRight(function(e,t){return!i[t.platformCityGoodsId]&&(i[t.platformCityGoodsId]=e.push(t)),e},[])}},handleSelectAll:function(e){var t={};if(e.length>0){var i=!0,s=!1,a=void 0;try{for(var o,r=c()(e);!(i=(o=r.next()).done);i=!0){var l=o.value;this.checkedList.push(l)}}catch(e){s=!0,a=e}finally{try{!i&&r.return&&r.return()}finally{if(s)throw a}}this.checkedList=this.checkedList.reduceRight(function(e,i){return!t[i.platformCityGoodsId]&&(t[i.platformCityGoodsId]=e.push(i)),e},[])}else{var d=[],n=!0,m=!1,h=void 0;try{for(var v,p=c()(this.activityGoodsCheckedList);!(n=(v=p.next()).done);n=!0){var f=v.value;d.push(f)}}catch(e){m=!0,h=e}finally{try{!n&&p.return&&p.return()}finally{if(m)throw h}}var y=u.i(this.checkedList,d,"platformCityGoodsId");this.checkedList=y&&y.length>0?y:[]}},confirmChooseStore:function(e){var t=[];t=e.checkedList&&e.checkedList.length?e.checkedList:[],this.activityStoresCheckedList=t},confirmChooseGoods:function(e){var t=[];t=e.checkedList&&e.checkedList.length?e.checkedList:[],this.activityGoodsCheckedList=t},deleteStoreItem:function(e){var t=e.erpStoreNo;this.activityStoresCheckedList=this.activityStoresCheckedList.filter(function(e){return e.erpStoreNo!==t})},deleteGoodsItem:function(e){var t=e.platformCityGoodsId;this.activityGoodsCheckedList=this.activityGoodsCheckedList.filter(function(e){return e.platformCityGoodsId!==t})},setDiscountBatch:function(){if(this.discount)if(/^[1-9]*[1-9][0-9]*$/.test(this.discount))if(0!==this.checkedList.length){var e=JSON.parse(r()(this.activityGoodsCheckedList)),t=!0,i=!1,s=void 0;try{for(var a,o=c()(e);!(t=(a=o.next()).done);t=!0){var l=a.value,d=!0,n=!1,u=void 0;try{for(var m,h=c()(this.checkedList);!(d=(m=h.next()).done);d=!0){var v=m.value;l.platformCityGoodsId===v.platformCityGoodsId&&(l.groupPrice=(parseFloat(this.discount)*parseFloat(l.price)/100).toFixed(2))}}catch(e){n=!0,u=e}finally{try{!d&&h.return&&h.return()}finally{if(n)throw u}}}}catch(e){i=!0,s=e}finally{try{!t&&o.return&&o.return()}finally{if(i)throw s}}this.activityGoodsCheckedList=e,this.checkedList=[]}else this.$message("请选择商品");else this.$message("拼团价折扣为(0-100整数)");else this.$message("请输入拼团价折扣")},doSaveHandel:function(){var e=this,t=/^[1-9]*[1-9][0-9]*$/,i=/((^[1-9]\d*)|^0)(\.\d{0,2}){0,1}$/;if(this.addParamMesg.activityName)if(this.addParamMesg.activityName.length>30)this.$message("活动名称限制30个汉字");else if(this.addParamMesg.activityStartDate)if(this.addParamMesg.activityEndDate){var s=Date.parse(new Date(this.addParamMesg.activityStartDate)),o=Date.parse(new Date(this.addParamMesg.activityEndDate));if(s<(new Date).getTime())this.$message("活动开始时间不能早于当前时间");else if(s>o)this.$message("活动结束时间不能早于开始时间");else if(this.canDelivery?this.addParamMesg.deliveryType=parseInt(this.deliveryTypeTemp):this.addParamMesg.deliveryType=0,this.canPickSelf?this.addParamMesg.pickSelf=1:this.addParamMesg.pickSelf=0,this.canPickSelf||this.canDelivery){if(this.addParamMesg.activityStoreList=[],this.activityStoresCheckedList&&this.activityStoresCheckedList.length){var r=!0,l=!1,d=void 0;try{for(var n,u=c()(this.activityStoresCheckedList);!(r=(n=u.next()).done);r=!0){var m=n.value;this.addParamMesg.activityStoreList.push(m.erpStoreNo)}}catch(e){l=!0,d=e}finally{try{!r&&u.return&&u.return()}finally{if(l)throw d}}}if(0!==this.addParamMesg.activityStoreList.length){if(this.activityGoodsCheckedList&&this.activityGoodsCheckedList.length){var h=!0,v=!1,p=void 0;try{for(var y,g=c()(this.activityGoodsCheckedList);!(h=(y=g.next()).done);h=!0){var k=y.value;if(!k.activityGoodsName)return void this.$message("请输入("+k.goodsName+")的活动商品名称");if(k.activityGoodsName.length>30)return void this.$message("请输入("+k.goodsName+")的活动商品名称限制30个汉字");if(!k.groupPrice)return void this.$message("请输入("+k.goodsName+")的拼团价");if(!i.test(k.groupPrice))return void this.$message("("+k.goodsName+")的拼团价是大于0，小数保留小数点后2位");if("0.00"==parseFloat(k.groupPrice))return void this.$message("("+k.goodsName+")的拼团价是大于0，小数保留小数点后2位");if(parseFloat(k.groupPrice)>k.price)return void this.$message("("+k.goodsName+")的拼团价必须小于或等于零售价");if(!k.groupCount)return void this.$message("请输入("+k.goodsName+")的成团人数");if(!t.test(k.groupCount))return void this.$message("("+k.goodsName+")的成团人数为大于零的正整数");if(k.limitGoodsCount&&!t.test(k.limitGoodsCount))return void this.$message("("+k.goodsName+")的限购数量为大于零的正整数");if(!k.curStock)return void this.$message("请输入("+k.goodsName+")的拼团库存");if(!t.test(k.curStock))return void this.$message("("+k.goodsName+")的拼团库存为大于零的正整数");if(!k.activityTimes)return void this.$message("请输入("+k.goodsName+")的成团时长");if(!t.test(k.activityTimes))return void this.$message("("+k.goodsName+")的成团时长为大于零的正整数");if(!k.sortNum)return void this.$message("请输入("+k.goodsName+")的排序权重");if(!t.test(k.sortNum))return void this.$message("("+k.goodsName+")的排序权重为1—100正整数");if(k.sortNum<1||k.sortNum>100)return void this.$message("("+k.goodsName+")的排序权重为1—100正整数");k.activityStartDate=this.addParamMesg.activityStartDate,k.activityEndDate=this.addParamMesg.activityEndDate}}catch(e){v=!0,p=e}finally{try{!h&&g.return&&g.return()}finally{if(v)throw p}}this.addParamMesg.platCityGoodsInfos=this.activityGoodsCheckedList}0!==this.addParamMesg.platCityGoodsInfos.length?(this.isDisabled=!0,this.$http.post(f,a()({},this.addParamMesg)).then(function(t){if(setTimeout(function(){e.isDisabled=!1},800),0===t.code)return e.$message.success("保存成功"),void e.$router.push("/store_act");throw new Error(t.msg)}).catch(function(t){e.isDisabled=!1,e.$notify.error({title:"提示",message:t.message})})):this.$message("请选择参与商品")}else this.$message("请选择参与门店")}else this.$message("请选择配送方式")}else this.$message("请输入活动结束时间");else this.$message("请输入活动开始时间");else this.$message("请输入活动名称")},doCancelHandel:function(){var e=this;this.$confirm("确定取消吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$router.push("/store_act")}).catch(function(){})}}},g={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"add-form-wraper"},[i("el-form",{ref:"form",attrs:{model:e.addParamMesg,"label-width":"140px"}},[i("el-form-item",{attrs:{label:"活动类型",required:""}},[i("p",{staticStyle:{color:"#222","font-size":"16px","font-weight":"bold"}},[e._v(e._s(e.addParamMesg.activityTypeName))])]),e._v(" "),i("region",{staticClass:"region-wrap",attrs:{className:"add-input",label:"选择区域",required:!0}}),e._v(" "),i("el-form-item",{attrs:{label:"活动名称",required:""}},[i("el-input",{staticClass:"add-input",attrs:{size:"small",placeholder:"请输入活动名称",clearable:""},model:{value:e.addParamMesg.activityName,callback:function(t){e.$set(e.addParamMesg,"activityName",t)},expression:"addParamMesg.activityName"}}),e._v(" "),i("span",[e._v("活动名称,限制30个汉字")])],1),e._v(" "),i("el-form-item",{attrs:{label:"开始时间",required:""}},[i("el-date-picker",{staticClass:"add-input",attrs:{type:"datetime",placeholder:"请选择活动开始时间",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",size:"small","picker-options":e.pickerOptions},model:{value:e.addParamMesg.activityStartDate,callback:function(t){e.$set(e.addParamMesg,"activityStartDate",t)},expression:"addParamMesg.activityStartDate"}}),e._v(" "),i("span",[e._v("活动开始时间")])],1),e._v(" "),i("el-form-item",{attrs:{label:"结束时间",required:""}},[i("el-date-picker",{staticClass:"add-input",attrs:{type:"datetime",placeholder:"请选择活动结束时间",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",size:"small","picker-options":e.pickerOptions},model:{value:e.addParamMesg.activityEndDate,callback:function(t){e.$set(e.addParamMesg,"activityEndDate",t)},expression:"addParamMesg.activityEndDate"}}),e._v(" "),i("span",[e._v("活动结束时间")])],1),e._v(" "),i("el-form-item",{attrs:{label:"配送方式",required:""}},[i("div",[i("el-checkbox",{model:{value:e.canDelivery,callback:function(t){e.canDelivery=t},expression:"canDelivery"}},[e._v("支持配送")]),e._v(" "),e.canDelivery?i("el-radio-group",{staticStyle:{"margin-left":"30px"},model:{value:e.deliveryTypeTemp,callback:function(t){e.deliveryTypeTemp=t},expression:"deliveryTypeTemp"}},[i("el-radio",{attrs:{label:1}},[e._v("支持外卖配送")]),e._v(" "),i("el-radio",{attrs:{label:2}},[e._v("支持快递配送")])],1):e._e()],1),e._v(" "),i("div",[i("el-checkbox",{model:{value:e.canPickSelf,callback:function(t){e.canPickSelf=t},expression:"canPickSelf"}},[e._v("支持自提")])],1)]),e._v(" "),i("el-form-item",{attrs:{label:"参与门店",required:""}},[i("el-button",{attrs:{size:"small",icon:"el-icon-plus"},on:{click:e.chooseStoreOpen}},[e._v("选择门店")]),e._v(" "),e.activityStoresCheckedList.length>0?i("div",{staticClass:"store-check-wraper"},[i("el-table",{staticClass:"fixed-height",attrs:{data:e.activityStoresCheckedList,"max-height":"300",size:"small"}},[i("el-table-column",{attrs:{"min-width":"220px",label:"门店编码/名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",[e._v("\n                  "+e._s(t.row.erpStoreNo)+"_"+e._s(t.row.erpStoreName)+"\n                ")])]}}],null,!1,3945522565)}),e._v(" "),i("el-table-column",{attrs:{"min-width":"80",prop:"cityName",label:"城市"}}),e._v(" "),i("el-table-column",{attrs:{"min-width":"80",prop:"saleTypeName",label:"门店类型"}}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-delete"},on:{click:function(i){return e.deleteStoreItem(t.row)}}},[e._v("删除")])]}}],null,!1,3121094832)})],1)],1):e._e()],1),e._v(" "),i("el-form-item",{attrs:{label:"参与商品",required:""}},[i("el-button",{attrs:{size:"small",icon:"el-icon-plus"},on:{click:e.chooseGoodsOpen}},[e._v("选择商品")]),e._v(" "),e.activityGoodsCheckedList.length>0?i("div",[i("el-input",{staticClass:"add-input",attrs:{placeholder:"拼团价折扣(0-100整数)",size:"small"},model:{value:e.discount,callback:function(t){e.discount=t},expression:"discount"}},[i("el-button",{attrs:{slot:"append"},on:{click:e.setDiscountBatch},slot:"append"},[e._v("确定")])],1),e._v(" "),i("el-table",{staticClass:"fixed-height",staticStyle:{width:"100%"},attrs:{data:e.activityGoodsCheckedList,"empty-text":"暂无选中任何商品","max-height":"400",size:"small"},on:{select:e.handleSelect,"select-all":e.handleSelectAll}},[i("el-table-column",{attrs:{type:"selection"}}),e._v(" "),i("el-table-column",{attrs:{"min-width":"220px",label:"商品信息"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticClass:"ll-p-m-w"},[i("div",{staticClass:"ll-img-w"},[t.row.imgUrl&&""!=t.row.imgUrl?i("img",{attrs:{src:t.row.imgUrl,alt:"",onerror:"onerror=null;src='/shop/static/img_error.png'"}}):i("img",{attrs:{src:"/shop/static/img_error.png",alt:""}})]),e._v(" "),i("div",{staticClass:"ll-p-m-c-r"},[i("div",[e._v("\n                      "+e._s(t.row.goodsName||"-")+"\n                    ")]),e._v(" "),i("div",{staticClass:"ll-erp-p-no"},[e._v("SKU编码："+e._s(t.row.goodsNo||"--"))])])])]}}],null,!1,2385194324)}),e._v(" "),i("el-table-column",{attrs:{"min-width":"100px",prop:"spec",label:"规格"}}),e._v(" "),i("el-table-column",{attrs:{"min-width":"130px",label:"活动商品名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",[i("el-input",{attrs:{size:"small",placeholder:"输入名称"},model:{value:t.row.activityGoodsName,callback:function(i){e.$set(t.row,"activityGoodsName",i)},expression:"scope.row.activityGoodsName"}})],1)]}}],null,!1,1948656908)}),e._v(" "),i("el-table-column",{attrs:{"min-width":"110px",label:"拼团限制"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",[i("el-radio-group",{model:{value:t.row.limitGroupType,callback:function(i){e.$set(t.row,"limitGroupType",i)},expression:"scope.row.limitGroupType"}},[i("p",[i("el-radio",{attrs:{label:0}},[e._v("全部")])],1),e._v(" "),i("p",[i("el-radio",{attrs:{label:1}},[e._v("老用户")])],1),e._v(" "),i("p",[i("el-radio",{attrs:{label:2}},[e._v("新用户")])],1)])],1)]}}],null,!1,4186277037)}),e._v(" "),i("el-table-column",{attrs:{"min-width":"90px",prop:"price",label:"零售价"}}),e._v(" "),i("el-table-column",{attrs:{"min-width":"110px",label:"拼团价"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",[i("el-input",{attrs:{size:"small",placeholder:"输入价格"},model:{value:t.row.groupPrice,callback:function(i){e.$set(t.row,"groupPrice",i)},expression:"scope.row.groupPrice"}})],1)]}}],null,!1,3480013650)}),e._v(" "),i("el-table-column",{attrs:{"min-width":"110px",label:"成团人数"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",[i("el-input",{attrs:{size:"small",placeholder:"输入人数"},model:{value:t.row.groupCount,callback:function(i){e.$set(t.row,"groupCount",i)},expression:"scope.row.groupCount"}})],1)]}}],null,!1,115815069)}),e._v(" "),i("el-table-column",{attrs:{"min-width":"150px",label:"限购数量(为空不限)"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",[i("el-input",{attrs:{size:"small",placeholder:"输入限购数量"},model:{value:t.row.limitGoodsCount,callback:function(i){e.$set(t.row,"limitGoodsCount",i)},expression:"scope.row.limitGoodsCount"}})],1)]}}],null,!1,2837806319)}),e._v(" "),i("el-table-column",{attrs:{"min-width":"110px",label:"拼团库存"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",[i("el-input",{attrs:{size:"small",placeholder:"输入库存"},model:{value:t.row.curStock,callback:function(i){e.$set(t.row,"curStock",i)},expression:"scope.row.curStock"}})],1)]}}],null,!1,132284644)}),e._v(" "),i("el-table-column",{attrs:{"min-width":"120px",label:"成团时长(分钟)"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",[i("el-input",{attrs:{size:"small",placeholder:"输入时长"},model:{value:t.row.activityTimes,callback:function(i){e.$set(t.row,"activityTimes",i)},expression:"scope.row.activityTimes"}})],1)]}}],null,!1,1190612873)}),e._v(" "),i("el-table-column",{attrs:{"min-width":"110px",label:"排序权重"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",[i("el-input",{attrs:{size:"small",placeholder:"输入权重"},model:{value:t.row.sortNum,callback:function(i){e.$set(t.row,"sortNum",i)},expression:"scope.row.sortNum"}})],1)]}}],null,!1,154466409)}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"操作",fixed:"right",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-delete"},on:{click:function(i){return e.deleteGoodsItem(t.row)}}},[e._v("删除")])]}}],null,!1,588916319)})],1),e._v(" "),i("div",[i("span",{staticStyle:{color:"red"}},[e._v("*")]),e._v("注意：权重排序，先创建的活动商品在前；剩余的按前端规则走。\n          ")])],1):e._e()],1),e._v(" "),i("hr",{staticClass:"s-slip-tb"}),e._v(" "),i("el-form-item",[i("el-button",{attrs:{type:"primary",size:"small",disabled:e.isDisabled},on:{click:e.doSaveHandel}},[e._v("保存")]),e._v(" "),i("el-button",{attrs:{size:"small"},on:{click:e.doCancelHandel}},[e._v("取消")])],1)],1)],1),e._v(" "),i("choose-store",{ref:"chooseStore",on:{confirmChooseStore:e.confirmChooseStore}}),e._v(" "),i("choose-goods",{ref:"chooseGoods",on:{confirmChooseGoods:e.confirmChooseGoods}})],1)},staticRenderFns:[]};var k=i("VU/8")(y,g,!1,function(e){i("xjTa")},null,null);t.default=k.exports},xjTa:function(e,t){}});
//# sourceMappingURL=78.635f07afe591e11cf6bb.js.map