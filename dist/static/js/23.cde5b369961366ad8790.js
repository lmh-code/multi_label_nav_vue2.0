webpackJsonp([23],{"6VCf":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("ifoU"),i=a.n(s),r=a("BO1k"),o=a.n(r),l=a("d7EF"),n=a.n(l),d=a("//Fk"),c=a.n(d),u=a("Dd8w"),m=a.n(u),g=(a("ssT3"),a("6fmR")),p=a("u4Bf"),h=a.n(p),f=(a("oAV5"),a("cpGA")),v="/foundation/qiniu/auth/file",y="/foundation/store/userStoreCityList",b="/foundation/store/userStoreList",M="/foundation/businessConfig/listByCommonCodes",P="/foundation/category/list",_="/plateform/p/tv/template/update",C=/^[1-9]*[1-9][0-9]*$/,k={data:function(){return{isDisabled:!1,addParamMsg:{detailImageList:[],templateType:2,templateName:null,tip:null,interval:null,cityId:null,moduleType:0,enable:0,display:0,storeNo:null},moduleGoodsReqList:[{categoryNos:[],categoryNamesStr:"",goodsTypes:[],showMemberPriceB:!0},{categoryNos:[],categoryNamesStr:"",goodsTypes:[],showMemberPriceB:!0},{categoryNos:[],categoryNamesStr:"",goodsTypes:[],showMemberPriceB:!0}],templateTypeOptions:[{label:"区域模板",value:1},{label:"门店模板",value:2}],enableOptions:[{label:"启用",value:0},{label:"禁用",value:1}],moduleTypeOptions:[{label:"商品模块",value:0},{label:"图片模块",value:1}],displayOptions:[{label:"横屏显示",value:0}],goodsTypeOptions:[],cityOptions:[{label:"商品模块",value:0},{label:"图片模块",value:1}],storeOptions:[],showModel:!1,categoryList:[],imageListArr:[{imgUrl:"",sortNum:""}],imageUploadLoading:!1,currentUpFileIdx:-1}},created:function(){this.getGoodsType(),this.getCityList(),this.getCategoryList()},components:{"goods-cat-dialog":g.a,draggable:h.a},methods:{getCategoryList:function(){var e=this;this.$http.get(P).then(function(t){if(0!==t.code)throw new Error(t.msg);e.categoryList=t.data&&t.data.length?t.data:[]}).catch(function(e){console.log("提示【获取区域列表】：",e.message)})},getGoodsType:function(){var e=this;this.$http.post(M,["GoodsType"]).then(function(t){if(0!==t.code)throw new Error(t.msg);var a=t.data&&t.data.GoodsType&&t.data.GoodsType.length?t.data.GoodsType:[];e.goodsTypeOptions=a.map(function(e){return{label:e.value,value:e.code}});var s=a.map(function(e){return e.code});e.moduleGoodsReqList.forEach(function(e){e.goodsTypes=s})}).catch(function(e){console.log("提示【获取商品分类】：",e.message)})},getCityList:function(){var e=this;this.$http.get(y).then(function(t){if(0!==t.code)throw new Error(t.msg);var a=t.data&&t.data.length?t.data:[];e.cityOptions=a.map(function(e){return{label:e.cityId+"_"+e.cityName,value:e.cityId}})}).catch(function(e){console.log("提示【获取区域列表】：",e.message)})},cityChange:function(e){var t=this,a={DIFFCITY:!0,pageNum:1,pageSize:-1,cityId:e};this.addParamMsg.storeNo=null,this.$http.post(b,m()({},a)).then(function(e){if(0!==e.code)throw new Error(e.msg);var a=e.data&&e.data.result&&e.data.result.length?e.data.result:[];t.storeOptions=a.map(function(e){return{label:e.storeNo+"_"+e.storeName,value:e.storeNo}})}).catch(function(e){t.$notify.error({title:"提示",message:e.message})})},showChooseCatDialog:function(e,t){var a={showModel:!0,currentIdx:t,defaultCheckedKeys:e.categoryNos};this.$refs.chooseGoodsDialog.setDefaultMsg(a)},confirmChooseCategory:function(e){var t=e.currentIdx,a=e.categoryNames,s=e.checkedKeys;this.moduleGoodsReqList[t].categoryNos=s,this.moduleGoodsReqList[t].categoryNamesStr=a},emitUpload:function(e){var t=this;this.imageListArr.length>8&&-1!=this.currentUpFileIdx?this.$message.error("上传图片最多可添加8张"):(this.imageUploadLoading=!0,this.getToken().then(function(a){f.upload(e.file,a.fileName,a.token).subscribe({error:function(){t.imageUploadLoading=!1},complete:function(e){var a="http://retailimg01.benlailife.com/"+e.key;if(t.imageUploadLoading=!1,t.setImgUrl(t.currentUpFileIdx,a),-1!=t.currentUpFileIdx){var s={};t.imageListArr.push({imgUrl:"",sortNum:""}),t.imageListArr=t.imageListArr.reduceRight(function(e,t){return!s[t.imgUrl]&&(s[t.imgUrl]=e.push(t)),e},[]),t.imageListArr.reverse()}},next:function(e){}})}))},imageUploadRegForMore:function(e){var t=this,a=-1!==e.type.indexOf("image/"),s="image/jpeg"===e.type||"image/png"===e.type,i=e.size<=2097152;if(!a)return this.$message.error("请上传1920*1080，大小不超过2M的jpg或png图片，最多可添加8张"),!1;if(!s)return this.$message.error("请上传1920*1080，大小不超过2M的jpg或png图片，最多可添加8张"),!1;if(!i)return this.$message.error("请上传1920*1080，大小不超过2M的jpg或png图片，最多可添加8张"),!1;var r=new c.a(function(t,a){var s=window.URL||window.webkitURL,i=new Image;i.onload=function(){1920==i.width&&1080==i.height?t():a()},i.src=s.createObjectURL(e)}).then(function(){return e},function(){return t.$message.error("请上传1920*1080，大小不超过2M的jpg或png图片，最多可添加8张"),c.a.reject()});return a&&s&&i&&r},getToken:function(){var e=this;return this.$http.post(v,{}).then(function(e){if(0==e.code){var t=e.data.token;return{fileName:e.data.key,token:t}}throw new Error(e.msg)}).catch(function(t){e.imageUploadLoading=!1,e.$notify.error({title:"提示",message:t.message})})},setItemIdx:function(e){this.currentUpFileIdx=e},setImgUrl:function(e,t){var a=this,s=t,i=e;if(-1===e){this.addParamMsg.detailImageList=[],this.addParamMsg.detailImageUrl=s;var r={imgUrl:s,sortNum:1};this.addParamMsg.detailImageList.push(r)}else this.imageListArr.forEach(function(e,t){t===i&&(a.imageListArr[t].imgUrl=s,a.imageListArr[t].sortNum=parseInt(i)+1)})},deleteUpFile:function(e){this.imageListArr=this.imageListArr.filter(function(t,a){return a!=e})},datadragEnd:function(e){var t=!0,a=!1,s=void 0;try{for(var r,l=o()(new i.a(this.imageListArr.map(function(e,t){return[t,e]})));!(t=(r=l.next()).done);t=!0){var d=r.value,c=n()(d,2),u=c[0];c[1].sortNum=u+1}}catch(e){a=!0,s=e}finally{try{!t&&l.return&&l.return()}finally{if(a)throw s}}this.imageListArr=this.imageListArr.filter(function(e){return""!=e.imgUrl});this.imageListArr.push({imgUrl:"",sortNum:""})},doSaveHandel:function(){var e=this;if(this.addParamMsg.cityId){var t={DIFFCITY:!0,templateType:this.addParamMsg.templateType,templateName:this.addParamMsg.templateName,tip:this.addParamMsg.tip,interval:this.addParamMsg.interval,cityId:this.addParamMsg.cityId,moduleType:this.addParamMsg.moduleType,enable:this.addParamMsg.enable,display:this.addParamMsg.display};if(2!==this.addParamMsg.templateType||(t.storeNo=this.addParamMsg.storeNo,this.addParamMsg.storeNo))if(this.addParamMsg.templateName)if(this.addParamMsg.templateName.length>20)this.$message("[模板名称]: 模板名称,限制20个汉字");else if(this.addParamMsg.interval)if(C.test(this.addParamMsg.interval))if(parseInt(this.addParamMsg.interval)<5)this.$message("[滚动设置]: 翻页间隔（秒）是大于5的整数");else{if(0===this.addParamMsg.moduleType){var a=!0,s=!1,i=void 0;try{for(var r,l=o()(this.moduleGoodsReqList.entries());!(a=(r=l.next()).done);a=!0){var d=r.value,c=n()(d,2),u=c[0],g=c[1];if(!g.categoryNos||0===g.categoryNos.length)return void this.$message("[页面模板设置]: 请选择第"+(u+1)+"块的商品分类")}}catch(e){s=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(s)throw i}}var p=this.moduleGoodsReqList.map(function(e){return{categoryNos:e.categoryNos,goodsTypes:e.goodsTypes,showMemberPrice:e.showMemberPriceB?1:0}});t.moduleGoodsReqList=p}else{var h=this.imageListArr.filter(function(e){return e.imgUrl});if(!h||0===h.length)return void this.$message("[页面模板设置]: 请上传图片");var f=h.map(function(e){return e.imgUrl});t.modulePicReqList=[];var v={imgUrlList:f};t.modulePicReqList.push(v)}var y="";0===t.enable?y="一个门店或区域有且仅有一个可生效模板，开启后原模板将被禁用，保存时确定要直接启用吗?":1===t.enable&&(y="保存时确定要直接禁用吗?"),this.$confirm(y,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.isDisabled=!0,e.$http.post(_,m()({},t)).then(function(t){if(setTimeout(function(){e.isDisabled=!1},500),0===t.code)return e.$message.success("保存成功"),void e.$router.push("/sc861816");throw new Error(t.msg)}).catch(function(t){setTimeout(function(){e.isDisabled=!1},500),e.$notify.error({title:"提示",message:t.message})})})}else this.$message("[滚动设置]: 翻页间隔（秒）是大于5的整数");else this.$message("[滚动设置]: 请输入滚动设置，翻页间隔（秒）");else this.$message("[模板名称]: 请输入模板名称");else this.$message("[门店]: 请选择门店")}else this.$message("[区域]: 请选择区域")},doCancelHandel:function(){var e=this;this.$confirm("确定取消吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$router.push("/sc861816")}).catch(function(){})}}},L={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"add-form-wraper"},[a("el-form",{ref:"form",attrs:{model:e.addParamMsg,"label-width":"160px"}},[a("el-form-item",{attrs:{label:"模板类型",required:""}},[a("el-select",{staticClass:"add-input",attrs:{placeholder:"请选择模板类型",size:"small"},model:{value:e.addParamMsg.templateType,callback:function(t){e.$set(e.addParamMsg,"templateType",t)},expression:"addParamMsg.templateType"}},e._l(e.templateTypeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"区域",required:""}},[a("el-select",{staticClass:"add-input",attrs:{placeholder:"请选择区域",size:"small",filterable:""},on:{change:e.cityChange},model:{value:e.addParamMsg.cityId,callback:function(t){e.$set(e.addParamMsg,"cityId",t)},expression:"addParamMsg.cityId"}},e._l(e.cityOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),2===e.addParamMsg.templateType?a("el-form-item",{attrs:{label:"门店",required:""}},[a("el-select",{staticClass:"add-input",attrs:{placeholder:"请选择门店",size:"small",filterable:""},model:{value:e.addParamMsg.storeNo,callback:function(t){e.$set(e.addParamMsg,"storeNo",t)},expression:"addParamMsg.storeNo"}},e._l(e.storeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),a("span",[e._v("请先选择区域再选择门店")])],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"模板名称",required:""}},[a("el-input",{staticClass:"add-input",attrs:{size:"small",placeholder:"模板名称"},model:{value:e.addParamMsg.templateName,callback:function(t){e.$set(e.addParamMsg,"templateName",t)},expression:"addParamMsg.templateName"}}),e._v(" "),a("span",[e._v("模板名称,限制20个汉字")])],1),e._v(" "),a("el-form-item",{attrs:{label:"温馨提示"}},[a("el-input",{staticClass:"add-input",attrs:{size:"small",placeholder:"温馨提示"},model:{value:e.addParamMsg.tip,callback:function(t){e.$set(e.addParamMsg,"tip",t)},expression:"addParamMsg.tip"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"滚动设置",required:""}},[a("el-input",{staticClass:"add-input",attrs:{size:"small",placeholder:"翻页间隔（秒）"},model:{value:e.addParamMsg.interval,callback:function(t){e.$set(e.addParamMsg,"interval",t)},expression:"addParamMsg.interval"}},[a("el-button",{attrs:{slot:"append"},slot:"append"},[e._v("秒")])],1),e._v(" "),a("span",[e._v("翻页间隔（秒）是大于5的整数")])],1),e._v(" "),a("el-form-item",{attrs:{label:"页面模板设置",required:""}},[a("el-select",{staticClass:"add-input-inline",attrs:{size:"small"},model:{value:e.addParamMsg.moduleType,callback:function(t){e.$set(e.addParamMsg,"moduleType",t)},expression:"addParamMsg.moduleType"}},e._l(e.moduleTypeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),a("el-select",{staticClass:"add-input-inline",attrs:{size:"small"},model:{value:e.addParamMsg.display,callback:function(t){e.$set(e.addParamMsg,"display",t)},expression:"addParamMsg.display"}},e._l(e.displayOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),0===e.addParamMsg.moduleType?a("div",{staticClass:"display-0-wrap"},e._l(e.moduleGoodsReqList,function(t,s){return a("div",{key:s,staticClass:"item-com display-item"},[a("div",[a("div",{staticStyle:{"line-height":"16px"}},[e._v("选择商品分类：")]),e._v(" "),a("el-input",{staticClass:"search-input",attrs:{size:"small",placeholder:"商品分类"},model:{value:t.categoryNamesStr,callback:function(a){e.$set(t,"categoryNamesStr",a)},expression:"item.categoryNamesStr"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:function(a){return e.showChooseCatDialog(t,s)}},slot:"append"})],1)],1),e._v(" "),a("div",[a("div",{staticStyle:{"line-height":"16px"}},[e._v("选择要显示的商品种类：")]),e._v(" "),a("el-select",{staticClass:"search-input",attrs:{size:"small",multiple:"","collapse-tags":"",placeholder:"要显示的商品种类"},model:{value:t.goodsTypes,callback:function(a){e.$set(t,"goodsTypes",a)},expression:"item.goodsTypes"}},e._l(e.goodsTypeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("div",[a("div",{staticStyle:{"line-height":"16px","margin-top":"8px"}},[e._v("是否显示以下字段：")]),e._v(" "),a("el-checkbox",{model:{value:t.showMemberPriceB,callback:function(a){e.$set(t,"showMemberPriceB",a)},expression:"item.showMemberPriceB"}},[e._v("显示会员价")])],1)])}),0):e._e(),e._v(" "),1===e.addParamMsg.moduleType?a("div",[a("span",[e._v("请上传1920*1080，大小不超过2M的jpg或png图片，最多可添加8张")])]):e._e(),e._v(" "),1===e.addParamMsg.moduleType?a("div",[a("draggable",{on:{update:e.datadragEnd},model:{value:e.imageListArr,callback:function(t){e.imageListArr=t},expression:"imageListArr"}},[a("transition-group",e._l(e.imageListArr,function(t,s){return a("div",{key:t.imgUrl,staticClass:"mh-up-w",on:{click:function(t){return e.setItemIdx(s)}}},[a("el-upload",{staticClass:"avatar-uploader-8-mt",attrs:{action:"","show-file-list":!1,"before-upload":e.imageUploadRegForMore,"http-request":e.emitUpload}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.imageUploadLoading&&e.currentUpFileIdx==s,expression:"imageUploadLoading && currentUpFileIdx == idx"}]},[t.imgUrl?a("img",{staticClass:"avatar-8-mt",attrs:{src:t.imgUrl}}):a("i",{staticClass:"el-icon-plus avatar-uploader-8-mt-icon"})])]),e._v(" "),t.imgUrl&&""!=t.imgUrl?a("div",{staticClass:"mh-up-h-w-sc"},[a("span",{staticClass:"up-h-i",on:{click:function(t){return e.deleteUpFile(s)}}},[a("i",{staticClass:"el-icon-delete"})]),e._v(" "),a("span",{staticClass:"up-h-i"},[a("i",{staticClass:"el-icon-rank"})])]):e._e()],1)}),0)],1)],1):e._e()],1),e._v(" "),a("el-form-item",{attrs:{label:"启用状态",required:""}},[a("el-radio-group",{attrs:{size:"small"},model:{value:e.addParamMsg.enable,callback:function(t){e.$set(e.addParamMsg,"enable",t)},expression:"addParamMsg.enable"}},e._l(e.enableOptions,function(t,s){return a("el-radio-button",{key:s,attrs:{label:t.value}},[e._v(e._s(t.label)+"\n        ")])}),1),e._v(" "),a("span",[e._v("开启后线上将直接启用")])],1),e._v(" "),a("hr",{staticClass:"s-slip-tb"}),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"small",disabled:e.isDisabled},on:{click:e.doSaveHandel}},[e._v("保存")]),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:e.doCancelHandel}},[e._v("取消")])],1)],1),e._v(" "),a("goods-cat-dialog",{ref:"chooseGoodsDialog",attrs:{categoryList:e.categoryList},on:{confirmChooseCategory:e.confirmChooseCategory}})],1)},staticRenderFns:[]};var w=a("VU/8")(k,L,!1,function(e){a("oBNG")},null,null);t.default=w.exports},"6fmR":function(e,t,a){"use strict";var s=a("Gu7T"),i=a.n(s),r={props:{categoryList:{type:Array,default:function(){return[]}}},data:function(){return{defaultProps:{children:"childrenList",label:"categoryName"},showModel:!1,currentIdx:0,defaultCheckedKeys:[]}},methods:{setDefaultMsg:function(e){var t=this;this.showModel=e.showModel,this.currentIdx=e.currentIdx,this.defaultCheckedKeys=e.defaultCheckedKeys,setTimeout(function(){t.$refs.tree.setCheckedKeys([].concat(i()(e.defaultCheckedKeys)))},0)},doConfirmHandel:function(){this.showModel=!1;var e=this.$refs.tree.getCheckedKeys(!0),t={categoryNames:e.join(","),checkedKeys:e,currentIdx:this.currentIdx};this.$emit("confirmChooseCategory",t)}}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{attrs:{title:"商品分类","close-on-click-modal":!1,"close-on-press-escape":!1,visible:e.showModel,width:"400px"},on:{"update:visible":function(t){e.showModel=t}}},[a("div",{staticStyle:{"max-height":"300px","overflow-y":"auto"}},[a("el-tree",{ref:"tree",attrs:{data:e.categoryList,"show-checkbox":"","node-key":"categoryNo","default-checked-keys":e.defaultCheckedKeys,props:e.defaultProps}})],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.showModel=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.doConfirmHandel}},[e._v("确 定")])],1)])],1)},staticRenderFns:[]},l=a("VU/8")(r,o,!1,null,null,null);t.a=l.exports},oBNG:function(e,t){}});
//# sourceMappingURL=23.cde5b369961366ad8790.js.map