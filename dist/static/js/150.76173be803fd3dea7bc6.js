webpackJsonp([150],{FTsH:function(a,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=t("Dd8w"),s=t.n(l),i=t("cpGA"),d="/plateform/a/apk/version/saveApk",n="/foundation/qiniu/auth/file",o={data:function(){return{isDisabled:!1,updateTypeOptions:[{value:0,label:"正常"},{value:1,label:"强制升级"}],addApkData:{versionName:"",des:"",url:"",versionCode:"",updateType:"",apkType:0},apkUploadLoading:!1,apkFile:{},apkTypeOptions:[{value:0,label:"门店端"},{value:1,label:"TV端"}]}},created:function(){},methods:{doSaveHandel:function(){var a=this;""!==this.addApkData.versionName?""!==this.addApkData.url?""!=this.addApkData.versionCode?!/^[1-9]*[1-9][0-9]*$/.test(this.addApkData.versionCode)||this.addApkData.versionCode<0?this.$message("内部版本号格式不正确"):""!==this.addApkData.updateType?(this.isDisabled=!0,this.$http.post(d,s()({},this.addApkData)).then(function(e){if(setTimeout(function(){a.isDisabled=!1},800),0!==e.code)throw new Error(e.msg);a.$router.push("/apk")}).catch(function(e){a.isDisabled=!1,a.$notify.error({title:"提示",message:e.message})})):this.$message("请选择升级类型"):this.$message("请输入内部版本号"):this.$message("请输入下载地址"):this.$message("请输入版本名称")},doCancelHandel:function(){var a=this;this.$confirm("确定取消吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.$router.push("/apk")}).catch(function(){})},apkUploadReg:function(a){var e=a.name,t=a.name.length;this.apkFile={fileExtension:"apk",fileName:e.slice(0,t-4)};var l="apk"===e.slice(t-3);return l||this.$message.error("文件必须是Apk格式!"),l},uploadApk:function(a){var e=this;this.apkUploadLoading=!0,this.getToken().then(function(t){i.upload(a.file,t.fileName,t.token).subscribe({error:function(){e.apkUploadLoading=!1},complete:function(a){var t="http://retailimg01.benlailife.com/"+a.key;e.addApkData.url=t,e.apkUploadLoading=!1},next:function(a){}})})},getToken:function(){var a=this;return this.$http.post(n,s()({},this.apkFile)).then(function(a){if(0==a.code){var e=a.data.token;return{fileName:a.data.key,token:e}}throw new Error(a.msg)}).catch(function(e){a.apkUploadLoading=!1,a.$notify.error({title:"提示",message:e.message})})}}},p={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"add-form-wraper"},[t("el-form",{ref:"form",attrs:{model:a.addApkData,"label-width":"160px"}},[t("el-form-item",{attrs:{label:"版本名称",required:""}},[t("el-input",{staticClass:"add-input",attrs:{size:"small",placeholder:"请输入版本名称"},model:{value:a.addApkData.versionName,callback:function(e){a.$set(a.addApkData,"versionName",e)},expression:"addApkData.versionName"}})],1),a._v(" "),t("el-form-item",{attrs:{label:"更新说明"}},[t("el-input",{staticClass:"add-input",attrs:{type:"textarea",rows:3,size:"small",placeholder:"请输入更新说明"},model:{value:a.addApkData.des,callback:function(e){a.$set(a.addApkData,"des",e)},expression:"addApkData.des"}})],1),a._v(" "),t("el-form-item",{attrs:{label:"Apk类型",required:""}},[t("el-select",{staticClass:"add-input",attrs:{size:"small",placeholder:"请选择Apk类型"},model:{value:a.addApkData.apkType,callback:function(e){a.$set(a.addApkData,"apkType",e)},expression:"addApkData.apkType"}},a._l(a.apkTypeOptions,function(a){return t("el-option",{key:a.value,attrs:{label:a.label,value:a.value}})}),1)],1),a._v(" "),t("el-form-item",{attrs:{label:"下载地址",required:""}},[t("el-input",{staticClass:"add-input",attrs:{size:"small",placeholder:"请输入下载地址",disabled:""},model:{value:a.addApkData.url,callback:function(e){a.$set(a.addApkData,"url",e)},expression:"addApkData.url"}}),a._v(" "),t("el-upload",{staticStyle:{display:"inline-block"},attrs:{action:"","show-file-list":!1,"before-upload":a.apkUploadReg,"http-request":a.uploadApk}},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:a.apkUploadLoading,expression:"apkUploadLoading"}]},[t("el-button",{attrs:{icon:"el-icon-upload2",size:"small"}},[a._v("上传apk文件")])],1)])],1),a._v(" "),t("el-form-item",{attrs:{label:"内部版本号",required:""}},[t("el-input",{staticClass:"add-input",attrs:{size:"small",placeholder:"请输入内部版本号"},model:{value:a.addApkData.versionCode,callback:function(e){a.$set(a.addApkData,"versionCode",e)},expression:"addApkData.versionCode"}}),a._v(" "),t("span",[a._v("内部版本号限制正整数")])],1),a._v(" "),t("el-form-item",{attrs:{label:"升级类型",required:""}},[t("el-select",{staticClass:"add-input",attrs:{size:"small",placeholder:"请选择升级类型"},model:{value:a.addApkData.updateType,callback:function(e){a.$set(a.addApkData,"updateType",e)},expression:"addApkData.updateType"}},a._l(a.updateTypeOptions,function(a){return t("el-option",{key:a.value,attrs:{label:a.label,value:a.value}})}),1)],1),a._v(" "),t("hr",{staticClass:"s-slip-tb"}),a._v(" "),t("el-form-item",[t("el-button",{attrs:{type:"primary",size:"small",disabled:a.isDisabled},on:{click:a.doSaveHandel}},[a._v("保存")]),a._v(" "),t("el-button",{attrs:{size:"small"},on:{click:a.doCancelHandel}},[a._v("取消")])],1)],1)],1)},staticRenderFns:[]},r=t("VU/8")(o,p,!1,null,null,null);e.default=r.exports}});
//# sourceMappingURL=150.76173be803fd3dea7bc6.js.map