webpackJsonp([158],{P68h:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("Dd8w"),r=s.n(a),i=s("oAV5"),n=s("cIv3"),m=s("zme4"),d="/member/erp/prom/batchAddProm",o={data:function(){return{isDisabled:!1,addParamMesg:{triggerType:"",triggerTypeName:"充值返券",cardType:2,title:"",beginTime:"",endTime:""},triggerTypeList:[{value:4,label:"充值发券(单次)"},{value:42,label:"充值发券(多次)"}],setDisableTime:{disabledDate:function(e){return e.getTime()<Date.now()-864e5}}}},created:function(){},mounted:function(){},components:{"store-template":n.a,"prom-type-template":m.a},methods:{changeStore:function(e){if(e)for(var t in e)this.addParamMesg[t]=e[t]},changePromType:function(e){this.addParamMesg.promReqs=e},formattData:function(){var e=this,t=/^\+?[1-9][0-9]*$/,s=/(^[1-9]{1}[0-9]*$)|(^[0-9]*\.[0-9]{1}$)|(^[0-9]*\.[0-9]{2}$)/;if(!this.addParamMesg.title)return this.$message("请输入活动名称"),!1;if(this.addParamMesg.title.length>30)return this.$message("活动名称限制30个汉字"),!1;if(""==this.addParamMesg.beginTime)return this.$message("请选择活动开始日期"),!1;if(this.addParamMesg.beginTime=i.u(new Date(this.addParamMesg.beginTime).getTime())+" 00:00:00",""==this.addParamMesg.endTime)return this.$message("请选择活动结束日期"),!1;if(this.addParamMesg.endTime=i.u(new Date(this.addParamMesg.endTime).getTime())+" 23:59:59",new Date(this.addParamMesg.endTime).getTime()<=new Date(this.addParamMesg.beginTime).getTime())return this.$message("活动结束日期不能早于或等于开始日期"),!1;if(""===this.addParamMesg.useType||void 0===this.addParamMesg.useType)return this.$message("请选择卡券有效时间"),!1;if(1===this.addParamMesg.useType){if(""==this.addParamMesg.useBeginTime)return this.$message("请选择卡券有效开始日期"),!1;if(this.addParamMesg.useBeginTime=i.u(new Date(this.addParamMesg.useBeginTime).getTime())+" 00:00:00",""==this.addParamMesg.useEndTime)return this.$message("请选择卡券有效结束日期"),!1;if(this.addParamMesg.useEndTime=i.u(new Date(this.addParamMesg.useEndTime).getTime())+" 23:59:59",new Date(this.addParamMesg.useEndTime).getTime()<=new Date(this.addParamMesg.useBeginTime).getTime())return this.$message("卡券有效结束日期不能早于或等于开始日期"),!1;if(new Date(this.addParamMesg.useEndTime).getTime()<new Date(this.addParamMesg.endTime).getTime())return this.$message("卡券有效结束日期不能早于活动结束时间"),!1;delete this.addParamMesg.useDayCount}else if(2===this.addParamMesg.useType){if(""==this.addParamMesg.useDayCount)return this.$message("卡券有效使用天数不能为空"),!1;if(0==t.test(this.addParamMesg.useDayCount))return this.$message("卡券有效使用天数为大于零的整数"),!1;delete this.addParamMesg.useBeginTime,delete this.addParamMesg.useEndTime}var a=this.addParamMesg.promReqs[0],r=!0;a&&a.promDiscounts&&a.promDiscounts.length>0&&a.promDiscounts.forEach(function(e){for(var t in e)"triggerAmount"!=t&&"discAmount"!=t&&"meetAmount"!=t&&"sendPromCount"!=t||""==e[t]||(r=!1)});var n=this.addParamMesg.promReqs[1],m=!0;if(n&&n.promDiscounts&&n.promDiscounts.length>0&&n.promDiscounts.forEach(function(e){for(var t in e)"triggerAmount"!=t&&"range"!=t&&"goodsType"!=t&&"needPayAmount"!=t&&"goodsNo"!=t&&"sendPromCount"!=t||""==e[t]||(m=!1)}),r&&m)return this.$message("请设置满减券卡券奖励"),!1;if(0==r&&0==(!(!a||!a.promDiscounts)&&a.promDiscounts.every(function(a){if(a.triggerAmount){var r=a.triggerAmount.indexOf("元");r>-1&&(a.triggerAmount=a.triggerAmount.slice(0,r))}return""==a.triggerAmount||void 0==a.triggerAmount?(e.$message("满减券卡券奖励-充值金额不能为空"),!1):""==a.meetAmount||""==a.discAmount||""==a.sendPromCount?(e.$message("满减券卡券奖励-满减金额或张数不能为空"),!1):!1===s.test(a.meetAmount)||!1===s.test(a.discAmount)?(e.$message("满减券卡券奖励-满减金额大于零的数字，允许输入两位小数"),!1):!1===t.test(a.sendPromCount)?(e.$message("满减券卡券奖励-满减金额或张数为大于零的整数"),!1):parseInt(a.meetAmount)<parseInt(a.discAmount)?(e.$message("满减券卡券奖励-减金额不能大于满金额"),!1):4===e.addParamMesg.triggerType&&a.remark&&a.remark.length>20?(e.$message("满减券卡券奖励-自定义活动文案，建议12个字，不得超过20个字"),!1):42!==e.addParamMesg.triggerType||(""===a.sendCount?(e.$message("满减券卡券奖励-发放次数不能为空"),!1):!t.test(a.sendCount)||a.sendCount<=1?(e.$message("满减券卡券奖励-发放次数为大于1的整数"),!1):""===a.sendIntervalDays?(e.$message("满减券卡券奖励-发放优惠券间隔不能为空"),!1):t.test(a.sendIntervalDays)?!(a.remark&&a.remark.length>20)||(e.$message("满减券卡券奖励-自定义活动文案，建议12个字，不得超过20个字"),!1):(e.$message("满减券卡券奖励-发放优惠券间隔为大于零的整数"),!1))})))return!1;if(0==m&&0==(!(!n||!n.promDiscounts)&&n.promDiscounts.every(function(a){if(a.triggerAmount){var r=a.triggerAmount.indexOf("元");r>-1&&(a.triggerAmount=a.triggerAmount.slice(0,r))}if(""==a.triggerAmount||void 0==a.triggerAmount)return e.$message("商品券卡券奖励-充值金额不能为空"),!1;if(""==a.needPayAmount||void 0==a.needPayAmount)return e.$message("商品券卡券奖励-商品应付价格不能为空"),!1;if(0!=a.needPayAmount&&!s.test(a.needPayAmount))return e.$message("商品券卡券奖励-商品应付价格输入大于等于0的数字，允许输入一位小数。"),!1;if(""==a.goodsNo||void 0==a.goodsNo)return e.$message("商品券卡券奖励-请选择商品"),!1;if(""==a.productQtyLimit||void 0==a.productQtyLimit)return e.$message("商品券卡券奖励-请输入选择商品数量小于等于的值"),!1;if(!t.test(a.productQtyLimit))return e.$message("商品券卡券奖励-选择商品数量小于等于的值格式不对，为大于零的整数"),!1;if(""===a.sendPromCount||void 0==a.sendPromCount)return e.$message("商品券卡券奖励-请输入发放优惠券数量"),!1;if(!t.test(a.sendPromCount))return e.$message("商品券卡券奖励-发放优惠券数量为大于零的整数"),!1;if(4===e.addParamMesg.triggerType&&a.remark&&a.remark.length>20)return e.$message("卡券奖励-自定义活动文案，建议12个字，不得超过20个字"),!1;if(42===e.addParamMesg.triggerType){if(""===a.sendCount||void 0==a.sendCount)return e.$message("卡券奖励-共发放次数不能为空"),!1;if(!t.test(a.sendCount)||a.sendCount<=1)return e.$message("卡券奖励-共发放次数为大于1的整数"),!1;if(""===a.sendIntervalDays||void 0==a.sendIntervalDays)return e.$message("卡券奖励-发放优惠券间隔不能为空"),!1;if(!t.test(a.sendIntervalDays))return e.$message("卡券奖励-发放优惠券间隔为大于零的整数"),!1;if(a.remark&&a.remark.length>20)return e.$message("卡券奖励-自定义活动文案，建议12个字，不得超过20个字"),!1}return!0})))return!1;return 1==r&&this.addParamMesg.promReqs.splice(0,1),1==m&&this.addParamMesg.promReqs.splice(1,1),!0},doSaveHandel:function(){var e=this;!1!==this.formattData()&&(this.addParamMesg.promReqs[0]&&this.$set(this.addParamMesg.promReqs[0],"onlineGoodsType","3;4;5"),this.addParamMesg.promReqs[1]&&this.$set(this.addParamMesg.promReqs[1],"onlineGoodsType","3;4;5"),this.isDisabled=!0,this.$http.post(d,r()({},this.addParamMesg)).then(function(t){if(setTimeout(function(){e.isDisabled=!1},800),0===t.code)return e.$message.success("保存成功"),void e.$router.push("/discount_coupon");throw new Error(t.msg)}).catch(function(t){e.isDisabled=!1,e.$notify.error({title:"提示",message:t.message})}))},doCancelHandel:function(){var e=this;this.$confirm("确定取消吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$router.push("/discount_coupon")}).catch(function(){})}}},g={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"add-form-wraper"},[s("el-form",{ref:"form",attrs:{model:e.addParamMesg,"label-width":"140px"}},[s("el-form-item",{attrs:{label:"活动类型",required:""}},[s("el-select",{staticClass:"add-input",attrs:{size:"small",placeholder:"请选择"},model:{value:e.addParamMesg.triggerType,callback:function(t){e.$set(e.addParamMesg,"triggerType",t)},expression:"addParamMesg.triggerType"}},e._l(e.triggerTypeList,function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),s("el-form-item",{attrs:{label:"活动名称",required:""}},[s("el-input",{staticClass:"add-input",attrs:{size:"small",placeholder:"请输入活动名称",clearable:""},model:{value:e.addParamMesg.title,callback:function(t){e.$set(e.addParamMesg,"title",t)},expression:"addParamMesg.title"}}),e._v(" "),s("span",[e._v("活动名称,限制30个汉字")])],1),e._v(" "),s("el-form-item",{attrs:{label:"活动开始日期",required:""}},[s("el-date-picker",{staticClass:"add-input",attrs:{type:"date",placeholder:"请选择活动开始日期","picker-options":e.setDisableTime,size:"small"},model:{value:e.addParamMesg.beginTime,callback:function(t){e.$set(e.addParamMesg,"beginTime",t)},expression:"addParamMesg.beginTime"}}),e._v(" "),s("span",[e._v("活动开始日期")])],1),e._v(" "),s("el-form-item",{attrs:{label:"活动结束日期",required:""}},[s("el-date-picker",{staticClass:"add-input",attrs:{type:"date",placeholder:"请选择活动结束日期","picker-options":e.setDisableTime,size:"small"},model:{value:e.addParamMesg.endTime,callback:function(t){e.$set(e.addParamMesg,"endTime",t)},expression:"addParamMesg.endTime"}}),e._v(" "),s("span",[e._v("活动结束日期")])],1),e._v(" "),s("store-template",{on:{changeStore:e.changeStore}}),e._v(" "),s("prom-type-template",{attrs:{triggerType:e.addParamMesg.triggerType},on:{changePromType:e.changePromType}}),e._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary",size:"small",disabled:e.isDisabled},on:{click:e.doSaveHandel}},[e._v("保存")]),e._v(" "),s("el-button",{attrs:{size:"small"},on:{click:e.doCancelHandel}},[e._v("取消")])],1)],1)],1)])},staticRenderFns:[]},u=s("VU/8")(o,g,!1,null,null,null);t.default=u.exports}});
//# sourceMappingURL=158.ea769fe27ec64bf4375b.js.map