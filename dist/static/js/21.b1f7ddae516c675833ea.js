webpackJsonp([21],{"Z/qZ":function(t,e){},iJHi:function(t,e){},vJZB:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("Dd8w"),o=a.n(r),s=a("ssT3"),i=a("Gu7T"),n=a.n(i),l=a("BO1k"),c=a.n(l),u=a("lHA8"),d=a.n(u),p=a("c/Tr"),h=a.n(p),m=a("mvHQ"),g=a.n(m),f=(a("oAV5"),"/plateform/a/category/getCategoryTree"),v="/plateform/a/mall/groupProduct/getPreProduct",S={data:function(){return{loading:!1,currentPage:1,pageSize:10,total:0,categoriesList:[],choosePreList:[],searchContent:{categoryCode:[],productNo:"",productName:""},groupMsg:[],tableData:[],categoriesSelectList:[],presaleIds:[]}},watch:{categoriesSelectList:function(t,e){this.searchContent.categoryCode=t,this.doSearchHandel()}},created:function(){this.getCategoriesList()},mounted:function(){},components:{},methods:{setDefault:function(t,e){this.groupMsg=t,this.currentPage=1,this.doSearchHandel()},timeFormatter:function(t,e,a){return t.preStartDate&&t.preEndDate&&t.preStartTime&&t.preEndTime?t.preStartDate+"-"+t.preEndDate+" "+t.preStartTime+"-"+t.preEndTime:""},statusFormatter:function(t,e,a){return 0==t.productStatus?"已失效":1==t.productStatus?"未开始":2==t.productStatus?"进行中":3==t.productStatus?"售罄":void 0},getCategoriesList:function(){var t=this;this.$http.post(f).then(function(e){if(0!==e.code)throw new Error(e.msg);e.data&&e.data.length?t.categoriesList=e.data.map(function(t){var e=t.categoryName,a=t.categoryId;return t.categoryVoList&&t.categoryVoList.length?{label:e,value:a,children:t.categoryVoList.map(function(t){return{label:t.categoryName,value:t.categoryId}})}:{label:e,value:a}}):t.categoriesList=[]}).catch(function(t){console.log("提示(获取分类列表):",t.message)})},changeSize:function(t){this.pageSize=t,this.currentPage=1,this.doSearchHandel()},changeCurrent:function(t){this.currentPage=t,this.doSearchHandel()},doSearchHandel:function(){var t=this;this.loading=!0,this.$http.post(v,o()({},this.searchContent,{pageNum:this.currentPage,pageSize:this.pageSize,queryCode:this.groupMsg.id,queryType:1})).then(function(e){if(t.loading=!1,0===e.code)return e.data&&e.data.result&&e.data.result.length?t.tableData=e.data.result:t.tableData=[],void(1==t.currentPage&&(t.total=e.data.total));throw new Error(e.msg)}).catch(function(e){t.loading=!1,t.$notify.error({title:"提示",message:e.message})})},handleSelect:function(t,e){var a=this,r=g()(e),o=e.presaleId;if(this.choosePreList.length>0){var s=!0;this.choosePreList.forEach(function(t,e){t.indexOf('"presaleId":'+o)>-1&&(s=!1,a.choosePreList.splice(e,1))}),s&&this.choosePreList.push(r)}else this.choosePreList.push(r)},handleSelectAll:function(t){if(t.length>0){var e=!0,a=!1,r=void 0;try{for(var o,s=c()(t);!(e=(o=s.next()).done);e=!0){var i=o.value,l=g()(i);this.choosePreList.push(l)}}catch(t){a=!0,r=t}finally{try{!e&&s.return&&s.return()}finally{if(a)throw r}}this.choosePreList=h()(new d.a(this.choosePreList))}else{var u=[],p=!0,m=!1,f=void 0;try{for(var v,S=c()(this.tableData);!(p=(v=S.next()).done);p=!0){var w=v.value,y=g()(w);u.push(y)}}catch(t){m=!0,f=t}finally{try{!p&&S.return&&S.return()}finally{if(m)throw f}}this.choosePreList=h()(new d.a([].concat(n()(this.choosePreList)).filter(function(t){return!new d.a(u).has(t)})))}},close:function(t){if(t){if(0==this.choosePreList.length)return void this.$notify({title:"警告",message:"您还没有选择任何商品",type:"warning"});var e={isShowGoods:!1,choosePreList:this.choosePreList.map(function(t,e){return JSON.parse(t)})};this.choosePreList=[],this.$refs.multipleTable.clearSelection(),this.$emit("closeDialog",e)}else{this.choosePreList=[],this.$refs.multipleTable.clearSelection(),this.$emit("closeDialog",{isShowGoods:!1})}}}},w={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-row",[a("el-input",{staticClass:"search-input",attrs:{placeholder:"请输入商品ERP编码",size:"small",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.doSearchHandel(e)}},model:{value:t.searchContent.productNo,callback:function(e){t.$set(t.searchContent,"productNo","string"==typeof e?e.trim():e)},expression:"searchContent.productNo"}}),t._v(" "),a("el-input",{staticClass:"search-input",attrs:{placeholder:"请输入名称关键字",size:"small",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.doSearchHandel(e)}},model:{value:t.searchContent.productName,callback:function(e){t.$set(t.searchContent,"productName","string"==typeof e?e.trim():e)},expression:"searchContent.productName"}}),t._v(" "),a("el-cascader",{staticClass:"search-input",attrs:{"expand-trigger":"click",options:t.categoriesList,placeholder:"请选择分类","change-on-select":"",size:"small",clearable:""},model:{value:t.categoriesSelectList,callback:function(e){t.categoriesSelectList=e},expression:"categoriesSelectList"}}),t._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.doSearchHandel}},[t._v("搜索")])],1),t._v(" "),a("el-row",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"multipleTable",staticClass:"fixed-height",staticStyle:{width:"100%"},attrs:{data:t.tableData,"empty-text":"没有查询到您想要的数据","max-height":"320",size:"small"},on:{select:t.handleSelect,"select-all":t.handleSelectAll}},[a("el-table-column",{attrs:{type:"selection"}}),t._v(" "),a("el-table-column",{attrs:{"min-width":"180",label:"商品信息"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"ll-p-m-w"},[a("div",{staticClass:"ll-img-w"},[e.row.productImg&&""!=e.row.productImg?a("img",{attrs:{src:e.row.productImg,alt:"",onerror:"onerror=null;src='/shop/static/img_error.png'"}}):a("img",{attrs:{src:"/shop/static/img_error.png",alt:""}})]),t._v(" "),a("div",{staticClass:"ll-p-m-c-r"},[a("div",[t._v(t._s(e.row.productName))]),t._v(" "),a("div",{staticClass:"ll-erp-p-no"},[t._v("SKU编码："+t._s(e.row.goodsNo||"--"))])])])]}}])}),t._v(" "),a("el-table-column",{attrs:{"min-width":"60",prop:"presalePrice",label:"预售价"}}),t._v(" "),a("el-table-column",{attrs:{width:"185",label:"预售时间",formatter:t.timeFormatter}}),t._v(" "),a("el-table-column",{attrs:{"min-width":"80",prop:"productStatus",formatter:t.statusFormatter,label:"有效状态"}})],1),t._v(" "),a("el-pagination",{directives:[{name:"show",rawName:"v-show",value:t.tableData.length>0,expression:"tableData.length>0"}],staticClass:"tc mt20",attrs:{background:"","current-page":t.currentPage,"page-sizes":[10,50,100,150,200],layout:"total, sizes, prev, pager, next, jumper","pager-count":5,total:t.total},on:{"size-change":t.changeSize,"current-change":t.changeCurrent,"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e}}})],1),t._v(" "),a("el-row",{staticStyle:{margin:"20px"}},[a("el-button",{staticStyle:{float:"right","margin-left":"20px"},attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.close(!0)}}},[t._v("选择并导入")]),t._v(" "),a("el-button",{staticStyle:{float:"right"},attrs:{size:"mini"},on:{click:function(e){return t.close(!1)}}},[t._v("关闭")])],1)],1)},staticRenderFns:[]};var y="/plateform/a/mall/groupProduct/getGroupProductPage",b="/plateform/a/mall/groupProduct/getGroupProductList",C="/plateform/a/mall/groupProduct/saveGroupProduct",P="/plateform/a/mall/groupProduct/updateGroupProduct",_={data:function(){return{loading:!1,isShowPreList:!1,currentPage:1,pageSize:20,total:0,tableData:[],statusOptions:[],cityName:"",groupMsg:[],searchContent:{groupId:"",productNo:"",productName:"",productStatus:""},choosePreList:[]}},created:function(){this.cityName=s.a.get("groupProductsCityName"),this.groupMsg=s.a.get("groupProducts"),this.searchContent.groupId=this.groupMsg.id,this.getStatusList(),this.doSearchHandel()},mounted:function(){},components:{"pre-list":a("VU/8")(S,w,!1,function(t){a("Z/qZ")},null,null).exports},methods:{timeFormatter:function(t,e,a){return t.preStartDate&&t.preEndDate&&t.preStartTime&&t.preEndTime?t.preStartDate+"-"+t.preEndDate+" "+t.preStartTime+"-"+t.preEndTime:""},statusFormatter:function(t,e,a){return 0==t.productStatus?"已失效":1==t.productStatus?"未开始":2==t.productStatus?"进行中":3==t.productStatus?"售罄":void 0},changeSize:function(t){this.pageSize=t,this.doSearchHandel()},changeCurrent:function(t){this.currentPage=t,this.doSearchHandel()},getStatusList:function(){var t=this;this.$http.post(y,{groupId:this.searchContent.groupId}).then(function(e){if(0!==e.code)throw new Error(e.msg);e.data&&e.data.productStatusList&&e.data.productStatusList.length?t.statusOptions=e.data.productStatusList.filter(function(t,e){if(null!=t.code)return t}):t.statusOptions=[]}).catch(function(t){console.log("提示(获取状态列表):",t.message)})},doSearchHandel:function(){var t=this;this.loading=!0,this.$http.post(b,o()({},this.searchContent,{pageNum:this.currentPage,pageSize:this.pageSize})).then(function(e){if(t.loading=!1,0!==e.code)throw new Error(e.msg);if(e.data&&e.data.result&&e.data.result.length){var a=e.data.result;a.forEach(function(t,e){t.updateSortNum=t.sortNum,t.showUpdate=!1}),t.tableData=a,t.choosePreList=[]}else t.tableData=[];1==t.currentPage&&(t.total=e.data.total)}).catch(function(e){t.loading=!1,t.$notify.error({title:"提示",message:e.message})})},removeProduct:function(t){var e=this;this.loading=!0,this.$http.post(P,{isDeleted:1,groupId:this.searchContent.groupId,presaleId:t.presaleId}).then(function(t){if(e.loading=!1,0===t.code)return e.$message({message:"移除商品成功",type:"success"}),void e.doSearchHandel();throw new Error(t.msg)}).catch(function(t){e.loading=!1,e.$notify.error({title:"提示",message:t.message})})},showPreList:function(){var t=this,e=[];this.isShowPreList=!0,setTimeout(function(){t.$refs.PreListDialog.setDefault(t.groupMsg,e)},200)},closeDialog:function(t){var e=this;if(this.isShowPreList=t.isShowGoods,t.choosePreList){var a=t.choosePreList.map(function(t,e){return t.presaleId});this.loading=!0,this.$http.post(C,{groupId:this.searchContent.groupId,presaleIds:a}).then(function(t){if(e.loading=!1,0!==t.code)throw new Error(t.msg);e.doSearchHandel()}).catch(function(t){e.loading=!1,e.$notify.error({title:"提示",message:t.message})})}},modifySortNum:function(t,e){1!=e.showUpdate&&(this.tableData[t].showUpdate=!0)},deleteSortNum:function(t,e){var a=this;e?setTimeout(function(){a.tableData[t].updateSortNum=a.tableData[t].SortNum,a.tableData[t].showUpdate=!1},200):(this.tableData[t].updateSortNum=this.tableData[t].SortNum,this.tableData[t].showUpdate=!1)},sureSortNum:function(t){var e=this;null!=t.updateSortNum&&1!=!/^[0-9]*$/.test(t.updateSortNum)?t.updateSortNum<=0||t.updateSortNum>99?this.$message("排序应大于0，小于等于99"):(this.loading=!0,this.$http.post(P,{SortNum:t.updateSortNum,groupId:this.searchContent.groupId,presaleId:t.presaleId}).then(function(t){if(e.loading=!1,0===t.code)return e.$message({message:"排序成功",type:"success"}),void e.doSearchHandel();throw new Error(t.msg)}).catch(function(t){e.loading=!1,e.$notify.error({title:"提示",message:t.message})})):this.$message("请输入正确的排序")}}},N={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"handel-search-wraper"},[a("div",{staticClass:"handel-wraper"},[a("p",{staticClass:"ll-fontw"},[t._v(t._s(t.cityName+"分组商品管理 - "+t.groupMsg.name))])]),t._v(" "),a("hr",{staticClass:"s-slip"}),t._v(" "),a("div",{staticClass:"handel-wraper"},[a("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-plus"},on:{click:t.showPreList}},[t._v("导入预售商品")])],1),t._v(" "),a("hr",{staticClass:"s-slip"}),t._v(" "),a("div",{staticClass:"search-form-wraper"},[a("el-form",{attrs:{model:t.searchContent,"label-position":"top"}},[a("el-form-item",{attrs:{label:"ERP编码"}},[a("el-input",{staticClass:"search-input",attrs:{placeholder:"请输入商品ERP编码",size:"small",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.doSearchHandel(e)}},model:{value:t.searchContent.productNo,callback:function(e){t.$set(t.searchContent,"productNo","string"==typeof e?e.trim():e)},expression:"searchContent.productNo"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"商品名称"}},[a("el-input",{staticClass:"search-input",attrs:{placeholder:"请输入名称关键字",size:"small",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.doSearchHandel(e)}},model:{value:t.searchContent.productName,callback:function(e){t.$set(t.searchContent,"productName","string"==typeof e?e.trim():e)},expression:"searchContent.productName"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"状态"}},[a("el-select",{staticClass:"search-input",attrs:{placeholder:"请选择状态",size:"small",clearable:""},on:{change:t.doSearchHandel},model:{value:t.searchContent.productStatus,callback:function(e){t.$set(t.searchContent,"productStatus",e)},expression:"searchContent.productStatus"}},t._l(t.statusOptions,function(t){return a("el-option",{key:t.code,attrs:{label:t.msg,value:t.code}})}),1)],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.doSearchHandel}},[t._v("搜索")])],1)],1)],1)]),t._v(" "),a("div",{staticClass:"table-wraper"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"fixed-height",staticStyle:{width:"100%"},attrs:{data:t.tableData,"empty-text":"没有查询到您想要的数据",size:"small"}},[a("el-table-column",{attrs:{"min-width":"240",label:"商品信息"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"ll-p-m-w"},[a("div",{staticClass:"ll-img-w"},[e.row.productImg&&""!=e.row.productImg?a("img",{attrs:{src:e.row.productImg,alt:"",onerror:"onerror=null;src='/shop/static/img_error.png'"}}):a("img",{attrs:{src:"/shop/static/img_error.png",alt:""}})]),t._v(" "),a("div",{staticClass:"ll-p-m-c-r"},[a("div",[t._v(t._s(e.row.productName))]),t._v(" "),a("div",{staticClass:"ll-erp-p-no"},[t._v("SKU编码："+t._s(e.row.goodsNo||"--"))])])])]}}])}),t._v(" "),a("el-table-column",{attrs:{"min-width":"80",prop:"spec",label:"规格"}}),t._v(" "),a("el-table-column",{attrs:{"min-width":"80",prop:"presalePrice",label:"预售价"}}),t._v(" "),a("el-table-column",{attrs:{width:"185",label:"预售时间",formatter:t.timeFormatter}}),t._v(" "),a("el-table-column",{attrs:{"min-width":"80",formatter:t.statusFormatter,label:"状态"}}),t._v(" "),a("el-table-column",{attrs:{"min-width":"120",prop:"sortNum",label:"排序"},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.showUpdate?a("div",{staticClass:"ll-sort-num"},[a("el-button-group",[a("el-input",{staticStyle:{width:"80px"},attrs:{placeholder:"请输入",size:"mini"},on:{focus:function(a){return t.modifySortNum(e.$index,e.row)}},model:{value:e.row.sortNum,callback:function(a){t.$set(e.row,"sortNum",a)},expression:"scope.row.sortNum"}})],1)],1):1==e.row.showUpdate?a("div",{staticClass:"ll-sort-num"},[a("el-button-group",[a("el-input",{staticStyle:{width:"80px"},attrs:{placeholder:"请输入",size:"mini"},on:{blur:function(a){return t.deleteSortNum(e.$index,!0)}},model:{value:e.row.updateSortNum,callback:function(a){t.$set(e.row,"updateSortNum",a)},expression:"scope.row.updateSortNum"}})],1),t._v(" "),a("el-button-group",[a("el-button",{staticStyle:{width:"25px"},attrs:{icon:"el-icon-check",size:"mini"},on:{click:function(a){return t.sureSortNum(e.row)}}}),t._v(" "),a("el-button",{staticStyle:{width:"25px"},attrs:{icon:"el-icon-close",size:"mini"},on:{click:function(a){return t.deleteSortNum(e.$index)}}})],1)],1):t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{"min-width":"80",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return t.removeProduct(e.row)}}},[t._v("移除")])]}}])})],1),t._v(" "),a("el-pagination",{directives:[{name:"show",rawName:"v-show",value:t.tableData.length>0,expression:"tableData.length>0"}],staticClass:"tc mt20",attrs:{background:"","current-page":t.currentPage,"page-sizes":[20,50,100,150,200],layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.changeSize,"current-change":t.changeCurrent,"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e}}})],1),t._v(" "),a("el-dialog",{attrs:{title:"选择商品",visible:t.isShowPreList,width:"700px"},on:{"update:visible":function(e){t.isShowPreList=e}}},[a("pre-list",{ref:"PreListDialog",on:{closeDialog:t.closeDialog}})],1)],1)},staticRenderFns:[]};var L=a("VU/8")(_,N,!1,function(t){a("iJHi")},null,null);e.default=L.exports}});
//# sourceMappingURL=21.b1f7ddae516c675833ea.js.map