webpackJsonp([140],{pKIj:function(e,t){},u636:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("Gu7T"),o=s.n(a),i=s("mvHQ"),r=s.n(i),l=s("BO1k"),n=s.n(l),c=s("Dd8w"),d=s.n(c),m=s("ssT3"),p=s("oAV5"),u=s("hR2Z"),f=s("VZ4h"),h=s("enjp"),v=s("8uth"),g=s("ylbZ"),y=/^[1-9]*[1-9][0-9]*$/,k=/((^[1-9]\d*)|^0)(\.\d{0,2}){0,1}$/,_="/plateform/a/preSale/activity/saveActivity",b="/newretail-shop/a/preSale/goods/checkPreGoodsInsert",C={data:function(){return{isDisabled:!1,addParamMsg:{platformId:5,DIFFCITY:!0,regionCode:m.a.get("regionCode")||"",activityType:41,presaleType:2,cycleType:1,activityTypeName:"新人专享",activityName:"",startDatetime:"",endDatetime:"",shortCycleType:1,cutoffTime:"22:00",shortPickUpType:0,goodsReqList:[],storeNoList:[]},shortCircleOptions:[{label:"每天",value:1},{label:"每2天",value:2}],shortPickUpTypeOptions:[{label:"截单后第2天提",value:0}],pickerOptions:{disabledDate:function(e){return e.getTime()<Date.now()-864e5}},checkedList:[],activityStoresCheckedList:[],tempConfig:{platformCityGoodsId:"区域商品id(必填)",goodsNo:"SKU编码(选填)",skuNo:"ERP商品编码(选填)",goodsName:"活动商品名称(可修改，必填)",price:"原价(必填）",preSalePrice:"活动价(必填)",stock:"活动库存(选填，为空时不限)",limitCount:"每人限购(选填，为空时不限)",sortNum:"排序(必填)",sfInStockStr:"顺丰仓现货（选填，填是/否，空时为是）"},showTipErrorMsg:!1,hasErrorMsgData:[]}},components:{"excel-add":h.a,"choose-goods":f.a,"choose-store":u.a,region:g.a},methods:{doSaveHandel:function(){var e=this;if(this.addParamMsg.activityName)if(this.addParamMsg.activityName.length>30)this.$message("活动名称,限制30个字");else if(this.addParamMsg.startDatetime)if(this.addParamMsg.endDatetime){var t=Date.parse(new Date(this.addParamMsg.startDatetime));if(Date.parse(new Date(this.addParamMsg.endDatetime))<=t)this.$message("活动结束时间不能早于或等于活动开始时间");else if(this.addParamMsg.cutoffTime){var s=this.activityStoresCheckedList.map(function(e){return e.erpStoreNo});if(this.addParamMsg.storeNoList=s,0!==this.addParamMsg.storeNoList.length){var a=[],o=!0,i=!1,r=void 0;try{for(var l,c=n()(this.checkedList);!(o=(l=c.next()).done);o=!0){var m=l.value;if(!m.goodsName)return void this.$message("请输入("+m.goodsName+")的商品名称");if(!m.price)return void this.$message("请输入("+m.goodsName+")的原价");if(!k.test(m.price)||0==m.price)return void this.$message("原价是大于0，小数保留小数点后2位");if(!m.preSalePrice)return void this.$message("请输入("+m.goodsName+")的活动价");if(!k.test(m.preSalePrice)||0==m.preSalePrice)return void this.$message("活动价是大于0，小数保留小数点后2位");if(parseFloat(m.preSalePrice)>parseFloat(m.price))return void this.$message("("+m.goodsName+")的原价必须大于等于活动价");if(0!=m.stock&&m.stock){if(!y.test(m.stock))return void this.$message("门店限售库存格式不正确");if(m.stock<0)return void this.$message("门店限售库存不能小于0")}if(0!=m.limitCount&&m.limitCount){if(!y.test(m.limitCount))return void this.$message("输入限购数量格式不正确");if(m.limitCount<0)return void this.$message("限购数量不能小于0")}if(0!=m.sortNum&&m.sortNum){if(!y.test(m.sortNum))return void this.$message("排序权重为0 — 299的整数，越大越靠前");if(m.sortNum<0||m.sortNum>299)return void this.$message("排序权重为0 — 299的整数，越大越靠前")}var p={goodsId:m.goodsId,goodsNo:m.goodsNo,skuNo:m.skuNo,goodsName:m.goodsName,preSalePrice:m.preSalePrice,price:m.price,stock:m.stock,limitCount:m.limitCount,sortNum:m.sortNum,spec:m.spec,platformCityGoodsId:m.platformCityGoodsId,sfInStock:m.sfInStock};a.push(p)}}catch(e){i=!0,r=e}finally{try{!o&&c.return&&c.return()}finally{if(i)throw r}}if(0!==a.length){var u={DIFFCITY:this.addParamMsg.DIFFCITY,regionCode:this.addParamMsg.regionCode,activityName:this.addParamMsg.activityName,presaleType:this.addParamMsg.presaleType,startDatetime:this.addParamMsg.startDatetime,endDatetime:this.addParamMsg.endDatetime,storeNoList:this.addParamMsg.storeNoList,activityType:this.addParamMsg.activityType,cycleType:this.addParamMsg.cycleType,cutoffType:0,cutoffDays:this.addParamMsg.shortCycleType,cutoffTime:this.addParamMsg.cutoffTime,pickUpType:this.addParamMsg.shortPickUpType,goodsReqList:a};this.isDisabled=!0,this.$http.post(_,d()({},u)).then(function(t){if(setTimeout(function(){e.isDisabled=!1},800),0===t.code)return e.$message.success("保存成功"),void e.$router.push("/store_act");throw new Error(t.msg)}).catch(function(t){e.isDisabled=!1,e.$notify.error({title:"提示",message:t.message})})}else this.$message("请先设置活动商品")}else this.$message("请选择参与门店")}else this.$message("请选择截单时间")}else this.$message("请选择活动结束时间");else this.$message("请选择活动开始时间");else this.$message("请输入活动名称")},doCancelHandel:function(){var e=this;this.$confirm("确定取消吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$router.push("/store_act")}).catch(function(){})},goAddGoodsDialog:function(){if(this.$refs.chooseGoods){var e={title:"选择商品",regionCode:this.addParamMsg.regionCode,checkedList:this.checkedList};this.$refs.chooseGoods.setDefault(e)}},confirmChooseGoods:function(e){this.checkedList=e.checkedList||[]},deleteItem:function(e){var t=e.platformCityGoodsId,s=this.checkedList.filter(function(e){return e.platformCityGoodsId!=t});this.checkedList=JSON.parse(r()(s))},sortNumHeader:function(){var e=this.$createElement;return e("el-popover",{attrs:{placement:"top-start",trigger:"hover",content:"0-299 越大越靠前"}},[e("span",{slot:"reference"},["排序权重",e("i",{class:"el-icon-question"})])])},chooseStoreOpen:function(){var e={platformId:this.addParamMsg.platformId,regionCode:this.addParamMsg.regionCode,title:"选择门店",checkedList:this.activityStoresCheckedList};this.$refs.chooseStore.setDefault(e)},deleteStoreItem:function(e){var t=e.erpStoreNo;this.activityStoresCheckedList=this.activityStoresCheckedList.filter(function(e){return e.erpStoreNo!==t})},confirmChooseStore:function(e){var t=[];t=e.checkedList&&e.checkedList.length?e.checkedList:[],this.activityStoresCheckedList=t},sfInStockHeader:function(){var e=this.$createElement;return e("el-popover",{attrs:{placement:"top-start",width:"260",trigger:"hover"}},[e("div",[e("p",["1、顺丰标品设为顺丰仓现货时，下单会校验仓库库存；"]),e("p",["2、本来鲜生鲜品无需设置；"])]),e("span",{slot:"reference"},["是否为顺丰仓现货",e("i",{class:"el-icon-question"})])])},doConfirmHandel:function(e){var t=this,s=e.dataList||[];s.forEach(function(e){e.activityType=41}),this.$http.post(b,[].concat(o()(s))).then(function(e){if(t.$refs.excelAdd.closeDisabled(),t.$refs.excelAdd.closeDialog(),0!==e.code)throw new Error(e.msg);if(t.hasErrorMsgData=e.data&&e.data.length?e.data:[],t.hasErrorMsgData.some(function(e){return 1===e.msgType}))t.showTipErrorMsg=!0;else{var s=[].concat(o()(t.checkedList));s.forEach(function(e){t.hasErrorMsgData.forEach(function(t){e.goodsId===t.goodsId&&e.goodsNo===t.goodsNo&&e.platformCityGoodsId===t.platformCityGoodsId&&e.skuNo===t.skuNo&&(e.goodsName=t.goodsName,e.price=t.price,e.preSalePrice=t.preSalePrice,e.stock=t.stock,e.limitCount=t.limitCount,e.sortNum=t.sortNum,e.sfInStock=t.sfInStock)})});var a={};t.checkedList=[].concat(o()(s),o()(t.hasErrorMsgData)).reduceRight(function(e,t){return!a[t.platformCityGoodsId]&&(a[t.platformCityGoodsId]=e.push(t)),e},[])}}).catch(function(e){t.$refs.excelAdd.closeDisabled(),t.$refs.excelAdd.closeDialog(),t.$notify.error({title:"提示",message:e.message})})},showExcelBatchInsertDialog:function(){if(this.$refs.excelAdd){var e={title:"Excel 批量导入",tempConfig:this.tempConfig};this.$refs.excelAdd.setDefaultMsg(e)}},downLoadErrorMsg:function(){var e=this,t=d()({},this.tempConfig);t.msgTypeStr="验证结果",t.msg="失败原因",this.hasErrorMsgData.forEach(function(e){e.msgTypeStr=1===e.msgType?"验证失败":"验证成功"});var s=p.o(t,!1),a=p.o(t,!0);v.a.ExportJsonToExcel({header:s,filterVal:a,data:this.hasErrorMsgData,filename:"Excel批量导入模板"}),setTimeout(function(){e.$notify.success({title:"温馨提示",message:"Excel批量导入模板下载成功"}),e.isDisabled=!1},500)}}},w={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"add-form-wraper"},[s("el-form",{ref:"form",attrs:{model:e.addParamMsg,"label-width":"160px"}},[s("el-form-item",{attrs:{label:"活动类型",required:""}},[s("p",{staticStyle:{color:"#222","font-size":"16px","font-weight":"bold"}},[e._v(e._s(e.addParamMsg.activityTypeName))])]),e._v(" "),s("region",{staticClass:"region-wrap",attrs:{className:"add-input",label:"选择区域",required:!0}}),e._v(" "),s("el-form-item",{attrs:{label:"活动名称",required:""}},[s("el-input",{staticClass:"add-input",attrs:{size:"small",placeholder:"请输入活动名称"},model:{value:e.addParamMsg.activityName,callback:function(t){e.$set(e.addParamMsg,"activityName",t)},expression:"addParamMsg.activityName"}}),e._v(" "),s("span",[e._v("活动名称，限制30个字")])],1),e._v(" "),s("el-form-item",{attrs:{label:"开始时间",required:""}},[s("el-date-picker",{staticClass:"add-input",attrs:{size:"small",type:"datetime",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss","picker-options":e.pickerOptions,placeholder:"请输入开始时间"},model:{value:e.addParamMsg.startDatetime,callback:function(t){e.$set(e.addParamMsg,"startDatetime",t)},expression:"addParamMsg.startDatetime"}}),e._v(" "),s("span",[e._v("活动开始时间")])],1),e._v(" "),s("el-form-item",{attrs:{label:"结束时间",required:""}},[s("el-date-picker",{staticClass:"add-input",attrs:{size:"small",type:"datetime",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss","picker-options":e.pickerOptions,placeholder:"请输入结束时间"},model:{value:e.addParamMsg.endDatetime,callback:function(t){e.$set(e.addParamMsg,"endDatetime",t)},expression:"addParamMsg.endDatetime"}}),e._v(" "),s("span",[e._v("活动结束时间")])],1),e._v(" "),s("el-form-item",{attrs:{label:"截单时间",required:""}},[s("el-select",{staticClass:"add-input-inline",attrs:{placeholder:"截单时间",size:"small"},model:{value:e.addParamMsg.shortCycleType,callback:function(t){e.$set(e.addParamMsg,"shortCycleType",t)},expression:"addParamMsg.shortCycleType"}},e._l(e.shortCircleOptions,function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),s("el-time-picker",{staticClass:"add-input-inline",attrs:{placeholder:"选择时间",format:"HH:mm","value-format":"HH:mm",size:"small"},model:{value:e.addParamMsg.cutoffTime,callback:function(t){e.$set(e.addParamMsg,"cutoffTime",t)},expression:"addParamMsg.cutoffTime"}}),e._v(" "),s("span",[e._v("每天截单即24小时一个周期，每2天截单即48小时一个周期")])],1),e._v(" "),s("el-form-item",{attrs:{label:"提货日期",required:""}},[s("el-select",{staticClass:"add-input",attrs:{placeholder:"提货日期",size:"small"},model:{value:e.addParamMsg.shortPickUpType,callback:function(t){e.$set(e.addParamMsg,"shortPickUpType",t)},expression:"addParamMsg.shortPickUpType"}},e._l(e.shortPickUpTypeOptions,function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),s("span",[e._v("表示一个周期结束后的第二天提货")])],1),e._v(" "),s("el-form-item",{attrs:{label:"参与门店",required:""}},[s("el-button",{attrs:{size:"small",icon:"el-icon-plus"},on:{click:e.chooseStoreOpen}},[e._v("选择门店")]),e._v(" "),e.activityStoresCheckedList.length>0?s("div",{staticClass:"choose-store-table-wrap"},[s("el-table",{staticClass:"fixed-height",attrs:{data:e.activityStoresCheckedList,"empty-text":"暂无选中任何门店","max-height":"300",size:"small"}},[s("el-table-column",{attrs:{"min-width":"220px",label:"门店编码/名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("div",[e._v("\n                "+e._s(t.row.erpStoreNo)+"_"+e._s(t.row.erpStoreName)+"\n              ")])]}}],null,!1,974369925)}),e._v(" "),s("el-table-column",{attrs:{"min-width":"80",prop:"cityName",label:"城市"}}),e._v(" "),s("el-table-column",{attrs:{"min-width":"80",prop:"saleTypeName",label:"门店类型"}}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-delete"},on:{click:function(s){return e.deleteStoreItem(t.row)}}},[e._v("删除")])]}}],null,!1,3121094832)})],1)],1):e._e()],1),e._v(" "),s("el-form-item",{attrs:{label:"活动商品",required:""}},[s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-plus"},on:{click:e.goAddGoodsDialog}},[e._v("添加商品")]),s("el-button",{attrs:{size:"mini",icon:"el-icon-plus"},on:{click:e.showExcelBatchInsertDialog}},[e._v("Excel批量导入")]),e._v(" "),s("el-table",{staticClass:"fixed-height choose-goods-wrap",staticStyle:{width:"100%"},attrs:{data:e.checkedList,"empty-text":"暂无选中任何商品","max-height":"560",size:"small"}},[s("el-table-column",{attrs:{"min-width":"220px",label:"商品信息"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("div",{staticClass:"ll-p-m-w"},[s("div",{staticClass:"ll-img-w"},[t.row.imgUrl&&""!=t.row.imgUrl?s("img",{attrs:{src:t.row.imgUrl,alt:"",onerror:"onerror=null;src='/shop/static/img_error.png'"}}):s("img",{attrs:{src:"/shop/static/img_error.png",alt:""}})]),e._v(" "),s("div",{staticClass:"ll-p-m-c-r"},[s("div",[e._v("\n                  "+e._s(t.row.goodsName||"-")+"\n                ")]),e._v(" "),s("div",{staticClass:"ll-erp-p-no"},[e._v("SKU编码："+e._s(t.row.goodsNo||"--"))]),e._v(" "),s("div",{staticClass:"ll-erp-p-no"},[e._v("商品ID："+e._s(t.row.platformCityGoodsId||"--"))]),e._v(" "),s("div",{staticClass:"ll-erp-p-no"},[e._v("商品编码："+e._s(t.row.goodsId||"--"))])])])]}}])}),e._v(" "),s("el-table-column",{attrs:{"min-width":"100px",prop:"spec",label:"规格"}}),e._v(" "),s("el-table-column",{attrs:{"min-width":"130px",label:"原价(必填)"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("div",[s("el-input",{attrs:{size:"small",placeholder:"输入原价"},model:{value:t.row.price,callback:function(s){e.$set(t.row,"price",s)},expression:"scope.row.price"}})],1)]}}])}),e._v(" "),s("el-table-column",{attrs:{"min-width":"130px",label:"活动价(必填)"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("div",[s("el-input",{attrs:{size:"small",placeholder:"输入活动价"},model:{value:t.row.preSalePrice,callback:function(s){e.$set(t.row,"preSalePrice",s)},expression:"scope.row.preSalePrice"}})],1)]}}])}),e._v(" "),s("el-table-column",{attrs:{"min-width":"130px",label:"活动库存(选填)"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("div",[s("el-input",{attrs:{size:"small",placeholder:"活动库存"},model:{value:t.row.stock,callback:function(s){e.$set(t.row,"stock",s)},expression:"scope.row.stock"}})],1)]}}])}),e._v(" "),s("el-table-column",{attrs:{"min-width":"140px",label:"每人限购"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("div",[s("el-input",{attrs:{size:"small",placeholder:"每人限购"},model:{value:t.row.limitCount,callback:function(s){e.$set(t.row,"limitCount",s)},expression:"scope.row.limitCount"}})],1)]}}])}),e._v(" "),s("el-table-column",{attrs:{"min-width":"140px","render-header":e.sortNumHeader},scopedSlots:e._u([{key:"default",fn:function(t){return[s("div",[s("el-input",{attrs:{size:"small",placeholder:"排序（0-299越大越靠前）"},model:{value:t.row.sortNum,callback:function(s){e.$set(t.row,"sortNum",s)},expression:"scope.row.sortNum"}})],1)]}}])}),e._v(" "),s("el-table-column",{attrs:{"min-width":"190px","render-header":e.sfInStockHeader},scopedSlots:e._u([{key:"default",fn:function(t){return[s("div",[s("el-radio",{attrs:{label:!0},model:{value:t.row.sfInStock,callback:function(s){e.$set(t.row,"sfInStock",s)},expression:"scope.row.sfInStock"}},[e._v("是")]),e._v(" "),s("el-radio",{attrs:{label:!1},model:{value:t.row.sfInStock,callback:function(s){e.$set(t.row,"sfInStock",s)},expression:"scope.row.sfInStock"}},[e._v("否")])],1)]}}])}),e._v(" "),s("el-table-column",{attrs:{fixed:"right",align:"center",label:"操作",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-delete"},on:{click:function(s){return e.deleteItem(t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),s("p",[s("span",{staticStyle:{color:"red"}},[e._v("*")]),e._v("活动未发布时可以编辑商品，发布后只可添加新商品，不可再编辑已有商品；\n      ")]),e._v(" "),s("p",[s("span",{staticStyle:{color:"red"}},[e._v("*")]),e._v("活动进行中时新上门店，请在活动商品中发布至门店；\n      ")])],1),e._v(" "),s("hr",{staticClass:"s-slip-tb"}),e._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary",size:"small",disabled:e.isDisabled,icon:e.isDisabled?"el-icon-loading":null},on:{click:e.doSaveHandel}},[e._v("保存")]),e._v(" "),s("el-button",{attrs:{size:"small"},on:{click:e.doCancelHandel}},[e._v("取消")])],1)],1),e._v(" "),s("choose-goods",{ref:"chooseGoods",on:{confirmChooseGoods:e.confirmChooseGoods}}),e._v(" "),s("choose-store",{ref:"chooseStore",on:{confirmChooseStore:e.confirmChooseStore}}),e._v(" "),s("excel-add",{ref:"excelAdd",on:{doConfirmHandel:e.doConfirmHandel}}),e._v(" "),s("el-dialog",{attrs:{title:"批量导入失败",visible:e.showTipErrorMsg,"close-on-click-modal":!1,"close-on-press-escape":!1,width:"450px"},on:{"update:visible":function(t){e.showTipErrorMsg=t}}},[s("div",[e._v("\n      部分商品不符合要求，请按要求修改后再重新导入。"),s("el-button",{attrs:{type:"text",size:"mini"},on:{click:e.downLoadErrorMsg}},[e._v("下载查看失败原因")])],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{size:"mini"},on:{click:function(t){e.showTipErrorMsg=!1}}},[e._v("关 闭")])],1)])],1)},staticRenderFns:[]};var S=s("VU/8")(C,w,!1,function(e){s("pKIj")},null,null);t.default=S.exports}});
//# sourceMappingURL=140.888d25dee7359de906b3.js.map