webpackJsonp([136],{"3rvq":function(e,a){},idDY:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=t("Dd8w"),i=t.n(s),r=t("oAV5"),n=t("cIv3"),m=t("zme4"),d="/member/erp/prom/batchAddProm",o={data:function(){return{isDisabled:!1,addParamMesg:{triggerType:"",triggerTypeName:"扫码领券",cardType:2,title:"",beginTime:"",endTime:"",triggerTimesType:0,baseWinPromRate:"",winRatePromReqs:[{consumeAmount:"",winRate:""}],scanPromCountType:1,limitCount:""},triggerTypeList:[{value:81,label:"扫码送券"},{value:82,label:"扫码消费送券"}],triggerTimesTypeRadio:[{value:1,label:"整个活动只发放一次"},{value:2,label:"每天一次"},{value:3,label:"每周一次"}],scanPromCountTypeOptions:[{value:1,label:"每天可扫数量"},{value:2,label:"活动总可扫数量"}],setDisableTime:{disabledDate:function(e){return e.getTime()<Date.now()-864e5}}}},created:function(){this.triggerTypeChange(81)},mounted:function(){},components:{"store-template":n.a,"prom-type-template":m.a},methods:{triggerTypeChange:function(e){var a=[],t=e;81===t?(this.addParamMesg.triggerTimesType=1,a=[{value:1,label:"整个活动只发放一次"},{value:2,label:"每天一次"},{value:3,label:"每周一次"}]):82===t&&(this.addParamMesg.triggerTimesType=0,a=[{value:0,label:"无限制"},{value:1,label:"整个活动只发放一次"},{value:2,label:"每天一次"},{value:3,label:"每周一次"}]),this.triggerTimesTypeRadio=a},changeStore:function(e){if(e)for(var a in e)this.addParamMesg[a]=e[a]},changePromType:function(e){this.addParamMesg.promReqs=e},plusDiscountAdjus:function(){this.addParamMesg.winRatePromReqs.push({consumeAmount:"",winRate:""})},minusDiscountAdjus:function(e){this.addParamMesg.winRatePromReqs.splice(e,1)},formattData:function(){var e=this,a=/^\+?[1-9][0-9]*$/,t=/(^[1-9]{1}[0-9]*$)|(^[0-9]*\.[0-9]{1}$)|(^[0-9]*\.[0-9]{2}$)/;if(!this.addParamMesg.title)return this.$message("请输入活动名称"),!1;if(this.addParamMesg.title.length>30)return this.$message("活动名称限制30个汉字"),!1;if(""==this.addParamMesg.beginTime)return this.$message("请选择活动开始日期"),!1;if(this.addParamMesg.beginTime=r.u(new Date(this.addParamMesg.beginTime).getTime())+" 00:00:00",""==this.addParamMesg.endTime)return this.$message("请选择活动结束日期"),!1;if(this.addParamMesg.endTime=r.u(new Date(this.addParamMesg.endTime).getTime())+" 23:59:59",new Date(this.addParamMesg.endTime).getTime()<=new Date(this.addParamMesg.beginTime).getTime())return this.$message("活动结束日期不能早于或等于开始日期"),!1;if(this.addParamMesg.newRegister=!0===this.addParamMesg.newRegister?1:null,81===this.addParamMesg.triggerType||82===this.addParamMesg.triggerType){if(!this.addParamMesg.baseWinPromRate)return this.$message("请输入客户中奖概率"),!1;if(!a.test(this.addParamMesg.baseWinPromRate))return this.$message("客户中奖概率为大于0小于100的正整数"),!1;if(this.addParamMesg.baseWinPromRate>100)return this.$message("客户中奖概率为大于0小于100的正整数"),!1}if(81===this.addParamMesg.triggerType){if(!this.addParamMesg.limitCount)return this.$message("请输入设置条件中的次数"),!1;if(!a.test(this.addParamMesg.limitCount))return this.$message("设置条件中的次数为大于0的正整数"),!1}if(82===this.addParamMesg.triggerType)for(var s=this.addParamMesg.winRatePromReqs,i=0;i<s.length;i++){if(!s[i].consumeAmount||!s[i].winRate)return this.$message("请输入单笔门店消费金额和中奖概率"),!1;if(!a.test(s[i].consumeAmount))return this.$message("单笔门店消费金额不允许重复，金额为正整数"),!1;if(!a.test(s[i].winRate))return this.$message("中奖概率为大于0小于100的正整数"),!1;if(s[i].winRate>100)return this.$message("中奖概率为大于0小于100的正整数"),!1;for(var n=0;n<this.addParamMesg.winRatePromReqs.length;n++)if(i!==n&&s[i].consumeAmount===s[n].consumeAmount)return this.$message("单笔门店消费金额不允许重复，金额为正整数"),!1}if(""===this.addParamMesg.triggerTimesType)return this.$message("请选择发放频率"),!1;var m=this.addParamMesg.triggerTimesType;if(2===m?this.addParamMesg.triggerIntervalDays=1:3===m&&(this.addParamMesg.triggerIntervalDays=7),""===this.addParamMesg.useType||void 0===this.addParamMesg.useType)return this.$message("请选择卡券有效时间"),!1;if(1===this.addParamMesg.useType){if(""==this.addParamMesg.useBeginTime)return this.$message("请选择卡券有效开始日期"),!1;if(this.addParamMesg.useBeginTime=r.u(new Date(this.addParamMesg.useBeginTime).getTime())+" 00:00:00",""==this.addParamMesg.useEndTime)return this.$message("请选择卡券有效结束日期"),!1;if(this.addParamMesg.useEndTime=r.u(new Date(this.addParamMesg.useEndTime).getTime())+" 23:59:59",new Date(this.addParamMesg.useEndTime).getTime()<=new Date(this.addParamMesg.useBeginTime).getTime())return this.$message("卡券有效结束日期不能早于或等于开始日期"),!1;if(new Date(this.addParamMesg.useEndTime).getTime()<new Date(this.addParamMesg.endTime).getTime())return this.$message("卡券有效结束日期不能早于活动结束时间"),!1;delete this.addParamMesg.useDayCount}else if(2===this.addParamMesg.useType){if(""==this.addParamMesg.useDayCount)return this.$message("卡券有效使用天数不能为空"),!1;if(0==a.test(this.addParamMesg.useDayCount))return this.$message("卡券有效使用天数为大于零的整数"),!1;delete this.addParamMesg.useBeginTime,delete this.addParamMesg.useEndTime}var d=this.addParamMesg.promReqs[0],o=!0;d&&d.promDiscounts&&d.promDiscounts.length>0&&d.promDiscounts.forEach(function(e){for(var a in e)"discAmount"!=a&&"meetAmount"!=a&&"winPromRate"!=a||""==e[a]||(o=!1)});var l=this.addParamMesg.promReqs[1],u=!0;l&&l.promDiscounts&&l.promDiscounts.length>0&&l.promDiscounts.forEach(function(e){for(var a in e)"range"!=a&&"goodsType"!=a&&"needPayAmount"!=a&&"goodsNo"!=a&&"winPromRate"!=a||""==e[a]||(u=!1)});var g=0;if(o&&u)return this.$message("请设置满减券卡券奖励"),!1;if(0==o&&0==(!(!d||!d.promDiscounts)&&d.promDiscounts.every(function(s){return""==s.meetAmount||""==s.discAmount?(e.$message("满减券卡券奖励-满减金额或张数不能为空"),!1):!1===t.test(s.meetAmount)||!1===t.test(s.discAmount)?(e.$message("满减券卡券奖励-满减金额大于零的数字，允许输入两位小数"),!1):parseInt(s.meetAmount)<parseInt(s.discAmount)?(e.$message("满减券卡券奖励-减金额不能大于满金额"),!1):s.winPromRate?a.test(s.winPromRate)?s.winPromRate>100?(e.$message("满减券卡券奖励-获得该券概率为大于0小于100的正整数"),!1):(s.sendPromCount=1,g+=parseInt(s.winPromRate),!0):(e.$message("满减券卡券奖励-获得该券概率为大于0小于100的正整数"),!1):(e.$message("请输入满减券卡券奖励-获得该券概率"),!1)})))return!1;if(0==u&&0==(!(!l||!l.promDiscounts)&&l.promDiscounts.every(function(s){return""==s.needPayAmount||void 0==s.needPayAmount?(e.$message("商品券卡券奖励-商品应付价格不能为空"),!1):0==s.needPayAmount||t.test(s.needPayAmount)?""==s.goodsNo||void 0==s.goodsNo?(e.$message("商品券卡券奖励-请选择商品"),!1):""==s.productQtyLimit||void 0==s.productQtyLimit?(e.$message("商品券卡券奖励-请输入选择商品数量小于等于的值"),!1):a.test(s.productQtyLimit)?s.winPromRate?a.test(s.winPromRate)?s.winPromRate>100?(e.$message("商品券卡券奖励-获得该券概率为大于0小于100的正整数"),!1):(s.sendPromCount=1,g+=parseInt(s.winPromRate),!0):(e.$message("商品券卡券奖励-获得该券概率为大于0小于100的正整数"),!1):(e.$message("请输入商品券卡券奖励-获得该券概率"),!1):(e.$message("商品券卡券奖励-选择商品数量小于等于的值格式不对，为大于零的整数"),!1):(e.$message("商品券卡券奖励-商品应付价格输入大于等于0的数字，允许输入一位小数。"),!1)})))return!1;return g>100?(this.$message("卡券奖励-获得卡券概率总和不能大于100%"),!1):(1==o&&this.addParamMesg.promReqs.splice(0,1),1==u&&this.addParamMesg.promReqs.splice(1,1),!0)},doSaveHandel:function(){var e=this;!1!==this.formattData()&&(this.addParamMesg.promReqs[0]&&this.$set(this.addParamMesg.promReqs[0],"onlineGoodsType","3;4;5"),this.addParamMesg.promReqs[1]&&this.$set(this.addParamMesg.promReqs[1],"onlineGoodsType","3;4;5"),this.isDisabled=!0,this.$http.post(d,i()({},this.addParamMesg)).then(function(a){if(setTimeout(function(){e.isDisabled=!1},800),0===a.code)return e.$message.success("保存成功"),void e.$router.push("/discount_coupon");throw new Error(a.msg)}).catch(function(a){e.isDisabled=!1,e.$notify.error({title:"提示",message:a.message})}))},doCancelHandel:function(){var e=this;this.$confirm("确定取消吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$router.push("/discount_coupon")}).catch(function(){})}}},l={render:function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",[t("div",{staticClass:"add-form-wraper prom-reqs"},[t("el-form",{ref:"form",attrs:{model:e.addParamMesg,"label-width":"140px"}},[t("el-form-item",{attrs:{label:"活动类型",required:""}},[t("el-select",{staticClass:"add-input",attrs:{size:"small",placeholder:"请选择"},on:{change:e.triggerTypeChange},model:{value:e.addParamMesg.triggerType,callback:function(a){e.$set(e.addParamMesg,"triggerType",a)},expression:"addParamMesg.triggerType"}},e._l(e.triggerTypeList,function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),t("el-form-item",{attrs:{label:"活动名称",required:""}},[t("el-input",{staticClass:"add-input",attrs:{size:"small",placeholder:"请输入活动名称",clearable:""},model:{value:e.addParamMesg.title,callback:function(a){e.$set(e.addParamMesg,"title",a)},expression:"addParamMesg.title"}}),e._v(" "),t("span",[e._v("活动名称,限制30个汉字")])],1),e._v(" "),t("el-form-item",{attrs:{label:"活动开始日期",required:""}},[t("el-date-picker",{staticClass:"add-input",attrs:{type:"date",placeholder:"请选择活动开始日期","picker-options":e.setDisableTime,size:"small"},model:{value:e.addParamMesg.beginTime,callback:function(a){e.$set(e.addParamMesg,"beginTime",a)},expression:"addParamMesg.beginTime"}}),e._v(" "),t("span",[e._v("活动开始日期")])],1),e._v(" "),t("el-form-item",{attrs:{label:"活动结束日期",required:""}},[t("el-date-picker",{staticClass:"add-input",attrs:{type:"date",placeholder:"请选择活动结束日期","picker-options":e.setDisableTime,size:"small"},model:{value:e.addParamMesg.endTime,callback:function(a){e.$set(e.addParamMesg,"endTime",a)},expression:"addParamMesg.endTime"}}),e._v(" "),t("span",[e._v("活动结束日期")])],1),e._v(" "),t("el-form-item",{attrs:{label:"设置条件"}},[t("div",[e._v("\n          客户中奖概率：\n          "),t("el-input",{staticClass:"coupon-input",attrs:{size:"small"},model:{value:e.addParamMesg.baseWinPromRate,callback:function(a){e.$set(e.addParamMesg,"baseWinPromRate",a)},expression:"addParamMesg.baseWinPromRate"}},[t("template",{slot:"append"},[e._v("%")])],2)],1),e._v(" "),81===e.addParamMesg.triggerType?t("div",[t("el-select",{staticClass:"search-input",attrs:{size:"small"},model:{value:e.addParamMesg.scanPromCountType,callback:function(a){e.$set(e.addParamMesg,"scanPromCountType","string"==typeof a?a.trim():a)},expression:"addParamMesg.scanPromCountType"}},e._l(e.scanPromCountTypeOptions,function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),e._v("\n              共\n          "),t("el-input",{staticClass:"coupon-input",attrs:{size:"small"},model:{value:e.addParamMesg.limitCount,callback:function(a){e.$set(e.addParamMesg,"limitCount",a)},expression:"addParamMesg.limitCount"}},[t("template",{slot:"append"},[e._v("次")])],2)],1):82===e.addParamMesg.triggerType?e._l(e.addParamMesg.winRatePromReqs,function(a,s){return t("div",{key:s},[e._v("\n          单笔门店消费：\n          "),t("el-input",{staticClass:"coupon-input",attrs:{size:"small"},model:{value:a.consumeAmount,callback:function(t){e.$set(a,"consumeAmount",t)},expression:"item.consumeAmount"}},[t("template",{slot:"append"},[e._v("元")])],2),e._v("\n              \n          中奖概率：\n          "),t("el-input",{staticClass:"coupon-input",attrs:{size:"small"},model:{value:a.winRate,callback:function(t){e.$set(a,"winRate",t)},expression:"item.winRate"}},[t("template",{slot:"append"},[e._v("%")])],2),e._v(" "),t("i",{staticClass:"push-remove el-icon-circle-plus",on:{click:e.plusDiscountAdjus}}),e._v(" "),e.addParamMesg.winRatePromReqs.length>1?t("i",{staticClass:"push-remove el-icon-remove",on:{click:function(a){return e.minusDiscountAdjus(s)}}}):e._e()],1)}):e._e()],2),e._v(" "),t("el-form-item",{attrs:{label:"客户开奖频率"}},[t("el-radio-group",{model:{value:e.addParamMesg.triggerTimesType,callback:function(a){e.$set(e.addParamMesg,"triggerTimesType",a)},expression:"addParamMesg.triggerTimesType"}},e._l(e.triggerTimesTypeRadio,function(a){return t("el-radio",{key:a.value,attrs:{label:a.value}},[e._v("\n            "+e._s(a.label)+"\n          ")])}),1)],1),e._v(" "),t("store-template",{on:{changeStore:e.changeStore}}),e._v(" "),t("prom-type-template",{attrs:{triggerType:e.addParamMesg.triggerType},on:{changePromType:e.changePromType}}),e._v(" "),t("el-form-item",[t("el-button",{attrs:{type:"primary",size:"small",disabled:e.isDisabled},on:{click:e.doSaveHandel}},[e._v("保存")]),e._v(" "),t("el-button",{attrs:{size:"small"},on:{click:e.doCancelHandel}},[e._v("取消")])],1)],1)],1)])},staticRenderFns:[]};var u=t("VU/8")(o,l,!1,function(e){t("3rvq")},null,null);a.default=u.exports}});
//# sourceMappingURL=136.0bbfe323c55deab8219a.js.map