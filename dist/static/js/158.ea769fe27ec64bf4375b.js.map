{"version":3,"sources":["webpack:///src/components/Activity/DisCoupon/Add/AddCharge.vue","webpack:///./src/components/Activity/DisCoupon/Add/AddCharge.vue?d546","webpack:///./src/components/Activity/DisCoupon/Add/AddCharge.vue"],"names":["reqUrl","AddCharge","data","isDisabled","addParamMesg","triggerType","triggerTypeName","cardType","title","beginTime","endTime","triggerTypeList","value","label","setDisableTime","disabledDate","time","getTime","Date","now","created","mounted","components","store-template","TemplateStore","prom-type-template","TemplatePromType","methods","changeStore","val","key","this","changePromType","promReqs","formattData","_this","countReg","countRegtofixed","$message","length","utils","useType","undefined","useBeginTime","useEndTime","useDayCount","test","disCount","disIsnull","promDiscounts","forEach","item","goodCount","goodIsnull","every","triggerAmount","index","indexOf","slice","meetAmount","discAmount","sendPromCount","parseInt","remark","sendCount","sendIntervalDays","needPayAmount","goodsNo","productQtyLimit","splice","doSaveHandel","_this2","$set","$http","post","extends_default","then","res","setTimeout","code","success","$router","push","Error","msg","catch","e","$notify","error","message","doCancelHandel","_this3","$confirm","confirmButtonText","cancelButtonText","type","Add_AddCharge","render","_vm","_h","$createElement","_c","_self","staticClass","ref","attrs","model","label-width","required","size","placeholder","callback","$$v","expression","_l","_v","clearable","picker-options","on","disabled","click","staticRenderFns","Component","__webpack_require__","normalizeComponent","__webpack_exports__"],"mappings":"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","file":"static/js/158.ea769fe27ec64bf4375b.js","sourcesContent":["<template>\r\n  <div>\r\n    <div class=\"add-form-wraper\">\r\n      <el-form ref=\"form\" :model=\"addParamMesg\" label-width=\"140px\">\r\n        <el-form-item label=\"活动类型\" required>\r\n          <el-select size=\"small\" class=\"add-input\" v-model=\"addParamMesg.triggerType\" placeholder=\"请选择\">\r\n            <el-option :label=\"item.label\" :value=\"item.value\" :key=\"item.value\" v-for=\"item in triggerTypeList\"></el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item label=\"活动名称\" required>\r\n          <el-input v-model=\"addParamMesg.title\" size=\"small\" class=\"add-input\" placeholder=\"请输入活动名称\" clearable></el-input>\r\n          <span>活动名称,限制30个汉字</span>\r\n        </el-form-item>\r\n        <el-form-item label=\"活动开始日期\" required>\r\n          <el-date-picker\r\n            class=\"add-input\"\r\n            v-model=\"addParamMesg.beginTime\"\r\n            type=\"date\"\r\n            placeholder=\"请选择活动开始日期\"\r\n            :picker-options=\"setDisableTime\"\r\n            size=\"small\">\r\n          </el-date-picker>\r\n          <span>活动开始日期</span>\r\n        </el-form-item>\r\n        <el-form-item label=\"活动结束日期\" required>\r\n          <el-date-picker\r\n            class=\"add-input\"\r\n            v-model=\"addParamMesg.endTime\"\r\n            type=\"date\"\r\n            placeholder=\"请选择活动结束日期\"\r\n            :picker-options=\"setDisableTime\"\r\n            size=\"small\">\r\n          </el-date-picker>\r\n          <span>活动结束日期</span>\r\n        </el-form-item>\r\n\r\n        <!-- 门店 -->\r\n        <store-template @changeStore=\"changeStore\"></store-template>\r\n        <!-- 卡券形式 满减券 商品券 -->\r\n        <prom-type-template @changePromType=\"changePromType\" :triggerType=\"addParamMesg.triggerType\"></prom-type-template>\r\n\r\n        <el-form-item>\r\n          <el-button type=\"primary\" size=\"small\" @click=\"doSaveHandel\" :disabled=\"isDisabled\">保存</el-button>\r\n          <el-button size=\"small\" @click=\"doCancelHandel\">取消</el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\n  import * as utils from '@/utils/utils'\r\n  import TemplateStore from \"../AddTemplate/TemplateStore\"\r\n  import TemplatePromType from \"../AddTemplate/TemplatePromType\"\r\n\r\n  const reqUrl = {\r\n    // 添加优惠券\r\n    batchAddProm: \"/member/erp/prom/batchAddProm\"\r\n  }\r\n  export default {\r\n    data() {\r\n      return {\r\n        isDisabled: false,\r\n        addParamMesg: {\r\n          triggerType: '',\r\n          triggerTypeName: '充值返券',\r\n          cardType: 2,\r\n          title: '',\r\n          beginTime: '',\r\n          endTime: ''\r\n        },\r\n        triggerTypeList: [\r\n          {\r\n            value: 4,\r\n            label: '充值发券(单次)'\r\n          },\r\n          {\r\n            value: 42,\r\n            label: '充值发券(多次)'\r\n          }\r\n        ],\r\n        setDisableTime: {\r\n          disabledDate(time) {\r\n            return time.getTime() < Date.now() - 8.64e7;\r\n          }\r\n        }\r\n\r\n      }\r\n    },\r\n    created() {\r\n\r\n    },\r\n    mounted() {\r\n      \r\n    },\r\n    components: {\r\n      \"store-template\": TemplateStore,\r\n      \"prom-type-template\": TemplatePromType\r\n    },\r\n    methods: {\r\n      changeStore(val) {\r\n        // 传值\r\n        if(val) {\r\n          for(let key in val) {\r\n            this.addParamMesg[key] = val[key]\r\n          }\r\n        }\r\n      },\r\n      changePromType(val) {\r\n        this.addParamMesg.promReqs = val\r\n      },\r\n      /**\r\n       * [formattData 数据格式化]\r\n       * @return {[type]} [description]\r\n       */\r\n      formattData() {\r\n        let countReg = /^\\+?[1-9][0-9]*$/;\r\n        let countRegtofixed = /(^[1-9]{1}[0-9]*$)|(^[0-9]*\\.[0-9]{1}$)|(^[0-9]*\\.[0-9]{2}$)/\r\n        // 活动名称 日期\r\n        if(!this.addParamMesg.title) {\r\n          this.$message(\"请输入活动名称\")\r\n          return false\r\n        }else if(this.addParamMesg.title.length > 30) {\r\n          this.$message(\"活动名称限制30个汉字\")\r\n          return false\r\n        }\r\n        if(this.addParamMesg.beginTime == \"\") {\r\n          this.$message(\"请选择活动开始日期\")\r\n          return false\r\n        }else {\r\n          this.addParamMesg.beginTime = utils.timestampToTimeNoHMS(new Date(this.addParamMesg.beginTime).getTime()) + ' 00:00:00'\r\n        }\r\n        if(this.addParamMesg.endTime == \"\") {\r\n          this.$message(\"请选择活动结束日期\")\r\n          return false\r\n        }else {\r\n          this.addParamMesg.endTime = utils.timestampToTimeNoHMS(new Date(this.addParamMesg.endTime).getTime()) + ' 23:59:59'\r\n        }\r\n        if(new Date(this.addParamMesg.endTime).getTime() <= new Date(this.addParamMesg.beginTime).getTime()) {\r\n          this.$message(\"活动结束日期不能早于或等于开始日期\")\r\n          return false\r\n        }\r\n\r\n        // 卡券有效时间\r\n        if(this.addParamMesg.useType === \"\" || this.addParamMesg.useType === undefined) {\r\n          this.$message(\"请选择卡券有效时间\")\r\n          return false\r\n        }else if(this.addParamMesg.useType === 1) {\r\n          if(this.addParamMesg.useBeginTime == \"\") {\r\n            this.$message(\"请选择卡券有效开始日期\")\r\n            return false\r\n          }else {\r\n            this.addParamMesg.useBeginTime = utils.timestampToTimeNoHMS(new Date(this.addParamMesg.useBeginTime).getTime()) + ' 00:00:00'\r\n          }\r\n          if(this.addParamMesg.useEndTime == \"\") {\r\n            this.$message(\"请选择卡券有效结束日期\")\r\n            return false\r\n          }else {\r\n            this.addParamMesg.useEndTime = utils.timestampToTimeNoHMS(new Date(this.addParamMesg.useEndTime).getTime()) + ' 23:59:59'\r\n          }\r\n          if(new Date(this.addParamMesg.useEndTime).getTime() <= new Date(this.addParamMesg.useBeginTime).getTime()) {\r\n            this.$message(\"卡券有效结束日期不能早于或等于开始日期\")\r\n            return false\r\n          }\r\n          if(new Date(this.addParamMesg.useEndTime).getTime() < new Date(this.addParamMesg.endTime).getTime()) {\r\n            this.$message(\"卡券有效结束日期不能早于活动结束时间\")\r\n            return false\r\n          }\r\n          delete this.addParamMesg['useDayCount']\r\n        }else if(this.addParamMesg.useType === 2) {\r\n          if(this.addParamMesg.useDayCount == \"\") {\r\n            this.$message(\"卡券有效使用天数不能为空\")\r\n            return false\r\n          }\r\n          if(countReg.test(this.addParamMesg.useDayCount) == false) {\r\n            this.$message(\"卡券有效使用天数为大于零的整数\");\r\n            return false\r\n          }\r\n          delete this.addParamMesg['useBeginTime']\r\n          delete this.addParamMesg['useEndTime']\r\n        }\r\n\r\n        // 满减券\r\n        let disCount = this.addParamMesg.promReqs[0]\r\n        let disIsnull = true\r\n        if(disCount && disCount.promDiscounts && disCount.promDiscounts.length > 0) {\r\n          disCount.promDiscounts.forEach(item => {\r\n            for(let key in item) {\r\n              if((key == 'triggerAmount' || key == 'discAmount' || key == 'meetAmount' || key == 'sendPromCount') && item[key] != '') {\r\n                disIsnull = false\r\n              }\r\n            }        \r\n          })\r\n        }\r\n        // 商品券\r\n        let goodCount = this.addParamMesg.promReqs[1]\r\n        let goodIsnull = true\r\n        if(goodCount && goodCount.promDiscounts && goodCount.promDiscounts.length > 0) {\r\n          goodCount.promDiscounts.forEach(item => {\r\n            for(let key in item) {\r\n              if((key == 'triggerAmount' || key == 'range' || key == 'goodsType' || key == 'needPayAmount' || key == 'goodsNo' || key == 'sendPromCount') && item[key] != '') {\r\n                goodIsnull = false\r\n              }\r\n            }        \r\n          })\r\n        }\r\n\r\n        if(disIsnull && goodIsnull) {\r\n          this.$message('请设置满减券卡券奖励')\r\n          return false\r\n        }\r\n        if(disIsnull == false) {\r\n          let dis = disCount && disCount.promDiscounts ? disCount.promDiscounts.every(item => {\r\n            if(item.triggerAmount) {\r\n              let index = item.triggerAmount.indexOf('元')\r\n              if(index > -1) {\r\n                item.triggerAmount = item.triggerAmount.slice(0, index)\r\n              }\r\n            } \r\n            if(item.triggerAmount == \"\" || item.triggerAmount == undefined) {\r\n              this.$message(\"满减券卡券奖励-充值金额不能为空\");\r\n              return false\r\n            }\r\n            if(item.meetAmount == '' || item.discAmount == '' || item.sendPromCount == '') {\r\n              this.$message(\"满减券卡券奖励-满减金额或张数不能为空\");\r\n              return false\r\n            }else if(countRegtofixed.test(item.meetAmount) === false || countRegtofixed.test(item.discAmount) === false) {\r\n              this.$message(\"满减券卡券奖励-满减金额大于零的数字，允许输入两位小数\");\r\n              return false\r\n            }else if(countReg.test(item.sendPromCount) === false) {\r\n              this.$message(\"满减券卡券奖励-满减金额或张数为大于零的整数\");\r\n              return false\r\n            }else if(parseInt(item.meetAmount) < parseInt(item.discAmount)) {\r\n              this.$message(\"满减券卡券奖励-减金额不能大于满金额\");\r\n              return false\r\n            }\r\n            if(this.addParamMesg.triggerType === 4) {\r\n              // 充值发券(单次)\r\n              if(item.remark && item.remark.length > 20) {\r\n                this.$message('满减券卡券奖励-自定义活动文案，建议12个字，不得超过20个字')\r\n                return false\r\n              }\r\n            }\r\n            if(this.addParamMesg.triggerType === 42) {\r\n              // 充值发券(多次)\r\n              if(item.sendCount === '') {\r\n                this.$message('满减券卡券奖励-发放次数不能为空')\r\n                return false\r\n              }else {\r\n                if(!countReg.test(item.sendCount) || item.sendCount <= 1) {\r\n                  this.$message('满减券卡券奖励-发放次数为大于1的整数')\r\n                  return false\r\n                }\r\n              }\r\n              if(item.sendIntervalDays === '') {\r\n                this.$message('满减券卡券奖励-发放优惠券间隔不能为空')\r\n                return false\r\n              }else {\r\n                if(!countReg.test(item.sendIntervalDays)) {\r\n                  this.$message('满减券卡券奖励-发放优惠券间隔为大于零的整数')\r\n                  return false\r\n                }\r\n              }\r\n              if(item.remark && item.remark.length > 20) {\r\n                this.$message('满减券卡券奖励-自定义活动文案，建议12个字，不得超过20个字')\r\n                return false\r\n              }\r\n              return true\r\n            }\r\n            return true\r\n          }) : false\r\n          if(dis == false) {\r\n            return false\r\n          }\r\n        }\r\n        if(goodIsnull == false) {\r\n          let good = goodCount && goodCount.promDiscounts ? goodCount.promDiscounts.every(item => {\r\n            if(item.triggerAmount) {\r\n              let index = item.triggerAmount.indexOf('元')\r\n              if(index > -1) {\r\n                item.triggerAmount = item.triggerAmount.slice(0, index)\r\n              }\r\n            } \r\n            if(item.triggerAmount == \"\" || item.triggerAmount == undefined) {\r\n              this.$message(\"商品券卡券奖励-充值金额不能为空\");\r\n              return false\r\n            }\r\n            if(item.needPayAmount == '' || item.needPayAmount == undefined) {\r\n              this.$message('商品券卡券奖励-商品应付价格不能为空')\r\n              return false\r\n            }else {\r\n              if(item.needPayAmount != 0 && !countRegtofixed.test(item.needPayAmount)) {\r\n                this.$message('商品券卡券奖励-商品应付价格输入大于等于0的数字，允许输入一位小数。')\r\n                return false\r\n              }\r\n            }\r\n            if(item.goodsNo == '' || item.goodsNo == undefined) {\r\n              this.$message('商品券卡券奖励-请选择商品')\r\n              return false\r\n            }\r\n            if(item.productQtyLimit == '' || item.productQtyLimit == undefined) {\r\n              this.$message('商品券卡券奖励-请输入选择商品数量小于等于的值')\r\n              return false\r\n            }else {\r\n              if(!countReg.test(item.productQtyLimit)) {\r\n                this.$message('商品券卡券奖励-选择商品数量小于等于的值格式不对，为大于零的整数')\r\n                return false\r\n              }\r\n            }\r\n            if(item.sendPromCount === '' || item.sendPromCount == undefined) {\r\n              this.$message('商品券卡券奖励-请输入发放优惠券数量')\r\n              return false\r\n            }else { \r\n              if(!countReg.test(item.sendPromCount)) {\r\n                this.$message('商品券卡券奖励-发放优惠券数量为大于零的整数')\r\n                return false\r\n              }\r\n            }\r\n            if(this.addParamMesg.triggerType === 4) {\r\n              // 充值发券(单次)\r\n              if(item.remark && item.remark.length > 20) {\r\n                this.$message('卡券奖励-自定义活动文案，建议12个字，不得超过20个字')\r\n                return false\r\n              }\r\n            }\r\n            if(this.addParamMesg.triggerType === 42) {\r\n              if(item.sendCount === '' || item.sendCount == undefined) {\r\n                this.$message('卡券奖励-共发放次数不能为空')\r\n                return false\r\n              }else {\r\n                if(!countReg.test(item.sendCount) || item.sendCount <= 1) {\r\n                  this.$message('卡券奖励-共发放次数为大于1的整数')\r\n                  return false\r\n                }\r\n              }\r\n              if(item.sendIntervalDays === '' || item.sendIntervalDays == undefined) {\r\n                this.$message('卡券奖励-发放优惠券间隔不能为空')\r\n                return false\r\n              }else {\r\n                if(!countReg.test(item.sendIntervalDays)) {\r\n                  this.$message('卡券奖励-发放优惠券间隔为大于零的整数')\r\n                  return false\r\n                }\r\n              }\r\n              if(item.remark && item.remark.length > 20) {\r\n                this.$message('卡券奖励-自定义活动文案，建议12个字，不得超过20个字')\r\n                return false\r\n              }\r\n            }\r\n\r\n            return true\r\n          }) : false\r\n          if(good == false) {\r\n            return false\r\n          }\r\n        }\r\n        // 删除空的满减券或者商品券\r\n        if(disIsnull == true) {\r\n          this.addParamMesg.promReqs.splice(0,1)\r\n        }\r\n        if(goodIsnull == true) {\r\n          this.addParamMesg.promReqs.splice(1,1)\r\n        }\r\n        return true\r\n      },\r\n      /**\r\n       * [doSaveHandel 保存]\r\n       * @return {[type]} [description]\r\n       */\r\n      doSaveHandel() {\r\n        if(this.formattData() === false) {\r\n          return\r\n        }\r\n        // 商品类型传3、4、5\r\n        if(this.addParamMesg.promReqs[0]) {\r\n          this.$set(this.addParamMesg.promReqs[0], 'onlineGoodsType', '3;4;5')\r\n        }\r\n        if(this.addParamMesg.promReqs[1]) {\r\n          this.$set(this.addParamMesg.promReqs[1], 'onlineGoodsType', '3;4;5')\r\n        }\r\n        this.isDisabled = true\r\n        this.$http.post(reqUrl.batchAddProm, {...this.addParamMesg}).then(res => {\r\n          // 保存按钮可再次点击\r\n          setTimeout(() => {\r\n            this.isDisabled = false\r\n          }, 800)\r\n          if(res.code === 0) {\r\n            this.$message.success(\"保存成功\")\r\n            this.$router.push('/discount_coupon')\r\n            return\r\n          }\r\n          throw new Error(res.msg)\r\n        }).catch(e => {\r\n          this.isDisabled = false\r\n          this.$notify.error({\r\n            title: '提示',\r\n            message: e.message\r\n          })\r\n        })\r\n      },\r\n      doCancelHandel() {\r\n        this.$confirm('确定取消吗?', '提示', {\r\n          confirmButtonText: '确定',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        }).then(() => {\r\n          this.$router.push('/discount_coupon')\r\n        }).catch(() => {})\r\n      }\r\n    }\r\n  }\r\n\r\n</script>\n\n\n// WEBPACK FOOTER //\n// src/components/Activity/DisCoupon/Add/AddCharge.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('div',{staticClass:\"add-form-wraper\"},[_c('el-form',{ref:\"form\",attrs:{\"model\":_vm.addParamMesg,\"label-width\":\"140px\"}},[_c('el-form-item',{attrs:{\"label\":\"活动类型\",\"required\":\"\"}},[_c('el-select',{staticClass:\"add-input\",attrs:{\"size\":\"small\",\"placeholder\":\"请选择\"},model:{value:(_vm.addParamMesg.triggerType),callback:function ($$v) {_vm.$set(_vm.addParamMesg, \"triggerType\", $$v)},expression:\"addParamMesg.triggerType\"}},_vm._l((_vm.triggerTypeList),function(item){return _c('el-option',{key:item.value,attrs:{\"label\":item.label,\"value\":item.value}})}),1)],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"活动名称\",\"required\":\"\"}},[_c('el-input',{staticClass:\"add-input\",attrs:{\"size\":\"small\",\"placeholder\":\"请输入活动名称\",\"clearable\":\"\"},model:{value:(_vm.addParamMesg.title),callback:function ($$v) {_vm.$set(_vm.addParamMesg, \"title\", $$v)},expression:\"addParamMesg.title\"}}),_vm._v(\" \"),_c('span',[_vm._v(\"活动名称,限制30个汉字\")])],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"活动开始日期\",\"required\":\"\"}},[_c('el-date-picker',{staticClass:\"add-input\",attrs:{\"type\":\"date\",\"placeholder\":\"请选择活动开始日期\",\"picker-options\":_vm.setDisableTime,\"size\":\"small\"},model:{value:(_vm.addParamMesg.beginTime),callback:function ($$v) {_vm.$set(_vm.addParamMesg, \"beginTime\", $$v)},expression:\"addParamMesg.beginTime\"}}),_vm._v(\" \"),_c('span',[_vm._v(\"活动开始日期\")])],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"活动结束日期\",\"required\":\"\"}},[_c('el-date-picker',{staticClass:\"add-input\",attrs:{\"type\":\"date\",\"placeholder\":\"请选择活动结束日期\",\"picker-options\":_vm.setDisableTime,\"size\":\"small\"},model:{value:(_vm.addParamMesg.endTime),callback:function ($$v) {_vm.$set(_vm.addParamMesg, \"endTime\", $$v)},expression:\"addParamMesg.endTime\"}}),_vm._v(\" \"),_c('span',[_vm._v(\"活动结束日期\")])],1),_vm._v(\" \"),_c('store-template',{on:{\"changeStore\":_vm.changeStore}}),_vm._v(\" \"),_c('prom-type-template',{attrs:{\"triggerType\":_vm.addParamMesg.triggerType},on:{\"changePromType\":_vm.changePromType}}),_vm._v(\" \"),_c('el-form-item',[_c('el-button',{attrs:{\"type\":\"primary\",\"size\":\"small\",\"disabled\":_vm.isDisabled},on:{\"click\":_vm.doSaveHandel}},[_vm._v(\"保存\")]),_vm._v(\" \"),_c('el-button',{attrs:{\"size\":\"small\"},on:{\"click\":_vm.doCancelHandel}},[_vm._v(\"取消\")])],1)],1)],1)])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-2f124f46\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/Activity/DisCoupon/Add/AddCharge.vue\n// module id = null\n// module chunks = ","var normalizeComponent = require(\"!../../../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./AddCharge.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./AddCharge.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-2f124f46\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../../../node_modules/vue-loader/lib/selector?type=template&index=0!./AddCharge.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = null\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/Activity/DisCoupon/Add/AddCharge.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}