webpackJsonp([111],{OPD4:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("Gu7T"),o=a.n(r),s=a("Dd8w"),n=a.n(s),i=a("BO1k"),l=a.n(i),c=(a("ssT3"),a("oAV5")),d="/plateform/a/category/getCategoryTree",h="/plateform/a/sf/stock/list",u="/plateform/a/sf/stock/retrySync",p="/plateform/a/sf/stock/retryTransferTotal",m={data:function(){return{isDisabled:!1,loading:!1,pageNum:1,pageSize:10,total:0,searchContent:{saleType:1,platformId:6,queryString:"",platformCityGoodsIds:[],categoryId:"",goodsNoList:[],categoryIdList:[],orderDateFrom:"",orderDateTo:"",syncStatus:""},syncStatusOptions:[{label:"全部",value:""},{label:"待同步",value:0},{label:"同步中",value:1},{label:"同步成功",value:2},{label:"同步失败",value:3},{label:"不同步",value:4}],dateTag:1,erpTotalDate:c.u(Date.parse(new Date)),dateTagOptions:[{label:"今日",value:1},{label:"昨日",value:2}],cateDefaultProps:{children:"categoryVoList",label:"categoryName",value:"categoryId"},categoryList:[],tableData:[],checkedList:[],dialogTitle:"重新查询要货汇总",formLabelWidth:"80",dialogFormVisible:!1,dialogFrom:"research",syncErrMsg:"",skuListMsg:[],transferTotalPaperNo:"",transferTotalTime:"",transferGoodsList:""}},created:function(){this.getCategoryId()},mounted:function(){this.doSearchHandel()},components:{"goods-select":a("d7hP").a},methods:{orderQtyHeader:function(){var t=this.$createElement;return t("el-popover",{attrs:{placement:"top-start",width:"260",trigger:"hover",content:"组合商品时，取转化线上库存最少的商品要货数量。"}},[t("span",{slot:"reference"},["母商品要货数量",t("i",{class:"el-icon-question"})])])},stockQtyHeader:function(){var t=this.$createElement;return t("el-popover",{attrs:{placement:"top-start",width:"260",trigger:"hover",content:"库存 = 母商品要货数量 * 转换比例；多个母商品时取最小库存数。"}},[t("span",{slot:"reference"},["库存",t("i",{class:"el-icon-question"})])])},safeStockQtyHeader:function(){var t=this.$createElement;return t("el-popover",{attrs:{placement:"top-start",width:"260",trigger:"hover",content:"安全库存 = 库存 * 安全库存占比。"}},[t("span",{slot:"reference"},["安全库存",t("i",{class:"el-icon-question"})])])},emptyFormatter:function(t,e,a){return a||0===a?a:"--"},skuTypeFormatter:function(t,e,a){return"C"===a?"组合商品":"Q"==a?"计量商品":"S"==a?"标准商品":"W"==a?"重量商品":"--"},handleSelection:function(t,e){return t.canRetry},getCategoryId:function(){var t=this;this.$http.post(d).then(function(e){if(0!==e.code)throw new Error(e.msg);if(e.data&&e.data.length){var a=!0,r=!1,o=void 0;try{for(var s,n=l()(e.data);!(a=(s=n.next()).done);a=!0){var i=s.value;i.categoryVoList&&0===i.categoryVoList.length&&(i.categoryVoList=null)}}catch(t){r=!0,o=t}finally{try{!a&&n.return&&n.return()}finally{if(r)throw o}}t.categoryList=e.data}else t.categoryList=[]}).catch(function(t){console.log("提示(三方平台店内分类):",t.message)})},doCategoryChangeHandel:function(){this.goodsSelectInit(),this.doSearchHandel(!0)},goodsSelectInit:function(){if(this.$refs.GoodsSelect){var t={queryString:this.searchContent.queryString,categoryIdList:this.searchContent.categoryIdList,saleType:this.searchContent.saleType,platformId:this.searchContent.platformId,platformCityGoodsIds:this.searchContent.platformCityGoodsIds};this.$refs.GoodsSelect.setDefaultMesg(t)}},changeSize:function(t){this.pageSize=t,this.doSearchHandel()},changeCurrent:function(t){this.pageNum=t,this.doSearchHandel()},doSearchHandel:function(t){var e=this;this.checkedList=[];var a=this.searchContent.categoryIdList.length-1;this.searchContent.categoryId=this.searchContent.categoryIdList[a];var r=this.searchContent.orderDateFrom?new Date(this.searchContent.orderDateFrom.replace(/-/g,"/")).getTime():0,o=this.searchContent.orderDateTo?new Date(this.searchContent.orderDateTo.replace(/-/g,"/")).getTime():0;if(this.searchContent.orderDateFrom&&this.searchContent.orderDateTo&&!isNaN(r)&&!isNaN(o)&&r>o)this.$message.warning("订货结束日期不能早于开始日期");else{this.loading=!0,!0===t&&(this.pageNum=1);var s={pageNum:this.pageNum,pageSize:this.pageSize,categoryId:this.searchContent.categoryId,goodsNoList:this.searchContent.goodsNoList,orderDateFrom:this.searchContent.orderDateFrom?this.searchContent.orderDateFrom+" 00:00:00":"",orderDateTo:this.searchContent.orderDateTo?this.searchContent.orderDateTo+" 23:59:59":"",syncStatus:this.searchContent.syncStatus};this.$http.post(h,n()({},s)).then(function(t){if(e.loading=!1,0!==t.code)throw new Error(t.msg);t.data?(t.data.result&&t.data.result.length?e.tableData=t.data.result:e.tableData=[],e.total=t.data.total):(e.total=0,e.tableData=[])}).catch(function(t){e.loading=!1,e.$notify.error({title:"系统提示",message:t.message})})}},handleSelect:function(t,e){var a={},r=[];if(c.m(e.id,"id",this.checkedList))this.checkedList=c.q("id",e.id,this.checkedList);else{r.push(e);var s=[].concat(r,o()(this.checkedList));this.checkedList=s.reduceRight(function(t,e){return!a[e.id]&&(a[e.id]=t.push(e)),t},[])}},handleSelectAll:function(t){var e={};if(t.length>0){var a=!0,r=!1,o=void 0;try{for(var s,n=l()(t);!(a=(s=n.next()).done);a=!0){var i=s.value;this.checkedList.push(i)}}catch(t){r=!0,o=t}finally{try{!a&&n.return&&n.return()}finally{if(r)throw o}}this.checkedList=this.checkedList.reduceRight(function(t,a){return!e[a.id]&&(e[a.id]=t.push(a)),t},[])}else{var d=[],h=!0,u=!1,p=void 0;try{for(var m,g=l()(this.tableData);!(h=(m=g.next()).done);h=!0){var f=m.value;d.push(f)}}catch(t){u=!0,p=t}finally{try{!h&&g.return&&g.return()}finally{if(u)throw p}}var v=c.i(this.checkedList,d,"id");this.checkedList=v&&v.length>0?v:[]}},showResearchDialog:function(){this.dialogTitle="重新查询要货汇总",this.dialogFormVisible=!0,this.dialogFrom="research",this.dateTag=1,this.erpTotalDate=c.u(Date.parse(new Date))},dateTagChange:function(t){1===t?(this.dateTag=1,this.erpTotalDate=c.u(Date.parse(new Date))):2===t&&(this.dateTag=2,this.erpTotalDate=c.u(Date.parse(new Date)-864e5))},researchHandel:function(){var t=this;this.isDisabled=!0,this.$http.post(p,{erpTotalDate:this.erpTotalDate}).then(function(e){if(0===e.code)return t.dialogFormVisible=!1,setTimeout(function(){t.isDisabled=!1},500),void t.doSearchHandel(!0);throw new Error(e.msg)}).catch(function(e){setTimeout(function(){t.isDisabled=!1},500),t.$notify.error({title:"系统提示",message:e.message})})},synchronizeHandel:function(){var t=this,e=this;if(0!==this.checkedList.length){var a=this.checkedList.map(function(t){return t.id});this.$confirm("确定要同步所选商品吗?","温馨提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$http.post(u,a).then(function(e){if(0===e.code)return t.$message.success("操作成功！"),void t.doSearchHandel();throw new Error(e.msg)}).catch(function(t){e.$notify.error({title:"系统提示",message:t.message})})}).catch(function(){})}else this.$message.warning("请先选择要同步的商品")},showErrMsg:function(t){this.dialogTitle="同步失败原因",this.dialogFormVisible=!0,this.dialogFrom="errMsg",this.syncErrMsg=t.syncErrMsg},reSynchronizeHandel:function(t){var e=this,a=this;this.$confirm("确定要重新同步吗?","温馨提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var r=[];r.push(t.id),a.$http.post(u,r).then(function(t){if(0===t.code)return e.$message.success("操作成功！"),void e.doSearchHandel();throw new Error(t.msg)}).catch(function(t){a.$notify.error({title:"系统提示",message:t.message})})}).catch(function(){})},showSkuMsg:function(t){this.skuListMsg=t.skuList||[]},orderQtyMsg:function(t){this.transferTotalPaperNo=t.transferTotalPaperNo||"",this.transferTotalTime=t.transferTotalTime||"",this.transferGoodsList=t.skuList||[]},DoSelectGoodsHandel:function(t){var e=t.checkedList,a=t.queryString,r=[],o=[],s=!0,n=!1,i=void 0;try{for(var c,d=l()(e);!(s=(c=d.next()).done);s=!0){var h=c.value;r.push(h.platformCityGoodsId),o.push(h.goodsNo)}}catch(t){n=!0,i=t}finally{try{!s&&d.return&&d.return()}finally{if(n)throw i}}this.searchContent.platformCityGoodsIds=r,this.searchContent.goodsNoList=o,this.searchContent.queryString=a,this.doSearchHandel(!0)}}},g={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"handel-search-wraper"},[a("div",{staticClass:"handel-wraper"},[a("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-search"},on:{click:t.showResearchDialog}},[t._v("重新查询要货汇总")]),t._v(" "),a("span",{staticStyle:{color:"red"}},[t._v("注意：每天8:00-22:00之间，请不要做此操作，避免重新同步库存，导致线上超卖!")])],1),t._v(" "),a("hr",{staticClass:"s-slip"}),t._v(" "),a("div",{staticClass:"search-form-wraper"},[a("el-form",{attrs:{model:t.searchContent,"label-position":"top"}},[a("el-form-item",{attrs:{label:"商品分类"}},[a("el-cascader",{staticClass:"search-input",attrs:{placeholder:"请选择分类",options:t.categoryList,"change-on-select":"",size:"small",clearable:"",filterable:"",props:t.cateDefaultProps},on:{change:t.doCategoryChangeHandel},model:{value:t.searchContent.categoryIdList,callback:function(e){t.$set(t.searchContent,"categoryIdList",e)},expression:"searchContent.categoryIdList"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"SKU编码/商品名称"}},[a("goods-select",{ref:"GoodsSelect",on:{DoSelectGoodsHandel:t.DoSelectGoodsHandel}})],1),t._v(" "),a("el-form-item",{attrs:{label:"订货开始日期"}},[a("el-date-picker",{staticClass:"search-input",attrs:{type:"date",placeholder:"请选择订货开始日期",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",size:"small"},on:{change:function(e){return t.doSearchHandel(!0)}},model:{value:t.searchContent.orderDateFrom,callback:function(e){t.$set(t.searchContent,"orderDateFrom",e)},expression:"searchContent.orderDateFrom"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"订货结束日期"}},[a("el-date-picker",{staticClass:"search-input",attrs:{type:"date",placeholder:"请选择订货结束日期",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",size:"small"},on:{change:function(e){return t.doSearchHandel(!0)}},model:{value:t.searchContent.orderDateTo,callback:function(e){t.$set(t.searchContent,"orderDateTo",e)},expression:"searchContent.orderDateTo\n          "}})],1),t._v(" "),a("el-form-item",{attrs:{label:"同步状态"}},[a("el-select",{staticClass:"search-input",attrs:{filterable:"",placeholder:"请选择同步状态",clearable:"",size:"small"},on:{change:function(e){return t.doSearchHandel(!0)}},model:{value:t.searchContent.syncStatus,callback:function(e){t.$set(t.searchContent,"syncStatus",e)},expression:"searchContent.syncStatus"}},t._l(t.syncStatusOptions,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.doSearchHandel(!0)}}},[t._v("搜索")])],1)],1)],1)]),t._v(" "),a("div",{staticClass:"table-wraper"},[a("div",{staticClass:"batch-handel-w"},[a("el-button",{staticClass:"sup-mini",attrs:{size:"mini",icon:"el-icon-sort",disabled:0===t.checkedList.length},on:{click:t.synchronizeHandel}},[t._v("同步")])],1),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"fixed-height",staticStyle:{width:"100%"},attrs:{data:t.tableData,"empty-text":"没有查询到您想要的数据",size:"small"},on:{select:t.handleSelect,"select-all":t.handleSelectAll}},[a("el-table-column",{attrs:{selectable:t.handleSelection,type:"selection",width:"50"}}),t._v(" "),a("el-table-column",{attrs:{"min-width":"110px",prop:"orderDate",label:"订货日期"}}),t._v(" "),a("el-table-column",{attrs:{"min-width":"236px",label:"商品信息"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"p-m-w"},[a("div",{staticClass:"img-w g-m-r"},[a("p",{directives:[{name:"show",rawName:"v-show",value:e.row.topMark,expression:"scope.row.topMark"}],staticClass:"t-m-w"},[t._v(t._s(e.row.topMark))]),t._v(" "),e.row.goodsImg&&""!=e.row.goodsImg?a("img",{attrs:{src:e.row.goodsImg,alt:"",onerror:"onerror=null;src='/shop/static/img_error.png'"}}):a("img",{attrs:{src:"/shop/static/img_error.png",alt:""}}),t._v(" "),a("p",{directives:[{name:"show",rawName:"v-show",value:e.row.bottomMark,expression:"scope.row.bottomMark"}],staticClass:"b-m-w"},[t._v(t._s(e.row.bottomMark))])]),t._v(" "),a("div",{staticClass:"p-m-c-r"},[a("div",[t._v(t._s(e.row.goodsName||"--"))]),t._v(" "),a("div",[a("el-popover",{attrs:{placement:"bottom-start",trigger:"click"}},[a("el-table",{attrs:{data:t.skuListMsg,"empty-text":"暂无数据",size:"small"}},[a("el-table-column",{attrs:{width:"80",prop:"skuNo",label:"ERP编码"}}),t._v(" "),a("el-table-column",{attrs:{width:"140",prop:"skuName",label:"母商品名称"}}),t._v(" "),a("el-table-column",{attrs:{width:"90",prop:"erpCategoryName",label:"ERP分类"}}),t._v(" "),a("el-table-column",{attrs:{width:"90",prop:"skuType",label:"商品种类",formatter:t.skuTypeFormatter}}),t._v(" "),a("el-table-column",{attrs:{width:"80",prop:"ratio",label:"转换比例"}}),t._v(" "),a("el-table-column",{attrs:{width:"60",prop:"unit",label:"单位"}})],1),t._v(" "),a("el-button",{staticClass:"erp-p-no g-no-w",attrs:{slot:"reference",type:"text",size:"mini"},on:{click:function(a){return t.showSkuMsg(e.row)}},slot:"reference"},[t._v("SKU编码："+t._s(e.row.goodsNo||"--"))])],1)],1)])])]}}])}),t._v(" "),a("el-table-column",{attrs:{"min-width":"100px",prop:"goodsSpec",label:"规格"}}),t._v(" "),a("el-table-column",{attrs:{"min-width":"140px",prop:"orderQty","render-header":t.orderQtyHeader},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.orderQty?a("div",{staticClass:"order-qty-txt"},[a("el-popover",{attrs:{placement:"bottom-start",trigger:"click"}},[a("div",[a("div",[t._v("汇总单号："+t._s(t.transferTotalPaperNo||"--"))]),t._v(" "),a("div",[t._v("汇总时间："+t._s(t.transferTotalTime||"--"))]),t._v(" "),t._l(t.transferGoodsList,function(e,r){return a("div",{key:r},[t._v("\n                  "+t._s(e.skuNo)+"   "+t._s(e.skuName)+"   "+t._s(e.orderQty)+"   【"+t._s(e.skuSpec)+"】\n                ")])})],2),t._v(" "),a("el-button",{attrs:{slot:"reference",type:"text",size:"mini"},on:{click:function(a){return t.orderQtyMsg(e.row)}},slot:"reference"},[t._v(t._s(e.row.orderQty))])],1)],1):a("div",[t._v(t._s(e.row.orderQty||"--"))])]}}])}),t._v(" "),a("el-table-column",{attrs:{"min-width":"90px",prop:"stockQty","render-header":t.stockQtyHeader,formatter:t.emptyFormatter}}),t._v(" "),a("el-table-column",{attrs:{"min-width":"110px",prop:"safeStockRatio",label:"安全库存占比",formatter:t.emptyFormatter}}),t._v(" "),a("el-table-column",{attrs:{"min-width":"100px",prop:"safeStockQty","render-header":t.safeStockQtyHeader,formatter:t.emptyFormatter}}),t._v(" "),a("el-table-column",{attrs:{"min-width":"166px",prop:"syncDateTime",label:"同步时间",formatter:t.emptyFormatter}}),t._v(" "),a("el-table-column",{attrs:{"min-width":"90px",label:"同步状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[0===e.row.syncStatus?a("div",[t._v("待同步")]):1===e.row.syncStatus?a("div",[t._v("同步中")]):2===e.row.syncStatus?a("div",[t._v("同步成功")]):3===e.row.syncStatus?a("div",{staticClass:"red-tip",on:{click:function(a){return t.showErrMsg(e.row)}}},[t._v("同步失败")]):4===e.row.syncStatus?a("div",[t._v("不同步")]):t._e()])]}}])}),t._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[3===e.row.syncStatus&&e.row.canRetry?a("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-sort"},on:{click:function(a){return t.reSynchronizeHandel(e.row)}}},[t._v("重新同步")]):t._e()],1)]}}])})],1),t._v(" "),t.total>0?a("el-pagination",{staticClass:"tc mt20",attrs:{background:"","current-page":t.pageNum,"page-sizes":[10,50,100,150,200],layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.changeSize,"current-change":t.changeCurrent,"update:currentPage":function(e){t.pageNum=e},"update:current-page":function(e){t.pageNum=e}}}):t._e()],1),t._v(" "),a("el-dialog",{attrs:{title:t.dialogTitle,visible:t.dialogFormVisible,width:"460px"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},["research"===t.dialogFrom?a("el-form",[a("el-form-item",{attrs:{label:"选择日期"}},[a("el-select",{staticClass:"search-input",attrs:{filterable:"",placeholder:"请选择选择日期",size:"small"},on:{change:t.dateTagChange},model:{value:t.dateTag,callback:function(e){t.dateTag=e},expression:"dateTag"}},t._l(t.dateTagOptions,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1)],1):t._e(),t._v(" "),"errMsg"===t.dialogFrom?a("div",[t._v("\n      "+t._s(t.syncErrMsg)+"\n    ")]):t._e(),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini"},on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("关 闭")]),t._v(" "),"research"===t.dialogFrom?a("el-button",{attrs:{type:"primary",disabled:t.isDisabled,size:"mini",loading:t.isDisabled},on:{click:t.researchHandel}},[t._v("确 定")]):t._e()],1)],1)],1)},staticRenderFns:[]};var f=a("VU/8")(m,g,!1,function(t){a("TXtL")},null,null);e.default=f.exports},TXtL:function(t,e){}});
//# sourceMappingURL=111.92b5c2f19485aeb6c8fb.js.map