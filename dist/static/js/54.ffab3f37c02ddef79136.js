webpackJsonp([54],{"0rIR":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("BO1k"),l=a.n(i),s=a("Dd8w"),o=a.n(s),n=(a("ssT3"),a("oAV5")),r=a("cpGA"),d="/foundation/qiniu/auth/file",m="/foundation/store/userStoreCityList",u="/foundation/store/userStoreList",c="/plateform/a/tv/multimedia/template/update",p={data:function(){return{isDisabled:!1,addParamMsg:{multimediaAudioVoList:[],templateType:2,multimediaType:0,templateName:null,cityId:null,enable:0,storeNo:null},moduleGoodsReqList:[{categoryNos:[],categoryNamesStr:"",goodsTypes:[],showMemberPriceB:!0},{categoryNos:[],categoryNamesStr:"",goodsTypes:[],showMemberPriceB:!0},{categoryNos:[],categoryNamesStr:"",goodsTypes:[],showMemberPriceB:!0}],templateTypeOptions:[{label:"区域模板",value:1},{label:"门店模板",value:2}],enableOptions:[{label:"启用",value:0},{label:"禁用",value:1}],cityOptions:[{label:"商品模块",value:0},{label:"图片模块",value:1}],storeOptions:[],uploadLoading:!1,multimediaAudioVoList:[],playTypeOptions:[{label:"循环播放",value:0},{label:"单次播放",value:1}]}},created:function(){this.getCityList()},methods:{getCityList:function(){var e=this;this.$http.get(m).then(function(t){if(0!==t.code)throw new Error(t.msg);var a=t.data&&t.data.length?t.data:[];e.cityOptions=a.map(function(e){return{label:e.cityId+"_"+e.cityName,value:e.cityId}})}).catch(function(e){console.log("提示【获取区域列表】：",e.message)})},cityChange:function(e){var t=this,a={DIFFCITY:!0,pageNum:1,pageSize:-1,cityId:e};this.addParamMsg.storeNo=null,this.$http.post(u,o()({},a)).then(function(e){if(0!==e.code)throw new Error(e.msg);var a=e.data&&e.data.result&&e.data.result.length?e.data.result:[];t.storeOptions=a.map(function(e){return{label:e.storeNo+"_"+e.storeName,value:e.storeNo}})}).catch(function(e){t.$notify.error({title:"提示",message:e.message})})},emitUpload:function(e){var t=this;this.uploadLoading=!0,this.getToken("mp3").then(function(a){r.upload(e.file,a.fileName,a.token).subscribe({error:function(){t.uploadLoading=!1},complete:function(e){t.uploadLoading=!1;var a={audioUrl:"http://retailimg01.benlailife.com/"+e.key,startTime:"",endTime:"",timeRange:["",""],playType:0};t.multimediaAudioVoList.push(a)},next:function(e){}})})},beforeUploadReg:function(e){return!0},getToken:function(e){var t=this;return this.$http.post(d,{fileExtension:e||null}).then(function(e){if(0==e.code){var t=e.data.token;return{fileName:e.data.key,token:t}}throw new Error(e.msg)}).catch(function(e){t.uploadLoading=!1,t.$notify.error({title:"提示",message:e.message})})},deleteUpFile:function(e){this.multimediaAudioVoList.splice(e,1)},doSaveHandel:function(){var e=this;if(this.addParamMsg.cityId){var t={DIFFCITY:!0,templateType:this.addParamMsg.templateType,multimediaType:this.addParamMsg.multimediaType,templateName:this.addParamMsg.templateName,cityId:this.addParamMsg.cityId,enable:this.addParamMsg.enable};if(2===this.addParamMsg.templateType){if(!this.addParamMsg.storeNo)return void this.$message("[门店]: 请选择门店");t.storeNo=this.addParamMsg.storeNo}if(this.addParamMsg.templateName)if(this.addParamMsg.templateName.length>20)this.$message("[模板名称]: 模板名称,限制20个汉字");else if(this.multimediaAudioVoList&&0!==this.multimediaAudioVoList.length){var a=[],i=[],s=!0,r=!1,d=void 0;try{for(var m,u=l()(this.multimediaAudioVoList);!(s=(m=u.next()).done);s=!0){var p=m.value;if(p.startTime=p.timeRange&&p.timeRange.length?p.timeRange[0]:"",p.endTime=p.timeRange&&p.timeRange.length?p.timeRange[1]:"",!p.startTime||!p.endTime)return void this.$message("[页面模板设置]: 请选择音频的播放时间段");a.push(p.startTime),i.push(p.endTime)}}catch(e){r=!0,d=e}finally{try{!s&&u.return&&u.return()}finally{if(r)throw d}}if(n.d(a,i)){t.multimediaAudioVoList=this.multimediaAudioVoList;var f="";0===t.enable?f="一个门店或区域有且仅有一个可生效模板，开启后原模板将被禁用，保存时确定要直接启用吗?":1===t.enable&&(f="保存时确定要直接禁用吗?"),this.$confirm(f,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.isDisabled=!0,e.$http.post(c,o()({},t)).then(function(t){if(setTimeout(function(){e.isDisabled=!1},500),0===t.code)return e.$message.success("保存成功"),void e.$router.push("/media");throw new Error(t.msg)}).catch(function(t){setTimeout(function(){e.isDisabled=!1},500),e.$notify.error({title:"提示",message:t.message})})})}else this.$message("音频的播放时间段不可互相包含，请重新设置")}else this.$message("[页面模板设置]: 请上传音频内容");else this.$message("[模板名称]: 请输入模板名称")}else this.$message("[区域]: 请选择区域")},doCancelHandel:function(){var e=this;this.$confirm("确定取消吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$router.push("/media")}).catch(function(){})}}},f={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"add-form-wraper"},[a("el-form",{ref:"form",attrs:{model:e.addParamMsg,"label-width":"160px"}},[a("el-form-item",{attrs:{label:"模板类型",required:""}},[a("el-select",{staticClass:"add-input",attrs:{placeholder:"请选择模板类型",size:"small"},model:{value:e.addParamMsg.templateType,callback:function(t){e.$set(e.addParamMsg,"templateType",t)},expression:"addParamMsg.templateType"}},e._l(e.templateTypeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"区域",required:""}},[a("el-select",{staticClass:"add-input",attrs:{placeholder:"请选择区域",size:"small",filterable:""},on:{change:e.cityChange},model:{value:e.addParamMsg.cityId,callback:function(t){e.$set(e.addParamMsg,"cityId",t)},expression:"addParamMsg.cityId"}},e._l(e.cityOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),2===e.addParamMsg.templateType?a("el-form-item",{attrs:{label:"门店",required:""}},[a("el-select",{staticClass:"add-input",attrs:{placeholder:"请选择门店",size:"small",filterable:""},model:{value:e.addParamMsg.storeNo,callback:function(t){e.$set(e.addParamMsg,"storeNo",t)},expression:"addParamMsg.storeNo"}},e._l(e.storeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),a("span",[e._v("请先选择区域再选择门店")])],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"模板名称",required:""}},[a("el-input",{staticClass:"add-input",attrs:{size:"small",placeholder:"模板名称"},model:{value:e.addParamMsg.templateName,callback:function(t){e.$set(e.addParamMsg,"templateName",t)},expression:"addParamMsg.templateName"}}),e._v(" "),a("span",[e._v("模板名称,限制20个汉字")])],1),e._v(" "),a("el-form-item",{attrs:{label:"页面模板设置",required:""}},[a("el-upload",{attrs:{action:"",disabled:e.uploadLoading,"show-file-list":!1,"before-upload":e.beforeUploadReg,"http-request":e.emitUpload}},[a("el-button",{attrs:{disabled:e.uploadLoading,size:"mini",icon:e.uploadLoading?"el-icon-loading":"el-icon-upload2",type:"primary"}},[e._v("上传音频")])],1),e._v(" "),e._l(e.multimediaAudioVoList,function(t,i){return a("div",{key:i,staticClass:"media-file-item mt10"},[a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini",circle:""},on:{click:function(t){return e.deleteUpFile(i)}}}),e._v(" "),a("div",[a("div",{staticClass:"audio-url-wrap ml10"},[a("a",{attrs:{href:t.audioUrl,target:"_blank"}},[e._v(e._s(t.audioUrl))])]),e._v(" "),a("div",[a("el-time-picker",{staticClass:"search-date-picker ml10",attrs:{"is-range":"",editable:!1,size:"small",format:"HH:mm","value-format":"HH:mm","range-separator":"-","start-placeholder":"开始时间","end-placeholder":"结束时间",placeholder:"选择时间范围"},model:{value:t.timeRange,callback:function(a){e.$set(t,"timeRange",a)},expression:"item.timeRange"}}),e._v(" "),a("el-select",{staticClass:"add-input-inline ml10",attrs:{placeholder:"请选择区域",size:"small",filterable:""},model:{value:t.playType,callback:function(a){e.$set(t,"playType",a)},expression:"item.playType"}},e._l(e.playTypeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)])],1)})],2),e._v(" "),a("el-form-item",{attrs:{label:"启用状态",required:""}},[a("el-radio-group",{attrs:{size:"small"},model:{value:e.addParamMsg.enable,callback:function(t){e.$set(e.addParamMsg,"enable",t)},expression:"addParamMsg.enable"}},e._l(e.enableOptions,function(t,i){return a("el-radio-button",{key:i,attrs:{label:t.value}},[e._v(e._s(t.label)+"\n        ")])}),1),e._v(" "),a("span",[e._v("开启后线上将直接启用")])],1),e._v(" "),a("hr",{staticClass:"s-slip-tb"}),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"small",disabled:e.isDisabled},on:{click:e.doSaveHandel}},[e._v("保存")]),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:e.doCancelHandel}},[e._v("取消")])],1)],1)],1)},staticRenderFns:[]};var g=a("VU/8")(p,f,!1,function(e){a("mS7m")},null,null);t.default=g.exports},mS7m:function(e,t){}});
//# sourceMappingURL=54.ffab3f37c02ddef79136.js.map