webpackJsonp([2],{"1hwZ":function(i,t){},AR0K:function(i,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=e("BO1k"),s=e.n(a),n=e("Gu7T"),l=e.n(n),r=e("Dd8w"),o=e.n(r),u=e("RCQo"),d=e("Yehp"),c=e("RaLY"),m={mixins:[u.a],data:function(){return{isDisabled:!1,type:"",supplierId:"",statusOptions:[{label:"待上传",value:0},{label:"待审核",value:1},{label:"审核通过",value:2},{label:"已驳回",value:3},{label:"已过期",value:4},{label:"即将过期",value:5},{label:"即将过期-更换中",value:6}],id:"",qualificationModelId:"",qualificationModelName:"",qualificationNo:"",status:"",qualificationBasicMsgList:[],qualificationTimeMsgList:[],qualificationImgList:[]}},created:function(){this.type=this.$route.params.type,this.id=this.$route.params.id,this.qualificationModelId=this.$route.params.modelId,this.supplierId=this.$route.params.supplierId},mounted:function(){this.getDetailMsg()},components:{"image-upload":c.a},methods:{getDetailMsg:function(){var i=this,t=d.a.qualificationMsgEdit;"001"===this.type?t=d.a.qualificationMsgEdit:"002"===this.type&&(t=d.a.goodsEdit);var e={id:this.id,qualificationModelId:this.qualificationModelId,supplierId:this.supplierId};this.$loading.show(),this.$http.post(t,o()({},e)).then(function(t){if(i.$loading.hide(),0!==t.code)throw new Error(t.msg);var e=t.data?t.data:{};i.setStateRenderDom(e)}).catch(function(t){i.$loading.hide(),i.$tip.notify(t.message||"","error","系统提示")})},setStateRenderDom:function(i){i&&(this.id=i.id,this.qualificationModelId=i.qualificationModelId,this.qualificationModelName=i.qualificationModelName,this.qualificationNo=i.qualificationNo,this.status=i.status,this.qualificationBasicMsgList=i.items&&i.items.length?i.items.filter(function(i){return 0===i.fieldType}):[],this.qualificationTimeMsgList=i.items&&i.items.length?i.items.filter(function(i){return 1===i.fieldType}):[],this.qualificationImgList=i.url?i.url.split(",").map(function(i,t){return{index:t,imageUrl:i}}):[{index:0,imageUrl:""}])},formatStatus:function(i){var t=this.statusOptions.filter(function(t){return t.value===i})[0];return t?t.label:""},setImageList:function(i){this.qualificationImgList=i&&i.imageList.length?[].concat(l()(i.imageList)):[{index:0,imageUrl:""}]},doSaveHandel:function(){var i=this;if(this.qualificationNo){var t=!0,e=!1,a=void 0;try{for(var n,r=s()(this.qualificationBasicMsgList);!(t=(n=r.next()).done);t=!0){var u=n.value;if(!u.textValue)return void this.$tip.message("请输入"+u.qualificationFieldName+"的内容","warning");if(u.textValue.length>50)return void this.$tip.message(u.qualificationFieldName+"的内容长度不能超过50","warning")}}catch(i){e=!0,a=i}finally{try{!t&&r.return&&r.return()}finally{if(e)throw a}}var c=!0,m=!1,g=void 0;try{for(var h,f=s()(this.qualificationTimeMsgList);!(c=(h=f.next()).done);c=!0){var p=h.value;if(!p.timeValue)return void this.$tip.message("请选择"+p.qualificationFieldName,"warning")}}catch(i){m=!0,g=i}finally{try{!c&&f.return&&f.return()}finally{if(m)throw g}}var v=this.qualificationImgList.filter(function(i){return i.imageUrl}).map(function(i){return i.imageUrl});if(v&&0!==v.length){var b={id:this.id,qualificationModelId:this.qualificationModelId,qualificationModelName:this.qualificationModelName,qualificationNo:this.qualificationNo,status:this.status,items:[].concat(l()(this.qualificationBasicMsgList),l()(this.qualificationTimeMsgList)),url:v.join(",")};this.isDisabled=!0;var w=d.a.uploadQualification;"001"===this.type?w=d.a.uploadQualification:"002"===this.type&&(w=d.a.uploadGoodsUpload),this.$http.post(w,o()({},b)).then(function(t){if(i.isDisabled=!1,0===t.code)return i.$tip.message("提交成功","success"),void("001"===i.type?(i.editSuccessHandel("/sc_qua"),i.closePage("/sc_qua/detail/001/"+i.id+"/"+i.qualificationModelId+"/"+i.supplierId)):"002"===i.type&&(i.editSuccessHandel("/goods_qua"),i.closePage("/goods_qua/detail/002/"+i.id+"/"+i.qualificationModelId+"/"+i.supplierId)));throw new Error(t.msg)}).catch(function(t){i.isDisabled=!1,i.$tip.notify(t.message||"","error","系统提示")})}else this.$tip.message("请上传资质图片","warning")}else this.$tip.message("请输入资质编号","warning")},doCancelHandel:function(){"001"===this.type?this.closePage("/sc_qua"):"002"===this.type&&this.closePage("/goods_qua")}}},g={render:function(){var i=this,t=i.$createElement,e=i._self._c||t;return e("div",{staticClass:"add-form-wraper"},[e("el-form",{attrs:{"label-position":"right","label-width":"160px"}},[e("div",{staticClass:"title"},[i._v("基本信息：")]),i._v(" "),e("el-form-item",{attrs:{label:"资质名称:"}},[i._v("\n      "+i._s(i.qualificationModelName)+"        资质状态： "+i._s(i.formatStatus(i.status))+"\n    ")]),i._v(" "),e("el-form-item",{attrs:{label:"资质编码:"}},[e("el-input",{staticClass:"add-input",attrs:{size:"small",placeholder:"请输入资质编码",clearable:""},model:{value:i.qualificationNo,callback:function(t){i.qualificationNo="string"==typeof t?t.trim():t},expression:"qualificationNo"}})],1),i._v(" "),e("div",{staticClass:"title"},[i._v("普通信息：")]),i._v(" "),i._l(i.qualificationBasicMsgList,function(t,a){return[e("el-form-item",{key:a,attrs:{label:t.qualificationFieldName+":"}},[e("el-input",{staticClass:"add-input",attrs:{size:"small",placeholder:t.qualificationFieldName,clearable:""},model:{value:t.textValue,callback:function(e){i.$set(t,"textValue","string"==typeof e?e.trim():e)},expression:"item.textValue"}})],1)]}),i._v(" "),e("div",{staticClass:"title"},[i._v("时间信息：")]),i._v(" "),i._l(i.qualificationTimeMsgList,function(t,a){return[e("el-form-item",{key:a+1e4,attrs:{label:t.qualificationFieldName+":"}},[e("el-date-picker",{staticClass:"add-input",attrs:{clearable:!1,type:"date",placeholder:t.qualificationFieldName,format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",size:"small"},model:{value:t.timeValue,callback:function(e){i.$set(t,"timeValue",e)},expression:"item.timeValue"}})],1)]}),i._v(" "),e("div",[e("span",{staticClass:"title"},[i._v("资质图片：")]),i._v("(图片格式要求jpg、png ;图片大小不超过3M;上传的资质需是加盖供应商公章的彩色扫描件；资质要求清晰；最多只能上传3张。)\n    ")]),i._v(" "),e("el-form-item",{attrs:{label:"图片内容:"}},[e("image-upload",{ref:"imageUpload",attrs:{defaultImages:i.qualificationImgList,imgAspect:2,maxImgsNum:3,imgSize:3072},on:{"images-change":i.setImageList}})],1),i._v(" "),e("el-form-item",[e("hr",{staticClass:"s-slip-tb"}),i._v(" "),e("el-button",{attrs:{type:"primary",size:"small",disabled:i.isDisabled,loading:i.isDisabled},on:{click:i.doSaveHandel}},[i._v("提交")]),i._v(" "),e("el-button",{attrs:{size:"small"},on:{click:i.doCancelHandel}},[i._v("关闭")])],1)],2)],1)},staticRenderFns:[]};var h=e("VU/8")(m,g,!1,function(i){e("1hwZ")},"data-v-2c47f672",null);t.default=h.exports},CbgY:function(i,t){i.exports={colorMain:"#1890ff",colorSubBlack:"#001529",colorGrey:"#cccccc"}},RaLY:function(i,t,e){"use strict";var a=e("//Fk"),s=e.n(a),n=e("Gu7T"),l=e.n(n),r=e("w/TU"),o=e.n(r),u=e("cpGA"),d={getQiNiuToken:e("bzuE").a.reqUrl+"/foundation/qiniu/auth/file"},c={props:{imgAspect:{type:Number,default:1},imgSize:{type:Number,default:0},maxImgsNum:{type:Number,default:0},width:{type:Number,default:0},height:{type:Number,default:0},defaultImages:{type:Array,default:function(){return[]}}},data:function(){return{imageUploadLoading:!1,currentUpFileIdx:-1,imageList:[{imageUrl:"",index:0}],dialogVisible:!1,bigImageUrl:""}},components:{draggable:o.a},watch:{defaultImages:{immediate:!0,handler:function(i,t){var e=[].concat(l()(i)).filter(function(i,t){return i.index=t,i.imageUrl});(e.length<this.maxImgsNum||0===this.maxImgsNum)&&e.push({imageUrl:"",index:e.length}),this.imageList=e}}},methods:{datadragStart:function(){!this.imageUploadLoading&&this.maxImgsNum},datadragEnd:function(i){var t=[].concat(l()(this.imageList)),e=t.filter(function(i,t){return i.index=t,i.imageUrl&&""!=i.imageUrl});this.$emit("images-change",{imageList:e});var a={};this.maxImgsNum?e.length<this.maxImgsNum&&(a.imageUrl="",a.index=t.length,e.push(a)):(a.imageUrl="",a.index=t.length,e.push(a)),this.imageList=e},setItemIdx:function(i){this.imageUploadLoading||(this.currentUpFileIdx=i)},imageUploadReg:function(i){var t=this,e="image/jpeg"===i.type||"image/png";if(!e)return this.$tip.message("图片只能是JPG或PNG格式!","warning"),!1;var a=!0;if(this.imgSize){var n="";if(n=this.imgSize<1024?this.imgSize+"KB":this.imgSize/1024+"M",i.size>1024*this.imgSize)return a=!1,this.$tip.message("图片大小不能超过"+n+"！","warning"),!1}var l=null;if(this.width&&this.height){var r=this;l=new s.a(function(t,e){var a=window.URL||window.webkitURL,s=new Image;s.onload=function(){s.width==r.width&&s.height==r.height?t():e()},s.src=a.createObjectURL(i)}).then(function(){return i},function(){return t.$tip.message("请上传宽度为: "+r.width+"，高度为: "+r.height+"像素，大小不超过"+sizeValiTipStr+"的JPG或PNG图片！","warning"),s.a.reject()})}else if(this.width){var o=this;l=new s.a(function(t,e){var a=window.URL||window.webkitURL,s=new Image;s.onload=function(){s.width==o.width?t():e()},s.src=a.createObjectURL(i)}).then(function(){return i},function(){return t.$tip.message("请上传宽度为: "+o.width+"像素，大小不超过"+sizeValiTipStr+"的JPG或PNG图片！","warning"),s.a.reject()})}else if(this.height){var u=this;l=new s.a(function(t,e){var a=window.URL||window.webkitURL,s=new Image;s.onload=function(){s.height==u.height?t():e()},s.src=a.createObjectURL(i)}).then(function(){return i},function(){return t.$tip.message("请上传高度为: "+u.height+"像素，大小不超过"+sizeValiTipStr+"的JPG或PNG图片！","warning"),s.a.reject()})}return this.width&&this.height||this.width||this.height?e&&a&&l:e&&a},emitUpload:function(i){var t=this;if(this.maxImgsNum&&this.imageList.length>this.maxImgsNum)return this.$tip.message("最多只能上传"+this.maxImgsNum+"张图片！","warning"),!1;this.imageUploadLoading=!0,this.getToken().then(function(e){u.upload(i.file,e.fileName,e.token).subscribe({error:function(){t.imageUploadLoading=!1},complete:function(i){t.imageUploadLoading=!1;var e="http://retailimg01.benlailife.com/"+i.key;t.imageList[t.currentUpFileIdx].imageUrl=e;var a=t.imageList.filter(function(i){return i.imageUrl&&""!=i.imageUrl});t.$emit("images-change",{imageList:a}),t.maxImgsNum?a.length<t.maxImgsNum&&a.push({index:t.currentUpFileIdx+1,imageUrl:""}):a.push({index:t.currentUpFileIdx+1,imageUrl:""}),t.imageList=a},next:function(i){}})})},getToken:function(){var i=this;return this.$http.post(d.getQiNiuToken,{}).then(function(i){if(0==i.code){var t=i.data.token;return{fileName:i.data.key,token:t}}throw new Error(i.msg)}).catch(function(t){i.imageUploadLoading=!1,i.$notify.error({title:"提示",message:t.message})})},deleteUpFile:function(i){if(!this.imageUploadLoading){this.imageList.splice(i,1);var t=this.imageList.filter(function(i){return i.imageUrl&&""!=i.imageUrl});this.$emit("images-change",{imageList:t}),t.push({index:t.length,imageUrl:""}),t.forEach(function(i,t){i.index=t}),this.imageList=t}},onPreviewHandel:function(i){this.bigImageUrl=i,this.dialogVisible=!0}}},m={render:function(){var i=this,t=i.$createElement,e=i._self._c||t;return e("div",[e("draggable",{staticClass:"bl-draggable-wrap",on:{update:i.datadragEnd,start:i.datadragStart},model:{value:i.imageList,callback:function(t){i.imageList=t},expression:"imageList"}},[e("transition-group",i._l(i.imageList,function(t,a){return e("div",{key:t.imageUrl,staticClass:"bl-upload-wrap",on:{click:function(t){return i.setItemIdx(a)}}},[e("el-upload",{class:2===i.imgAspect?"uploader34":3===i.imgAspect?"uploader43":"uploader11",attrs:{action:"","show-file-list":!1,"before-upload":i.imageUploadReg,"http-request":i.emitUpload}},[e("div",{directives:[{name:"loading",rawName:"v-loading",value:i.imageUploadLoading&&i.currentUpFileIdx==a,expression:"imageUploadLoading && currentUpFileIdx == idx"}],staticClass:"upload-img-wrap"},[t.imageUrl?e("img",{attrs:{src:t.imageUrl}}):e("i",{staticClass:"el-icon-plus"})])]),i._v(" "),t.imageUrl&&""!=t.imageUrl?e("div",{staticClass:"btn-w"},[e("span",{staticClass:"up-h-i",on:{click:function(e){return i.onPreviewHandel(t.imageUrl)}}},[e("i",{staticClass:"el-icon-zoom-in"})]),i._v(" "),e("span",{staticClass:"up-h-i",on:{click:function(t){return i.deleteUpFile(a)}}},[e("i",{staticClass:"el-icon-delete"})]),i._v(" "),e("span",{staticClass:"up-h-i"},[e("i",{staticClass:"el-icon-rank"})])]):i._e()],1)}),0)],1),i._v(" "),e("el-dialog",{attrs:{visible:i.dialogVisible,"append-to-body":""},on:{"update:visible":function(t){i.dialogVisible=t}}},[e("img",{attrs:{width:"100%",src:i.bigImageUrl,alt:""}})])],1)},staticRenderFns:[]};var g=e("VU/8")(c,m,!1,function(i){e("CbgY")},null,null);t.a=g.exports}});
//# sourceMappingURL=2.af2a8022ebbfaab5cc8c.1615898974438.js.map