webpackJsonp([20],{"/zE0":function(e,t){},YUa7:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("Dd8w"),o=a.n(s),r=a("//Fk"),i=a.n(r),l=a("OVbB"),n=a("oAV5"),d=a("cpGA"),c=(a("bzuE"),a("ssT3")),g="/foundation/qiniu/auth/file",m={data:function(){return{isDisabled:!1,imageUploadLoading:!1,addParamMsg:{id:"",DIFFCITY:!0,regionCode:c.a.get("regionCode")||"",regionName:"",templateType:1,posterTitle:"",posterImageUrl:"",enable:0,categoryNoList:[]},categoryNamesStr:"",templateTypeOptions:[{label:"预售模板",value:1},{label:"爆款模板",value:2},{label:"秒杀模板",value:3}],enableOptions:[{label:"启用",value:0},{label:"禁用",value:1}],categoryList:[]}},components:{category:a("ii1g").a},created:function(){this.addParamMsg.id=this.$route.params.id,this.getDetailMsg(),this.selectCategoryList()},methods:{getDetailMsg:function(){var e=this;n.r(),this.$http.post(l.a.detail,{id:this.addParamMsg.id,DIFFCITY:!0}).then(function(t){if(n.c(),0===t.code){var a=t.data||{};return e.addParamMsg.id=a.id,e.addParamMsg.regionCode=a.regionCode||"",e.addParamMsg.regionName=a.regionName||"",e.addParamMsg.categoryNoList=a.categoryNoList||[],e.categoryNamesStr=a.categoryNoList&&a.categoryNoList.length?a.categoryNoList.join(","):"",e.addParamMsg.enable=a.enable||0,e.addParamMsg.templateType=a.templateType||1,e.addParamMsg.posterTitle=a.posterTitle||"",void(e.addParamMsg.posterImageUrl=a.posterImageUrl||"")}throw new Error(t.msg)}).catch(function(t){n.c(),e.$notify.error({title:"提示",message:t.message})})},getToken:function(){var e=this;return this.$http.post(g,{}).then(function(e){if(0==e.code){var t=e.data.token;return{fileName:e.data.key,token:t}}throw new Error(e.msg)}).catch(function(t){e.imageUploadLoading=!1,e.$notify.error({title:"获取七牛token提示",message:t.message})})},imageUploadReg:function(e){var t=this,a=this,s=-1!==e.type.indexOf("image/"),o="image/jpeg"===e.type||"image/png",r=e.size<=512e3;if(!s||!o||!r)return this.$message.error("海报图片为大小不超过500K的jpg或png图片（预售模板和爆款模板满足750*2812像素，秒杀模板满足750*2252像素）"),!1;var l=new i.a(function(t,s){var o=window.URL||window.webkitURL,r=new Image;r.src=o.createObjectURL(e),r.onload=function(){3===a.addParamMsg.templateType?750===r.width&&2252===r.height?t():s():750===r.width&&2812===r.height?t():s()}}).then(function(){return e},function(){return 3===a.addParamMsg.templateType?t.$message.error("海报图片为大小不超过500K的jpg或png图片，秒杀模板满足750*2252像素"):t.$message.error("海报图片为大小不超过500K的jpg或png图片，预售模板和爆款模板满足750*2812像素"),i.a.reject()});return s&&o&&r&&l},emitUpload:function(e){var t=this;this.imageUploadLoading=!0,this.getToken().then(function(a){d.upload(e.file,a.fileName,a.token).subscribe({error:function(){t.$message.error("图片上传失败，请重试"),t.imageUploadLoading=!1},complete:function(e){var a="http://retailimg01.benlailife.com/"+e.key;t.imageUploadLoading=!1,t.addParamMsg.posterImageUrl=a},next:function(e){}})})},doSaveHandel:function(){var e=this;this.addParamMsg.posterTitle?this.addParamMsg.posterTitle.length>20?this.$message("海报标题限制20个字"):this.addParamMsg.posterImageUrl?(this.isDisabled=!0,this.$http.post(l.a.saveAndUpdate,o()({},this.addParamMsg)).then(function(t){if(setTimeout(function(){e.isDisabled=!1},800),0===t.code)return e.$message.success("保存成功"),void e.$router.push("/poster");throw new Error(t.msg)}).catch(function(t){e.isDisabled=!1,e.$notify.error({title:"提示",message:t.message})})):this.$message("请上传大小不超过500K的jpg或png图片（预售模板和爆款模板满足750*2812像素，秒杀模板满足750*2252像素）"):this.$message("请输入海报标题")},showChooseCatDialog:function(){var e={showModel:!0,defaultCheckedKeys:this.addParamMsg.categoryNoList};this.$refs.chooseGoodsDialog.setDefaultMsg(e)},doCancelHandel:function(){var e=this;this.$confirm("确定取消添加商品吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$router.push("/poster")}).catch(function(){})},selectCategoryList:function(){var e=this;this.$http.get(l.a.selectCategoryList).then(function(t){if(0!==t.code)throw new Error(t.msg);e.categoryList=t.data&&t.data.length?t.data:[]}).catch(function(t){e.$notify.error({title:"提示",message:t.message})})},confirmChooseCategory:function(e){this.addParamMsg.categoryNoList=e.checkedKeys||[],this.categoryNamesStr=e.categoryNames||""}},beforeRouteLeave:function(e,t,a){e.meta.keepAlive=!0,a()}},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"add-form-wraper"},[a("el-form",{ref:"form",attrs:{model:e.addParamMsg,"label-width":"160px"}},[a("el-form-item",{attrs:{label:"选择区域",required:""}},[a("el-input",{staticClass:"add-input",attrs:{size:"small",placeholder:"选择区域",disabled:""},model:{value:e.addParamMsg.regionName,callback:function(t){e.$set(e.addParamMsg,"regionName",t)},expression:"addParamMsg.regionName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"模板类型",required:""}},[a("el-select",{staticClass:"add-input",attrs:{placeholder:"请选择模板类型",size:"small"},model:{value:e.addParamMsg.templateType,callback:function(t){e.$set(e.addParamMsg,"templateType",t)},expression:"addParamMsg.templateType"}},e._l(e.templateTypeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"海报标题",required:""}},[a("el-input",{staticClass:"add-input",attrs:{size:"small",placeholder:"请输入海报标题"},model:{value:e.addParamMsg.posterTitle,callback:function(t){e.$set(e.addParamMsg,"posterTitle","string"==typeof t?t.trim():t)},expression:"addParamMsg.posterTitle"}}),e._v(" "),a("span",[e._v("海报标题，限制20个字")])],1),e._v(" "),a("el-form-item",{attrs:{label:"海报图片",required:""}},[a("el-upload",{staticClass:"avatar-uploader-3ratio4",attrs:{action:"","show-file-list":!1,"before-upload":e.imageUploadReg,"http-request":e.emitUpload}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.imageUploadLoading,expression:"imageUploadLoading"}]},[e.addParamMsg.posterImageUrl?a("img",{staticClass:"avatar-3ratio4",attrs:{src:e.addParamMsg.posterImageUrl}}):a("i",{staticClass:"el-icon-plus avatar-uploader-3ratio4-icon"})])]),e._v(" "),a("span",[e._v("请上传大小不超过500K的jpg或png图片（预售模板和爆款模板满足750*2812像素，秒杀模板满足750*2252像素）")])],1),e._v(" "),a("el-form-item",{attrs:{label:"展示商品配置"}},[a("el-input",{staticClass:"add-input",attrs:{size:"small",placeholder:"选择商品分类"},model:{value:e.categoryNamesStr,callback:function(t){e.categoryNamesStr=t},expression:"categoryNamesStr"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.showChooseCatDialog},slot:"append"})],1),e._v(" "),a("span",[e._v("请选择的商品分类")])],1),e._v(" "),a("el-form-item",{attrs:{label:"启用状态",required:""}},[a("el-radio-group",{attrs:{size:"small"},model:{value:e.addParamMsg.enable,callback:function(t){e.$set(e.addParamMsg,"enable",t)},expression:"addParamMsg.enable"}},e._l(e.enableOptions,function(t,s){return a("el-radio-button",{key:s,attrs:{label:t.value}},[e._v(e._s(t.label)+"\n          ")])}),1),e._v(" "),a("span",[e._v("开启后线上将直接启用")])],1),e._v(" "),a("hr",{staticClass:"s-slip-tb"}),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"small",disabled:e.isDisabled,icon:e.isDisabled?"el-icon-loading":null},on:{click:e.doSaveHandel}},[e._v("保存")]),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:e.doCancelHandel}},[e._v("取消")])],1)],1)],1),e._v(" "),a("category",{ref:"chooseGoodsDialog",attrs:{categoryList:e.categoryList},on:{confirmChooseCategory:e.confirmChooseCategory}})],1)},staticRenderFns:[]};var p=a("VU/8")(m,u,!1,function(e){a("/zE0")},null,null);t.default=p.exports},ii1g:function(e,t,a){"use strict";var s=a("Gu7T"),o=a.n(s),r={props:{categoryList:{type:Array,default:function(){return[]}}},data:function(){return{defaultProps:{children:"childCategoryList",label:"categoryName"},showModel:!1,defaultCheckedKeys:[]}},methods:{setDefaultMsg:function(e){var t=this;this.showModel=e.showModel,this.defaultCheckedKeys=e.defaultCheckedKeys,setTimeout(function(){t.$refs.tree.setCheckedKeys([].concat(o()(e.defaultCheckedKeys)))},0)},doConfirmHandel:function(){this.showModel=!1;var e=this.$refs.tree.getCheckedKeys(!0),t={categoryNames:e.join(","),checkedKeys:e};this.$emit("confirmChooseCategory",t)}}},i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{attrs:{title:"商品分类","close-on-click-modal":!1,"close-on-press-escape":!1,visible:e.showModel,width:"400px"},on:{"update:visible":function(t){e.showModel=t}}},[a("div",{staticStyle:{"max-height":"300px","overflow-y":"auto"}},[a("el-tree",{ref:"tree",attrs:{data:e.categoryList,"show-checkbox":"","node-key":"categoryId","default-checked-keys":e.defaultCheckedKeys,props:e.defaultProps}})],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.showModel=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.doConfirmHandel}},[e._v("确 定")])],1)])],1)},staticRenderFns:[]},l=a("VU/8")(r,i,!1,null,null,null);t.a=l.exports}});
//# sourceMappingURL=20.4c77cb7d8326d2b75da7.js.map