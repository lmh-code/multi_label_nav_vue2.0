webpackJsonp([112],{"9lB8":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("BO1k"),i=a.n(n),o=a("Dd8w"),r=a.n(o),s=a("Gu7T"),l=a.n(s),c=a("ssT3"),p=(a("oAV5"),a("XfvZ")),u=a("32kd"),d="/plateform/a/mall/pageTemp/findTemp",m="/plateform/a/mall/pageTemp/pageTempList",g="/plateform/a/mall/pageTemp/delPage",h={data:function(){return{loading:!1,pageNum:1,pageSize:20,total:0,searchContent:{DIFFCITY:!0,regionCode:c.a.get("regionCode")||"",cityId:"",pageName:"",pageType:0,useStatus:"",defaultRange:[],createTime:"",updateTime:""},pageTypeOptions:[{label:"全部",value:0},{label:"首页",value:1},{label:"专题页",value:2}],selectTempOptions:[],orderStatusOptions:[{label:"全部",value:""},{label:"上架",value:1},{label:"下架",value:2}],dialogFormVisible:!1,pageType:"",tempId:"",tableData:[]}},created:function(){this.findTemp()},mounted:function(){var e=c.a.get("searchContent");this.$route.meta.keepAlive&&e&&(this.pageNum=e.pageNum,this.searchContent=e.searchContent,c.a.remove("searchContent")),this.doSearchHandel()},components:{"date-picker-range":p.a,"region-city-store":u.a},methods:{StoreGroupChange:function(e){this.searchContent.regionCode=e.regionCode,this.searchContent.cityId=e.cityId,this.doSearchHandel(!0)},addPage:function(){0===this.selectTempOptions.length&&this.findTemp(),this.pageType="",this.dialogFormVisible=!0},changeSize:function(e){this.pageSize=e,this.doSearchHandel()},changeCurrent:function(e){this.pageNum=e,this.doSearchHandel()},findTemp:function(){var e=this;this.$http.get(d).then(function(t){if(0!==t.code)throw new Error(t.msg);t.data&&t.data.length?e.selectTempOptions=[].concat(l()(t.data)):e.selectTempOptions=[]}).catch(function(e){console.log("提示(获取选择专题的列表):",e.message)})},doSearchHandel:function(e){var t=this;!0===e&&(this.pageNum=1),this.loading=!0,this.$http.post(m,r()({},this.searchContent,{pageNum:this.pageNum,pageSize:this.pageSize})).then(function(e){if(t.loading=!1,0!==e.code)throw new Error(e.msg);if(e.data){if(e.data.result&&e.data.result.length){var a=!0,n=!1,o=void 0;try{for(var r,s=i()(e.data.result);!(a=(r=s.next()).done);a=!0){var l=r.value;1===l.pageType?l.copyUrl="pages/shopping/newindex?id="+l.id:2===l.pageType&&(l.copyUrl="pages/shopping/subject?id="+l.id),l.userStoreNumRedirectUrl="/store_page?pageName="+l.pageName+"&pageType="+l.pageType,l.userOnStoreNumRedirectUrl="/store_page?pageName="+l.pageName+"&pageType="+l.pageType+"&useStatus=1"}}catch(e){n=!0,o=e}finally{try{!a&&s.return&&s.return()}finally{if(n)throw o}}t.tableData=e.data.result}else t.tableData=[];t.total=e.data.total}else t.total=0,t.tableData=[]}).catch(function(e){t.loading=!1,t.$notify.error({title:"提示",message:e.message})})},goNextHandel:function(){this.pageType&&this.tempId?this.$router.push("/set_page/add/"+this.pageType+"/"+this.tempId):this.$message("请选择模板")},changeSelectTemp:function(e){if(e){var t=this.selectTempOptions.filter(function(t){return t.id===e})[0];this.tempId=t.id,this.pageType=t.pageType}},showDetail:function(e){var t={pageNum:this.pageNum,searchContent:this.searchContent};c.a.set("searchContent",t);var a=e.pageType,n=e.templateId,i=e.id,o=e.pageName,r=e.useStatus,s=e.regionName,l=e.regionCode;this.$router.push("/set_page/edit/"+a+"/"+n+"/"+i+"?regionCode="+l+"&regionName="+s+"&pageName="+o+"&useStatus="+r+"&actionType=edit")},deleteItem:function(e){var t=this,a={pageId:e.id,pageType:e.pageType,isDeleted:1};this.$confirm("您确定要删除所选页面吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$http.post(g,a).then(function(e){if(0===e.code)return t.$message.success("删除成功"),void t.doSearchHandel();throw new Error(e.msg)}).catch(function(e){t.$notify.error({title:"提示",message:e.message})})}).catch(function(){})},onCopySuc:function(){this.$message.success("链接已复制至剪切板，仅限微信公众号中使用")},onCopyError:function(){this.$message.error("复制链接失败,请手动复制")},copyItem:function(e){var t={pageNum:this.pageNum,searchContent:this.searchContent};c.a.set("searchContent",t);var a=e.pageType,n=e.templateId,i=e.id,o=e.pageName,r=e.useStatus,s=e.regionName,l=e.regionCode;this.$router.push("/set_page/edit/"+a+"/"+n+"/"+i+"?regionCode="+l+"&regionName="+s+"&pageName="+o+"&useStatus="+r+"&actionType=copy")},datePickerRangeChange:function(e){this.searchContent.defaultRange=e?[].concat(l()(e)):e,this.searchContent.createTime=e?e[0]:"",this.searchContent.updateTime=e?e[1]:"",this.doSearchHandel(!0)}},beforeRouteLeave:function(e,t,a){t.meta.keepAlive=!1,a()}},f={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"handel-search-wraper"},[a("div",{staticClass:"handel-wraper"},[a("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-plus"},on:{click:e.addPage}},[e._v("新建页面")])],1),e._v(" "),a("hr",{staticClass:"s-slip"}),e._v(" "),a("div",{staticClass:"search-form-wraper"},[a("el-form",{attrs:{model:e.searchContent,"label-position":"top"}},[a("el-form-item",{attrs:{label:"创建时间"}},[a("date-picker-range",{attrs:{defaultRange:e.searchContent.defaultRange,format:"yyyy-MM-dd",type:"daterange"},on:{datePickerRangeChange:e.datePickerRangeChange}})],1),e._v(" "),a("region-city-store",{attrs:{showGroup:!1,showStore:!1,defaultCityId:e.searchContent.cityId},on:{StoreGroupChange:e.StoreGroupChange}}),e._v(" "),a("el-form-item",{attrs:{label:"页面名称"}},[a("el-input",{staticClass:"search-input",attrs:{placeholder:"请输入页面名称",size:"small",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.doSearchHandel(!0)}},model:{value:e.searchContent.pageName,callback:function(t){e.$set(e.searchContent,"pageName","string"==typeof t?t.trim():t)},expression:"searchContent.pageName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"页面类型"}},[a("el-select",{staticClass:"search-input",attrs:{filterable:"",placeholder:"请选择页面类型",size:"small"},on:{change:function(t){return e.doSearchHandel(!0)}},model:{value:e.searchContent.pageType,callback:function(t){e.$set(e.searchContent,"pageType",t)},expression:"searchContent.pageType"}},e._l(e.pageTypeOptions,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.doSearchHandel(!0)}}},[e._v("搜索")])],1)],1)],1)]),e._v(" "),a("div",{staticClass:"table-wraper"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"fixed-height",staticStyle:{width:"100%"},attrs:{data:e.tableData,"empty-text":"没有查询到您想要的数据",size:"small"}},[a("el-table-column",{attrs:{"min-width":"70px",prop:"id",label:"页面ID"}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"120px",prop:"pageName",label:"页面名称"}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"120px",prop:"pageTypeName",label:"页面类型"}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"110px",prop:"regionName",label:"区域"}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"100px",label:"应用门店数"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("router-link",{attrs:{to:t.row.userStoreNumRedirectUrl,target:"_blank"}},[e._v(e._s(t.row.userStoreNum||0))])]}}])}),e._v(" "),a("el-table-column",{attrs:{"min-width":"100px",label:"上架门店数"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("router-link",{attrs:{to:t.row.userOnStoreNumRedirectUrl,target:"_blank"}},[e._v(e._s(t.row.userOnStoreNum||0))])]}}])}),e._v(" "),a("el-table-column",{attrs:{"min-width":"170px",prop:"createTime",label:"创建时间"}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"170px",prop:"updateTime",label:"修改时间"}}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-edit"},on:{click:function(a){return e.showDetail(t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-delete"},on:{click:function(a){return e.deleteItem(t.row)}}},[e._v("删除")])],1),e._v(" "),a("div",[a("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-document"},on:{click:function(a){return e.copyItem(t.row)}}},[e._v("复制")])],1)]}}])})],1),e._v(" "),e.total>0?a("el-pagination",{staticClass:"tc mt20",attrs:{background:"","current-page":e.pageNum,"page-sizes":[20,50,100,150,200],layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.changeSize,"current-change":e.changeCurrent,"update:currentPage":function(t){e.pageNum=t},"update:current-page":function(t){e.pageNum=t}}}):e._e()],1),e._v(" "),a("el-dialog",{attrs:{"close-on-click-modal":!1,"close-on-press-escape":!1,title:"选择模板",visible:e.dialogFormVisible,width:"420px"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"form",attrs:{"label-width":"90px"}},[a("el-form-item",{attrs:{label:"选择模板",required:""}},[a("el-select",{staticClass:"search-input",attrs:{filterable:"",clearable:"",placeholder:"请选择页面类型",size:"small"},on:{change:e.changeSelectTemp},model:{value:e.tempId,callback:function(t){e.tempId=t},expression:"tempId"}},e._l(e.selectTempOptions,function(e,t){return a("el-option",{key:t,attrs:{label:e.tempName,value:e.id}})}),1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini",disabled:""===e.pageType||!e.pageType},on:{click:e.goNextHandel}},[e._v("下一步")])],1)],1)],1)},staticRenderFns:[]};var v=a("VU/8")(h,f,!1,function(e){a("qOmy")},null,null);t.default=v.exports},qOmy:function(e,t){}});
//# sourceMappingURL=112.4a091236231f1d421504.js.map