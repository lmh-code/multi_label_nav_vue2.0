webpackJsonp([5],{"3a+s":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,o=a("bOdI"),i=a.n(o),r=a("Gu7T"),l=a.n(r),n=a("mvHQ"),d=a.n(n),c=a("BO1k"),m=a.n(c),p=a("Dd8w"),u=a.n(p),h=a("ssT3"),f=a("oAV5"),g=a("cpGA"),v=a("hR2Z"),y=a("Rav0"),C=a("RAJj"),b=a("enjp"),k=a("8uth"),_=a("ylbZ"),S=a("3rb3"),w=a("u6Xy"),P=/^[1-9]*[1-9][0-9]*$/,M=/((^[1-9]\d*)|^0)(\.\d{0,2}){0,1}$/,D={data:function(){return{isDisabled:!1,addParamMsg:{platformId:5,DIFFCITY:!0,regionCode:h.a.get("regionCode")||"",activityName:"",startDatetime:"",endDatetime:"",activityType:51,presaleType:2,cycleType:1,shortCycleType:1,longCycleType:3,cutoffTime:"",shortPickUpType:0,longPickUpType:5,pickUpStartDate:"",pickUpEndDate:"",goodsReqList:[],storeNoList:[]},shortCircleOptions:[{label:"每天",value:1},{label:"每2天",value:2}],shortPickUpTypeOptions:[{label:"截单后第2天提",value:0}],longCycleOptions:[{label:"周一",value:1},{label:"周二",value:2},{label:"周三",value:3},{label:"周四",value:4},{label:"周五",value:5},{label:"周六",value:6},{label:"周日",value:7}],pickerOptions:{disabledDate:function(e){return e.getTime()<Date.now()-864e5}},checkedList:[],imageUploadLoading:!1,currentUpFileIdx:-1,activityStoresCheckedList:[],tempConfig:{platformCityGoodsId:"区域商品id(必填)",goodsNo:"SKU编码(选填)",skuNo:"ERP商品编码(选填)",goodsName:"活动商品名称(可修改，必填)",price:"原价(必填）",preSalePrice:"预售价(必填)",platformCurStock:"区域限售库存(选填，为空时不限)",stock:"门店限售库存(选填，为空时不限)",limitCount:"每人每期限购(选填，为空时不限)",sortNum:"排序(必填)"},showTipErrorMsg:!1,hasErrorMsgData:[],currentTableGoodsId:-1,chooseVendorLoading:!1}},components:{"excel-add":b.a,"choose-goods":y.a,"choose-store":v.a,region:_.a,"choose-vendor":C.a},methods:(s={doSaveHandel:function(){var e=this;if(this.addParamMsg.activityName)if(this.addParamMsg.activityName.length>20)this.$message("预售周期名称,限制20个字");else if(this.addParamMsg.startDatetime)if(this.addParamMsg.endDatetime){var t=f.a(this.addParamMsg.startDatetime),a=f.a(this.addParamMsg.endDatetime);if(a<=t)this.$message("结束时间不能早于或等于开始时间");else{if(1===parseInt(this.addParamMsg.presaleType)){if(!this.addParamMsg.pickUpStartDate)return void this.$message("请选择提货日期");if(f.a(this.addParamMsg.pickUpStartDate)<=a)return void this.$message("提货日期不能早于结束时间")}else if(2===parseInt(this.addParamMsg.presaleType)&&!this.addParamMsg.cutoffTime)return void this.$message("请选择截单时间");var s=this.activityStoresCheckedList.map(function(e){return e.erpStoreNo});if(this.addParamMsg.storeNoList=s,0!==this.addParamMsg.storeNoList.length){var o=[],i=!0,r=!1,l=void 0;try{for(var n,d=m()(this.checkedList);!(i=(n=d.next()).done);i=!0){var c=n.value;if(""===c.goodsName)return void this.$message("请输入("+c.goodsName+")的商品名称");if(!c.vendorNo)return void this.$message("请输入("+c.goodsName+")的供应商");if(!c.price)return void this.$message("请输入("+c.goodsName+")的原价");if(!M.test(c.price)||0==c.price)return void this.$message("原价是大于0，小数保留小数点后2位");if(!c.preSalePrice)return void this.$message("请输入("+c.goodsName+")的预售价");if(!M.test(c.preSalePrice)||0==c.preSalePrice)return void this.$message("预售价是大于0，小数保留小数点后2位");if(parseFloat(c.preSalePrice)>parseFloat(c.price))return void this.$message("("+c.goodsName+")的原价必须大于等于预售价");if(0!=c.platformCurStock&&c.platformCurStock){if(!P.test(c.platformCurStock))return void this.$message("区域限售库存格式不正确");if(c.platformCurStock<0)return void this.$message("区域限售库存不能小于0");if(c.platformCurStock>9999)return void this.$message("区域限售库存不能大于9999");if(c.platformCurStock>c.vendorStock)return void this.$message("区域限售库存不能大于供应商库存"+c.vendorStock)}if(0!=c.limitCount&&c.limitCount){if(!P.test(c.limitCount))return void this.$message("输入限购数量格式不正确");if(c.limitCount<0)return void this.$message("限购数量不能小于0")}if(0!=c.sortNum&&c.sortNum){if(!P.test(c.sortNum))return void this.$message("排序权重为0 — 299的整数，越大越靠前");if(c.sortNum<0||c.sortNum>299)return void this.$message("排序权重为0 — 299的整数，越大越靠前")}var p={preSaleImageUrl:c.preSaleImageUrl,goodsId:c.goodsId,goodsNo:c.goodsNo,skuNo:c.skuNo,goodsName:c.goodsName,preSalePrice:c.preSalePrice,price:c.price,platformCurStock:c.platformCurStock,limitCount:c.limitCount,sortNum:c.sortNum,spec:c.spec,platformCityGoodsId:c.platformCityGoodsId,vendorNo:c.vendorNo,vendorName:c.vendorName,vendorStock:c.vendorStock};o.push(p)}}catch(e){r=!0,l=e}finally{try{!i&&d.return&&d.return()}finally{if(r)throw l}}if(0!==o.length){var h={DIFFCITY:this.addParamMsg.DIFFCITY,regionCode:this.addParamMsg.regionCode,activityName:this.addParamMsg.activityName,presaleType:this.addParamMsg.presaleType,startDatetime:this.addParamMsg.startDatetime,endDatetime:this.addParamMsg.endDatetime,storeNoList:this.addParamMsg.storeNoList,activityType:this.addParamMsg.activityType,goodsReqList:o};2===parseInt(this.addParamMsg.presaleType)?1===parseInt(this.addParamMsg.cycleType)?(h.cycleType=this.addParamMsg.cycleType,h.cutoffType=0,h.cutoffDays=this.addParamMsg.shortCycleType,h.cutoffTime=this.addParamMsg.cutoffTime,h.pickUpType=this.addParamMsg.shortPickUpType):(h.cycleType=this.addParamMsg.cycleType,h.cutoffType=this.addParamMsg.longCycleType,h.cutoffTime=this.addParamMsg.cutoffTime,h.pickUpType=this.addParamMsg.longPickUpType):h.pickUpStartDatetime=this.addParamMsg.pickUpStartDate+" 00:00:00",this.isDisabled=!0,this.$http.post(w.a.saveActivity,u()({},h)).then(function(t){if(setTimeout(function(){e.isDisabled=!1},800),0===t.code)return e.$message.success("保存成功"),void e.$router.push("/supplier_act");throw new Error(t.msg)}).catch(function(t){e.isDisabled=!1,e.$notify.error({title:"提示",message:t.message})})}else this.$message("请先设置预售商品")}else this.$message("请选择参与门店")}}else this.$message("请选择结束时间");else this.$message("请选择开始时间");else this.$message("请输入预售周期名称")},doCancelHandel:function(){var e=this;this.$confirm("确定取消吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$router.push("/supplier_act")}).catch(function(){})},goAddGoodsDialog:function(){if(this.addParamMsg.startDatetime&&this.addParamMsg.endDatetime){var e=f.a(this.addParamMsg.startDatetime);if(f.a(this.addParamMsg.endDatetime)<=e)this.$message("活动结束时间不能早于或等于开始时间");else if(this.$refs.chooseGoods){var t={title:"选择商品",regionCode:this.addParamMsg.regionCode,vendorType:1,checkedList:this.checkedList};this.$refs.chooseGoods.setDefault(t)}}else this.$message("请先选择活动开始时间和结束时间")},confirmChooseGoods:function(e){var t=e.checkedList||[],a=this.checkedList;t.forEach(function(e){e.activityType=51,e.goodsName=e.platformCityGoodsName,e.preSaleImageUrl=e.bigImageUrl,a.forEach(function(t){e.platformCityGoodsId==t.platformCityGoodsId&&(e.goodsName=t.goodsName,e.preSaleImageUrl=t.preSaleImageUrl,e.preSalePrice=t.preSalePrice,e.price=t.price,e.limitCount=t.limitCount,e.platformCurStock=t.platformCurStock,e.sortNum=t.sortNum,e.stock=t.stock,e.vendorName=t.vendorName,e.vendorNo=t.vendorNo,e.vendorStock=t.vendorStock)})}),this.checkedList=JSON.parse(d()(t))},deleteItem:function(e){var t=e.platformCityGoodsId,a=this.checkedList.filter(function(e){return e.platformCityGoodsId!=t});this.checkedList=JSON.parse(d()(a))},setItemIdx:function(e){this.imageUploadLoading||(this.currentUpFileIdx=e)},emitUpload:function(e){var t=this;this.imageUploadLoading=!0,this.getToken().then(function(a){g.upload(e.file,a.fileName,a.token).subscribe({error:function(){t.imageUploadLoading=!1},complete:function(e){var a="http://retailimg01.benlailife.com/"+e.key;t.imageUploadLoading=!1;var s=[].concat(l()(t.checkedList));s.forEach(function(e){e.goodsId===t.currentUpFileIdx&&(e.preSaleImageUrl=a)}),t.checkedList=s},next:function(e){}})})},imageUploadReg:function(e){var t=-1!==e.type.indexOf("image/"),a="image/jpeg"===e.type||"image/png",s=e.size<=307200;return t&&a&&s||this.$message.error("商品图片建议上传大小不超过300K的710*420像素的jpg或png图片"),t&&a&&s},getToken:function(){var e=this;return this.$http.post(S.a.getQiNiuToken,{}).then(function(e){if(0==e.code){var t=e.data.token;return{fileName:e.data.key,token:t}}throw new Error(e.msg)}).catch(function(t){e.imageUploadLoading=!1,e.$notify.error({title:"获取七牛token提示",message:t.message})})},platformCurStockHeader:function(){var e=this.$createElement;return e("el-popover",{attrs:{placement:"top-start",width:"260",trigger:"hover"}},[e("div",[e("p",["区域限售库存，即所有门店共享的总预售库存；"]),e("p",["门店限售即每个门店的预售库存，可在门店预售商品中调整门店库存；"]),e("p",["每个商品至少要设置一种限售库存方式，最大可设置9999；"]),e("p",["如果既设了区域限售，又设了门店限售，则先校验区域库存，再校验门店库存；"])]),e("span",{slot:"reference"},["区域限售库存",e("i",{class:"el-icon-question"})])])},limitCountHeader:function(){var e=this.$createElement;return e("el-popover",{attrs:{placement:"top-start",width:"260",trigger:"hover",content:"短周期为每人每天限购数量；长周期为每人每周限购数量；单期预售为每人活动期间限购数量；为空时不限；"}},[e("span",{slot:"reference"},["每人每期限购",e("i",{class:"el-icon-question"})])])},sortNumHeader:function(){var e=this.$createElement;return e("el-popover",{attrs:{placement:"top-start",trigger:"hover",content:"0-299 越大越靠前"}},[e("span",{slot:"reference"},["排序权重",e("i",{class:"el-icon-question"})])])}},i()(s,"platformCurStockHeader",function(){var e=this.$createElement;return e("el-popover",{attrs:{placement:"top-start",width:"260",trigger:"hover"}},[e("div",[e("p",["区域限售库存，即所有门店共享的总预售库存；"]),e("p",["门店限售即每个门店的预售库存，可在门店预售商品中调整门店库存；"]),e("p",["每个商品至少要设置一种限售库存方式，最大可设置9999；"]),e("p",["如果既设了区域限售，又设了门店限售，则先校验区域库存，再校验门店库存；"])]),e("span",{slot:"reference"},["区域限售库存",e("i",{class:"el-icon-question"})])])}),i()(s,"chooseStoreOpen",function(){var e={platformId:this.addParamMsg.platformId,regionCode:this.addParamMsg.regionCode,title:"选择门店",checkedList:this.activityStoresCheckedList};this.$refs.chooseStore.setDefault(e)}),i()(s,"deleteStoreItem",function(e){var t=e.erpStoreNo;this.activityStoresCheckedList=this.activityStoresCheckedList.filter(function(e){return e.erpStoreNo!==t})}),i()(s,"confirmChooseStore",function(e){var t=[];t=e.checkedList&&e.checkedList.length?e.checkedList:[],this.activityStoresCheckedList=t}),i()(s,"doConfirmHandel",function(e){var t=this,a=e.dataList||[];a.forEach(function(e){e.activityType=51}),this.$http.post(w.a.checkPreGoodsInsert,[].concat(l()(a))).then(function(e){if(t.$refs.excelAdd.closeDisabled(),t.$refs.excelAdd.closeDialog(),0!==e.code)throw new Error(e.msg);if(t.hasErrorMsgData=e.data&&e.data.length?e.data:[],t.hasErrorMsgData.some(function(e){return 1===e.msgType}))t.showTipErrorMsg=!0;else{var a=[].concat(l()(t.checkedList));a.forEach(function(e){t.hasErrorMsgData.forEach(function(t){e.goodsId===t.goodsId&&e.goodsNo===t.goodsNo&&e.platformCityGoodsId===t.platformCityGoodsId&&e.skuNo===t.skuNo&&(e.goodsName=t.goodsName,e.spec=t.spec,e.preSaleImageUrl=t.preSaleImageUrl,e.price=t.price,e.preSalePrice=t.preSalePrice,e.platformCurStock=t.platformCurStock,e.stock=t.stock,e.limitCount=t.limitCount,e.sortNum=t.sortNum)})});var s={};t.checkedList=[].concat(l()(a),l()(t.hasErrorMsgData)).reduceRight(function(e,t){return!s[t.platformCityGoodsId]&&(s[t.platformCityGoodsId]=e.push(t)),e},[])}}).catch(function(e){t.$refs.excelAdd.closeDisabled(),t.$refs.excelAdd.closeDialog(),t.$notify.error({title:"提示",message:e.message})})}),i()(s,"showExcelBatchInsertDialog",function(){if(this.$refs.excelAdd){var e={title:"Excel 批量导入",tempConfig:this.tempConfig};this.$refs.excelAdd.setDefaultMsg(e)}}),i()(s,"downLoadErrorMsg",function(){var e=this,t=u()({},this.tempConfig);t.msgTypeStr="验证结果",t.msg="失败原因",this.hasErrorMsgData.forEach(function(e){e.msgTypeStr=1===e.msgType?"验证失败":"验证成功"});var a=f.o(t,!1),s=f.o(t,!0);k.a.ExportJsonToExcel({header:a,filterVal:s,data:this.hasErrorMsgData,filename:"Excel批量导入模板"}),setTimeout(function(){e.$notify.success({title:"温馨提示",message:"Excel批量导入模板下载成功"}),e.isDisabled=!1},500)}),i()(s,"shortCircleChange",function(){this.checkedList=[]}),i()(s,"chooseVendorHandel",function(e){var t=this;if(this.addParamMsg.startDatetime&&this.addParamMsg.endDatetime){var a=f.a(this.addParamMsg.startDatetime);if(f.a(this.addParamMsg.endDatetime)<=a)this.$message("活动结束时间不能早于或等于开始时间");else{var s={DIFFCITY:!0,startDate:this.addParamMsg.startDatetime,endDate:this.addParamMsg.endDatetime,regionCode:this.addParamMsg.regionCode,skuNo:e.skuNo,goodsNo:e.goodsNo};if(2===parseInt(this.addParamMsg.presaleType))s.days=this.addParamMsg.shortCycleType?parseInt(this.addParamMsg.shortCycleType):null;else{var o=f.a(this.addParamMsg.startDatetime),i=f.a(this.addParamMsg.endDatetime),r=Math.ceil((i-o)/864e5);s.days=isNaN(r)?null:r}this.currentTableGoodsId=e.platformCityGoodsId,this.chooseVendorLoading=!0,this.$http.post(w.a.vendorSingleGoodsPrice,u()({},s)).then(function(a){if(t.currentTableGoodsId=-1,t.chooseVendorLoading=!1,0!==a.code)throw new Error(a.msg);var s={platformCityGoodsId:e.platformCityGoodsId,tableData:a.data&&a.data.length?a.data:[]};t.$refs.chooseVendor.setDefault(s)}).catch(function(e){t.currentTableGoodsId=-1,t.chooseVendorLoading=!1,t.$notify.error({title:"提示",message:e.message})})}}else this.$message("请先选择活动开始时间和结束时间")}),i()(s,"confirmChooseVendor",function(e){var t=e.platformCityGoodsId,a=e.row,s=this.checkedList;s.forEach(function(e){e.platformCityGoodsId==t&&(e.vendorNo=a.vendorNo,e.vendorName=a.vendorName,e.vendorStock=a.vendorStock,e.platformCurStock=a.vendorStock,e.price=a.price,e.preSalePrice=a.salePrice)}),this.checkedList=JSON.parse(d()(s))}),s)},T={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"add-form-wraper"},[a("el-form",{ref:"form",attrs:{model:e.addParamMsg,"label-width":"160px"}},[a("region",{staticClass:"region-wrap",attrs:{className:"add-input",label:"选择区域",required:!0}}),e._v(" "),a("el-form-item",{attrs:{label:"预售活动名称",required:""}},[a("el-input",{staticClass:"add-input",attrs:{size:"small",placeholder:"请输入预售活动名称"},model:{value:e.addParamMsg.activityName,callback:function(t){e.$set(e.addParamMsg,"activityName",t)},expression:"addParamMsg.activityName"}}),e._v(" "),a("span",[e._v("活动名称，限制20个字")])],1),e._v(" "),a("el-form-item",{attrs:{label:"预售类型",required:""}},[a("div",[a("el-radio",{attrs:{label:2},model:{value:e.addParamMsg.presaleType,callback:function(t){e.$set(e.addParamMsg,"presaleType",t)},expression:"addParamMsg.presaleType"}},[e._v("周期预售（起止时间周期性提货，适用于今订明取，或每周固定周几提）")])],1),e._v(" "),a("div",[a("el-radio",{attrs:{label:1},model:{value:e.addParamMsg.presaleType,callback:function(t){e.$set(e.addParamMsg,"presaleType",t)},expression:"addParamMsg.presaleType"}},[e._v("单期预售（结束后，一次性提货，适用于未上市商品，提前预售）")])],1)]),e._v(" "),2==e.addParamMsg.presaleType?a("el-form-item",{attrs:{label:"周期类型",required:""}},[a("el-radio",{attrs:{label:1},model:{value:e.addParamMsg.cycleType,callback:function(t){e.$set(e.addParamMsg,"cycleType",t)},expression:"addParamMsg.cycleType"}},[e._v("短周期（隔1-2日提）")])],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"开始时间",required:""}},[a("el-date-picker",{staticClass:"add-input",attrs:{size:"small",type:"datetime",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss","picker-options":e.pickerOptions,placeholder:"请输入开始时间"},model:{value:e.addParamMsg.startDatetime,callback:function(t){e.$set(e.addParamMsg,"startDatetime",t)},expression:"addParamMsg.startDatetime"}}),e._v(" "),a("span",[e._v("同一个商品不同周期，起止时间不能有重叠，开始时间添加保存后不可修改")])],1),e._v(" "),a("el-form-item",{attrs:{label:"结束时间",required:""}},[a("el-date-picker",{staticClass:"add-input",attrs:{size:"small",type:"datetime",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss","picker-options":e.pickerOptions,placeholder:"请输入结束时间"},model:{value:e.addParamMsg.endDatetime,callback:function(t){e.$set(e.addParamMsg,"endDatetime",t)},expression:"addParamMsg.endDatetime"}}),e._v(" "),a("span",[e._v("周期预售最后一期、单期预售，用户端以结束时间截单，结束时间添加保存后不可修改")])],1),e._v(" "),2==e.addParamMsg.presaleType&&1==e.addParamMsg.cycleType?a("div",[a("el-form-item",{attrs:{label:"截单时间",required:""}},[a("el-select",{staticClass:"add-input-inline",attrs:{placeholder:"截单时间",size:"small"},on:{change:e.shortCircleChange},model:{value:e.addParamMsg.shortCycleType,callback:function(t){e.$set(e.addParamMsg,"shortCycleType",t)},expression:"addParamMsg.shortCycleType"}},e._l(e.shortCircleOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),a("el-time-picker",{staticClass:"add-input-inline",attrs:{placeholder:"选择时间",format:"HH:mm","value-format":"HH:mm",size:"small"},model:{value:e.addParamMsg.cutoffTime,callback:function(t){e.$set(e.addParamMsg,"cutoffTime",t)},expression:"addParamMsg.cutoffTime"}}),e._v(" "),a("span",[e._v("每天截单即24小时一个周期，每2天截单即48小时一个周期")])],1),e._v(" "),a("el-form-item",{attrs:{label:"提货日期",required:""}},[a("el-select",{staticClass:"add-input",attrs:{placeholder:"提货日期",size:"small"},model:{value:e.addParamMsg.shortPickUpType,callback:function(t){e.$set(e.addParamMsg,"shortPickUpType",t)},expression:"addParamMsg.shortPickUpType"}},e._l(e.shortPickUpTypeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),a("span",[e._v("表示一个周期结束后的第二天提货")])],1)],1):e._e(),e._v(" "),2==e.addParamMsg.presaleType&&2==e.addParamMsg.cycleType?a("div",[a("el-form-item",{attrs:{label:"截单时间",required:""}},[a("el-select",{staticClass:"add-input-inline",attrs:{placeholder:"截单时间",size:"small"},model:{value:e.addParamMsg.longCycleType,callback:function(t){e.$set(e.addParamMsg,"longCycleType",t)},expression:"addParamMsg.longCycleType"}},e._l(e.longCycleOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),a("el-time-picker",{staticClass:"add-input-inline",attrs:{placeholder:"选择时间",format:"HH:mm","value-format":"HH:mm",size:"small"},model:{value:e.addParamMsg.cutoffTime,callback:function(t){e.$set(e.addParamMsg,"cutoffTime",t)},expression:"addParamMsg.cutoffTime"}}),e._v(" "),a("span",[e._v("用户端在当天截单时间后不展示本期预售商品，后台在截单时间提交订货")])],1),e._v(" "),a("el-form-item",{attrs:{label:"提货日期",required:""}},[a("el-select",{staticClass:"add-input",attrs:{placeholder:"提货日期",size:"small"},model:{value:e.addParamMsg.longPickUpType,callback:function(t){e.$set(e.addParamMsg,"longPickUpType",t)},expression:"addParamMsg.longPickUpType"}},e._l(e.longCycleOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),a("span",[e._v("每周五提货，建议给采购预留1天，每周三截单")])],1)],1):e._e(),e._v(" "),1==e.addParamMsg.presaleType?a("el-form-item",{attrs:{label:"提货日期",required:""}},[a("el-date-picker",{staticClass:"add-input",attrs:{size:"small",type:"date",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd","picker-options":e.pickerOptions,placeholder:"提货日期"},model:{value:e.addParamMsg.pickUpStartDate,callback:function(t){e.$set(e.addParamMsg,"pickUpStartDate",t)},expression:"addParamMsg.pickUpStartDate"}}),e._v(" "),a("span",[e._v("活动结束后提货，日期需大于活动结束日期")])],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"参与门店",required:""}},[a("el-button",{attrs:{size:"small",icon:"el-icon-plus"},on:{click:e.chooseStoreOpen}},[e._v("选择门店")]),e._v(" "),e.activityStoresCheckedList.length>0?a("div",{staticClass:"choose-store-table-wrap"},[a("el-table",{staticClass:"fixed-height",attrs:{data:e.activityStoresCheckedList,"empty-text":"暂无选中任何门店","max-height":"300",size:"small"}},[a("el-table-column",{attrs:{"min-width":"220px",label:"门店编码/名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v("\n                "+e._s(t.row.erpStoreNo)+"_"+e._s(t.row.erpStoreName)+"\n              ")])]}}],null,!1,974369925)}),e._v(" "),a("el-table-column",{attrs:{"min-width":"80",prop:"cityName",label:"城市"}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"80",prop:"saleTypeName",label:"门店类型"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-delete"},on:{click:function(a){return e.deleteStoreItem(t.row)}}},[e._v("删除")])]}}],null,!1,3121094832)})],1)],1):e._e()],1),e._v(" "),a("el-form-item",{attrs:{label:"设置预售商品",required:""}},[a("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-plus"},on:{click:e.goAddGoodsDialog}},[e._v("添加商品")]),e._v(" "),e._v("\n          "),a("span",{staticStyle:{color:"red"}},[e._v("*注意：")]),a("span",[e._v("商品图片建议上传大小不超过300K的710*420像素的jpg或png图片")]),e._v(" "),a("el-table",{staticClass:"fixed-height choose-goods-wrap",staticStyle:{width:"100%"},attrs:{data:e.checkedList,"empty-text":"暂无选中任何商品","max-height":"560",size:"small"}},[a("el-table-column",{attrs:{"min-width":"300px",label:"商品信息"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"ll-p-m-w"},[a("div",{staticClass:"mh-up-w",on:{click:function(a){return e.setItemIdx(t.row.goodsId)}}},[a("el-upload",{staticClass:"avatar-uploader-sf-goods-img",attrs:{action:"","show-file-list":!1,"before-upload":e.imageUploadReg,"http-request":e.emitUpload}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.imageUploadLoading&&e.currentUpFileIdx==t.row.goodsId,expression:"imageUploadLoading && currentUpFileIdx == scope.row.goodsId"}]},[t.row.preSaleImageUrl?a("span",[a("img",{staticClass:"avatar-sf-goods",attrs:{src:t.row.preSaleImageUrl}})]):a("i",{staticClass:"el-icon-plus avatar-uploader-sf-icon"})])])],1),e._v(" "),a("div",{staticClass:"ll-p-m-c-r"},[a("div",[a("el-input",{attrs:{size:"small",placeholder:"输入商品名称"},model:{value:t.row.goodsName,callback:function(a){e.$set(t.row,"goodsName",a)},expression:"scope.row.goodsName"}})],1),e._v(" "),a("div",{staticClass:"ll-erp-p-no"},[e._v("SKU编码："+e._s(t.row.goodsNo||"--"))]),e._v(" "),a("div",{staticClass:"ll-erp-p-no"},[e._v("商品ID："+e._s(t.row.platformCityGoodsId||"--"))]),e._v(" "),a("div",{staticClass:"ll-erp-p-no"},[e._v("商品编码："+e._s(t.row.skuNo||"--"))])])])]}}])}),e._v(" "),a("el-table-column",{attrs:{"min-width":"100px",prop:"spec",label:"规格"}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"170px",label:"供应商"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("el-input",{attrs:{size:"small",placeholder:"选择供应商",disabled:""},model:{value:t.row.vendorName,callback:function(a){e.$set(t.row,"vendorName",a)},expression:"scope.row.vendorName"}},[a("el-button",{attrs:{slot:"append",size:"small",icon:e.currentTableGoodsId===t.row.platformCityGoodsId&&e.chooseVendorLoading?"el-icon-loading":"el-icon-search"},on:{click:function(a){return e.chooseVendorHandel(t.row)}},slot:"append"})],1)],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{"min-width":"130px",label:"原价(必填)"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("el-input",{attrs:{size:"small",placeholder:"输入原价"},model:{value:t.row.price,callback:function(a){e.$set(t.row,"price",a)},expression:"scope.row.price"}})],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{"min-width":"130px",label:"预售价(必填)"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("el-input",{attrs:{disabled:"",size:"small",placeholder:"输入预售价"},model:{value:t.row.preSalePrice,callback:function(a){e.$set(t.row,"preSalePrice",a)},expression:"scope.row.preSalePrice"}})],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{"min-width":"130px","render-header":e.platformCurStockHeader},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("el-input",{attrs:{size:"small",placeholder:"区域限售库存"},model:{value:t.row.platformCurStock,callback:function(a){e.$set(t.row,"platformCurStock",a)},expression:"scope.row.platformCurStock"}})],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{"min-width":"140px","render-header":e.limitCountHeader},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("el-input",{attrs:{size:"small",placeholder:"每人每期限购"},model:{value:t.row.limitCount,callback:function(a){e.$set(t.row,"limitCount",a)},expression:"scope.row.limitCount"}})],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{"min-width":"140px","render-header":e.sortNumHeader},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("el-input",{attrs:{size:"small",placeholder:"排序（0-299越大越靠前）"},model:{value:t.row.sortNum,callback:function(a){e.$set(t.row,"sortNum",a)},expression:"scope.row.sortNum"}})],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",align:"center",label:"操作",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-delete"},on:{click:function(a){return e.deleteItem(t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("p",[a("span",{staticStyle:{color:"red"}},[e._v("*")]),e._v("预售活动未发布时可以编辑商品，发布后只可添加新商品，不可再编辑已有商品；")]),e._v(" "),a("p",[a("span",{staticStyle:{color:"red"}},[e._v("*")]),e._v("活动进行中时新上门店，请在预售商品中发布至门店；")])],1),e._v(" "),a("hr",{staticClass:"s-slip-tb"}),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"small",disabled:e.isDisabled,icon:e.isDisabled?"el-icon-loading":null},on:{click:e.doSaveHandel}},[e._v("保存")]),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:e.doCancelHandel}},[e._v("取消")])],1)],1),e._v(" "),a("choose-goods",{ref:"chooseGoods",on:{confirmChooseGoods:e.confirmChooseGoods}}),e._v(" "),a("choose-store",{ref:"chooseStore",on:{confirmChooseStore:e.confirmChooseStore}}),e._v(" "),a("excel-add",{ref:"excelAdd",on:{doConfirmHandel:e.doConfirmHandel}}),e._v(" "),a("el-dialog",{attrs:{title:"批量导入失败",visible:e.showTipErrorMsg,"close-on-click-modal":!1,"close-on-press-escape":!1,width:"450px"},on:{"update:visible":function(t){e.showTipErrorMsg=t}}},[a("div",[e._v("\n      部分商品不符合要求，请按要求修改后再重新导入。"),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:e.downLoadErrorMsg}},[e._v("下载查看失败原因")])],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.showTipErrorMsg=!1}}},[e._v("关 闭")])],1)]),e._v(" "),a("choose-vendor",{ref:"chooseVendor",on:{confirmChooseVendor:e.confirmChooseVendor}})],1)},staticRenderFns:[]};var N=a("VU/8")(D,T,!1,function(e){a("OCnz")},null,null);t.default=N.exports},OCnz:function(e,t){},RAJj:function(e,t,a){"use strict";var s=a("Gu7T"),o=a.n(s),i=a("mvHQ"),r=a.n(i),l=a("bOdI"),n=a.n(l),d={data:function(){var e;return e={isShow:!1,title:"选择供应商",searchContent:{searchValue:""},tableData:[]},n()(e,"tableData",[]),n()(e,"platformCityGoodsId",""),e},methods:{setDefault:function(e){this.title=e.title||"选择供应商",this.tableData=e.tableData&&e.tableData.length?JSON.parse(r()(e.tableData)):[],this.tableDataTemp=e.tableData&&e.tableData.length?JSON.parse(r()(e.tableData)):[],this.platformCityGoodsId=e.platformCityGoodsId||"",this.searchContent.searchValue="",this.isShow=!0},chooseHandel:function(e){var t={platformCityGoodsId:this.platformCityGoodsId,row:e};this.$emit("confirmChooseVendor",t),this.isShow=!1},doSearchHandel:function(){var e=this.searchContent.searchValue;this.tableData=e?this.tableDataTemp.filter(function(t){return t.vendorName.includes(e)||t.vendorNo==e}):[].concat(o()(this.tableDataTemp))}}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{attrs:{"close-on-click-modal":!1,"close-on-press-escape":!1,title:e.title,visible:e.isShow,width:"720px"},on:{"update:visible":function(t){e.isShow=t}}},[a("div",{staticClass:"search-form-wraper c-g-sfw"},[a("el-form",{attrs:{model:e.searchContent,"label-position":"top"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",[a("el-input",{staticClass:"search-input",attrs:{placeholder:"供应商编号/关键字",size:"small",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.doSearchHandel(t)}},model:{value:e.searchContent.searchValue,callback:function(t){e.$set(e.searchContent,"searchValue","string"==typeof t?t.trim():t)},expression:"searchContent.searchValue"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.doSearchHandel}},[e._v("搜索")])],1)],1)],1),e._v(" "),a("div",[a("el-table",{staticClass:"fixed-height",staticStyle:{width:"100%"},attrs:{data:e.tableData,"row-key":"platformCityGoodsId","empty-text":"没有查询到您想要的数据",height:"350",size:"small"}},[a("el-table-column",{attrs:{"min-width":"90px",prop:"vendorNo",label:"供应商编号"}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"120px",prop:"vendorName",label:"供应商名称"}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"70px",prop:"price",label:"市场价"}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"70px",prop:"salePrice",label:"售价"}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"80px",prop:"vendorStock",label:"活动库存"}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"210px",label:"有效期"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.validStartDate&&t.row.validEndDate?a("div",{staticClass:"date-wrap-inline"},[a("div",[a("p",[e._v(e._s(t.row.validStartDate.substr(0,10)))]),e._v(" "),a("p",[e._v(e._s(t.row.validStartDate.substr(11,8)))])]),e._v(" "),a("div",[e._v(" - ")]),e._v(" "),a("div",[a("p",[e._v(e._s(t.row.validEndDate.substr(0,10)))]),e._v(" "),a("p",[e._v(e._s(t.row.validEndDate.substr(11,8)))])])]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",align:"center",label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.chooseHandel(t.row)}}},[e._v("选择")])]}}])})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.isShow=!1}}},[e._v("关闭")])],1)])],1)},staticRenderFns:[]};var m=a("VU/8")(d,c,!1,function(e){a("gnqg")},"data-v-554dcfac",null);t.a=m.exports},Rav0:function(e,t,a){"use strict";var s=a("Dd8w"),o=a.n(s),i=a("BO1k"),r=a.n(i),l=a("mvHQ"),n=a.n(l),d=a("bzuE"),c="/plateform/a/category/getCategoryTree",m="/plateform/a/baseCommon/city/selectPreSaleCityGoodsList",p={data:function(){return{pageSizes:d.a.pageSizes10,isDisabled:!1,isShow:!1,title:"选择商品",loading:!1,pageNum:1,pageSize:10,total:0,searchContent:{DIFFCITY:!0,regionCode:"",saleType:4,vendorType:2,categoryIdList:[],searchValue:"",categoryId:""},tableData:[],checkedList:[],cateDefaultProps:{children:"categoryVoList",label:"categoryName",value:"categoryId"},isClickSublimitCloseDialog:!0,categoryList:[]}},methods:{setDefault:function(e){this.title=e.title||"",this.searchContent.regionCode=e.regionCode||"",this.searchContent.vendorType=e.vendorType||2,this.checkedList=e.checkedList&&e.checkedList.length?JSON.parse(n()(e.checkedList)):[],this.isClickSublimitCloseDialog=!0!==e.isClickSublimitCloseDialog&&!1!==e.isClickSublimitCloseDialog||e.isClickSublimitCloseDialog,this.isShow=!0,this.getCategoryId(),this.doSearchHandel(!0)},getCategoryId:function(){var e=this;this.$http.post(c,{DIFFCITY:!0}).then(function(t){if(0!==t.code)throw new Error(t.msg);if(t.data&&t.data.length){var a=!0,s=!1,o=void 0;try{for(var i,l=r()(t.data);!(a=(i=l.next()).done);a=!0){var n=i.value;n.categoryVoList&&0===n.categoryVoList.length&&(n.categoryVoList=null)}}catch(e){s=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(s)throw o}}e.categoryList=t.data}else e.categoryList=[]}).catch(function(e){console.log("提示(三方平台店内分类):",e.message)})},changeSize:function(e){this.pageSize=e,this.doSearchHandel()},changeCurrent:function(e){this.pageNum=e,this.doSearchHandel()},doSearchHandel:function(e){var t=this,a=this.searchContent.categoryIdList.length-1;this.searchContent.categoryId=this.searchContent.categoryIdList[a],this.loading=!0,!0===e&&(this.pageNum=1),this.$http.post(m,o()({},this.searchContent,{pageNum:this.pageNum,pageSize:this.pageSize})).then(function(e){if(t.loading=!1,0===e.code)return e.data&&e.data.result&&e.data.result.length?(t.tableData=e.data.result,t.total=e.data.total):t.tableData=[],void t.defaultSelectFun();throw new Error(e.msg)}).catch(function(e){t.loading=!1,t.$notify.error({title:"提示",message:e.message})})},handleSelect:function(e,t){if(e.includes(t))this.checkedList.push(t);else{var a=this.checkedList.findIndex(function(e){return e.storeNo===t.storeNo});this.checkedList.splice(a,1)}},handleSelectAll:function(e){var t=this;e.length?this.tableData.forEach(function(e){-1===t.checkedList.findIndex(function(t){return t.platformCityGoodsId===e.platformCityGoodsId})&&t.checkedList.push(e)}):this.tableData.forEach(function(e){var a=t.checkedList.findIndex(function(t){return t.platformCityGoodsId===e.platformCityGoodsId});-1!==a&&t.checkedList.splice(a,1)})},defaultSelectFun:function(){var e=this,t=[];this.tableData.forEach(function(a){e.checkedList.forEach(function(e){a.platformCityGoodsId==e.platformCityGoodsId&&(a.disabled=e.disabled,t.push(a))})}),t.length>0?(this.$refs.multipleTable.clearSelection(),setTimeout(function(){t.forEach(function(t){e.$refs.multipleTable.toggleRowSelection(t)})},100)):setTimeout(function(){e.$refs.multipleTable.clearSelection()},100)},confirmClose:function(){this.isDisabled=!0;var e={checkedList:this.checkedList};this.$emit("confirmChooseGoods",e),this.isClickSublimitCloseDialog&&(this.isShow=!1,this.isDisabled=!1)},doCategorysChangeHandel:function(){this.doSearchHandel(!0)},selectableHandel:function(e,t){return!e.disabled},closeDialog:function(){this.isShow=!1},closeDiasbled:function(){this.isDisabled=!1}}},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{attrs:{"close-on-click-modal":!1,"close-on-press-escape":!1,title:e.title,visible:e.isShow,width:"720px"},on:{"update:visible":function(t){e.isShow=t}}},[a("div",{staticClass:"search-form-wraper c-g-sfw"},[a("el-form",{attrs:{model:e.searchContent,"label-position":"top"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",[a("el-cascader",{staticClass:"search-input",attrs:{placeholder:"请选择分类",options:e.categoryList,"change-on-select":"",size:"small",clearable:"",filterable:"",props:e.cateDefaultProps},on:{change:e.doCategorysChangeHandel},model:{value:e.searchContent.categoryIdList,callback:function(t){e.$set(e.searchContent,"categoryIdList",t)},expression:"searchContent.categoryIdList"}})],1),e._v(" "),a("el-form-item",[a("el-input",{staticClass:"search-input",attrs:{placeholder:"SKU编码/商品名称",size:"small",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.doSearchHandel(!0)}},model:{value:e.searchContent.searchValue,callback:function(t){e.$set(e.searchContent,"searchValue","string"==typeof t?t.trim():t)},expression:"searchContent.searchValue"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.doSearchHandel(!0)}}},[e._v("搜索")])],1)],1)],1),e._v(" "),a("div",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"fixed-height",staticStyle:{width:"100%"},attrs:{data:e.tableData,"row-key":"platformCityGoodsId","empty-text":"没有查询到您想要的数据",height:"350",size:"small"},on:{select:e.handleSelect,"select-all":e.handleSelectAll}},[a("el-table-column",{attrs:{type:"selection",align:"center",selectable:e.selectableHandel}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"226px",label:"商品信息"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"ll-p-m-w"},[a("div",{staticClass:"ll-img-w"},[t.row.platformImageUrl&&""!=t.row.platformImageUrl?a("img",{attrs:{src:t.row.platformImageUrl,alt:"",onerror:"onerror=null;src='/shop/static/img_error.png'"}}):a("img",{attrs:{src:"/shop/static/img_error.png",alt:""}})]),e._v(" "),a("div",{staticClass:"ll-p-m-c-r"},[a("div",[e._v(e._s(t.row.platformCityGoodsName||"--"))]),e._v(" "),a("div",{staticClass:"ll-erp-p-no"},[e._v("SKU编码："+e._s(t.row.goodsNo||"--"))]),e._v(" "),a("div",{staticClass:"ll-erp-p-no"},[e._v("商品ID："+e._s(t.row.platformCityGoodsId||"--"))])])])]}}])}),e._v(" "),a("el-table-column",{attrs:{"min-width":"120px",prop:"spec",label:"规格"}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"120px",prop:"categoryName",label:"分类"}})],1),e._v(" "),a("el-pagination",{directives:[{name:"show",rawName:"v-show",value:e.tableData.length>0,expression:"tableData.length>0"}],staticClass:"tc mt20",attrs:{background:"","current-page":e.pageNum,"page-sizes":e.pageSizes,layout:"total, sizes, prev, pager, next, jumper","pager-count":5,total:e.total},on:{"size-change":e.changeSize,"current-change":e.changeCurrent,"update:currentPage":function(t){e.pageNum=t},"update:current-page":function(t){e.pageNum=t}}})],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.isShow=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini",disabled:e.isDisabled||0===e.checkedList.length},on:{click:e.confirmClose}},[e._v("导 入")])],1)])],1)},staticRenderFns:[]};var h=a("VU/8")(p,u,!1,function(e){a("teo1")},"data-v-7ce06524",null);t.a=h.exports},gnqg:function(e,t){},teo1:function(e,t){}});
//# sourceMappingURL=5.27d3437048ef1f582caa.js.map