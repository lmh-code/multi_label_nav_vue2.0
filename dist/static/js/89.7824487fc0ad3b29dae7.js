webpackJsonp([89],{eSgP:function(e,t){},i8bl:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("Dd8w"),s=a.n(r),i=a("oAV5"),d=a("cIv3"),m=a("zme4"),n="/member/erp/prom/batchAddProm",o={data:function(){return{isDisabled:!1,addParamMesg:{triggerType:71,triggerTypeName:"消费发放",cardType:2,title:"",beginTime:"",endTime:"",triggerSaleType:1,triggerSource:0,triggerTimesType:0},triggerSourceRadio:[{value:1,label:"单笔门店消费:",triggerAmount:""},{value:2,label:"单笔商城消费:",triggerAmount:""}],triggerTimesTypeRadio:[{value:0,label:"无限制"},{value:1,label:"整个活动只发放一次"},{value:2,label:"每天一次"},{value:3,label:"每周一次"}],setDisableTime:{disabledDate:function(e){return e.getTime()<Date.now()-864e5}}}},created:function(){},mounted:function(){},components:{"store-template":d.a,"prom-type-template":m.a},methods:{changeStore:function(e){if(e)for(var t in e)this.addParamMesg[t]=e[t]},changePromType:function(e){this.addParamMesg.promReqs=e,console.log(e)},formattData:function(){var e=this,t=/^\+?[1-9][0-9]*$/,a=/(^[1-9]{1}[0-9]*$)|(^[0-9]*\.[0-9]{1}$)|(^[0-9]*\.[0-9]{2}$)/;if(!this.addParamMesg.title)return this.$message("请输入活动名称"),!1;if(this.addParamMesg.title.length>30)return this.$message("活动名称限制30个汉字"),!1;if(""==this.addParamMesg.beginTime)return this.$message("请选择活动开始日期"),!1;if(this.addParamMesg.beginTime=i.u(new Date(this.addParamMesg.beginTime).getTime())+" 00:00:00",""==this.addParamMesg.endTime)return this.$message("请选择活动结束日期"),!1;if(this.addParamMesg.endTime=i.u(new Date(this.addParamMesg.endTime).getTime())+" 23:59:59",new Date(this.addParamMesg.endTime).getTime()<=new Date(this.addParamMesg.beginTime).getTime())return this.$message("活动结束日期不能早于或等于开始日期"),!1;if(0===this.addParamMesg.triggerSource)return this.$message("请设置单笔消费金额"),!1;if(1===this.addParamMesg.triggerSource){if(!1===a.test(this.triggerSourceRadio[0].triggerAmount))return this.$message("设置单笔门店消费金额有误"),!1}else if(2===this.addParamMesg.triggerSource&&!1===a.test(this.triggerSourceRadio[1].triggerAmount))return this.$message("设置单笔商城消费金额有误"),!1;if(""===this.addParamMesg.triggerTimesType)return this.$message("请选择发放频率"),!1;var r=this.addParamMesg.triggerTimesType;if(2===r?this.addParamMesg.triggerIntervalDays=1:3===r&&(this.addParamMesg.triggerIntervalDays=7),""===this.addParamMesg.useType||void 0===this.addParamMesg.useType)return this.$message("请选择卡券有效时间"),!1;if(1===this.addParamMesg.useType){if(""==this.addParamMesg.useBeginTime)return this.$message("请选择卡券有效开始日期"),!1;if(this.addParamMesg.useBeginTime=i.u(new Date(this.addParamMesg.useBeginTime).getTime())+" 00:00:00",""==this.addParamMesg.useEndTime)return this.$message("请选择卡券有效结束日期"),!1;if(this.addParamMesg.useEndTime=i.u(new Date(this.addParamMesg.useEndTime).getTime())+" 23:59:59",new Date(this.addParamMesg.useEndTime).getTime()<=new Date(this.addParamMesg.useBeginTime).getTime())return this.$message("卡券有效结束日期不能早于或等于开始日期"),!1;if(new Date(this.addParamMesg.useEndTime).getTime()<new Date(this.addParamMesg.endTime).getTime())return this.$message("卡券有效结束日期不能早于活动结束时间"),!1;delete this.addParamMesg.useDayCount}else if(2===this.addParamMesg.useType){if(""==this.addParamMesg.useDayCount)return this.$message("卡券有效使用天数不能为空"),!1;if(0==t.test(this.addParamMesg.useDayCount))return this.$message("卡券有效使用天数为大于零的整数"),!1;delete this.addParamMesg.useBeginTime,delete this.addParamMesg.useEndTime}var s=this.addParamMesg.promReqs[0],d=!0;s&&s.promDiscounts&&s.promDiscounts.length>0&&s.promDiscounts.forEach(function(e){for(var t in e)"discAmount"!=t&&"meetAmount"!=t&&"sendPromCount"!=t||""==e[t]||(d=!1)});var m=this.addParamMesg.promReqs[1],n=!0;if(m&&m.promDiscounts&&m.promDiscounts.length>0&&m.promDiscounts.forEach(function(e){for(var t in e)"range"!=t&&"goodsType"!=t&&"needPayAmount"!=t&&"goodsNo"!=t&&"sendPromCount"!=t||""==e[t]||(n=!1)}),d&&n)return this.$message("请设置满减券卡券奖励"),!1;if(0==d&&0==(!(!s||!s.promDiscounts)&&s.promDiscounts.every(function(r){return""==r.meetAmount||""==r.discAmount||""==r.sendPromCount?(e.$message("满减券卡券奖励-满减金额或张数不能为空"),!1):!1===a.test(r.meetAmount)||!1===a.test(r.discAmount)?(e.$message("满减券卡券奖励-满减金额大于零的数字，允许输入两位小数"),!1):!1===t.test(r.sendPromCount)?(e.$message("满减券卡券奖励-满减金额或张数为大于零的整数"),!1):parseInt(r.meetAmount)<parseInt(r.discAmount)?(e.$message("满减券卡券奖励-减金额不能大于满金额"),!1):(1==e.addParamMesg.triggerSource?(r.triggerAmount=e.triggerSourceRadio[0].triggerAmount,e.addParamMesg.triggerAmount=e.triggerSourceRadio[0].triggerAmount):2==e.addParamMesg.triggerSource&&(r.triggerAmount=e.triggerSourceRadio[1].triggerAmount,e.addParamMesg.triggerAmount=e.triggerSourceRadio[1].triggerAmount),!0)})))return!1;if(0==n&&0==(!(!m||!m.promDiscounts)&&m.promDiscounts.every(function(r){return""==r.needPayAmount||void 0==r.needPayAmount?(e.$message("商品券卡券奖励-商品应付价格不能为空"),!1):0==r.needPayAmount||a.test(r.needPayAmount)?""==r.goodsNo||void 0==r.goodsNo?(e.$message("商品券卡券奖励-请选择商品"),!1):""==r.productQtyLimit||void 0==r.productQtyLimit?(e.$message("商品券卡券奖励-请输入选择商品数量小于等于的值"),!1):t.test(r.productQtyLimit)?""===r.sendPromCount||void 0==r.sendPromCount?(e.$message("商品券卡券奖励-请输入发放优惠券数量"),!1):t.test(r.sendPromCount)?(1==e.addParamMesg.triggerSource?r.triggerAmount=e.triggerSourceRadio[0].triggerAmount:2==e.addParamMesg.triggerSource&&(r.triggerAmount=e.triggerSourceRadio[1].triggerAmount),!0):(e.$message("商品券卡券奖励-发放优惠券数量为大于零的整数"),!1):(e.$message("商品券卡券奖励-选择商品数量小于等于的值格式不对，为大于零的整数"),!1):(e.$message("商品券卡券奖励-商品应付价格输入大于等于0的数字，允许输入一位小数。"),!1)})))return!1;return 1==d&&this.addParamMesg.promReqs.splice(0,1),1==n&&this.addParamMesg.promReqs.splice(1,1),!0},doSaveHandel:function(){var e=this;!1!==this.formattData()&&(this.addParamMesg.promReqs[0]&&this.$set(this.addParamMesg.promReqs[0],"onlineGoodsType","3;4;5"),this.addParamMesg.promReqs[1]&&this.$set(this.addParamMesg.promReqs[1],"onlineGoodsType","3;4;5"),this.addParamMesg.triggerOnlineGoodsType="3;4;5",this.isDisabled=!0,this.$http.post(n,s()({},this.addParamMesg)).then(function(t){if(setTimeout(function(){e.isDisabled=!1},800),0===t.code)return e.$message.success("保存成功"),void e.$router.push("/discount_coupon");throw new Error(t.msg)}).catch(function(t){e.isDisabled=!1,e.$notify.error({title:"提示",message:t.message})}))},doCancelHandel:function(){var e=this;this.$confirm("确定取消吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$router.push("/discount_coupon")}).catch(function(){})}}},g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"add-form-wraper"},[a("el-form",{ref:"form",attrs:{model:e.addParamMesg,"label-width":"140px"}},[a("el-form-item",{attrs:{label:"活动类型",required:""}},[a("p",{staticStyle:{color:"#222","font-size":"16px","font-weight":"bold"}},[e._v(e._s(e.addParamMesg.triggerTypeName))])]),e._v(" "),a("el-form-item",{attrs:{label:"活动名称",required:""}},[a("el-input",{staticClass:"add-input",attrs:{size:"small",placeholder:"请输入活动名称",clearable:""},model:{value:e.addParamMesg.title,callback:function(t){e.$set(e.addParamMesg,"title",t)},expression:"addParamMesg.title"}}),e._v(" "),a("span",[e._v("活动名称,限制30个汉字")])],1),e._v(" "),a("el-form-item",{attrs:{label:"活动开始日期",required:""}},[a("el-date-picker",{staticClass:"add-input",attrs:{type:"date",placeholder:"请选择活动开始日期","picker-options":e.setDisableTime,size:"small"},model:{value:e.addParamMesg.beginTime,callback:function(t){e.$set(e.addParamMesg,"beginTime",t)},expression:"addParamMesg.beginTime"}}),e._v(" "),a("span",[e._v("活动开始日期")])],1),e._v(" "),a("el-form-item",{attrs:{label:"活动结束日期",required:""}},[a("el-date-picker",{staticClass:"add-input",attrs:{type:"date",placeholder:"请选择活动结束日期","picker-options":e.setDisableTime,size:"small"},model:{value:e.addParamMesg.endTime,callback:function(t){e.$set(e.addParamMesg,"endTime",t)},expression:"addParamMesg.endTime"}}),e._v(" "),a("span",[e._v("活动结束日期")])],1),e._v(" "),a("el-form-item",{attrs:{label:"设置条件"}},[a("el-radio-group",{model:{value:e.addParamMesg.triggerSource,callback:function(t){e.$set(e.addParamMesg,"triggerSource",t)},expression:"addParamMesg.triggerSource"}},e._l(e.triggerSourceRadio,function(t){return a("el-radio",{key:t.value,staticClass:"trigger-radio",attrs:{label:t.value}},[e._v("\n            "+e._s(t.label)+"\n            "),a("el-input",{staticClass:"coupon-input",attrs:{size:"small"},model:{value:t.triggerAmount,callback:function(a){e.$set(t,"triggerAmount",a)},expression:"item.triggerAmount"}},[a("template",{slot:"append"},[e._v("元")])],2)],1)}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"设置发放频率"}},[a("el-radio-group",{model:{value:e.addParamMesg.triggerTimesType,callback:function(t){e.$set(e.addParamMesg,"triggerTimesType",t)},expression:"addParamMesg.triggerTimesType"}},e._l(e.triggerTimesTypeRadio,function(t){return a("el-radio",{key:t.value,attrs:{label:t.value}},[e._v("\n            "+e._s(t.label)+"\n          ")])}),1)],1),e._v(" "),a("store-template",{on:{changeStore:e.changeStore}}),e._v(" "),a("prom-type-template",{attrs:{triggerType:e.addParamMesg.triggerType},on:{changePromType:e.changePromType}}),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"small",disabled:e.isDisabled},on:{click:e.doSaveHandel}},[e._v("保存")]),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:e.doCancelHandel}},[e._v("取消")])],1)],1)],1)])},staticRenderFns:[]};var u=a("VU/8")(o,g,!1,function(e){a("eSgP")},"data-v-603f28b0",null);t.default=u.exports}});
//# sourceMappingURL=89.7824487fc0ad3b29dae7.js.map