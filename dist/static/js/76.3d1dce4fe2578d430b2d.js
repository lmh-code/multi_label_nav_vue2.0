webpackJsonp([76],{TMvv:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("Dd8w"),i=a.n(s),r=a("oAV5"),n=a("cIv3"),m=a("zme4"),d="/member/erp/prom/batchAddProm",o={data:function(){return{isDisabled:!1,addParamMesg:{triggerType:91,triggerTypeName:"省钱礼包",cardType:2,title:"",beginTime:"",endTime:"",triggerAmount:"",triggerIntegral:"",triggerDisAmount:"",limitCount:""},setDisableTime:{disabledDate:function(e){return e.getTime()<Date.now()-864e5}},triggerAmountChecked:!0,triggerIntegralChecked:!1}},components:{"store-template":n.a,"prom-type-template":m.a},methods:{changeStore:function(e){if(e)for(var t in e)this.addParamMesg[t]=e[t]},changePromType:function(e){this.addParamMesg.promReqs=e},formattData:function(){var e=this,t=/^\+?[1-9][0-9]*$/,a=/(^[1-9]{1}[0-9]*$)|(^[0-9]*\.[0-9]{1}$)|(^[0-9]*\.[0-9]{2}$)/;if(!this.addParamMesg.title)return this.$message("请输入活动名称"),!1;if(this.addParamMesg.title.length>30)return this.$message("活动名称限制30个汉字"),!1;if(""==this.addParamMesg.beginTime)return this.$message("请选择活动开始日期"),!1;if(this.addParamMesg.beginTime=r.u(new Date(this.addParamMesg.beginTime).getTime())+" 00:00:00",""==this.addParamMesg.endTime)return this.$message("请选择活动结束日期"),!1;if(this.addParamMesg.endTime=r.u(new Date(this.addParamMesg.endTime).getTime())+" 23:59:59",new Date(this.addParamMesg.endTime).getTime()<=new Date(this.addParamMesg.beginTime).getTime())return this.$message("活动结束日期不能早于或等于开始日期"),!1;if(""===this.addParamMesg.useType||void 0===this.addParamMesg.useType)return this.$message("请选择卡券有效时间"),!1;if(1===this.addParamMesg.useType){if(""==this.addParamMesg.useBeginTime)return this.$message("请选择卡券有效开始日期"),!1;if(this.addParamMesg.useBeginTime=r.u(new Date(this.addParamMesg.useBeginTime).getTime())+" 00:00:00",""==this.addParamMesg.useEndTime)return this.$message("请选择卡券有效结束日期"),!1;if(this.addParamMesg.useEndTime=r.u(new Date(this.addParamMesg.useEndTime).getTime())+" 23:59:59",new Date(this.addParamMesg.useEndTime).getTime()<=new Date(this.addParamMesg.useBeginTime).getTime())return this.$message("卡券有效结束日期不能早于或等于开始日期"),!1;if(new Date(this.addParamMesg.useEndTime).getTime()<new Date(this.addParamMesg.endTime).getTime())return this.$message("卡券有效结束日期不能早于活动结束时间"),!1;delete this.addParamMesg.useDayCount}else if(2===this.addParamMesg.useType){if(""==this.addParamMesg.useDayCount)return this.$message("卡券有效使用天数不能为空"),!1;if(0==t.test(this.addParamMesg.useDayCount))return this.$message("卡券有效使用天数为大于零的整数"),!1;delete this.addParamMesg.useBeginTime,delete this.addParamMesg.useEndTime}if(!this.addParamMesg.triggerAmount)return this.$message("请输入购买方式中的需要金额"),!1;if(0!=this.addParamMesg.triggerAmount&&!a.test(this.addParamMesg.triggerAmount))return this.$message("购买方式中的需要金额，输入大于等于0的数字，允许输入两位小数。"),!1;if(this.addParamMesg.triggerIntegral&&!t.test(this.addParamMesg.triggerIntegral))return this.$message("购买方式中的积分购买值为大于零的整数。"),!1;if(this.addParamMesg.limitCount&&!t.test(this.addParamMesg.limitCount))return this.$message("每人限购数量的值为大于零的整数。"),!1;if(this.addParamMesg.triggerDisAmount&&0!=this.addParamMesg.triggerDisAmount&&!a.test(this.addParamMesg.triggerDisAmount))return this.$message("最高可节省金额，输入大于等于0的数字，允许输入两位小数。"),!1;var s=this.addParamMesg.promReqs[0],i=!0;s&&s.promDiscounts&&s.promDiscounts.length>0&&s.promDiscounts.forEach(function(e){for(var t in e)"discAmount"!=t&&"meetAmount"!=t&&"sendPromCount"!=t||""==e[t]||(i=!1)});var n=this.addParamMesg.promReqs[1],m=!0;if(n&&n.promDiscounts&&n.promDiscounts.length>0&&n.promDiscounts.forEach(function(e){for(var t in e)"range"!=t&&"goodsType"!=t&&"needPayAmount"!=t&&"goodsNo"!=t&&"sendPromCount"!=t||""==e[t]||(m=!1)}),i&&m)return this.$message("请设置满减券卡券奖励"),!1;if(0==i&&0==(!(!s||!s.promDiscounts)&&s.promDiscounts.every(function(s){return""==s.meetAmount||""==s.discAmount||""==s.sendPromCount?(e.$message("满减券卡券奖励-满减金额或张数不能为空"),!1):!1===a.test(s.meetAmount)||!1===a.test(s.discAmount)?(e.$message("满减券卡券奖励-满减金额大于零的数字，允许输入两位小数"),!1):!1===t.test(s.sendPromCount)?(e.$message("满减券卡券奖励-满减金额或张数为大于零的整数"),!1):!(parseInt(s.meetAmount)<parseInt(s.discAmount))||(e.$message("满减券卡券奖励-减金额不能大于满金额"),!1)})))return!1;if(0==m&&0==(!(!n||!n.promDiscounts)&&n.promDiscounts.every(function(s){return""==s.needPayAmount||void 0==s.needPayAmount?(e.$message("商品券卡券奖励-商品应付价格不能为空"),!1):0==s.needPayAmount||a.test(s.needPayAmount)?""==s.goodsNo||void 0==s.goodsNo?(e.$message("商品券卡券奖励-请选择商品"),!1):""==s.productQtyLimit||void 0==s.productQtyLimit?(e.$message("商品券卡券奖励-请输入选择商品数量小于等于的值"),!1):t.test(s.productQtyLimit)?""===s.sendPromCount||void 0==s.sendPromCount?(e.$message("商品券卡券奖励-请输入发放优惠券数量"),!1):!!t.test(s.sendPromCount)||(e.$message("商品券卡券奖励-发放优惠券数量为大于零的整数"),!1):(e.$message("商品券卡券奖励-选择商品数量小于等于的值格式不对，为大于零的整数"),!1):(e.$message("商品券卡券奖励-商品应付价格输入大于等于0的数字，允许输入一位小数。"),!1)})))return!1;return 1==i&&this.addParamMesg.promReqs.splice(0,1),1==m&&this.addParamMesg.promReqs.splice(1,1),!0},doSaveHandel:function(){var e=this;!1!==this.formattData()&&(this.addParamMesg.promReqs[0]&&this.$set(this.addParamMesg.promReqs[0],"onlineGoodsType","3;4;5"),this.addParamMesg.promReqs[1]&&this.$set(this.addParamMesg.promReqs[1],"onlineGoodsType","3;4;5"),this.isDisabled=!0,this.$http.post(d,i()({},this.addParamMesg)).then(function(t){if(setTimeout(function(){e.isDisabled=!1},800),0===t.code)return e.$message.success("保存成功"),void e.$router.push("/discount_coupon");throw new Error(t.msg)}).catch(function(t){e.isDisabled=!1,e.$notify.error({title:"提示",message:t.message})}))},doCancelHandel:function(){var e=this;this.$confirm("确定取消吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$router.push("/discount_coupon")}).catch(function(){})}}},g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"add-form-wraper prom-reqs"},[a("el-form",{ref:"form",attrs:{model:e.addParamMesg,"label-width":"140px"}},[a("el-form-item",{attrs:{label:"活动类型",required:""}},[a("p",{staticStyle:{color:"#222","font-size":"16px","font-weight":"bold"}},[e._v(e._s(e.addParamMesg.triggerTypeName))])]),e._v(" "),a("el-form-item",{attrs:{label:"活动名称",required:""}},[a("el-input",{staticClass:"add-input",attrs:{size:"small",placeholder:"请输入活动名称",clearable:""},model:{value:e.addParamMesg.title,callback:function(t){e.$set(e.addParamMesg,"title",t)},expression:"addParamMesg.title"}}),e._v(" "),a("span",[e._v("活动名称,限制30个汉字")])],1),e._v(" "),a("el-form-item",{attrs:{label:"活动开始日期",required:""}},[a("el-date-picker",{staticClass:"add-input",attrs:{type:"date",placeholder:"请选择活动开始日期","picker-options":e.setDisableTime,size:"small"},model:{value:e.addParamMesg.beginTime,callback:function(t){e.$set(e.addParamMesg,"beginTime",t)},expression:"addParamMesg.beginTime"}}),e._v(" "),a("span",[e._v("活动开始日期")])],1),e._v(" "),a("el-form-item",{attrs:{label:"活动结束日期",required:""}},[a("el-date-picker",{staticClass:"add-input",attrs:{type:"date",placeholder:"请选择活动结束日期","picker-options":e.setDisableTime,size:"small"},model:{value:e.addParamMesg.endTime,callback:function(t){e.$set(e.addParamMesg,"endTime",t)},expression:"addParamMesg.endTime"}}),e._v(" "),a("span",[e._v("活动结束日期")])],1),e._v(" "),a("el-form-item",{attrs:{label:"购买方式",required:""}},[a("el-checkbox",{attrs:{disabled:""},model:{value:e.triggerAmountChecked,callback:function(t){e.triggerAmountChecked=t},expression:"triggerAmountChecked"}},[e._v("需要金额")]),e._v(" "),a("el-input",{staticClass:"coupon-input",attrs:{size:"small"},model:{value:e.addParamMesg.triggerAmount,callback:function(t){e.$set(e.addParamMesg,"triggerAmount",t)},expression:"addParamMesg.triggerAmount"}},[a("template",{slot:"append"},[e._v("元")])],2),e._v(" "),e.triggerIntegralChecked?a("span",[a("el-checkbox",{staticStyle:{"margin-left":"30px"},model:{value:e.triggerIntegralChecked,callback:function(t){e.triggerIntegralChecked=t},expression:"triggerIntegralChecked"}},[e._v("积分购买")]),e._v(" "),a("el-input",{staticClass:"coupon-input",attrs:{size:"small"},model:{value:e.addParamMesg.triggerIntegral,callback:function(t){e.$set(e.addParamMesg,"triggerIntegral",t)},expression:"addParamMesg.triggerIntegral"}},[a("template",{slot:"append"},[e._v("分")])],2)],1):e.triggerIntegralChecked?e._e():a("span",[a("el-checkbox",{staticStyle:{"margin-left":"30px"},model:{value:e.triggerIntegralChecked,callback:function(t){e.triggerIntegralChecked=t},expression:"triggerIntegralChecked"}},[e._v("积分购买")]),e._v(" "),a("el-input",{staticClass:"coupon-input",attrs:{size:"small",disabled:""},model:{value:e.addParamMesg.triggerIntegral,callback:function(t){e.$set(e.addParamMesg,"triggerIntegral",t)},expression:"addParamMesg.triggerIntegral"}},[a("template",{slot:"append"},[e._v("分")])],2)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"限制&展示"}},[a("span",[e._v("每人限购数量")]),e._v(" "),a("el-input",{staticClass:"coupon-input",attrs:{size:"small"},model:{value:e.addParamMesg.limitCount,callback:function(t){e.$set(e.addParamMesg,"limitCount",t)},expression:"addParamMesg.limitCount"}},[a("template",{slot:"append"},[e._v("次")])],2),e._v(" "),a("span",{staticStyle:{"margin-left":"30px"}},[e._v("最高可节省金额")]),e._v(" "),a("el-input",{staticClass:"coupon-input",attrs:{size:"small"},model:{value:e.addParamMesg.triggerDisAmount,callback:function(t){e.$set(e.addParamMesg,"triggerDisAmount",t)},expression:"addParamMesg.triggerDisAmount"}},[a("template",{slot:"append"},[e._v("元")])],2),e._v(" "),a("span",{staticStyle:{color:"red"}},[e._v("*最高可节省金额只用于小程序展示吸引用户。")])],1),e._v(" "),a("store-template",{on:{changeStore:e.changeStore}}),e._v(" "),a("prom-type-template",{attrs:{triggerType:e.addParamMesg.triggerType},on:{changePromType:e.changePromType}}),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"small",disabled:e.isDisabled},on:{click:e.doSaveHandel}},[e._v("保存")]),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:e.doCancelHandel}},[e._v("取消")])],1)],1)],1)])},staticRenderFns:[]};var l=a("VU/8")(o,g,!1,function(e){a("qLu8")},null,null);t.default=l.exports},qLu8:function(e,t){}});
//# sourceMappingURL=76.3d1dce4fe2578d430b2d.js.map