webpackJsonp([6],{"4Kz/":function(e,t,o){"use strict";var a=o("8uth"),i={data:function(){return{fileName:""}},props:{requireCheckTotal:"",maxTotal:""},methods:{uploadHandle:function(e){var t=this,o=this;this.$emit("uploadEmit");var i=e.target.files[0]||{name:""};a.a.parseToJSON(i).then(function(e){o.requireCheckTotal&&e&&e.length>o.maxTotal?message.warn("一次限导入"+o.maxTotal+"条"):e&&e.length&&(t.fileName=i.name,t.importHandle(e))},function(e){console.log(e)})},doExportDataHandel:function(){this.$emit("doExportDataHandel")},importHandle:function(e){this.$emit("importHandle",e)},renderChild:function(e){return e}}},r={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"rel"},[o("span",{staticClass:"btn"},[e._v("请选择文件")]),e._v(" "),o("div",{staticClass:"chooseFile"},[e._v(e._s(e.fileName))]),e._v(" "),o("input",{staticClass:"btn-input",attrs:{type:"file",accept:".xlsx, .xls"},on:{change:e.uploadHandle,click:function(e){e.target.value=""}}}),e._v(" "),o("span",{staticClass:"btn-download",on:{click:e.doExportDataHandel}},[e._v("下载模板")]),e._v(" "),o("div",{staticClass:"pop-content"},[e._t("default")],2)])},staticRenderFns:[]};var n=o("VU/8")(i,r,!1,function(e){o("YGJB")},"data-v-14a59b34",null);t.a=n.exports},TTLm:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o("//Fk"),i=o.n(a),r=o("Gu7T"),n=o.n(r),s=o("Dd8w"),l=o.n(s),c=o("dWfj"),d=o("4Kz/"),u=(o("t0/o"),o("segh")),m=o("snIt"),p=o("oAV5"),h=o("8uth"),g=o("RCQo"),f={components:{ChooseGoods:c.a,ImportExcel:d.a},mixins:[g.a],data:function(){return{userPermission:[],moduleId:"/quote_mgt",remark:"",statusOptions:m.a.statusOptions,typeOptions:m.a.typeOptions,type:"",tableData:[],columns:[{title:"商品编号",dataIndex:"goodsNo",minWidth:80},{title:"商品简称",dataIndex:"shortName",minWidth:80},{title:"商品规格",dataIndex:"spec",minWidth:80},{title:"单位",dataIndex:"saleUnit",minWidth:60},{title:"预计进货量",dataIndex:"predictQty",minWidth:90},{title:"当前定价",dataIndex:"currentPrice",minWidth:80},{title:"本次报价",dataIndex:"quotationPrice",minWidth:80,input:!0,inputChangeFunc:this.numberFilter},{title:"报货量",dataIndex:"qty",minWidth:80,input:!0,inputChangeFunc:this.intFilter},{title:"调整额",dataIndex:"adjustAmount",minWidth:80,filterFn:this.calAdjustAmount},{title:"调整率",dataIndex:"adjustRate",minWidth:80,filterFn:this.calAdjustRate},{title:"商品备注",dataIndex:"remark",width:150,input:!0,inputChangeFunc:this.remarkFilter}],loading:!1,delLoading:!1,confLoading:!1,log:[],logColumns:[{title:"操作人",dataIndex:"operationUserName",minWidth:150},{title:"操作时间",dataIndex:"time",minWidth:150},{title:"操作内容",dataIndex:"operationTypeName",minWidth:150}],checkedGoodsList:[],res:{state:0},visible:!1,showImportResult:!1,exportConfig:{goodsNo:"商品编码",shortName:"商品简称",quotationPricetitle:"本次报价",qty:"报货量",remark:"商品备注",errorMsg:"错误原因"},exportConfig1:{goodsNo:"商品编码",shortName:"商品简称",quotationPrice:"本次报价",qty:"报货量",remark:"商品备注"},exportData:[{goodsNo:"",shortName:"",quotationPrice:"",qty:"",remark:""}],selectedRowKeys:[],rules:{storeGroupName:{required:!0,message:"请选择区域",trigger:"change"},typeName:{required:!0,message:"请选择调价类型",trigger:"change"},goodsCategoryName:{required:!0,message:"请选择分类",trigger:"change"},paperNo:{required:!0,message:"请输入报价单号",trigger:"change"},vendorName:{required:!0,message:"请选择供应商",trigger:"change"},startTime:{required:!0,message:"请选择生效起始日期",trigger:"change"},endTime:{required:!0,message:"请选择生效终止日期",trigger:"change"},remark:{max:20,message:"备注不能超过20个字",trigger:"blur"}},ruleForm:{storeGroupName:"",typeName:"",goodsCategoryName:"",paperNo:"",vendorName:"",startTime:"",endTime:"",remark:""}}},created:function(){this.ruleForm.paperNo=this.$route.params.paperNo,this._getQuoteDetail(),this._getLog(),this.userPermission=this.$store.state.common.userPermissionMap[this.moduleId]},methods:{_getQuoteDetail:function(){var e=this;this.$loading.show(),this.$http.post(u.a.getQuoteDetail+"/"+this.$route.params.paperNo).then(function(t){if(e.$loading.hide(),t&&0===t.code){var o=t.data&&t.data.details||[];o=(o||[]).map(function(t){return t.adjustAmount=e.calAdjustAmount(t,t.adjustAmount+""),t.adjustRate=e.calAdjustRate(t,t.adjustAmount+""),t}),e.tableData=o,e.ruleForm=l()({},t.data),e.res=l()({},t.data)}else e.$tip.notify(t.msg,"error")}).catch(function(t){e.$loading.hide(),e.$tip.notify(t.message,"error")})},showAddGoodsDialog:function(){var e=this;this.ruleForm.storeGroupNo?this.ruleForm.vendorNo?this.ruleForm.goodsCategory?this.$nextTick(function(){e.$refs.chooseGoods.setDefaultMsg({title:"选择商品",vendorNo:e.ruleForm.vendorNo,categoryNos:e.ruleForm.goodsCategory,regionNo:e.ruleForm.storeGroupNo,defaultChecked:e.checkedGoodsList})},function(){e.$refs.chooseGoods.doSearchHandle()}):this.$tip.message("请选择分类","warning"):this.$tip.message("请选择供应商","warning"):this.$tip.message("请选择区域","warning")},confirmHandel:function(e){var t=this;this.checkedGoodsList=[].concat(n()(e));var o=this.checkedGoodsList.filter(function(e){return!t.tableData.find(function(t){return t.goodsNo==e.goodsNo})});this.tableData=this.tableData.concat(o)},numberFilter:function(e){if(e){var t=(e+="")&&e.replace&&e.replace(/[^0-9.]/gi,"");return(t=(t=t&&t.replace&&t.replace(/^(\.)+/g,""))&&t.replace&&t.match(/^(0|([1-9]\d*))(\.\d{1,2})?/g))&&t.length&&t[0]}},intFilter:function(e){var t=(e+="")&&e.replace&&e.replace(/[\D]/gi,"");return(t=t&&t.replace&&t.match(/^(0|[1-9]\d*)/g))&&t.length&&t[0]},calAdjustAmount:function(e,t){var o=(e.quotationPrice||0)-(e.currentPrice||0)<0?"-":"";return e?""+o+this.numberFilter(Object(p.c)((e.quotationPrice||0)-(e.currentPrice||0))+""):""},calAdjustRate:function(e,t){var o=((e.quotationPrice||0)-(e.currentPrice||0))*(e.quotationPrice||0)<0?"-":"",a=e?""+o+this.numberFilter((e.quotationPrice||0)-(e.currentPrice||0)+""):"",i=e&&e.quotationPrice&&"0"!=e.quotationPrice?Object(p.c)((a||0)/e.quotationPrice*100,0):"";return i+(0==i?"":"%")},remarkFilter:function(e){if(e)return e&&e.substring&&e.substring(0,20)},saveAndLaunch:function(e){var t=this;return new i.a(function(o,a){t.$refs.ruleForm.validate(function(i){if(i){var r=t.tableData,n=t.ruleForm;n.endTime,n.startTime,n.goodsCategory;if(!r||!r.length)return t.$tip.message("请选择商品","warning"),void a(!1);var s=!0;(r||[]).map(function(e){return e.quotationPrice&&(s=!1),e});if(s)return t.$tip.message("商品价格信息缺失，请补充","warning"),void a(!1);t.addOrUpdateQuote(e).then(function(e){o(e)}).catch(function(e){a(e)})}else a(!1)})})},addOrUpdateQuote:function(e){var t=this;return new i.a(function(o,a){for(var i=t.ruleForm,r=i.startTime,n=i.endTime,s=i.remark,l=i.vendorNo,c=i.storeGroupNo,d=i.goodsCategory,m=t.$route.params.paperNo,p=(t.tableData||[]).map(function(e){var o=t.numberFilter(e.quotationPrice);return e.quotationPrice="string"==typeof o?parseFloat(o):o,e.qty=t.intFilter(e.qty),e}),h=0;h<p.length;h++)p[h].remark=t.remarkFilter(p[h].remark);var g={vendorNo:l,endTime:n,startTime:r,details:p,goodsCategoryNo:d,storeGroupNo:c,remark:s,paperNo:m};t.loading=!0,t.$http.post(u.a.addOrUpdateQuote,g).then(function(i){t.loading=!1,i&&0===i.code?(t.$tip.message("保存成功","success"),"save"===e&&(t._getQuoteDetail(),t._getLog(),t.editSuccessHandel("/quote_mgt")),o(i)):(t.$tip.notify(i.msg,"error"),a(i.msg))}).catch(function(e){t.loading=!1,t.confirmLoading=!1,t.$tip.notify(e.message,"error"),a(e)})})},_getLog:function(){var e=this,t={keyValue:this.$route.params.paperNo};this.$http.post(u.a.getOperationLog,t).then(function(t){t&&0===t.code?e.log=t.data:e.$tip.notify(t.msg,"error")}).catch(function(t){e.$tip.notify(t.message,"error")})},operate:function(e){"delete"===e?this.deleteQuote():"confirm"===e?this.confirmQuote():"save"===e&&this.saveAndLaunch(e)},deleteQuote:function(){var e=this;this.delLoading=!0,this.$http.post(u.a.deleteQuote+"/"+this.ruleForm.paperNo).then(function(t){e.delLoading=!1,t&&0===t.code?(e.$tip.message("废弃成功","success"),e.deleteSuccessHandel("/quote_mgt")):e.$tip.notify(t.msg,"error")}).catch(function(t){e.delLoading=!1,e.$tip.notify(t.message,"error")})},confirmQuote:function(){var e=this;this.confLoading=!0,this.saveAndLaunch().then(function(t){e.$http.post(u.a.confirmQuote+"/"+e.ruleForm.paperNo).then(function(t){e.confLoading=!1,t&&0===t.code?(e.$tip.message("已审核","success"),e._getQuoteDetail(),e._getLog(),e.editSuccessHandel("/quote_mgt")):e.$tip.notify(t.msg,"error")}).catch(function(t){e.confLoading=!1,e.$tip.notify(t.message,"error")})}).catch(function(t){e.confLoading=!1})},showModal:function(){this.ruleForm.storeGroupNo?this.ruleForm.vendorNo?this.ruleForm.goodsCategory?this.visible=!0:this.$tip.message("请选择分类","warning"):this.$tip.message("请选择供应商","warning"):this.$tip.message("请先选择区域","warning")},handleOk:function(){var e=this;if(this.visible=!1,this.timeout&&clearTimeout(this.timeout),!this.timeout){this.confirmLoading=!0;var t=this.tableData,o=(this.tableDataTmp||[]).filter(function(e){return!t.some(function(t){return e.goodsId==t.goodsId})});this.visible=!1,this.confirmLoading=!1,this.tableData=(this.tableData||[]).concat(o||[]),this.importMsg="",this.showImportResult=!1,this.$refs.importFile.fileName="未选择文件..."}this.timeout=setTimeout(function(){e.timeout=null},5e3)},handleCancel:function(){this.visible=!1},doExportDataHandel:function(){var e=this.exportData,t=Object(p.i)(this.exportConfig1,!1),o=Object(p.i)(this.exportConfig1,!0);h.a.ExportJsonToExcel({header:t,filterVal:o,data:e,filename:"供应商报价导入模板"})},downLoadReasonExcel:function(){var e=this.errDataDownload,t=Object(p.i)(this.exportConfig,!1),o=Object(p.i)(this.exportConfig,!0);h.a.ExportJsonToExcel({header:t,filterVal:o,data:e,filename:"报价导入错误"})},importHandle:function(e){var t=[];(e||[]).map(function(e){var o={};for(var a in e)switch(a){case"商品编码":o.goodsNo=e[a];break;case"商品简称":o.shortName=e[a];break;case"本次报价":o.quotationPrice=e[a];break;case"报货量":o.qty=e[a];break;case"商品备注":o.remark=e[a];break;case"错误原因":o.errorMsg=e[a]}return t.push(o),e});this._checkImportFile(t)},_checkImportFile:function(e){var t=this,o=(e||[]).map(function(e){return e.goodsId="",e}),a=this.ruleForm,i=a.endTime,r=a.startTime,n=a.vendorNo,s=a.storeGroupNo,l={endTime:i,startTime:r,goodsCategoryNo:a.goodsCategory,storeGroupNo:s,vendorNo:n,details:o,paperNo:a.paperNo,remark:a.remark};this.$http.post(u.a.importQuote,l).then(function(o){if(o&&0===o.code){var a=o.data.details||[],i=o.data.errorInfos||[],r="导入成功"+(a.length||0)+"条，失败"+i.length+"条",n=e.map(function(e){var t=i.findIndex(function(t){return e.goodsNo==t.goodsNo});return-1!=t&&(e.errorMsg=i[t].errorMsg),e});t.showImportResult=!0,t.importMsg=r,t.errData=i,t.errDataDownload=n,t.tableDataTmp=a}})},uploadEmit:function(e){this.importMsg="",this.showImportResult=!1,this.errData=[],this.errDataDownload=[],this.tableDataTmp=[]},deleteProcducts:function(){var e=this,t=[].concat(n()(this.tableData));t=t.filter(function(t){return-1===(e.selectedRowKeys||[]).indexOf(t.goodsNo)}),this.tableData=t,this.selectedRowKeys=[]},selectionChange:function(e){var t=e.selection;this.selectedRowKeys=t.map(function(e){return e.goodsNo})},handleSave:function(e){var t=[].concat(n()(this.tableData)),o=t.findIndex(function(t){return e.goodsNo===t.goodsNo}),a=t[o];t.splice(o,1,l()({},a,e)),this.tableData=t},doCancelHandel:function(){this.closePage("/quote_mgt")}}},v={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("div",{staticClass:"handel-wraper row-clolum"},[o("div",{staticClass:"left"},[e.userPermission&&e.userPermission.includes("删除")?o("el-button",{attrs:{loading:e.delLoading,type:0!==e.res.state?"":"primary",size:"mini",icon:"el-icon-delete",disabled:0!==e.res.state},on:{click:function(t){return e.operate("delete")}}},[e._v("废弃\n      ")]):e._e(),e._v(" "),e.userPermission&&e.userPermission.includes("审核")?o("el-button",{attrs:{loading:e.confLoading,type:0!==e.res.state?"":"primary",size:"mini",disabled:0!==e.res.state},on:{click:function(t){return e.operate("confirm")}}},[e._v("审核\n      ")]):e._e()],1),e._v(" "),o("div",{staticClass:"right"},[o("el-popover",{staticClass:"fr",attrs:{placement:"bottom",width:"320",trigger:"hover",title:"说明"}},[o("ul",{staticClass:"suggestion"},[o("li",[e._v("类型：供应商默认报价类型为自主报价，且不可编辑；采购方可发起采购询报价和促销询报价；")]),e._v(" "),o("li",[e._v("当单据类型为采购询价及促销询价时，商品不可导入、添加、删除。")]),e._v(" "),o("li",[e._v("预计进货量：由采购方提供。"),o("br"),e._v("\n          当前定价：当前供应价；"),o("br"),e._v("\n          调整额：本次报价-当前定价；\n          ")]),e._v(" "),o("li",[e._v("调整率：调整额/本次报价")])]),e._v(" "),o("span",{staticClass:"el-icon-question",attrs:{slot:"reference"},slot:"reference"},[e._v("说明")])])],1)]),e._v(" "),o("div",{staticClass:"search-form-wraper"},[o("el-form",{ref:"ruleForm",attrs:{"label-position":"top",rules:e.rules,model:e.ruleForm}},[o("el-form-item",{attrs:{label:"报价单号",prop:"paperNo"}},[o("el-input",{staticClass:"add-input",attrs:{size:"small",disabled:"",clearable:"",placeholder:"报价单号"},model:{value:e.ruleForm.paperNo,callback:function(t){e.$set(e.ruleForm,"paperNo","string"==typeof t?t.trim():t)},expression:"ruleForm.paperNo"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"类型",prop:"type"}},[o("el-input",{staticClass:"add-input",attrs:{size:"small",disabled:"",clearable:"",placeholder:"类型"},model:{value:e.ruleForm.typeName,callback:function(t){e.$set(e.ruleForm,"typeName","string"==typeof t?t.trim():t)},expression:"ruleForm.typeName"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"区域",prop:"storeGroupName"}},[o("el-input",{staticClass:"add-input",attrs:{size:"small",disabled:"",clearable:"",placeholder:"选择区域"},model:{value:e.ruleForm.storeGroupName,callback:function(t){e.$set(e.ruleForm,"storeGroupName","string"==typeof t?t.trim():t)},expression:"ruleForm.storeGroupName"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"供应商",prop:"vendorName"}},[o("el-input",{staticClass:"add-input",attrs:{size:"small",disabled:"",clearable:"",placeholder:"选择供应商"},model:{value:e.ruleForm.vendorName,callback:function(t){e.$set(e.ruleForm,"vendorName","string"==typeof t?t.trim():t)},expression:"ruleForm.vendorName"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"商品分类",prop:"goodsCategoryName"}},[o("el-input",{staticClass:"add-input",attrs:{size:"small",disabled:"",clearable:"",placeholder:"选择商品分类"},model:{value:e.ruleForm.goodsCategoryName,callback:function(t){e.$set(e.ruleForm,"goodsCategoryName","string"==typeof t?t.trim():t)},expression:"ruleForm.goodsCategoryName"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"生效起始日期",prop:"startTime"}},[o("el-date-picker",{staticClass:"add-input",attrs:{clearable:"",type:"date",placeholder:"生效起始日期",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",disabled:"",size:"small"},model:{value:e.ruleForm.startTime,callback:function(t){e.$set(e.ruleForm,"startTime",t)},expression:"ruleForm.startTime"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"生效终止日期",prop:"endTime"}},[o("el-date-picker",{staticClass:"add-input",attrs:{clearable:"",type:"date",placeholder:"生效终止日期",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",disabled:"",size:"small"},model:{value:e.ruleForm.endTime,callback:function(t){e.$set(e.ruleForm,"endTime",t)},expression:"ruleForm.endTime"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"备注",prop:"remark"}},[o("el-input",{staticClass:"add-input",attrs:{size:"small",clearable:"",placeholder:"备注"},model:{value:e.ruleForm.remark,callback:function(t){e.$set(e.ruleForm,"remark","string"==typeof t?t.trim():t)},expression:"ruleForm.remark"}})],1)],1)],1),e._v(" "),o("div",{staticClass:"add-form-wraper"},[o("el-form",[o("el-form-item",{attrs:{label:"选择商品"}},[o("el-button",{attrs:{type:2!==e.type||0!==e.res.state?"":"primary",disabled:2!==e.type||0!==e.res.state,size:"mini",icon:"el-icon-plus"},on:{click:e.showAddGoodsDialog}},[e._v("添加商品")]),e._v(" "),o("el-button",{attrs:{type:2!==e.type||0!==e.res.state?"":"primary",disabled:2!==e.type||0!==e.res.state,size:"mini",icon:"el-icon-upload2"},on:{click:e.showModal}},[e._v("导入")]),e._v(" "),o("el-button",{attrs:{type:2!==e.type||0!==e.res.state?"":"primary",disabled:2!==e.type||0!==e.res.state,size:"mini",icon:"el-icon-delete"},on:{click:e.deleteProcducts}},[e._v("批量删除")])],1),e._v(" "),o("el-form-item",[o("bl-table",{attrs:{border:!1,selection:!0,dataSource:e.tableData,columns:e.columns},on:{"selection-change":e.selectionChange}})],1),e._v(" "),o("hr",{staticClass:"s-slip"}),e._v(" "),o("el-form-item",[e.userPermission&&e.userPermission.includes("保存")?o("el-button",{attrs:{loading:e.loading,type:0!==e.res.state?"":"primary",size:"small",disabled:0!==e.res.state},on:{click:function(t){return e.operate("save")}}},[e._v("保存")]):e._e(),e._v(" "),o("el-button",{attrs:{size:"small"},on:{click:e.doCancelHandel}},[e._v("关闭")])],1),e._v(" "),o("el-form-item",{attrs:{label:"操作记录："}},[o("bl-table",{attrs:{border:!1,dataSource:e.log,columns:e.logColumns}})],1)],1)],1),e._v(" "),o("el-dialog",{attrs:{title:"批量导入",visible:e.visible},on:{"update:visible":function(t){e.visible=t}}},[o("ImportExcel",{ref:"importFile",attrs:{requireCheckTotal:"true",maxTotal:"1000"},on:{doExportDataHandel:e.doExportDataHandel,importHandle:e.importHandle,uploadEmit:e.uploadEmit}},[e.showImportResult?o("div",{staticStyle:{"margin-top":"30px",color:"#000"}},[o("span",[e._v(e._s(e.importMsg))]),e._v(" "),o("span",{staticStyle:{float:"right",color:"blue"},on:{click:function(t){e.downLoadReasonExcel()}}},[e._v("查看错误原因")])]):e._e()]),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.handleCancel}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.handleOk}},[e._v("确 定")])],1)],1),e._v(" "),o("choose-goods",{ref:"chooseGoods",on:{confirm:e.confirmHandel}})],1)},staticRenderFns:[]};var b=o("VU/8")(f,v,!1,function(e){o("a8AF")},"data-v-2b5eea71",null);t.default=b.exports},YGJB:function(e,t){},a8AF:function(e,t){},dWfj:function(e,t,o){"use strict";var a=o("Dd8w"),i=o.n(a),r=o("Gu7T"),n=o.n(r),s=o("t0/o"),l={data:function(){return{title:"",visible:!1,loading:!1,pageNum:1,pageSize:10,total:0,searchContent:{vendorNos:"",goodsNo:"",goodsName:"",categoryNos:"",regionNo:""},columns:[{title:"商品条码",dataIndex:"barcode",minWidth:120},{title:"商品编码",dataIndex:"goodsNo",minWidth:100},{title:"商品名称",dataIndex:"shortName",minWidth:120},{title:"单位",dataIndex:"saleUnit",minWidth:80},{title:"规格",dataIndex:"spec",minWidth:90}],tableData:[],checkedList:[]}},watch:{searchCondition:function(e,t){e!==t&&this.doSearchHandle(!0)}},computed:{searchCondition:function(){var e=this.searchContent;return{vendorNos:e.vendorNos,categoryNos:e.categoryNos,regionNo:e.regionNo}}},methods:{setDefaultMsg:function(e){this.title=e.title||"",this.searchContent.vendorNos=e.vendorNo?[e.vendorNo]:"",this.searchContent.categoryNos=e.categoryNos?[e.categoryNos]:"",this.searchContent.regionNo=e.regionNo,this.checkedList=e.defaultChecked&&e.defaultChecked.length?[].concat(n()(e.defaultChecked)):[],this.visible=!0},changeSize:function(e){this.pageSize=e,this.doSearchHandle()},changeCurrent:function(e){this.pageNum=e,this.doSearchHandle()},doSearchHandle:function(e){var t=this;this.loading=!0,this.$http.post(s.a.queryRegionCategoryGoodsList,i()({},this.searchContent,{pageNum:this.pageNum,pageSize:this.pageSize})).then(function(e){if(t.loading=!1,0===e.code)return t.tableData=e.data&&e.data.result&&e.data.result.length?e.data.result:[],void(t.total=e.data&&e.data.total?e.data.total:0);throw new Error(e.msg)}).catch(function(e){t.loading=!1,t.$tip.notify(e.message,"error")})},selectHandel:function(e){var t=e.selection,o=e.row;if(t.includes(o))this.checkedList.push(o);else{var a=this.checkedList.findIndex(function(e){return e.goodsNo===o.goodsNo});this.checkedList.splice(a,1)}},selectAllHandel:function(e){var t=this;e.selection.length?this.tableData.forEach(function(e){-1===t.checkedList.findIndex(function(t){return t.goodsNo===e.goodsNo})&&t.checkedList.push(e)}):this.tableData.forEach(function(e){var o=t.checkedList.findIndex(function(t){return t.goodsNo===e.goodsNo});-1!==o&&t.checkedList.splice(o,1)})},confirm:function(){this.visible=!1,this.$emit("confirm",this.checkedList)}}},c={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,title:e.title,visible:e.visible,width:"700px"},on:{"update:visible":function(t){e.visible=t}}},[o("div",{staticClass:"search-form-wraper c-g-sfw"},[o("el-form",{attrs:{model:e.searchContent,"label-position":"top"},nativeOn:{submit:function(e){e.preventDefault()}}},[o("el-form-item",[o("el-input",{staticClass:"search-input",attrs:{placeholder:"输入商品编码",size:"small",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.doSearchHandle(!0)}},model:{value:e.searchContent.goodsNo,callback:function(t){e.$set(e.searchContent,"goodsNo","string"==typeof t?t.trim():t)},expression:"searchContent.goodsNo"}})],1),e._v(" "),o("el-form-item",[o("el-input",{staticClass:"search-input",attrs:{placeholder:"输入商品名称",size:"small",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.doSearchHandle(!0)}},model:{value:e.searchContent.goodsName,callback:function(t){e.$set(e.searchContent,"goodsName","string"==typeof t?t.trim():t)},expression:"searchContent.goodsName"}})],1),e._v(" "),o("el-form-item",[o("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.doSearchHandle(!0)}}},[e._v("搜索")])],1)],1)],1),e._v(" "),o("div",[o("bl-table",{attrs:{loading:e.loading,border:!1,selection:!0,dataSource:e.tableData,columns:e.columns,maxHeight:300,defaultChecked:e.checkedList,uniqueStr:"goodsNo"},on:{select:e.selectHandel,"select-all":e.selectAllHandel}}),e._v(" "),o("bl-pagination",{attrs:{showPagination:e.tableData.length>0,pageNum:e.pageNum,total:e.total},on:{"size-change":e.changeSize,"current-change":e.changeCurrent}})],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{size:"mini"},on:{click:function(t){e.visible=!1}}},[e._v("取消")]),e._v(" "),o("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.confirm}},[e._v("确定")])],1)])},staticRenderFns:[]},d=o("VU/8")(l,c,!1,null,null,null);t.a=d.exports}});
//# sourceMappingURL=6.050d41ee49cde38c9021.1615898974438.js.map