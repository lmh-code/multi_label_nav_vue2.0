webpackJsonp([16],{ZxOr:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("Gu7T"),o=a.n(i),s=a("Dd8w"),r=a.n(s),n=a("BO1k"),l=a.n(n),d=a("ssT3"),c=a("oAV5"),u=a("VMhH"),g=a("FzCZ"),m="/plateform/a/product/goods/batchInsert",h={data:function(){return{conDisabled:!1,isDisabled:!1,saveLoading:!1,title:"批量添加",isShow:!1,formLabelWidth:"70px",file:{name:""},exportGoods:[],tempConfig:{skuNo:"ERP商品编码（必填）",ratio:"转换比例（必填，卖1份需减扣多少单位的母商品）",skuName:"商品名称（必填，限制30个汉字）",spec:"规格（必填）",buyName:"商品卖点（选填，商品特色、优点，限制20个字）",weight:"重量（必填，整数，单位：g）",categoryId1:"一级分类id（必填）",categoryId2:"二级分类id（没有二级分类可不填，有则必填）",sortNum:"排序（0-999的整数，数值越大越靠前，必填）",origin:"产地（选填）",qualityPeriod:"保质期（选填）",pack:"包装（选填）",images:"商品方图url（选填，多张逗号区分）",detailImages:"商品详情图url（选填）"},list:[]}},methods:{setDefaultMesg:function(e){this.isShow=!0,e.title&&(this.title=e.title),this.file={name:""};var t=document.getElementById("excelFile");t&&(t.value="")},downloadModel:function(){var e=this;this.isDisabled=!0;g.a.exportFileByConfig([{skuNo:"",ratio:"",skuName:"",spec:"",buyName:"",weight:"",categoryId1:"",categoryId2:"",sortNum:"",origin:"",qualityPeriod:"",pack:"",images:"",detailImages:""}],"批量添加线上商品库商品模板.xlsx",this.tempConfig),this.$notify.success({title:"温馨提示",message:"批量添加线上商品库商品模板下载成功"}),setTimeout(function(){e.isDisabled=!1},500)},handleFileSelect:function(e){var t=this;if(e.target.files.length){this.file=e.target.files[0]||{name:""};var a=this.file.name.lastIndexOf("."),i=this.file.name.length,o=this.file.name.substring(a,i);if(!this.file.name||".xlsx"!=o)return this.$notify.warning({title:"提示",message:"请选择excel文件"}),this.file={name:""},void(document.getElementById("excelFile").value="");var s={};for(var r in this.tempConfig)s[this.tempConfig[r]]=r;g.a.parseToJSON(this.file,s).then(function(e){var a=e.filter(function(e){return!!e.skuNo}),i=[],o=/^[1-9]*[1-9][0-9]*$/,s=/((^[1-9]\d*)|^0)(\.\d{0,3}){0,1}$/,r=!0,n=!1,d=void 0;try{for(var c,u=l()(a);!(r=(c=u.next()).done);r=!0){var g=c.value;if(!g.skuNo)return t.$notify.warning({title:"提示",message:"请填写ERP商品编码"}),t.file={name:""},void(document.getElementById("excelFile").value="");if(!g.ratio)return t.$notify.warning({title:"提示",message:"请填写转换比例"}),t.file={name:""},void(document.getElementById("excelFile").value="");if(!s.test(g.ratio))return t.$notify.warning({title:"提示",message:"转换比例是大于0，小数保留小数点后3位"}),t.file={name:""},void(document.getElementById("excelFile").value="");if(parseFloat(g.ratio)>10)return t.$notify.warning({title:"提示",message:"转换比例大于10，添加失败"}),t.file={name:""},void(document.getElementById("excelFile").value="");if(!g.skuName)return t.$notify.warning({title:"提示",message:"请填写商品名称"}),t.file={name:""},void(document.getElementById("excelFile").value="");if(g.skuName.length>30)return t.$notify.warning({title:"提示",message:"商品名称,限制30个汉字"}),t.file={name:""},void(document.getElementById("excelFile").value="");if(!g.spec)return t.$notify.warning({title:"提示",message:"请填写商品规格"}),t.file={name:""},void(document.getElementById("excelFile").value="");if(g.buyName&&g.buyName.length>20)return t.$notify.warning({title:"提示",message:"商品卖点信息,限制20个字"}),t.file={name:""},void(document.getElementById("excelFile").value="");if(!g.weight)return t.$notify.warning({title:"提示",message:"请填写商品重量"}),t.file={name:""},void(document.getElementById("excelFile").value="");if(!o.test(g.weight))return t.$notify.warning({title:"提示",message:"商品重量大于0的整数"}),t.file={name:""},void(document.getElementById("excelFile").value="");if(g.weight<=0)return t.$notify.warning({title:"提示",message:"商品重量为大于0的整数"}),t.file={name:""},void(document.getElementById("excelFile").value="");if(!g.categoryId1)return t.$notify.warning({title:"提示",message:"请填写一级分类id"}),t.file={name:""},void(document.getElementById("excelFile").value="");if(""==g.sortNum)g.sortNum=0;else if(0==g.sortNum)g.sortNum=0;else{if(!o.test(g.sortNum))return t.$notify.warning({title:"提示",message:"店内分类下的商品排序，0-999的整数，数值越大越靠前"}),t.file={name:""},void(document.getElementById("excelFile").value="");if(g.sortNum<0||g.sortNum>999)return t.$notify.warning({title:"提示",message:"店内分类下的商品排序，0-999的整数，数值越大越靠前"}),t.file={name:""},void(document.getElementById("excelFile").value="")}g.images&&(g.imageList=g.images.replace(/\，/g,",").split(",")),g.detailImages&&(g.detailImageList=g.detailImages.replace(/\，/g,",").split(",")),i.push(g)}}catch(e){n=!0,d=e}finally{try{!r&&u.return&&u.return()}finally{if(n)throw d}}t.list=i}).catch()}},doConfirmHandel:function(){var e=this;this.conDisabled=!0,this.saveLoading=!0,this.$http.post(m,{list:this.list}).then(function(t){if(setTimeout(function(){e.conDisabled=!1,e.saveLoading=!1},800),0===t.code)return e.$message.success("批量添加成功"),e.isShow=!1,void e.$emit("doSearchHandel");throw new Error(t.msg)}).catch(function(t){e.conDisabled=!1,e.saveLoading=!1,e.$notify.error({title:"提示",message:t.message})})}}},f={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{attrs:{title:e.title,visible:e.isShow,width:"450px"},on:{"update:visible":function(t){e.isShow=t}}},[a("el-form",{ref:"form",attrs:{"label-width":"80px"}},[a("el-form-item",{attrs:{label:"本地上传"}},[a("div",{staticClass:"excel-u-d-wrap"},[a("div",{staticClass:"u-btn-wrap"},[a("div",{staticClass:"file-name-wrap"},[e._v(e._s(e.file.name))]),e._v(" "),a("div",{staticClass:"label-wrap"},[a("label",{staticClass:"excel-file-label",attrs:{for:"excelFile"}},[a("input",{attrs:{type:"file",id:"excelFile",hidden:""},on:{change:e.handleFileSelect}}),e._v(" "),a("span",{staticClass:"u-txt"},[e._v("选择文件")])])])]),e._v(" "),a("div",{staticClass:"d-btn-wrap"},[a("span",[e._v("请按EXCEL模板格式导入")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini",disabled:e.isDisabled},on:{click:e.downloadModel}},[e._v("下载模板")])],1)])])],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.isShow=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini",disabled:!e.file.name||e.conDisabled,loading:e.saveLoading},on:{click:e.doConfirmHandel}},[e._v("确定")])],1)],1)],1)},staticRenderFns:[]};var p=a("VU/8")(h,f,!1,function(e){a("kbgC")},null,null).exports,v=a("//Fk"),y=a.n(v),b=a("ifoU"),w=a.n(b),k=a("d7EF"),I=a.n(k),C=a("u4Bf"),L=a.n(C),N=a("cpGA"),x="/foundation/qiniu/auth/file",_="/plateform/a/product/goods/updateorinsert",S="/plateform/a/product/goods/detail",P={data:function(){return{loading:!1,disabled:!1,saveLoading:!1,title:"添加商品图片",goodsId:"",isShow:!1,addParamMesg:{DIFFCITY:!0,checkOrUpdate:!0,skuTempName:"",categoryId:"",categoryPlatList:[],categoryName:"",detailImageList:[],detailImageUrl:"",qualityPeriod:"",imageList:[],initStock:"",marketPrice:"",pack:"",origin:"",goodsDesc:"",goodsId:"",sortNum:"",skuId:"",skuName:"",skuNo:"",spec:"",weight:"",buyName:"",goodsErpSkuRelations:[]},imageListArr:[],currentUpFileIdx:-1,imageUploadLoading:!1}},components:{draggable:L.a},methods:{setDefaultMesg:function(e){this.isShow=!0,e.title&&(this.title=e.title),e.goodsId&&(this.goodsId=e.goodsId,this.getLibraryDetil(e.goodsId))},getLibraryDetil:function(e){var t=this,a=e;this.loading=!0,this.$http.post(S,{goodsId:a,DIFFCITY:!0}).then(function(e){if(t.loading=!1,0!==e.code)throw new Error(e.msg);if(e.data){var a=e.data;t.addParamMesg.goodsId=a.id,t.addParamMesg.skuTempName=a.skuNo+"-"+a.skuName+"-"+a.spec,t.addParamMesg.skuName=a.skuName,t.addParamMesg.skuNo=a.skuNo,t.addParamMesg.skuId=a.skuId,t.addParamMesg.goodsName=a.goodsName,t.addParamMesg.spec=a.spec,t.addParamMesg.goodsErpSkuRelations=a.goodsItems&&a.goodsItems.length>0?a.goodsItems:[],t.addParamMesg.categoryId=a.categoryId,a.categoryPlatList&&a.categoryPlatList.length>0&&(a.categoryPlatList=a.categoryPlatList.map(function(e){return e&&parseInt(e)}),t.addParamMesg.categoryPlatList=a.categoryPlatList),t.addParamMesg.categoryId=t.addParamMesg.categoryPlatList[t.addParamMesg.categoryPlatList.length-1],t.addParamMesg.categoryName=a.categoryName,t.addParamMesg.marketPrice=a.marketPrice,t.addParamMesg.sortNum=a.sortNum,t.addParamMesg.weight=a.weight,t.addParamMesg.buyName=a.buyName,t.addParamMesg.goodsDesc=a.goodsDesc,t.addParamMesg.pack=a.pack,t.addParamMesg.origin=a.origin,t.addParamMesg.initStock=a.initStock,t.addParamMesg.qualityPeriod=a.qualityPeriod,a.detailImageList&&a.detailImageList.length>0&&(t.addParamMesg.detailImageList=a.detailImageList,t.addParamMesg.detailImageUrl=a.detailImageList[0].imgUrl),a.imageList&&a.imageList.length>0?t.imageListArr=a.imageList:t.imageListArr=[],t.imageListArr.push({imgUrl:"",sortNum:""})}}).catch(function(e){t.loading=!1,t.$notify.error({title:"提示",message:e.message})})},datadragEnd:function(e){var t=!0,a=!1,i=void 0;try{for(var o,s=l()(new w.a(this.imageListArr.map(function(e,t){return[t,e]})));!(t=(o=s.next()).done);t=!0){var r=o.value,n=I()(r,2),d=n[0];n[1].sortNum=d+1}}catch(e){a=!0,i=e}finally{try{!t&&s.return&&s.return()}finally{if(a)throw i}}this.imageListArr=this.imageListArr.filter(function(e){return""!=e.imgUrl});this.imageListArr.push({imgUrl:"",sortNum:""})},emitUpload:function(e){var t=this;this.imageListArr.length>6&&-1!=this.currentUpFileIdx?this.$message.error("商品方图，最多可添加6张"):(this.imageUploadLoading=!0,this.getToken().then(function(a){N.upload(e.file,a.fileName,a.token).subscribe({error:function(){t.imageUploadLoading=!1},complete:function(e){var a="http://retailimg01.benlailife.com/"+e.key;t.imageUploadLoading=!1,t.setImgUrl(t.currentUpFileIdx,a)},next:function(e){}})}))},setImgUrl:function(e,t){var a=t,i=e,o=!0,s=!1,r=void 0;try{for(var n,d=l()(new w.a(this.imageListArr.map(function(e,t){return[t,e]})));!(o=(n=d.next()).done);o=!0){var c=n.value,u=I()(c,2),g=u[0];u[1];g===i&&(this.imageListArr[g].imgUrl=a,this.imageListArr[g].sortNum=parseInt(i)+1)}}catch(e){s=!0,r=e}finally{try{!o&&d.return&&d.return()}finally{if(s)throw r}}var m={};this.imageListArr.push({imgUrl:"",sortNum:""}),this.imageListArr=this.imageListArr.reduceRight(function(e,t){return!m[t.imgUrl]&&(m[t.imgUrl]=e.push(t)),e},[]),this.imageListArr.reverse()},imageUploadRegForMore:function(e){var t=this,a=-1!==e.type.indexOf("image/"),i="image/jpeg"===e.type||"image/png",o=e.size<=235520;if(!a)return this.$message.error("请上传大小不超过230KB的800*800像素的JPG或PNG图片，最多可添加6张"),!1;if(!i)return this.$message.error("请上传大小不超过230KB的800*800像素的JPG或PNG图片，最多可添加6张"),!1;if(!o)return this.$message.error("请上传大小不超过230KB的800*800像素的JPG或PNG图片，最多可添加6张"),!1;var s=new y.a(function(t,a){var i=window.URL||window.webkitURL,o=new Image;o.onload=function(){800==o.width&&800==o.height?t():a()},o.src=i.createObjectURL(e)}).then(function(){return e},function(){return t.$message.error("请上传大小不超过230KB的800*800像素的JPG或PNG图片，最多可添加6张"),y.a.reject()});return a&&i&&o&&s},getToken:function(){var e=this;return this.$http.post(x,{}).then(function(e){if(0==e.code){var t=e.data.token;return{fileName:e.data.key,token:t}}throw new Error(e.msg)}).catch(function(t){e.imageUploadLoading=!1,e.$notify.error({title:"提示",message:t.message})})},setItemIdx:function(e){this.currentUpFileIdx=e},deleteUpFile:function(e){this.imageListArr=this.imageListArr.filter(function(t,a){return a!=e})},doConfirmHandel:function(){var e=this,t=this.imageListArr.filter(function(e,t){return""!=e.imgUrl}),a=!0,i=!1,o=void 0;try{for(var s,n=l()(new w.a(t.map(function(e,t){return[t,e]})));!(a=(s=n.next()).done);a=!0){var d=s.value,c=I()(d,2),u=c[0];c[1].sortNum=parseInt(u)+1}}catch(e){i=!0,o=e}finally{try{!a&&n.return&&n.return()}finally{if(i)throw o}}this.addParamMesg.imageList=t,0!==this.addParamMesg.imageList.length?(this.disabled=!0,this.saveLoading=!0,this.$http.post(_,r()({},this.addParamMesg)).then(function(t){if(setTimeout(function(){e.disabled=!1,e.saveLoading=!1},800),0===t.code)return e.isShow=!1,e.$message.success("添加商品图片成功"),void e.$emit("doSearchHandel");throw new Error(t.msg)}).catch(function(t){setTimeout(function(){e.disabled=!1,e.saveLoading=!1},800),e.$notify.error({title:"提示",message:t.message})})):this.$message("请添加商品方图")}}},$={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{attrs:{title:e.title,visible:e.isShow,width:"524px"},on:{"update:visible":function(t){e.isShow=t}}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"draggable-img-wrap"},[a("draggable",{on:{update:e.datadragEnd},model:{value:e.imageListArr,callback:function(t){e.imageListArr=t},expression:"imageListArr"}},[a("transition-group",e._l(e.imageListArr,function(t,i){return a("div",{key:t.imgUrl,staticClass:"mh-up-w-draggable",on:{click:function(t){return e.setItemIdx(i)}}},[a("el-upload",{staticClass:"avatar-uploader",attrs:{action:"","show-file-list":!1,"before-upload":e.imageUploadRegForMore,"http-request":e.emitUpload}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.imageUploadLoading&&e.currentUpFileIdx==i,expression:"imageUploadLoading && currentUpFileIdx == idx"}]},[t.imgUrl?a("img",{staticClass:"avatar",attrs:{src:t.imgUrl}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])]),e._v(" "),t.imgUrl&&""!=t.imgUrl?a("div",{staticClass:"mh-up-d-w-btn-w"},[a("span",{staticClass:"up-h-i",on:{click:function(t){return e.deleteUpFile(i)}}},[a("i",{staticClass:"el-icon-delete"})]),e._v(" "),a("span",{staticClass:"up-h-i"},[a("i",{staticClass:"el-icon-rank"})])]):e._e()],1)}),0)],1)],1),e._v(" "),a("p",[e._v("请上传大小不超过230KB的800*800像素的JPG或PNG图片，最多可添加6张")]),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.isShow=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini",disabled:e.disabled,loading:e.saveLoading},on:{click:e.doConfirmHandel}},[e._v("确定")])],1)])],1)},staticRenderFns:[]};var F=a("VU/8")(P,$,!1,function(e){a("mnQ6")},null,null).exports,D=a("bzuE"),E="/plateform/a/category/getCategoryTree",U="/plateform/a/product/goods/search",G="/plateform/a/product/goods/del",z="/plateform/a/product/goods/batchUpdateGoodsCategory",T="/plateform/a/product/goods/export",M="/plateform/a/product/goods/goodsItems",A="/foundation/storeGroup/areaStoreGroupList",H={data:function(){return{pageSizes:D.a.pageSizes10,exportLoading:!1,loading:!1,pageNum:1,pageSize:10,total:0,searchContent:{pick:-1,refund:-1,skuNo:"",skuType:"",goodsType:"",byCityId:!1,queryString:"",goodsIds:[],categoryIdList:[],categoryId:"",regionCode:""},cateDefaultProps:{children:"categoryVoList",label:"categoryName",value:"categoryId"},tableData:[],categoryList:[],checkedList:[],dialogFormVisible:!1,categoryPlatList:[],byCityIdOptions:[{label:"是",value:!0},{label:"否",value:!1}],goodsTypeOptions:[{label:"全部",value:""},{label:"常规商品",value:1},{label:"组合商品",value:2}],skuTypeOptions:[{label:"全部",value:""},{label:"重量商品",value:"W"},{label:"标准商品",value:"S"},{label:"计量商品",value:"Q"},{label:"组合商品",value:"C"}],exportConfig:{goodsNo:"SKU编码",skuNo:"母商品ERP编码",skuName:"商品名称",spec:"商品规格",imgListStr:"商品方图（多个逗号分隔）",goodsDetailImg:"商品详情图",regionNameStr:"ERP可售城市",platformNameStr:"本城市在售渠道",buyName:"商品卖点",weight:"重量（g）",categoryName:"所属分类",sortNum:"排序",origin:"产地",qualityPeriod:"保质期",pack:"包装"},visiblePopoverLoading:!1,currentGoodsId:"",goodsErpSkuRelationsData:[],refundAndPickOptions:[{label:"全部",value:-1},{label:"未开启",value:0},{label:"已开启",value:1}],regionOptions:[]}},created:function(){this.getCategoryId(),this.areaStoreGroupList()},mounted:function(){var e=d.a.get("searchContent");this.$route.meta.keepAlive&&e&&(this.pageNum=e.pageNum,this.searchContent=e.searchContent),this.doSearchHandel(),d.a.remove("searchContent"),this.goodsSelectInit()},components:{"goods-select":u.a,"batch-add-goods":p,"add-goods-img":F},methods:{goAddGoodsPage:function(){this.$router.push("/mall_goods_mgt/add_goods")},getCategoryId:function(){var e=this;this.$http.post(E,{DIFFCITY:!0}).then(function(t){if(0!==t.code)throw new Error(t.msg);if(t.data&&t.data.length){var a=!0,i=!1,o=void 0;try{for(var s,r=l()(t.data);!(a=(s=r.next()).done);a=!0){var n=s.value;n.categoryVoList&&0===n.categoryVoList.length&&(n.categoryVoList=null)}}catch(e){i=!0,o=e}finally{try{!a&&r.return&&r.return()}finally{if(i)throw o}}e.categoryList=t.data}else e.categoryList=[]}).catch(function(e){console.log("提示(三方平台店内分类):",e.message)})},doCategorysChangeHandel:function(){this.goodsSelectInit(),this.doSearchHandel(!0)},goodsSelectInit:function(){if(this.$refs.GoodsSelect){var e={queryString:this.searchContent.queryString,categoryIdList:this.searchContent.categoryIdList,goodsIds:this.searchContent.goodsIds};this.$refs.GoodsSelect.setDefaultMesg(e)}},changeSize:function(e){this.pageSize=e,this.doSearchHandel()},changeCurrent:function(e){this.pageNum=e,this.doSearchHandel()},doSearchHandel:function(e){var t=this;this.checkedList=[];var a=this.searchContent.categoryIdList.length-1;this.searchContent.categoryId=this.searchContent.categoryIdList[a],this.loading=!0,!0===e&&(this.pageNum=1),this.$http.post(U,r()({},this.searchContent,{pageNum:this.pageNum,pageSize:this.pageSize,DIFFCITY:!0})).then(function(e){if(t.loading=!1,0!==e.code)throw new Error(e.msg);if(e.data&&e.data.result&&e.data.result.length){var a=!0,i=!1,o=void 0;try{for(var s,r=l()(e.data.result);!(a=(s=r.next()).done);a=!0){var n=s.value;n.uniqueId=n.id+""+n.skuNo}}catch(e){i=!0,o=e}finally{try{!a&&r.return&&r.return()}finally{if(i)throw o}}t.tableData=e.data.result}else t.tableData=[];t.total=e.data.total}).catch(function(e){t.loading=!1,t.$notify.error({title:"提示",message:e.message})})},editItem:function(e){var t={searchContent:this.searchContent,pageNum:this.pageNum};d.a.set("searchContent",t),this.$router.push("/mall_goods_mgt/edit_goods/"+e.id)},deleteItem:function(e){var t=this,a=[];a.push(e.id),this.$confirm("您确定要删除所选商品吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$http.post(G,{goodsIds:a,DIFFCITY:!0}).then(function(e){if(0===e.code)return t.$message.success("删除成功"),void t.doSearchHandel();throw new Error(e.msg)}).catch(function(e){t.$notify.error({title:"提示",message:e.message})})}).catch(function(){})},deleteGoods:function(){var e=this;if(0!==this.checkedList){var t=[],a=!0,i=!1,o=void 0;try{for(var s,r=l()(this.checkedList);!(a=(s=r.next()).done);a=!0){var n=s.value;t.push(n.id)}}catch(e){i=!0,o=e}finally{try{!a&&r.return&&r.return()}finally{if(i)throw o}}this.$confirm("您确定要删除所选商品吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$http.post(G,{goodsIds:t,DIFFCITY:!0}).then(function(t){if(0===t.code)return e.$message.success("批量删除成功"),e.checkedList=[],void e.doSearchHandel();throw new Error(t.msg)}).catch(function(t){e.$notify.error({title:"提示",message:t.message})})}).catch(function(){})}else this.$message("请选择要删除商品")},handleSelect:function(e,t){var a={},i=[];if(c.l(t.uniqueId,this.checkedList))this.checkedList=c.q("uniqueId",t.uniqueId,this.checkedList);else{i.push(t);var s=[].concat(i,o()(this.checkedList));this.checkedList=s.reduceRight(function(e,t){return!a[t.uniqueId]&&(a[t.uniqueId]=e.push(t)),e},[])}},handleSelectAll:function(e){var t={};if(e.length>0){var a=!0,i=!1,o=void 0;try{for(var s,r=l()(e);!(a=(s=r.next()).done);a=!0){var n=s.value;this.checkedList.push(n)}}catch(e){i=!0,o=e}finally{try{!a&&r.return&&r.return()}finally{if(i)throw o}}this.checkedList=this.checkedList.reduceRight(function(e,a){return!t[a.uniqueId]&&(t[a.uniqueId]=e.push(a)),e},[])}else{var d=[],u=!0,g=!1,m=void 0;try{for(var h,f=l()(this.tableData);!(u=(h=f.next()).done);u=!0){var p=h.value;d.push(p)}}catch(e){g=!0,m=e}finally{try{!u&&f.return&&f.return()}finally{if(g)throw m}}var v=c.i(this.checkedList,d,"uniqueId");this.checkedList=v&&v.length>0?v:[]}},showChangeCatDialog:function(){0!==this.checkedList?(this.categoryPlatList=[],this.dialogFormVisible=!0):this.$message("请选择要修改分类的商品")},doConfirmHandel:function(){var e=this,t=this.categoryPlatList.length-1,a=this.categoryPlatList[t],i=[],o=!0,s=!1,r=void 0;try{for(var n,d=l()(this.checkedList);!(o=(n=d.next()).done);o=!0){var c=n.value;i.push(c.id)}}catch(e){s=!0,r=e}finally{try{!o&&d.return&&d.return()}finally{if(s)throw r}}if(a){var u={categoryId:a,goodsIds:i,DIFFCITY:!0};this.$http.post(z,u).then(function(t){if(0===t.code)return e.dialogFormVisible=!1,e.$message.success("批量修改分类成功"),e.checkedList=[],void e.doSearchHandel();throw new Error(t.msg)}).catch(function(t){e.$notify.error({title:"提示",message:t.message})})}else this.$message("请选择分类")},exportData:function(){var e=this;this.exportLoading=!0,this.$http.post(T,r()({},this.searchContent,{pageNum:0,pageSize:0,DIFFCITY:!0})).then(function(t){if(e.exportLoading=!1,0!==t.code)throw new Error(t.msg);if(t.data&&t.data.result&&t.data.result.length){var a=!0,i=!1,o=void 0;try{for(var s,r=l()(t.data.result);!(a=(s=r.next()).done);a=!0){var n=s.value;n.regionNameStr=n.regionName?n.regionName.join(","):"",n.platformNameStr=n.platformName?n.platformName.join(","):"",n.imgListStr=n.imgs&&n.imgs.length?n.imgs.join(","):"",n.goodsDetailImg=n.detailImgs&&n.detailImgs.length?n.detailImgs.join(","):""}}catch(e){i=!0,o=e}finally{try{!a&&r.return&&r.return()}finally{if(i)throw o}}var d=t.data.result;g.a.exportFileByConfig(d,c.u(Date.parse(new Date))+"_线上商品库.xlsx",e.exportConfig),e.$notify.success({title:"温馨提示",message:c.u(Date.parse(new Date))+"_线上商品库导出成功"})}else e.$notify.warning({title:"温馨提示",message:"没有查询到要导出的数据"})}).catch(function(t){e.exportLoading=!1,e.$notify.error({title:"提示(导出数据)：",message:t.message})})},batchAddGoodsShow:function(){if(this.$refs.batchAddGoods){this.$refs.batchAddGoods.setDefaultMesg({title:"批量添加"})}},showErpSkuRelation:function(e){var t=this;this.visiblePopoverLoading=!0;var a=e.id;this.$http.post(M,{goodsId:a,DIFFCITY:!0}).then(function(e){if(t.visiblePopoverLoading=!1,0!==e.code)throw new Error(e.msg);e.data&&e.data.length?t.goodsErpSkuRelationsData=e.data:t.goodsErpSkuRelationsData=[]}).catch(function(e){t.visiblePopoverLoading=!1,t.$notify.error({title:"提示",message:e.message})})},skuTypeFormater:function(e,t,a){return"C"===a?"组合商品":"Q"==a?"计量商品":"S"==a?"标准商品":"W"==a?"重量商品":"--"},addGoodsImgShow:function(e){var t=e.id;if(this.$refs.addGoodsImg){var a={title:"添加商品图片",goodsId:t};this.$refs.addGoodsImg.setDefaultMesg(a)}},DoSelectGoodsHandel:function(e){var t=e.checkedList,a=e.queryString,i=[],o=!0,s=!1,r=void 0;try{for(var n,d=l()(t);!(o=(n=d.next()).done);o=!0){var c=n.value;i.push(c.goodsId)}}catch(e){s=!0,r=e}finally{try{!o&&d.return&&d.return()}finally{if(s)throw r}}this.searchContent.goodsIds=i,this.searchContent.queryString=a,this.doSearchHandel(!0)},areaStoreGroupList:function(){var e=this;this.$http.get(A).then(function(t){if(0===t.code)return e.regionOptions=t.data&&t.data.length?t.data:[],void e.regionOptions.unshift({storeGroupNo:"",storeGroupName:"全部"});throw new Error(t.msg)}).catch(function(e){console.log("提示(获取门店列表):",e.message)})}},beforeRouteLeave:function(e,t,a){t.meta.keepAlive=!1,a()}},B={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"handel-search-wraper"},[a("div",{staticClass:"handel-wraper"},[a("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-plus"},on:{click:e.goAddGoodsPage}},[e._v("添加商品")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-plus"},on:{click:e.batchAddGoodsShow}},[e._v("批量添加商品")])],1),e._v(" "),a("hr",{staticClass:"s-slip"}),e._v(" "),a("div",{staticClass:"search-form-wraper"},[a("el-form",{attrs:{model:e.searchContent,"label-position":"top"}},[a("el-form-item",{attrs:{label:"商品分类"}},[a("el-cascader",{staticClass:"search-input",attrs:{placeholder:"请选择分类",options:e.categoryList,"change-on-select":"",size:"small",clearable:"",filterable:"",props:e.cateDefaultProps},on:{change:e.doCategorysChangeHandel},model:{value:e.searchContent.categoryIdList,callback:function(t){e.$set(e.searchContent,"categoryIdList",t)},expression:"searchContent.categoryIdList"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"SKU编码/商品名称"}},[a("goods-select",{ref:"GoodsSelect",on:{DoSelectGoodsHandel:e.DoSelectGoodsHandel}})],1),e._v(" "),a("el-form-item",{attrs:{label:"ERP编码"}},[a("el-input",{staticClass:"search-input",attrs:{placeholder:"ERP编码",size:"small",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.doSearchHandel(!0)}},model:{value:e.searchContent.skuNo,callback:function(t){e.$set(e.searchContent,"skuNo","string"==typeof t?t.trim():t)},expression:"searchContent.skuNo"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"商品类型"}},[a("el-select",{staticClass:"search-input",attrs:{placeholder:"请选择",size:"small"},on:{change:function(t){return e.doSearchHandel(!0)}},model:{value:e.searchContent.goodsType,callback:function(t){e.$set(e.searchContent,"goodsType",t)},expression:"searchContent.goodsType"}},e._l(e.goodsTypeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"母商品种类"}},[a("el-select",{staticClass:"search-input",attrs:{placeholder:"请选择",size:"small"},on:{change:function(t){return e.doSearchHandel(!0)}},model:{value:e.searchContent.skuType,callback:function(t){e.$set(e.searchContent,"skuType",t)},expression:"searchContent.skuType"}},e._l(e.skuTypeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"区域"}},[a("el-select",{staticClass:"search-input",attrs:{filterable:"",placeholder:"请选择区域",size:"small"},on:{change:function(t){return e.doSearchHandel(!0)}},model:{value:e.searchContent.regionCode,callback:function(t){e.$set(e.searchContent,"regionCode",t)},expression:"searchContent.regionCode"}},e._l(e.regionOptions,function(e){return a("el-option",{key:e.storeGroupNo,attrs:{label:e.storeGroupName,value:e.storeGroupNo}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"扫码捡货"}},[a("el-select",{staticClass:"search-input",attrs:{placeholder:"请选择",size:"small"},on:{change:function(t){return e.doSearchHandel(!0)}},model:{value:e.searchContent.pick,callback:function(t){e.$set(e.searchContent,"pick",t)},expression:"searchContent.pick"}},e._l(e.refundAndPickOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"差额退款"}},[a("el-select",{staticClass:"search-input",attrs:{placeholder:"请选择",size:"small"},on:{change:function(t){return e.doSearchHandel(!0)}},model:{value:e.searchContent.refund,callback:function(t){e.$set(e.searchContent,"refund",t)},expression:"searchContent.refund"}},e._l(e.refundAndPickOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.doSearchHandel(!0)}}},[e._v("搜索")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini",loading:e.exportLoading},on:{click:e.exportData}},[e._v("导出")])],1)],1)],1)]),e._v(" "),a("div",{staticClass:"table-wraper"},[a("div",{staticClass:"batch-handel-w"},[a("el-button",{staticClass:"sup-mini",attrs:{size:"mini",icon:"el-icon-edit",disabled:0===e.checkedList.length},on:{click:e.showChangeCatDialog}},[e._v("批量改分类")]),e._v(" "),a("el-button",{staticClass:"sup-mini",attrs:{size:"mini",icon:"el-icon-delete",disabled:0===e.checkedList.length},on:{click:e.deleteGoods}},[e._v("批量删除")])],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"fixed-height",staticStyle:{width:"100%"},attrs:{data:e.tableData,"empty-text":"没有查询到您想要的数据",size:"small"},on:{select:e.handleSelect,"select-all":e.handleSelectAll}},[a("el-table-column",{attrs:{align:"center",type:"selection"}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"240px",label:"商品信息"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"p-m-w"},[a("div",{staticClass:"img-w"},[t.row.imgUrl&&""!=t.row.imgUrl?a("div",{staticClass:"b-add-img-w",on:{click:function(a){return e.addGoodsImgShow(t.row)}}},[a("img",{attrs:{src:t.row.imgUrl,alt:"",onerror:"onerror=null;src='/shop/static/img_error.png'"}})]):a("div",{staticClass:"b-add-img-btn-w",on:{click:function(a){return e.addGoodsImgShow(t.row)}}},[a("i",{staticClass:"el-icon-plus"})])]),e._v(" "),a("div",{staticClass:"p-m-c-r"},[a("div",[e._v(e._s(t.row.skuName||"暂无"))]),e._v(" "),a("div",{staticClass:"erp-p-no"},[e._v("SKU编码："+e._s(t.row.goodsNo||"--"))]),e._v(" "),a("div",[a("el-popover",{attrs:{placement:"bottom-start",trigger:"click"}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.visiblePopoverLoading,expression:"visiblePopoverLoading"}],attrs:{data:e.goodsErpSkuRelationsData,"empty-text":"暂无数据",size:"small"}},[a("el-table-column",{attrs:{width:"80",prop:"skuNo",label:"ERP编码"}}),e._v(" "),a("el-table-column",{attrs:{width:"150",prop:"skuName",label:"母商品名称"}}),e._v(" "),a("el-table-column",{attrs:{width:"90",prop:"categoryName",label:"ERP分类"}}),e._v(" "),a("el-table-column",{attrs:{width:"90",prop:"skuType",label:"商品种类",formatter:e.skuTypeFormater}}),e._v(" "),a("el-table-column",{attrs:{width:"80",prop:"ratio",label:"转换比例"}}),e._v(" "),a("el-table-column",{attrs:{width:"60",prop:"saleUnitName",label:"单位"}})],1),e._v(" "),a("el-button",{attrs:{slot:"reference",type:"text",size:"mini"},on:{click:function(a){return e.showErpSkuRelation(t.row)}},slot:"reference"},[e._v("查看母商品")])],1)],1)])])]}}])}),e._v(" "),a("el-table-column",{attrs:{"min-width":"120px",prop:"spec",label:"规格"}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"120px",prop:"categoryName",label:"分类"}}),e._v(" "),a("el-table-column",{attrs:{label:"区域可售","min-width":"200px"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.regionName?e._l(t.row.regionName,function(i,o){return a("div",{key:o,staticClass:"a-s-p-i"},[a("span",[e._v(e._s(i))]),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:o+1!=t.row.regionName.length,expression:"(idx+1) != scope.row.regionName.length"}]},[e._v("/")]),e._v(" \n          ")])}):a("div",[e._v("\n            --\n          ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{"min-width":"80px",prop:"sortNum",label:"排序"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",fixed:"right",label:"操作",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-edit"},on:{click:function(a){return e.editItem(t.row)}}},[e._v("编辑")])],1)]}}])})],1),e._v(" "),e.total>0?a("el-pagination",{staticClass:"tc mt20",attrs:{background:"","current-page":e.pageNum,"page-sizes":e.pageSizes,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.changeSize,"current-change":e.changeCurrent,"update:currentPage":function(t){e.pageNum=t},"update:current-page":function(t){e.pageNum=t}}}):e._e()],1),e._v(" "),a("el-dialog",{attrs:{title:"批量改分类",visible:e.dialogFormVisible,width:"460px"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",[a("el-form",{ref:"form",attrs:{"label-width":"60px"}},[a("el-form-item",{attrs:{label:"分类",required:""}},[a("el-cascader",{staticClass:"search-date-picker",attrs:{placeholder:"请选择分类",options:e.categoryList,size:"small",clearable:"",filterable:"",props:e.cateDefaultProps},model:{value:e.categoryPlatList,callback:function(t){e.categoryPlatList=t},expression:"categoryPlatList"}})],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.doConfirmHandel}},[e._v("确 定")])],1)],1),e._v(" "),a("batch-add-goods",{ref:"batchAddGoods",on:{doSearchHandel:function(t){return e.doSearchHandel(!0)}}}),e._v(" "),a("add-goods-img",{ref:"addGoodsImg",on:{doSearchHandel:function(t){return e.doSearchHandel(!0)}}})],1)},staticRenderFns:[]};var R=a("VU/8")(H,B,!1,function(e){a("no97")},null,null);t.default=R.exports},kbgC:function(e,t){},mnQ6:function(e,t){},no97:function(e,t){}});
//# sourceMappingURL=16.07e55ad669346b64e262.js.map