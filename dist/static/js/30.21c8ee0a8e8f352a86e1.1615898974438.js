webpackJsonp([30],{"za/k":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("BO1k"),i=a.n(n),o=a("Dd8w"),s=a.n(o),r=a("Gu7T"),l=a.n(r),c=a("WorT"),d=a("4WFj"),u=a("RjAO"),h=a("oAV5"),m=a("t0/o"),p=a("7592"),f={mixins:[c.a,d.a],components:{"choose-store":p.a},data:function(){return{pageNum:1,pageSize:10,loading:!1,total:0,tableData:[],searchContent:{targetNoList:[],storeNoList:[],paperNo:"",sourceOrderNo:"",status:"",isDispute:"",startOrderOperationDate:Object(h.b)("yyyy-MM-dd",Date.parse(new Date)-5184e5),endOrderOperationDate:Object(h.b)("yyyy-MM-dd",Date.parse(new Date))},storeNames:"",checkedStoreList:[],statusOptions:[],isDisputeOptions:[{label:"全部",value:""},{label:"是",value:1},{label:"否",value:0}],columns:[{title:"收退货单号",dataIndex:"paperNo",ellipsis:!0,minWidth:120},{title:"订单编号",dataIndex:"sourceOrderNo",ellipsis:!0,minWidth:120},{title:"订单类型",dataIndex:"orderTypeName",minWidth:100},{title:"单据时间",dataIndex:"orderOperationDate",ellipsis:!0,minWidth:100},{title:"供应商",dataIndex:"targetName",ellipsis:!0,minWidth:130},{title:"城市",dataIndex:"cityName",minWidth:70},{title:"收货门店/仓库",dataIndex:"storeName",minWidth:120},{title:"不含税收货总金额",dataIndex:"totalNetAmount",minWidth:140},{title:"收货总金额",dataIndex:"totalAmount",minWidth:100},{title:"对账金额",dataIndex:"reconciliationAmount",minWidth:100},{title:"差异金额",dataIndex:"differenceAmount",minWidth:80},{title:"供应商对帐人",dataIndex:"vReconciliationUserName",minWidth:120},{title:"供应商对帐时间",dataIndex:"vReconciliationTime",ellipsis:!0,minWidth:130},{title:"本来鲜对帐人",dataIndex:"reconciliationUserName",minWidth:120},{title:"对帐时间",dataIndex:"reconciliationDate",ellipsis:!0,minWidth:100},{title:"付款状态",dataIndex:"paidValue",minWidth:100},{title:"对账状态",dataIndex:"statusValue",minWidth:110},{title:"对帐批次号",dataIndex:"batchNo",ellipsis:!0,minWidth:130},{title:"争议内容",dataIndex:"disputeText",ellipsis:!0,minWidth:130},{title:"操作",fixed:"right",width:180,operation:[{label:"详情",icon:"el-icon-view",clickFunc:this.goDetailPage},{label:"对账通过",icon:"el-icon-circle-check",isShow:function(t){return 0===t.status},clickFunc:this.recConfirmHandel},{label:"发起争议",icon:"el-icon-warning-outline",isShow:function(t){return 0===t.status},clickFunc:this.goEditPage}]}],confirmLoading:!1,checkedList:[],totalSum:{differenceAmount:"",reconciliationAmount:"",totalAmount:"",totalNetAmount:""}}},mounted:function(){this.getStatus(),this.initMounted()},methods:{initMounted:function(){var t=this;this.vendors&&this.vendors.length>0?this.doSearchHandle(!0):setTimeout(function(){t.initMounted()},500)},getStatus:function(){var t=this;this.$http.post(m.a.listByCommonCodes,["ReconciliationStatus"]).then(function(e){if(0===e.code){var a=e.data&&e.data.ReconciliationStatus&&e.data.ReconciliationStatus.length?e.data.ReconciliationStatus.map(function(t){return{id:t.id,value:t.code,label:t.value}}):[];return a.unshift({id:-1,value:"",label:"全部"}),void(t.statusOptions=a)}throw new Error(e.msg)}).catch(function(t){console.log("【对账管理状态】:",t.message)})},clickInputHandel:function(){this.vendorNos=this.searchContent.targetNoList&&this.searchContent.targetNoList.length>0?this.searchContent.targetNoList:this.vendors.map(function(t){return t.vendorNo}),this.$refs.chooseStore.setDefault({vendorNos:this.vendorNos,defaultChecked:this.checkedStoreList})},confirmHandel:function(t){this.checkedStoreList=t,this.searchContent.storeNoList=t.map(function(t){return t.storeNo}),this.storeNames=t.map(function(t){return t.storeName}).join(",")},selectionChangeHandel:function(t){var e=t.selection;this.checkedList=[].concat(l()(e))},doSearchHandle:function(t){this.searchContent.startOrderOperationDate&&this.searchContent.endOrderOperationDate?Object(h.a)(this.searchContent.startOrderOperationDate)>Object(h.a)(this.searchContent.endOrderOperationDate)?this.$tip.message("单据结束时间不能早于开始时间","warning"):(this.doSearchHandleRequest(t),this.getListTotal()):this.$tip.message("单据开始时间和结束时间不能为空","warning")},getListTotal:function(){var t=this,e=s()({},this.searchContent,{startOrderOperationDate:this.searchContent.startOrderOperationDate+" 00:00:00",endOrderOperationDate:this.searchContent.endOrderOperationDate+" 23:59:59"});(!e.targetNoList||e.targetNoList.length<=0)&&(e.targetNoList=this.vendors.map(function(t){return t.vendorNo})),this.$http.post(u.a.listTotal,s()({},e)).then(function(e){if(0!==e.code)throw new Error(e.msg);e.data?t.totalSum={differenceAmount:e.data.differenceAmount,reconciliationAmount:e.data.reconciliationAmount,totalAmount:e.data.totalAmount,totalNetAmount:e.data.totalNetAmount}:t.totalSum={differenceAmount:"-",reconciliationAmount:"-",totalAmount:"-",totalNetAmount:"-"}}).catch(function(t){console.log("【列表统计提示】:",t.message||"")})},changeSize:function(t){this.pageSize=t,this.doSearchHandleRequest()},changeCurrent:function(t){this.pageNum=t,this.doSearchHandleRequest()},doSearchHandleRequest:function(t){var e=this;this.checkedList=[];var a=s()({},this.searchContent,{startOrderOperationDate:this.searchContent.startOrderOperationDate+" 00:00:00",endOrderOperationDate:this.searchContent.endOrderOperationDate+" 23:59:59"});(!a.targetNoList||a.targetNoList.length<=0)&&(a.targetNoList=this.vendors.map(function(t){return t.vendorNo})),!0===t&&(this.pageNum=1),this.loading=!0,this.$http.post(u.a.reconciliationList,s()({},a,{pageNum:this.pageNum,pageSize:this.pageSize})).then(function(t){if(e.loading=!1,0===t.code)return e.tableData=t.data&&t.data.result&&t.data.result.length?t.data.result:[],void(e.total=t.data&&t.data.total?t.data.total:0);throw new Error(t.msg)}).catch(function(t){e.loading=!1,e.$tip.notify(t.message||"","error","系统提示")})},batchConfirmHandel:function(){var t=this,e=this.checkedList.map(function(t){return t.id}),a=this.checkedList.filter(function(t){return 0===t.status}),n=0,o=!0,s=!1,r=void 0;try{for(var c,d=i()(a);!(o=(c=d.next()).done);o=!0){var m=c.value;n+=parseFloat(m.totalAmount)}}catch(t){s=!0,r=t}finally{try{!o&&d.return&&d.return()}finally{if(s)throw r}}n=isNaN(Object(h.c)(n))?"-":Object(h.c)(n);var p=this.$createElement;this.$msgbox({title:"对账通过",message:p("p",null,[p("span",null,"共选择"+this.checkedList.length+"个对账单，有"+a.length+"个未对帐，对账总金额:"),p("span",{style:"color: red;"},""+n),p("span",null,"元，确定对帐通过？")]),showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(n){0!==a.length?(t.confirmLoading=!0,t.$http.post(u.a.batchConfirm,[].concat(l()(e))).then(function(e){if(t.confirmLoading=!1,0===e.code)return t.$tip.message("批量对账通过成功","success"),void t.doSearchHandleRequest();throw new Error(e.msg)}).catch(function(e){t.confirmLoading=!1,t.$tip.notify(e.message||"","error","系统提示")})):t.$tip.message("批量对账通过成功","success")}).catch(function(t){})},recConfirmHandel:function(t){var e=this,a=t.reconciliationAmount||0==parseFloat(t.reconciliationAmount)?t.reconciliationAmount:t.totalAmount,n=this.$createElement;this.$msgbox({title:"对账通过",message:n("p",null,[n("span",null,"对账金额:"),n("span",{style:"color: red;"},""+a),n("span",null,"元，确定对帐通过？")]),showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(a){e.$http.post(u.a.confirm,{storeNo:t.storeNo,paperNo:t.paperNo,updateTime:t.updateTime}).then(function(t){if(0===t.code)return e.$tip.message("对账通过成功","success"),void e.doSearchHandleRequest();throw new Error(t.msg)}).catch(function(t){e.$tip.notify(t.message||"","error","系统提示")})}).catch(function(t){})},goDetailPage:function(t){var e=t.isDispute?"110":"001";this.$router.push("/reconciliation/detail/detail/"+t.storeNo+"/"+t.paperNo+"/"+e)},goEditPage:function(t){var e=t.isDispute?"110":"001";this.$router.push("/reconciliation/edit/edit/"+t.storeNo+"/"+t.paperNo+"/"+e)},getSummaries:function(t){var e=this,a=[],n=[];return t.columns.forEach(function(t){e.totalSum[t.property]||0==e.totalSum[t.property]?n.push(e.totalSum[t.property]):n.push("")}),(a=n)[0]="合计",a}}},g={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"search-form-wraper"},[a("el-form",{attrs:{model:t.searchContent,"label-position":"top"}},[a("el-form-item",{attrs:{label:"供应商"}},[a("el-select",{staticClass:"search-input",attrs:{placeholder:"选择供应商",multiple:"","collapse-tags":"",size:"small"},model:{value:t.searchContent.targetNoList,callback:function(e){t.$set(t.searchContent,"targetNoList",e)},expression:"searchContent.targetNoList"}},t._l(t.vendors,function(t){return a("el-option",{key:t.vendorNo,attrs:{label:t.vendorName,value:t.vendorNo}})}),1)],1),t._v(" "),a("el-form-item",{attrs:{label:"门店"}},[a("el-input",{staticClass:"search-input",attrs:{size:"small",placeholder:"点击选择门店",readonly:""},model:{value:t.storeNames,callback:function(e){t.storeNames="string"==typeof e?e.trim():e},expression:"storeNames"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.clickInputHandel},slot:"append"})],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"收退货单号"}},[a("el-input",{staticClass:"search-input",attrs:{size:"small",placeholder:"请输入收退货单号",clearable:""},model:{value:t.searchContent.paperNo,callback:function(e){t.$set(t.searchContent,"paperNo","string"==typeof e?e.trim():e)},expression:"searchContent.paperNo"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"订单编号"}},[a("el-input",{staticClass:"search-input",attrs:{size:"small",placeholder:"请输入订单编号",clearable:""},model:{value:t.searchContent.sourceOrderNo,callback:function(e){t.$set(t.searchContent,"sourceOrderNo","string"==typeof e?e.trim():e)},expression:"searchContent.sourceOrderNo"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"对账状态"}},[a("el-select",{staticClass:"search-input",attrs:{placeholder:"状态",filterable:"",clearable:"",size:"small"},model:{value:t.searchContent.status,callback:function(e){t.$set(t.searchContent,"status",e)},expression:"searchContent.status"}},t._l(t.statusOptions,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),t._v(" "),a("el-form-item",{attrs:{label:"是否有争议"}},[a("el-select",{staticClass:"search-input",attrs:{placeholder:"状态",filterable:"",clearable:"",size:"small"},model:{value:t.searchContent.isDispute,callback:function(e){t.$set(t.searchContent,"isDispute",e)},expression:"searchContent.isDispute"}},t._l(t.isDisputeOptions,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),t._v(" "),a("el-form-item",{attrs:{label:"单据开始时间"}},[a("el-date-picker",{staticClass:"search-input",attrs:{type:"date",placeholder:"单据开始时间",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",size:"small"},model:{value:t.searchContent.startOrderOperationDate,callback:function(e){t.$set(t.searchContent,"startOrderOperationDate",e)},expression:"searchContent.startOrderOperationDate"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"单据结束时间"}},[a("el-date-picker",{staticClass:"search-input",attrs:{type:"date",placeholder:"单据结束时间",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",size:"small"},model:{value:t.searchContent.endOrderOperationDate,callback:function(e){t.$set(t.searchContent,"endOrderOperationDate",e)},expression:"searchContent.endOrderOperationDate"}})],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.doSearchHandle(!0)}}},[t._v("搜索")])],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{disabled:0===t.checkedList.length,size:"mini",loading:t.confirmLoading},on:{click:t.batchConfirmHandel}},[t._v("批量对账通过")])],1)],1)],1),t._v(" "),a("div",{staticClass:"table-wraper"},[a("bl-table",{attrs:{loading:t.loading,border:!1,dataSource:t.tableData,columns:t.columns,selection:!0,showSummary:!0,getSummaries:t.getSummaries},on:{"selection-change":t.selectionChangeHandel}}),t._v(" "),a("bl-pagination",{attrs:{showPagination:t.tableData.length>0,pageNum:t.pageNum,total:t.total},on:{"size-change":t.changeSize,"current-change":t.changeCurrent}})],1),t._v(" "),a("choose-store",{ref:"chooseStore",on:{confirm:t.confirmHandel}})],1)},staticRenderFns:[]},v=a("VU/8")(f,g,!1,null,null,null);e.default=v.exports}});
//# sourceMappingURL=30.21c8ee0a8e8f352a86e1.1615898974438.js.map