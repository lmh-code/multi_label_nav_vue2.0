webpackJsonp([149],{"6mvw":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("Dd8w"),l=a.n(i),s=a("cpGA"),n=a("ssT3"),o="/plateform/a/apk/version/saveApk",p="/foundation/qiniu/auth/file",r={data:function(){return{isDisabled:!1,updateTypeOptions:[{value:0,label:"正常"},{value:1,label:"强制升级"}],editApkData:{versionName:"",des:"",url:"",versionCode:"",updateType:"",id:"",apkType:0},apkUploadLoading:!1,apkFile:{},apkTypeOptions:[{value:0,label:"门店端"},{value:1,label:"TV端"}]}},mounted:function(){var e=n.a.get("ApkDate");e&&(this.editApkData=e)},created:function(){},methods:{doSaveHandel:function(){var e=this;""!==this.editApkData.versionName?""!==this.editApkData.url?""!=this.editApkData.versionCode?!/^[1-9]*[1-9][0-9]*$/.test(this.editApkData.versionCode)||this.editApkData.versionCode<0?this.$message("内部版本号格式不正确"):""!==this.editApkData.updateType?(this.isDisabled=!0,this.$http.post(o,l()({},this.editApkData)).then(function(t){if(setTimeout(function(){e.isDisabled=!1},800),0!==t.code)throw new Error(t.msg);e.$router.push("/apk")}).catch(function(t){e.isDisabled=!1,e.$notify.error({title:"提示",message:t.message})})):this.$message("请选择升级类型"):this.$message("请输入内部版本号"):this.$message("请输入下载地址"):this.$message("请输入版本名称")},doCancelHandel:function(){var e=this;this.$confirm("确定取消吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$router.push("/apk")}).catch(function(){})},apkUploadReg:function(e){var t=e.name,a=e.name.length;this.apkFile={fileExtension:"apk",fileName:t.slice(0,a-4)};var i="apk"===t.slice(a-3);return i||this.$message.error("文件必须是Apk格式!"),i},uploadApk:function(e){var t=this;this.apkUploadLoading=!0,this.getToken().then(function(a){s.upload(e.file,a.fileName,a.token).subscribe({error:function(){t.apkUploadLoading=!1},complete:function(e){var a="http://retailimg01.benlailife.com/"+e.key;t.editApkData.url=a,t.apkUploadLoading=!1},next:function(e){}})})},getToken:function(){var e=this;return this.$http.post(p,l()({},this.apkFile)).then(function(e){if(0==e.code){var t=e.data.token;return{fileName:e.data.key,token:t}}throw new Error(e.msg)}).catch(function(t){e.apkUploadLoading=!1,e.$notify.error({title:"提示",message:t.message})})}},beforeRouteLeave:function(e,t,a){e.meta.keepAlive=!0,a()}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"add-form-wraper"},[a("el-form",{ref:"form",attrs:{model:e.editApkData,"label-width":"160px"}},[a("el-form-item",{attrs:{label:"版本名称",required:""}},[a("el-input",{staticClass:"add-input",attrs:{size:"small",placeholder:"请输入版本名称"},model:{value:e.editApkData.versionName,callback:function(t){e.$set(e.editApkData,"versionName",t)},expression:"editApkData.versionName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"更新说明"}},[a("el-input",{staticClass:"add-input",attrs:{type:"textarea",rows:3,size:"small",placeholder:"请输入更新说明"},model:{value:e.editApkData.des,callback:function(t){e.$set(e.editApkData,"des",t)},expression:"editApkData.des"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Apk类型",required:""}},[a("el-select",{staticClass:"add-input",attrs:{size:"small",placeholder:"请选择Apk类型"},model:{value:e.editApkData.apkType,callback:function(t){e.$set(e.editApkData,"apkType",t)},expression:"editApkData.apkType"}},e._l(e.apkTypeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"下载地址",required:""}},[a("el-input",{staticClass:"add-input",attrs:{size:"small",placeholder:"请输入下载地址",disabled:""},model:{value:e.editApkData.url,callback:function(t){e.$set(e.editApkData,"url",t)},expression:"editApkData.url"}}),e._v(" "),a("el-upload",{staticStyle:{display:"inline-block"},attrs:{action:"","show-file-list":!1,"before-upload":e.apkUploadReg,"http-request":e.uploadApk}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.apkUploadLoading,expression:"apkUploadLoading"}]},[a("el-button",{attrs:{icon:"el-icon-upload2",size:"small"}},[e._v("上传apk文件")])],1)])],1),e._v(" "),a("el-form-item",{attrs:{label:"内部版本号",required:""}},[a("el-input",{staticClass:"add-input",attrs:{size:"small",placeholder:"请输入内部版本号"},model:{value:e.editApkData.versionCode,callback:function(t){e.$set(e.editApkData,"versionCode",t)},expression:"editApkData.versionCode"}}),e._v(" "),a("span",[e._v("内部版本号限制正整数")])],1),e._v(" "),a("el-form-item",{attrs:{label:"升级类型",required:""}},[a("el-select",{staticClass:"add-input",attrs:{size:"small",placeholder:"请选择升级类型"},model:{value:e.editApkData.updateType,callback:function(t){e.$set(e.editApkData,"updateType",t)},expression:"editApkData.updateType"}},e._l(e.updateTypeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("hr",{staticClass:"s-slip-tb"}),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"small",disabled:e.isDisabled},on:{click:e.doSaveHandel}},[e._v("保存")]),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:e.doCancelHandel}},[e._v("取消")])],1)],1)],1)},staticRenderFns:[]},u=a("VU/8")(r,d,!1,null,null,null);t.default=u.exports}});
//# sourceMappingURL=149.a0b18cb7425bbf6ee03b.js.map