webpackJsonp([13],{"8YYm":function(t,e){},oqqI:function(t,e){},qGar:function(t,e){},uJmM:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("Dd8w"),o=s.n(i),a=s("BO1k"),r=s.n(a),n=s("ssT3"),l=s("oAV5"),c=s("Gu7T"),d=s.n(c),u={data:function(){return{tableData:[],checkedList:[]}},methods:{setDefaultMesg:function(t){this.tableData=t.tableData,this.checkedList=[]},statusFormatter:function(t,e,s,i){return 0===s?"上架":1===s?"下架":void 0},updateShelfStatus:function(t,e){var s={row:t,shelfStatus:e};this.$emit("updateShelfStatus",s)},deleteItem:function(t){var e={row:t};this.$emit("deleteItem",e)},handleSelect:function(t,e){var s={},i=[];if(l.m(e.uniqueId,"uniqueId",this.checkedList))this.checkedList=l.q("uniqueId",e.uniqueId,this.checkedList);else{i.push(e);var o=[].concat(i,d()(this.checkedList));this.checkedList=o.reduceRight(function(t,e){return!s[e.uniqueId]&&(s[e.uniqueId]=t.push(e)),t},[])}},handleSelectAll:function(t){var e={};if(t.length>0){var s=!0,i=!1,o=void 0;try{for(var a,n=r()(t);!(s=(a=n.next()).done);s=!0){var c=a.value;this.checkedList.push(c)}}catch(t){i=!0,o=t}finally{try{!s&&n.return&&n.return()}finally{if(i)throw o}}this.checkedList=this.checkedList.reduceRight(function(t,s){return!e[s.uniqueId]&&(e[s.uniqueId]=t.push(s)),t},[])}else{var d=[],u=!0,h=!1,p=void 0;try{for(var m,f=r()(this.tableData);!(u=(m=f.next()).done);u=!0){var v=m.value;d.push(v)}}catch(t){h=!0,p=t}finally{try{!u&&f.return&&f.return()}finally{if(h)throw p}}var g=l.i(this.checkedList,d,"uniqueId");this.checkedList=g&&g.length>0?g:[]}},showSetPriceDialog:function(){if(this.checkedList.some(function(t,e){return t.activitys&&t.activitys.length}))this.$notify.warning({title:"温馨提示",message:"所选商品中部分商品因参加活动不能进行批量调价，请取消选择再进行批量调价！"});else{var t={checkedList:this.checkedList};this.$emit("batchUpdatePrice",t)}},showSetStockDialog:function(){var t={checkedList:this.checkedList};this.$emit("batchUpdateStock",t)},doBatchDelHandel:function(){var t={checkedList:this.checkedList};this.$emit("doBatchDelHandel",t)},deletePriceNum:function(t,e){var s=this;setTimeout(function(){s.tableData[t].updatePrice=s.tableData[t].price,s.tableData[t].showPriceUpdate=!1},500)},deleteStockNum:function(t,e){var s=this;setTimeout(function(){s.tableData[t].updateStockNum=s.tableData[t].stockNum,s.tableData[t].showUpdate=!1},500)},deleteSortNum:function(t,e){var s=this;setTimeout(function(){s.tableData[t].updateSortNum=s.tableData[t].sortNum,s.tableData[t].showSortNumUpdate=!1},500)},modifyPriceNum:function(t,e){1!=e.showPriceUpdate&&(this.tableData[t].showPriceUpdate=!0)},modifystockNum:function(t,e){1!=e.showUpdate&&(this.tableData[t].showUpdate=!0)},modifySortNum:function(t,e){1!=e.showSortNumUpdate&&(this.tableData[t].showSortNumUpdate=!0)},sureUpdataPriceNum:function(t){var e=t.updatePrice;if(e)if(/((^[1-9]\d*)|^0)(\.\d{0,2}){0,1}$/.test(e)){var s={row:t,price:e};this.$emit("updatePriceNumHandel",s)}else this.$message("门店售价为大于0，小数保留小数点后2位");else this.$message("请输入门店售价")},sureUpdataStockNum:function(t){var e=t.updateStockNum;if(""!=e){if(0==e)e=0;else{if(!/^[1-9]*[1-9][0-9]*$/.test(e))return void this.$message("库存数为0-999的整数");if(e<0||e>999)return void this.$message("库存数为0-999的整数")}var s={row:t,stockNum:e};this.$emit("updateStockNumHandel",s)}else this.$message("请输入库存数量")},sureUpdataSortNum:function(t){var e=t.updateSortNum;if(""!=e){if(0==e)e=0;else{if(!/^[1-9]*[1-9][0-9]*$/.test(e))return void this.$message("库存数为0-999的整数");if(e<0||e>999)return void this.$message("库存数为0-999的整数")}var s={row:t,sortNum:e};this.$emit("updateSortNumHandel",s)}else this.$message("请输入库存数量")},batchUpdateShelfStatus:function(t){var e={shelfStatus:t,checkedList:this.checkedList};this.$emit("batchUpdateShelfStatus",e)},showBatchSort:function(){var t={checkedList:this.checkedList};this.$emit("batchUpdateSort",t)}}},h={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"batch-handel-w"},[s("el-button",{staticClass:"sup-mini",attrs:{size:"mini",icon:"el-icon-circle-check",disabled:0===t.checkedList.length},on:{click:t.showSetPriceDialog}},[t._v("设置价格")]),t._v(" "),s("el-button",{staticClass:"sup-mini",attrs:{size:"mini",icon:"el-icon-edit",disabled:0===t.checkedList.length},on:{click:t.showSetStockDialog}},[t._v("设置库存")]),t._v(" "),s("el-button",{staticClass:"sup-mini",attrs:{size:"mini",icon:"el-icon-upload2",disabled:0===t.checkedList.length},on:{click:function(e){return t.batchUpdateShelfStatus(0)}}},[t._v("上架")]),t._v(" "),s("el-button",{staticClass:"sup-mini",attrs:{size:"mini",icon:"el-icon-download",disabled:0===t.checkedList.length},on:{click:function(e){return t.batchUpdateShelfStatus(1)}}},[t._v("下架")]),t._v(" "),s("el-button",{staticClass:"sup-mini",attrs:{size:"mini",icon:"el-icon-sort",disabled:0===t.checkedList.length},on:{click:t.showBatchSort}},[t._v("设置排序")]),t._v(" "),s("el-button",{staticClass:"sup-mini",attrs:{size:"mini",icon:"el-icon-delete",disabled:0===t.checkedList.length},on:{click:t.doBatchDelHandel}},[t._v("删除")])],1),t._v(" "),s("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,"empty-text":"没有查询到您想要的数据",size:"small"},on:{select:t.handleSelect,"select-all":t.handleSelectAll}},[s("el-table-column",{attrs:{type:"selection",align:"center"}}),t._v(" "),s("el-table-column",{attrs:{label:"门店信息","min-width":"120px"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("div",[s("p",[t._v(t._s(e.row.storeName))]),t._v(" "),s("p",{staticClass:"erp-p-no"},[t._v("ERP编码："+t._s(e.row.storeNo))])])]}}])}),t._v(" "),s("el-table-column",{attrs:{label:"商品信息","min-width":"256px"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("div",{staticClass:"p-m-w"},[s("div",{staticClass:"img-w"},[e.row.imgUrl&&""!=e.row.imgUrl?s("img",{attrs:{src:e.row.imgUrl,alt:"",onerror:"onerror=null;src='/shop/static/img_error.png'"}}):s("img",{attrs:{src:"/shop/static/img_error.png",alt:""}})]),t._v(" "),s("div",{staticClass:"p-m-c-r"},[s("div",[t._v(t._s(e.row.productName||"--"))]),t._v(" "),s("div",{staticClass:"erp-p-no"},[t._v("SKU编码："+t._s(e.row.goodsNo||"--"))]),t._v(" "),s("p",{staticClass:"erp-p-no"},[t._v("门店商品ID："+t._s(e.row.presaleId||"--"))])])])]}}])}),t._v(" "),s("el-table-column",{attrs:{label:"营销活动","min-width":"110px"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.activitys&&e.row.activitys.length?s("div",t._l(e.row.activitys,function(e,i){return s("div",{key:i,staticClass:"act-name-wrap"},[t._v("\n            "+t._s(e)+"\n          ")])}),0):s("div",[t._v("--")])]}}])}),t._v(" "),s("el-table-column",{attrs:{label:"门店售价","min-width":"160px"},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.showPriceUpdate?s("div",{staticClass:"stock-num"},[s("el-button-group",[s("el-input",{staticStyle:{width:"80px"},attrs:{size:"mini",disabled:!(!e.row.activitys||!e.row.activitys.length)},on:{focus:function(s){return t.modifyPriceNum(e.$index,e.row)}},model:{value:e.row.price,callback:function(s){t.$set(e.row,"price",s)},expression:"scope.row.price"}})],1)],1):1==e.row.showPriceUpdate?s("div",{staticClass:"stock-num"},[s("el-button-group",[s("el-input",{staticStyle:{width:"80px"},attrs:{size:"mini"},on:{blur:function(s){return t.deletePriceNum(e.$index,!0)}},model:{value:e.row.updatePrice,callback:function(s){t.$set(e.row,"updatePrice",s)},expression:"scope.row.updatePrice"}})],1),t._v(" "),s("el-button-group",[s("el-button",{staticStyle:{width:"25px"},attrs:{icon:"el-icon-check",size:"mini"},on:{click:function(s){return t.sureUpdataPriceNum(e.row)}}}),t._v(" "),s("el-button",{staticStyle:{width:"25px"},attrs:{icon:"el-icon-close",size:"mini"},on:{click:function(s){return t.deletePriceNum(e.$index)}}})],1)],1):t._e()]}}])}),t._v(" "),s("el-table-column",{attrs:{label:"库存","min-width":"160px"},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.showUpdate?s("div",{staticClass:"stock-num"},[s("el-button-group",[s("el-input",{staticStyle:{width:"80px"},attrs:{size:"mini"},on:{focus:function(s){return t.modifystockNum(e.$index,e.row)}},model:{value:e.row.stockNum,callback:function(s){t.$set(e.row,"stockNum",s)},expression:"scope.row.stockNum"}})],1)],1):1==e.row.showUpdate?s("div",{staticClass:"stock-num"},[s("el-button-group",[s("el-input",{staticStyle:{width:"80px"},attrs:{size:"mini"},on:{blur:function(s){return t.deleteStockNum(e.$index,!0)}},model:{value:e.row.updateStockNum,callback:function(s){t.$set(e.row,"updateStockNum",s)},expression:"scope.row.updateStockNum"}})],1),t._v(" "),s("el-button-group",[s("el-button",{staticStyle:{width:"25px"},attrs:{icon:"el-icon-check",size:"mini"},on:{click:function(s){return t.sureUpdataStockNum(e.row)}}}),t._v(" "),s("el-button",{staticStyle:{width:"25px"},attrs:{icon:"el-icon-close",size:"mini"},on:{click:function(s){return t.deleteStockNum(e.$index)}}})],1)],1):t._e()]}}])}),t._v(" "),s("el-table-column",{attrs:{label:"排序","min-width":"160px"},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.showSortNumUpdate?s("div",{staticClass:"stock-num"},[s("el-button-group",[s("el-input",{staticStyle:{width:"80px"},attrs:{size:"mini"},on:{focus:function(s){return t.modifySortNum(e.$index,e.row)}},model:{value:e.row.sortNum,callback:function(s){t.$set(e.row,"sortNum",s)},expression:"scope.row.sortNum"}})],1)],1):1==e.row.showSortNumUpdate?s("div",{staticClass:"stock-num"},[s("el-button-group",[s("el-input",{staticStyle:{width:"80px"},attrs:{size:"mini"},on:{blur:function(s){return t.deleteSortNum(e.$index,!0)}},model:{value:e.row.updateSortNum,callback:function(s){t.$set(e.row,"updateSortNum",s)},expression:"scope.row.updateSortNum"}})],1),t._v(" "),s("el-button-group",[s("el-button",{staticStyle:{width:"25px"},attrs:{icon:"el-icon-check",size:"mini"},on:{click:function(s){return t.sureUpdataSortNum(e.row)}}}),t._v(" "),s("el-button",{staticStyle:{width:"25px"},attrs:{icon:"el-icon-close",size:"mini"},on:{click:function(s){return t.deleteSortNum(e.$index)}}})],1)],1):t._e()]}}])}),t._v(" "),s("el-table-column",{attrs:{prop:"status",label:"状态",formatter:t.statusFormatter}}),t._v(" "),s("el-table-column",{attrs:{fixed:"right",label:"操作",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("div",[1===e.row.status?s("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-upload2"},on:{click:function(s){return t.updateShelfStatus(e.row,"0")}}},[t._v("上架")]):0===e.row.status?s("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-download"},on:{click:function(s){return t.updateShelfStatus(e.row,"1")}}},[t._v("下架")]):t._e()],1),t._v(" "),s("div",[s("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-delete"},on:{click:function(s){return t.deleteItem(e.row)}}},[t._v("删除")])],1)]}}])})],1)],1)},staticRenderFns:[]};var p=s("VU/8")(u,h,!1,function(t){s("oqqI")},null,null).exports,m="/plateform/a/platformStore/getPlatformStoreByCityId",f="/plateform/a/product/store/presale/copyProduct",v={data:function(){return{isDisabled:!1,isShow:!1,title:"复制门店商品",addParamMesg:{DIFFCITY:!0,saleType:"",fromStoreNo:"",platformId:"",toStoreNo:[]},storeNoOptions:[],checkedList:[],searchContent:{DIFFCITY:!0,regionCode:"",searchValue:"",platformId:"",cityId:"",storeGroupTypeNo:"",storeGroupNo:"",storeGroupTypeNoList:[]}}},components:{"region-store":s("PJOa").a},methods:{setDefaultMesg:function(t){this.isShow=!0,this.title=t.title||"",this.addParamMesg.platformId=t.platformId||"",this.addParamMesg.saleType=t.saleType||"",this.searchContent={DIFFCITY:!0,regionCode:t.regionCode,searchValue:"",platformId:t.platformId,cityId:"",storeGroupTypeNo:"",storeGroupNo:"",storeGroupTypeNoList:[]},this.checkedList=[],this.getStoreList()},getStoreList:function(){var t=this;this.addParamMesg.fromStoreNo="",this.$http.post(m,o()({},this.searchContent)).then(function(e){if(0!==e.code)throw new Error(e.msg);e.data&&e.data.length?(t.addParamMesg.fromStoreNo=e.data[0].storeNo,t.storeNoOptions=e.data.map(function(t){return{value:t.storeNo,label:t.storeNo+"-"+t.storeName}})):t.storeNoOptions=[]}).catch(function(t){console.log("【提示】获取门店信息错误：",t.message)})},confirmClose:function(){var t=this,e=this.checkedList.map(function(t){return t.storeNo});this.addParamMesg.toStoreNo=e,0!==this.addParamMesg.toStoreNo.length?(this.isDisabled=!0,this.$http.post(f,o()({},this.addParamMesg)).then(function(e){if(setTimeout(function(){t.isDisabled=!1},800),0===e.code)return t.isShow=!1,t.$message.success("复制门店商品成功"),void t.$emit("doSearchHandel");throw new Error(e.msg)}).catch(function(e){t.isDisabled=!1,t.$notify.error({title:"提示",message:e.message})})):this.$message.success("请选择要复制到的门店")},setCheckedData:function(t){this.checkedList=t||[]}}},g={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("el-dialog",{attrs:{"close-on-press-escape":!1,"close-on-click-modal":!1,title:t.title,visible:t.isShow,width:"820px"},on:{"update:visible":function(e){t.isShow=e}}},[s("el-form",{ref:"form",attrs:{"label-width":"70px"},nativeOn:{submit:function(t){t.preventDefault()}}},[s("el-form-item",{attrs:{label:"从",required:""}},[s("el-select",{staticClass:"add-input",attrs:{filterable:"",placeholder:"请选择门店",size:"small"},model:{value:t.addParamMesg.fromStoreNo,callback:function(e){t.$set(t.addParamMesg,"fromStoreNo",e)},expression:"addParamMesg.fromStoreNo"}},t._l(t.storeNoOptions,function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),t._v(" "),s("el-form-item",{attrs:{label:"复制到",required:""}},[s("region-store",{attrs:{regionCode:t.searchContent.regionCode,platformId:t.searchContent.platformId,getStoreListUrl:"/plateform/a/platformStore/getPlatformStoreByCityId",showGroup:!0},on:{setCheckedData:t.setCheckedData}})],1),t._v(" "),s("div",[s("p",{staticClass:"des-p-style"},[t._v("1、可以将A门店有，B门店没有（ERP上已引入本门店）的商品，复制到B门店；")]),t._v(" "),s("p",{staticClass:"des-p-style"},[t._v("2、可以将单个门店商品，复制到本城市多个门店中，前提是商品引入了门店；")]),t._v(" "),s("p",{staticClass:"des-p-style"},[t._v("3、使用场景，新门店上线无商品时，直接复制本城市已有商品的门店，或者门店商品不全，需要复制本城市商品比较全的门店的商品。")])])],1),t._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{size:"mini"},on:{click:function(e){t.isShow=!1}}},[t._v("取 消")]),t._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",disabled:t.isDisabled},on:{click:t.confirmClose}},[t._v("确 定")])],1)],1)],1)},staticRenderFns:[]},b=s("VU/8")(v,g,!1,null,null,null).exports,y=s("FzCZ"),S="/plateform/a/store/condition/search",w="/plateform/a/product/store/presale/search",k="/plateform/a/product/store/presale/excelUpdateStorePrice",N={data:function(){return{conDisabled:!1,isDisabled:!1,title:"批量调价",isShow:!1,formLabelWidth:"70px",file:{name:""},exportGoods:[],tempConfig:{platformName:"平台(禁止修改)",storeNo:"门店编码(禁止修改)",storeName:"门店名称(禁止修改)",presaleId:"门店商品ID(禁止修改)",goodsNo:"SKU编码(禁止修改)",productNo:"母商品ERP编码(禁止修改)",productName:"商品名称(禁止修改)",spec:"商品规格(禁止修改)",price:"门店原价(禁止修改)",newPrice:"门店新售价（必填）"},presaleList:[],saleType:"",platformId:"",storeNo:"",storeOptions:[],regionCode:""}},methods:{setDefaultMesg:function(t){this.isShow=!0,t.title&&(this.title=t.title),t.saleType&&(this.saleType=t.saleType),t.storeNo&&(this.storeNo=t.storeNo),t.platformId&&(this.platformId=t.platformId),t.regionCode&&(this.regionCode=t.regionCode),this.file={name:""};var e=document.getElementById("excelFile");e&&(e.value=""),this.getStoreList()},getStoreList:function(){var t=this,e={regionCode:this.regionCode};e.DIFFCITY=!!this.regionCode,this.$http.post(S,o()({},e)).then(function(e){if(0!==e.code)throw new Error(e.msg);if(e.data&&e.data.length){var s=[],i=!0,o=!1,a=void 0;try{for(var n,l=r()(e.data);!(i=(n=l.next()).done);i=!0){var c=n.value,d={value:c.storeNo,label:c.storeNo+"-"+c.storeName};s.push(d)}}catch(t){o=!0,a=t}finally{try{!i&&l.return&&l.return()}finally{if(o)throw a}}t.storeOptions=s}else t.storeOptions=[]}).catch(function(t){console.log("提示(获取门店列表):",t.message)})},downloadModel:function(){var t=this;this.storeNo?(this.isDisabled=!0,this.$http.post(w,{platformId:this.platformId,saleType:this.saleType,storeNo:this.storeNo,limitFlag:!1,DIFFCITY:!0}).then(function(e){if(setTimeout(function(){t.isDisabled=!1},800),0!==e.code)throw new Error(e.msg);if(e.data&&e.data.pageVo&&e.data.pageVo.result&&e.data.pageVo.result.length){var s=e.data.pageVo.result;y.a.exportFileByConfig(s,"批量调价模板.xlsx",t.tempConfig),t.$notify.success({title:"温馨提示",message:"批量调价模板下载成功"})}else t.$notify.warning({title:"温馨提示",message:"未获取到数据，下载失败"})}).catch(function(e){t.isDisabled=!0,t.$notify.error({title:"提示(下载模板)：",message:e.message})})):this.$message("请选择门店")},handleFileSelect:function(t){var e=this,s=/((^[1-9]\d*)|^0)(\.\d{0,2}){0,1}$/;if(t.target.files.length){this.file=t.target.files[0]||{name:""};var i=this.file.name.lastIndexOf("."),o=this.file.name.length,a=this.file.name.substring(i,o);if(!this.file.name||".xlsx"!=a)return this.$notify.warning({title:"提示",message:"请选择excel文件"}),this.file={name:""},void(document.getElementById("excelFile").value="");var n={};for(var l in this.tempConfig)n[this.tempConfig[l]]=l;y.a.parseToJSON(this.file,n).then(function(t){var i=t.filter(function(t){return!!t.presaleId}),o=[],a=!0,n=!1,l=void 0;try{for(var c,d=r()(i);!(a=(c=d.next()).done);a=!0){var u=c.value;if(!u.newPrice)return e.$notify.warning({title:"提示",message:"请填写("+u.productName+")的门店新售价"}),e.file={name:""},void(document.getElementById("excelFile").value="");if(!s.test(u.newPrice))return e.$notify.warning({title:"提示",message:"("+u.productName+")的门店新售价为大于0，小数保留小数点后2位"}),e.file={name:""},void(document.getElementById("excelFile").value="");var h={storePlatformGoodsId:u.presaleId,price:u.newPrice};o.push(h)}}catch(t){n=!0,l=t}finally{try{!a&&d.return&&d.return()}finally{if(n)throw l}}e.presaleList=o}).catch()}},doConfirmHandel:function(){var t=this,e={regionCode:this.regionCode};e.DIFFCITY=!!this.regionCode,this.conDisabled=!0,this.$http.post(k,o()({adjustPriceList:this.presaleList},e)).then(function(e){if(setTimeout(function(){t.conDisabled=!1},800),0===e.code)return t.$message.success("批量调价成功"),t.isShow=!1,void t.$emit("doSearchHandel");throw new Error(e.msg)}).catch(function(e){t.conDisabled=!1,t.$notify.error({title:"提示",message:e.message,duration:0})})}}},C={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("el-dialog",{attrs:{"close-on-press-escape":!1,"close-on-click-modal":!1,title:t.title,visible:t.isShow,width:"450px"},on:{"update:visible":function(e){t.isShow=e}}},[s("el-form",{ref:"form",attrs:{"label-width":"80px"}},[s("el-form-item",{attrs:{label:"选择门店"}},[s("el-select",{staticClass:"search-date-picker",attrs:{filterable:"",placeholder:"请选择门店",clearable:"",size:"small"},model:{value:t.storeNo,callback:function(e){t.storeNo=e},expression:"storeNo"}},t._l(t.storeOptions,function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1),t._v(" "),s("span",[t._v("下载模板必选")])],1),t._v(" "),s("el-form-item",{attrs:{label:"本地上传"}},[s("div",{staticClass:"excel-u-d-wrap"},[s("div",{staticClass:"u-btn-wrap"},[s("div",{staticClass:"file-name-wrap"},[t._v(t._s(t.file.name))]),t._v(" "),s("div",{staticClass:"label-wrap"},[s("label",{staticClass:"excel-file-label",attrs:{for:"excelFile"}},[s("input",{attrs:{type:"file",id:"excelFile",hidden:""},on:{change:t.handleFileSelect}}),t._v(" "),s("span",{staticClass:"u-txt"},[t._v("选择文件")])])])]),t._v(" "),s("div",{staticClass:"d-btn-wrap"},[s("span",[t._v("请按EXCEL模板格式导入")]),t._v(" "),s("el-button",{attrs:{type:"text",size:"mini",disabled:t.isDisabled},on:{click:t.downloadModel}},[t._v("下载模板")])],1)])])],1),t._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{size:"mini"},on:{click:function(e){t.isShow=!1}}},[t._v("取消")]),t._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",disabled:!t.file.name||t.conDisabled},on:{click:t.doConfirmHandel}},[t._v("确定")])],1)],1)],1)},staticRenderFns:[]};var _=s("VU/8")(N,C,!1,function(t){s("8YYm")},null,null).exports,$=s("Xlsm"),I=s("3GJe"),D=s("32kd"),x=s("bzuE"),L="/plateform/a/category/getCategoryTree",U="/plateform/a/product/store/presale/search",P="/plateform/a/product/store/presale/batchblxOffShelf",T="/plateform/a/product/store/presale/batchDel",z="/plateform/a/product/store/presale/batchUpdateStock",H="/plateform/a/product/store/presale/batchUpdateWeight",F="/plateform/a/product/store/presale/batchUpdateStorePrice",V={data:function(){return{pageSizes:x.a.pageSizes10,loading:!1,pageNum:1,pageSize:10,total:0,activeName:"all",searchContent:{DIFFCITY:!0,regionCode:n.a.get("regionCode")||"",cityId:"",storeGroupTypeNo:"",storeGroupNo:"",queryString:"",platformId:5,saleType:4,platformCityGoodsIds:[],storeNo:"",categoryId:"",categoryIdList:[],status:-1},cateDefaultProps:{children:"categoryVoList",label:"categoryName",value:"categoryId"},categoryList:[],tableData:[],checkedList:[],isDisabled:!1,dialogFormVisible:!1,stockNum:"",topCardCount:{all:0,putaWay:0,soldOut:0},priceDialogFormVisible:!1,price:"",sortDialogFormVisible:!1,sortNum:""}},created:function(){var t=this.$route.query.platformCityGoodsId;t&&(this.searchContent.platformCityGoodsIds.push(t),this.searchContent.queryString=t),this.getCategoryId()},components:{"my-table":p,"copy-goods":b,"batch-update-price":_,"batch-update-stock":$.a,"goods-select":I.a,"region-city-store":D.a},mounted:function(){this.doSearchHandel(!0),this.goodsSelectInit()},methods:{StoreGroupChange:function(t){this.searchContent.regionCode=t.regionCode,this.searchContent.cityId=t.cityId,this.searchContent.storeNo=t.storeNo,this.searchContent.storeGroupTypeNo=t.storeGroupTypeNoList[0],this.searchContent.storeGroupNo=t.storeGroupTypeNoList[1],this.doSearchHandel(!0)},getCategoryId:function(){var t=this;this.$http.post(L).then(function(e){if(0!==e.code)throw new Error(e.msg);if(e.data&&e.data.length){var s=!0,i=!1,o=void 0;try{for(var a,n=r()(e.data);!(s=(a=n.next()).done);s=!0){var l=a.value;l.categoryVoList&&0===l.categoryVoList.length&&(l.categoryVoList=null)}}catch(t){i=!0,o=t}finally{try{!s&&n.return&&n.return()}finally{if(i)throw o}}t.categoryList=e.data}else t.categoryList=[]}).catch(function(t){console.log("提示(三方平台店内分类):",t.message)})},handleTabClick:function(t){"all"==t.name?this.searchContent.status=-1:"onShelf"==t.name?this.searchContent.status=0:"downShelf"==t.name&&(this.searchContent.status=1),this.activeName=t.name,this.doSearchHandel(!0)},changeSize:function(t){this.pageSize=t,this.doSearchHandel()},changeCurrent:function(t){this.pageNum=t,this.doSearchHandel()},doSearchHandel:function(t){var e=this,s=this.searchContent.categoryIdList.length-1;this.searchContent.categoryId=this.searchContent.categoryIdList[s],this.loading=!0,!0===t&&(this.pageNum=1),this.$http.post(U,o()({},this.searchContent,{pageSize:this.pageSize,pageNum:this.pageNum})).then(function(t){if(e.loading=!1,0!==t.code)throw new Error(t.msg);if(t.data&&t.data.pageVo&&t.data.pageVo.result&&t.data.pageVo.result.length){var s=!0,i=!1,o=void 0;try{for(var a,n=r()(t.data.pageVo.result);!(s=(a=n.next()).done);s=!0){var l=a.value;l.showUpdate=!1,l.updateStockNum=l.stockNum,l.showSortNumUpdate=!1,l.updateSortNum=l.sortNum,l.showPriceUpdate=!1,l.updatePrice=l.price,l.uniqueId=""+l.presaleId+l.productNo}}catch(t){i=!0,o=t}finally{try{!s&&n.return&&n.return()}finally{if(i)throw o}}e.tableData=t.data.pageVo.result;var c={tableData:e.tableData};e.$refs.myTable&&e.$refs.myTable.setDefaultMesg(c),1===e.pageNum&&(e.total=t.data.pageVo.total)}else{e.tableData=[];var d={tableData:e.tableData};e.$refs.myTable&&e.$refs.myTable.setDefaultMesg(d),1===e.pageNum&&(e.total=0)}t.data&&t.data.countVo&&(e.topCardCount.all=t.data.countVo.all,e.topCardCount.putaWay=t.data.countVo.putaWay,e.topCardCount.soldOut=t.data.countVo.soldOut)}).catch(function(t){e.loading=!1,e.$notify.error({title:"提示",message:t.message})})},updateShelfStatus:function(t){var e=this,s=[];s.push(t.row.presaleId);var i=-1,o="";0==t.shelfStatus?(i=0,o="上架"):1==t.shelfStatus&&(i=1,o="下架"),this.$confirm("确定要执行("+o+")操作吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){l.r(),e.$http.post(P,{presaleIds:s,shelfStatus:i}).then(function(t){if(l.c(),0===t.code)return 0===i?e.$message.success("上架成功"):1===i&&e.$message.success("下架成功"),void e.doSearchHandel();throw new Error(t.msg)}).catch(function(t){l.c(),e.$notify.error({title:"提示",message:t.message})})}).catch(function(){})},deleteItem:function(t){var e=this,s=[];s.push(t.row.presaleId),this.$confirm("确定要执行删除操作吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){l.r(),e.$http.post(T,{presaleIds:s,deleteStatus:1}).then(function(t){if(l.c(),0===t.code)return e.$message.success("删除成功"),void e.doSearchHandel(!0);throw new Error(t.msg)}).catch(function(t){l.c(),e.$notify.error({title:"提示",message:t.message})})}).catch(function(){})},doBatchDelHandel:function(t){var e=this;if(t.checkedList&&(this.checkedList=t.checkedList),0!==this.checkedList.length){var s=[],i=!0,o=!1,a=void 0;try{for(var n,c=r()(this.checkedList);!(i=(n=c.next()).done);i=!0){var d=n.value;s.push(d.presaleId)}}catch(t){o=!0,a=t}finally{try{!i&&c.return&&c.return()}finally{if(o)throw a}}this.$confirm("确定要执行批量删除操作吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){l.r(),e.$http.post(T,{presaleIds:s,deleteStatus:1}).then(function(t){if(l.c(),0===t.code)return e.$message.success("删除成功"),void e.doSearchHandel(!0);throw new Error(t.msg)}).catch(function(t){l.c(),e.$notify.error({title:"提示",message:t.message})})}).catch(function(){})}else this.$message("请选择商品")},batchUpdatePrice:function(t){t.checkedList&&(this.checkedList=t.checkedList),this.priceDialogFormVisible=!0,1===t.checkedList.length?this.price=t.checkedList[0].price:this.price=""},batchUpdateStock:function(t){t.checkedList&&(this.checkedList=t.checkedList),this.dialogFormVisible=!0,1===t.checkedList.length?this.stockNum=t.checkedList[0].stockNum:this.stockNum=""},doConfirmHandel:function(){var t=this;if(0!==this.checkedList.length)if(this.stockNum){if(0==this.stockNum)this.stockNum=0;else{if(!/^[1-9]*[1-9][0-9]*$/.test(this.stockNum))return void this.$message("库存数为0-999的整数");if(this.stockNum<0||this.stockNum>999)return void this.$message("库存数为0-999的整数")}var e=[],s=!0,i=!1,o=void 0;try{for(var a,n=r()(this.checkedList);!(s=(a=n.next()).done);s=!0){var l=a.value;e.push(l.presaleId)}}catch(t){i=!0,o=t}finally{try{!s&&n.return&&n.return()}finally{if(i)throw o}}var c=parseInt(this.stockNum);this.isDisabled=!0,this.$http.post(z,{presaleIds:e,stockNum:c}).then(function(e){if(setTimeout(function(){t.isDisabled=!1},800),0===e.code)return t.dialogFormVisible=!1,t.$message.success("批量设置库存成功"),void t.doSearchHandel();throw new Error(e.msg)}).catch(function(e){t.isDisabled=!1,t.$notify.error({title:"提示",message:e.message})})}else this.$message("请输入库存数量");else this.$message("请选择商品")},updateStockNumHandel:function(t){var e=this;if(t){var s=[];s.push(t.row.presaleId);var i=parseInt(t.stockNum);l.r(),this.$http.post(z,{presaleIds:s,stockNum:i}).then(function(t){if(l.c(),0===t.code)return e.dialogFormVisible=!1,e.$message.success("设置库存成功"),void e.doSearchHandel();throw new Error(t.msg)}).catch(function(t){l.c(),e.$notify.error({title:"提示",message:t.message})})}},copyStoreGoods:function(){var t={title:"复制门店商品",saleType:this.searchContent.saleType,platformId:this.searchContent.platformId,regionCode:this.searchContent.regionCode};this.$refs.copyGoods.setDefaultMesg(t)},showBatchUpdatePrice:function(){var t={title:"批量调价",storeNo:this.searchContent.storeNo,saleType:this.searchContent.saleType,platformId:this.searchContent.platformId,regionCode:this.searchContent.regionCode};this.$refs.batchUpdatePrice.setDefaultMesg(t)},showBatchUpdateStock:function(){var t={title:"批量设置库存",storeNo:this.searchContent.storeNo,saleType:this.searchContent.saleType,platformId:this.searchContent.platformId,regionCode:this.searchContent.regionCode};this.$refs.batchUpdateStock.setDefaultMesg(t)},batchUpdateShelfStatus:function(t){var e=this;if(t.checkedList&&(this.checkedList=t.checkedList),0!==this.checkedList.length){var s=[],i=!0,o=!1,a=void 0;try{for(var n,c=r()(this.checkedList);!(i=(n=c.next()).done);i=!0){var d=n.value;s.push(d.presaleId)}}catch(t){o=!0,a=t}finally{try{!i&&c.return&&c.return()}finally{if(o)throw a}}var u=-1,h="";0==t.shelfStatus?(u=0,h="上架"):1==t.shelfStatus&&(u=1,h="下架"),this.$confirm("确定要执行批量("+h+")操作吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){l.r(),e.$http.post(P,{presaleIds:s,shelfStatus:u}).then(function(t){if(l.c(),0===t.code)return 0===u?e.$message.success("批量上架成功"):1===u&&e.$message.success("批量下架成功"),void e.doSearchHandel();throw new Error(t.msg)}).catch(function(t){l.c(),e.$notify.error({title:"提示",message:t.message})})}).catch(function(){})}else this.$message("请选择商品")},batchUpdateSort:function(t){t.checkedList&&(this.checkedList=t.checkedList),this.sortDialogFormVisible=!0,1===t.checkedList.length?this.sortNum=t.checkedList[0].sortNum:this.sortNum=""},doConfirmUpdateSortHandel:function(){var t=this;if(0!==this.checkedList.length)if(""!=this.sortNum){if(0==this.sortNum)this.sortNum=0;else{if(!/^[1-9]*[1-9][0-9]*$/.test(this.sortNum))return void this.$message("排序值为0-999的整数");if(this.sortNum<0||this.sortNum>999)return void this.$message("排序值为0-999的整数")}var e=[],s=!0,i=!1,o=void 0;try{for(var a,n=r()(this.checkedList);!(s=(a=n.next()).done);s=!0){var l=a.value;e.push(l.presaleId)}}catch(t){i=!0,o=t}finally{try{!s&&n.return&&n.return()}finally{if(i)throw o}}var c=parseInt(this.sortNum);this.isDisabled=!0,this.$http.post(H,{presaleIds:e,sortNum:c}).then(function(e){if(setTimeout(function(){t.isDisabled=!1},800),0===e.code)return t.sortDialogFormVisible=!1,t.$message.success("批量设置排序成功"),void t.doSearchHandel();throw new Error(e.msg)}).catch(function(e){t.isDisabled=!1,t.$notify.error({title:"提示",message:e.message})})}else this.$message("请输入排序值");else this.$message("请选择商品")},updateSortNumHandel:function(t){var e=this;if(t){var s=[];s.push(t.row.presaleId);var i=parseInt(t.sortNum);l.r(),this.$http.post(H,{presaleIds:s,sortNum:i}).then(function(t){if(l.c(),0===t.code)return e.sortDialogFormVisible=!1,e.$message.success("设置排序成功"),void e.doSearchHandel();throw new Error(t.msg)}).catch(function(t){l.c(),e.$notify.error({title:"提示",message:t.message})})}},doConfirmUpdatePriceHandel:function(){var t=this;if(0!==this.checkedList.length)if(this.price)if(/((^[1-9]\d*)|^0)(\.\d{0,2}){0,1}$/.test(this.price)){var e=[],s=!0,i=!1,o=void 0;try{for(var a,n=r()(this.checkedList);!(s=(a=n.next()).done);s=!0){var l=a.value;e.push(l.presaleId)}}catch(t){i=!0,o=t}finally{try{!s&&n.return&&n.return()}finally{if(i)throw o}}var c=parseFloat(this.price);this.isDisabled=!0,this.$http.post(F,{storePlatformGoodsIds:e,price:c}).then(function(e){if(setTimeout(function(){t.isDisabled=!1},800),0===e.code)return t.priceDialogFormVisible=!1,t.$message.success("批量设置价格成功"),void t.doSearchHandel();throw new Error(e.msg)}).catch(function(e){t.isDisabled=!1,t.$notify.error({title:"提示",message:e.message})})}else this.$message("门店售价为大于0，小数保留小数点后2位");else this.$message("请输入门店售价");else this.$message("请选择商品")},updatePriceNumHandel:function(t){var e=this;if(t){var s=[];s.push(t.row.presaleId);var i=parseFloat(t.price);l.r(),this.$http.post(F,{storePlatformGoodsIds:s,price:i}).then(function(t){if(l.c(),0===t.code)return e.sortDialogFormVisible=!1,e.$message.success("设置门店售价成功"),void e.doSearchHandel();throw new Error(t.msg)}).catch(function(t){l.c(),e.$notify.error({title:"提示",message:t.message})})}},goodsSelectInit:function(){if(this.$refs.GoodsSelect){var t={queryString:this.searchContent.queryString,categoryIdList:this.searchContent.categoryIdList,saleType:this.searchContent.saleType,platformId:this.searchContent.platformId,platformCityGoodsIds:this.searchContent.platformCityGoodsIds};this.$refs.GoodsSelect.setDefaultMesg(t)}},DoSelectGoodsHandel:function(t){var e=t.checkedList,s=t.queryString,i=[],o=!0,a=!1,n=void 0;try{for(var l,c=r()(e);!(o=(l=c.next()).done);o=!0){var d=l.value;i.push(d.platformCityGoodsId)}}catch(t){a=!0,n=t}finally{try{!o&&c.return&&c.return()}finally{if(a)throw n}}this.searchContent.platformCityGoodsIds=i,this.searchContent.queryString=s,this.doSearchHandel(!0)}}},G={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"handel-search-wraper"},[s("div",{staticClass:"handel-wraper"},[s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-circle-check"},on:{click:t.showBatchUpdatePrice}},[t._v("批量调价")]),t._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-edit"},on:{click:t.showBatchUpdateStock}},[t._v("批量调库存")]),t._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-document"},on:{click:t.copyStoreGoods}},[t._v("复制门店商品")])],1),t._v(" "),s("hr",{staticClass:"s-slip"}),t._v(" "),s("div",{staticClass:"search-form-wraper"},[s("el-form",{attrs:{model:t.searchContent,"label-position":"top"}},[s("region-city-store",{on:{StoreGroupChange:t.StoreGroupChange}}),t._v(" "),s("el-form-item",{attrs:{label:"SKU编码/商品名称"}},[s("goods-select",{ref:"GoodsSelect",on:{DoSelectGoodsHandel:t.DoSelectGoodsHandel}})],1),t._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.doSearchHandel(!0)}}},[t._v("搜索")])],1)],1)],1)]),t._v(" "),s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"table-wraper tab-wraper"},[s("el-tabs",{on:{"tab-click":t.handleTabClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[s("el-tab-pane",{attrs:{name:"all"}},[s("span",{attrs:{slot:"label"},slot:"label"},[t._v("全部 "+t._s(this.topCardCount.all))])]),t._v(" "),s("el-tab-pane",{attrs:{name:"onShelf"}},[s("span",{attrs:{slot:"label"},slot:"label"},[t._v("上架中 "+t._s(this.topCardCount.putaWay))])]),t._v(" "),s("el-tab-pane",{attrs:{name:"downShelf"}},[s("span",{attrs:{slot:"label"},slot:"label"},[t._v("已下架 "+t._s(this.topCardCount.soldOut))])]),t._v(" "),s("my-table",{ref:"myTable",on:{updateShelfStatus:t.updateShelfStatus,deleteItem:t.deleteItem,batchUpdateStock:t.batchUpdateStock,doBatchDelHandel:t.doBatchDelHandel,updateStockNumHandel:t.updateStockNumHandel,batchUpdateShelfStatus:t.batchUpdateShelfStatus,batchUpdateSort:t.batchUpdateSort,updateSortNumHandel:t.updateSortNumHandel,batchUpdatePrice:t.batchUpdatePrice,updatePriceNumHandel:t.updatePriceNumHandel}})],1)],1),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.tableData.length>0,expression:"tableData.length > 0"}],staticClass:"pagination"},[s("el-pagination",{attrs:{background:"","current-page":t.pageNum,"page-sizes":t.pageSizes,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.changeSize,"current-change":t.changeCurrent,"update:currentPage":function(e){t.pageNum=e},"update:current-page":function(e){t.pageNum=e}}})],1),t._v(" "),s("el-dialog",{attrs:{title:"批量设置价格",visible:t.priceDialogFormVisible,width:"400px"},on:{"update:visible":function(e){t.priceDialogFormVisible=e}}},[s("el-form",[s("el-form",{ref:"form",attrs:{"label-width":"80px"}},[s("el-form-item",{attrs:{label:"门店售价",required:""}},[s("el-input",{staticClass:"search-input",attrs:{size:"small",placeholder:"请输入门店售价"},model:{value:t.price,callback:function(e){t.price=e},expression:"price"}}),t._v(" "),s("div",[t._v("所选商品全部将以此价格售卖")])],1)],1)],1),t._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{size:"mini"},on:{click:function(e){t.priceDialogFormVisible=!1}}},[t._v("取 消")]),t._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",disabled:t.isDisabled},on:{click:t.doConfirmUpdatePriceHandel}},[t._v("确 定")])],1)],1),t._v(" "),s("el-dialog",{attrs:{title:"批量设置库存",visible:t.dialogFormVisible,width:"400px"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[s("el-form",[s("el-form",{ref:"form",attrs:{"label-width":"80px"}},[s("el-form-item",{attrs:{label:"库存",required:""}},[s("el-input",{staticClass:"search-input",attrs:{size:"small",placeholder:"请输入库存"},model:{value:t.stockNum,callback:function(e){t.stockNum=e},expression:"stockNum"}}),t._v(" "),s("div",[t._v("所选商品全部将以此库存售卖")])],1)],1)],1),t._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{size:"mini"},on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取 消")]),t._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",disabled:t.isDisabled},on:{click:t.doConfirmHandel}},[t._v("确 定")])],1)],1),t._v(" "),s("el-dialog",{attrs:{title:"批量设置排序",visible:t.sortDialogFormVisible,width:"400px"},on:{"update:visible":function(e){t.sortDialogFormVisible=e}}},[s("el-form",[s("el-form",{ref:"form",attrs:{"label-width":"80px"}},[s("el-form-item",{attrs:{label:"排序值",required:""}},[s("el-input",{staticClass:"search-input",attrs:{size:"small",placeholder:"请输入排序值"},model:{value:t.sortNum,callback:function(e){t.sortNum=e},expression:"sortNum"}}),t._v(" "),s("div",[t._v("0-999的整数，越大越靠前")])],1)],1)],1),t._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{size:"mini"},on:{click:function(e){t.sortDialogFormVisible=!1}}},[t._v("取 消")]),t._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",disabled:t.isDisabled},on:{click:t.doConfirmUpdateSortHandel}},[t._v("确 定")])],1)],1),t._v(" "),s("copy-goods",{ref:"copyGoods",on:{doSearchHandel:t.doSearchHandel}}),t._v(" "),s("batch-update-price",{ref:"batchUpdatePrice",on:{doSearchHandel:t.doSearchHandel}}),t._v(" "),s("batch-update-stock",{ref:"batchUpdateStock",on:{doSearchHandel:t.doSearchHandel}})],1)},staticRenderFns:[]};var E=s("VU/8")(V,G,!1,function(t){s("qGar")},null,null);e.default=E.exports}});
//# sourceMappingURL=13.6a1caa9eb6a3cf1d6d0f.js.map