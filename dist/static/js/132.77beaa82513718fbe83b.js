webpackJsonp([132],{fwXe:function(e,t){},zlR5:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("BO1k"),a=i.n(s),o=i("ssT3"),n=(i("oAV5"),i("FzCZ")),r=i("PJOa"),l=i("ylbZ"),d=/((^[1-9]\d*)|^0)(\.\d{0,2}){0,1}$/,c="/plateform/a/platformCityGoods/presale/platformCityGoodsList",f="/plateform/a/product/store/presale/excelUpdateCityStorePrice",m={data:function(){return{isDisabled:!1,file:{name:""},checkedList:[],saleType:4,platformId:5,tempConfig:{platformName:"平台(禁止修改)",platformCityGoodsId:"商品ID(禁止修改)",goodsNo:"SKU编码(禁止修改)",skuNo:"ERP编码(禁止修改)",goodsName:"商品名称(禁止修改)",spec:"商品规格(禁止修改)",categoryName:"所属分类(禁止修改)",regionCode:"区域ID(禁止修改)",regionName:"区域名称(禁止修改)",newPrice:"新售价即要调整的售价(必填)"},adjustPriceList:[],regionCode:o.a.get("regionCode")}},components:{"region-store":r.a,region:l.a},methods:{downloadModel:function(){var e=this;this.isDisabled=!0,this.$http.post(c,{platformId:this.platformId,saleType:this.saleType,regionCode:this.regionCode,DIFFCITY:!0}).then(function(t){if(setTimeout(function(){e.isDisabled=!1},800),0!==t.code)throw new Error(t.msg);if(t.data&&t.data.length){var i=t.data;n.a.exportFileByConfig(i,"及时达批量调门店售价模板.xlsx",e.tempConfig),e.$notify.success({title:"温馨提示",message:"及时达批量调门店售价模板下载成功"})}else e.$notify.warning({title:"温馨提示",message:"未获取到数据，下载失败"})}).catch(function(t){e.isDisabled=!0,e.$notify.error({title:"提示(下载模板)：",message:t.message})})},handleFileSelect:function(e){var t=this;if(e.target.files.length){this.file=e.target.files[0]||{name:""};var i=this.file.name.lastIndexOf("."),s=this.file.name.length,o=this.file.name.substring(i,s);if(!this.file.name||".xlsx"!=o)return this.$notify.warning({title:"提示",message:"请选择excel文件"}),this.file={name:""},void(document.getElementById("excelFile").value="");var r={};for(var l in this.tempConfig)r[this.tempConfig[l]]=l;n.a.parseToJSON(this.file,r).then(function(e){var i=e.filter(function(e){return!!e.platformCityGoodsId}),s=[],o=!0,n=!1,r=void 0;try{for(var l,c=a()(i);!(o=(l=c.next()).done);o=!0){var f=l.value;if(!f.newPrice)return t.$notify.warning({title:"提示",message:"请填写("+f.platformCityGoodsId+"_"+f.goodsName+")的新售价"}),t.file={name:""},void(document.getElementById("excelFile").value="");if(!d.test(f.newPrice))return t.$notify.warning({title:"提示",message:"("+f.platformCityGoodsId+"_"+f.goodsName+")的新售价为大于0，小数保留小数点后2位"}),t.file={name:""},void(document.getElementById("excelFile").value="");var m={platformCityGoodsId:f.platformCityGoodsId,price:f.newPrice,goodsNo:f.goodsNo};s.push(m)}}catch(e){n=!0,r=e}finally{try{!o&&c.return&&c.return()}finally{if(n)throw r}}t.adjustPriceList=s}).catch()}},doSaveHandel:function(){var e=this;if(0!==this.adjustPriceList.length)if(0!==this.checkedList.length){var t=this.checkedList.map(function(e){return e.storeNo});this.isDisabled=!0,this.saveLoading=!0,this.$http.post(f,{adjustPriceList:this.adjustPriceList,storeNos:t,DIFFCITY:!0}).then(function(t){if(setTimeout(function(){e.isDisabled=!1,e.saveLoading=!1},800),0!==t.code)throw new Error(t.msg);e.$message.success("批量调门店售价成功")}).catch(function(t){e.isDisabled=!1,e.saveLoading=!1,e.$notify.error({title:"提示",message:t.message,duration:0})})}else this.$message.warning("请选择批量更新门店");else this.$message.warning("请先上传商品")},setCheckedData:function(e){this.checkedList=e||[]}}},u={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"add-form-wraper"},[i("el-form",{ref:"form",attrs:{"label-width":"160px"},nativeOn:{submit:function(e){e.preventDefault()}}},[i("region",{staticClass:"region-wrap",attrs:{className:"add-input",required:!0}}),e._v(" "),i("el-form-item",{attrs:{label:"本地上传",required:""}},[i("div",{staticClass:"excel-u-d-wrap"},[i("div",{staticClass:"u-btn-wrap"},[i("div",{staticClass:"file-name-wrap"},[e._v(e._s(e.file.name))]),e._v(" "),i("div",{staticClass:"label-wrap"},[i("label",{staticClass:"excel-file-label",attrs:{for:"excelFile"}},[i("input",{attrs:{type:"file",id:"excelFile",hidden:""},on:{change:e.handleFileSelect}}),e._v(" "),i("span",{staticClass:"u-txt"},[e._v("选择文件")])])])]),e._v(" "),i("div",{staticClass:"d-btn-wrap"},[i("span",[e._v("请按EXCEL模板格式导入")]),e._v(" "),i("el-button",{attrs:{type:"text",size:"mini",disabled:e.isDisabled},on:{click:e.downloadModel}},[e._v("下载模板")])],1)])]),e._v(" "),i("el-form-item",{attrs:{label:"批量更新门店售价",required:""}},[i("div",{staticStyle:{width:"740px"}},[i("region-store",{attrs:{regionCode:e.regionCode,platformId:e.platformId},on:{setCheckedData:e.setCheckedData}})],1)]),e._v(" "),i("hr",{staticClass:"s-slip-tb"}),e._v(" "),i("el-form-item",[i("el-button",{attrs:{type:"primary",size:"small",disabled:e.isDisabled},on:{click:e.doSaveHandel}},[e._v("保存")])],1)],1)],1)])},staticRenderFns:[]};var h=i("VU/8")(m,u,!1,function(e){i("fwXe")},null,null);t.default=h.exports}});
//# sourceMappingURL=132.77beaa82513718fbe83b.js.map