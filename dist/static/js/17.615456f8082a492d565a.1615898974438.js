webpackJsonp([17],{"Ocb/":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("BO1k"),i=a.n(o),n=a("Dd8w"),s=a.n(n),r=a("Gu7T"),d=a.n(r),l=a("WorT"),c=a("oGZo"),m=a("RCQo"),u=a("ZAFg"),h=a("VYwm"),g=a("oAV5"),f=a("8e4C"),p=(a("Zbyc"),{mixins:[l.a,c.a,m.a],components:{ChooseGoods:h.a},data:function(){var e=this,t=function(t,a,o){return e.addParamMsg.startTime?e.addParamMsg.endTime?Object(g.a)(e.addParamMsg.endTime)<Object(g.a)(e.addParamMsg.startTime)?o(new Error("价格有效终止时间不能早于起始时间")):void o():o(new Error("请选择价格有效终止时间")):o(new Error("请选择价格有效起始时间"))};return{isDisabled:!1,addParamMsg:{vendorNo:"",vendorName:"",startTime:Object(g.b)("yyyy-MM-dd HH:mm:ss",(new Date).getTime()),endTime:Object(g.b)("yyyy-MM-dd HH:mm:ss",(new Date).getTime()+864e5),goods:[],regionNos:[],regions:[],status:""},rules:{vendorNo:[{required:!0,validator:function(e,t,a){if(!t)return a(new Error("请选择供应商"));a()},trigger:"change"}],startTime:[{required:!0,validator:t,trigger:"change"}],endTime:[{required:!0,validator:t,trigger:"change"}],regionNos:[{required:!0,validator:function(t,a,o){if(!e.addParamMsg.regionNos||0===e.addParamMsg.regionNos.length)return o(new Error("请选择区域"));o()},trigger:"change"}]},checkedGoodsList:[],columns:[{title:"条形码",dataIndex:"barCode",ellipsis:!0,minWidth:120},{title:"商品编码",dataIndex:"goodsNo",minWidth:100},{title:"货号",dataIndex:"vendorGoodsNo",minWidth:100},{title:"商品名称",dataIndex:"name",ellipsis:!0,minWidth:120},{title:"规格",dataIndex:"spec",minWidth:80},{title:"单位",dataIndex:"saleUnitName",minWidth:80},{title:"市场参考价",dataIndex:"showPrice",input:!0,placeholder:"市场参考价",minWidth:100},{title:"销售价",dataIndex:"salePrice",input:!0,placeholder:"销售价",minWidth:100},{title:"日均可订货量",dataIndex:"qty",input:!0,placeholder:"日均可订货量",minWidth:120},{title:"操作",width:80,fixed:"right",operation:[{label:"删除",icon:"el-icon-delete",clickFunc:this.deleteHandel}]}]}},methods:{showAddGoodsDialog:function(){var e=this;this.addParamMsg.vendorNo?this.$nextTick(function(){e.$refs.chooseGoods.setDefaultMsg({title:"选择商品",vendorNo:e.addParamMsg.vendorNo,defaultChecked:e.checkedGoodsList})}):this.$tip.message("请先选择供应商","warning")},confirmHandel:function(e){this.checkedGoodsList=[].concat(d()(e))},deleteHandel:function(e){this.checkedGoodsList=this.checkedGoodsList.filter(function(t){return t.goodsNo!==e.goodsNo})},doSaveHandel:function(e){var t=this;this.$refs.ruleForm.validate(function(a){if(!a)return!1;if(t.checkedGoodsList&&0!==t.checkedGoodsList.length){var o=!0,n=!1,r=void 0;try{for(var d,l=i()(t.checkedGoodsList);!(o=(d=l.next()).done);o=!0){var c=d.value;if(!c.showPrice&&0!=parseFloat(c.showPrice))return void t.$tip.message("请输入【"+c.name+"】的市场参考价","warning");if(!f.a.salePriceReg.test(c.showPrice))return void t.$tip.message("【"+c.name+"】的市场参考价应为数字，小数保留两位小数","warning");if(!c.salePrice&&0!=parseFloat(c.salePrice))return void t.$tip.message("请输入【"+c.name+"】的销售价","warning");if(!f.a.salePriceReg.test(c.salePrice))return void t.$tip.message("【"+c.name+"】的市场销售价应为数字，小数保留两位小数","warning");if(parseFloat(c.salePrice)>parseFloat(c.showPrice))return void t.$tip.message("【"+c.name+"】的销售价不能大于市场参考价","warning");if(!c.qty&&0!=parseInt(c.qty))return void t.$tip.message("请输入【"+c.name+"】的日均可订货量","warning");if(!f.a.numReg.test(c.qty))return void t.$tip.message("【"+c.name+"】的日均可订货量应为整数","warning")}}catch(e){n=!0,r=e}finally{try{!o&&l.return&&l.return()}finally{if(n)throw r}}t.addParamMsg.status=e;var m=t.vendors.filter(function(e){return e.vendorNo===t.addParamMsg.vendorNo})[0];t.addParamMsg.vendorName=m?m.vendorName:"";var h=[],g=!0,p=!1,v=void 0;try{for(var b,N=i()(t.regionsList);!(g=(b=N.next()).done);g=!0){var y=b.value,k=!0,M=!1,w=void 0;try{for(var P,C=i()(t.addParamMsg.regionNos);!(k=(P=C.next()).done);k=!0){var x=P.value;y.storeGroupNo===x&&h.push(y)}}catch(e){M=!0,w=e}finally{try{!k&&C.return&&C.return()}finally{if(M)throw w}}}}catch(e){p=!0,v=e}finally{try{!g&&N.return&&N.return()}finally{if(p)throw v}}t.addParamMsg.regions=h.map(function(e){return{regionCode:e.storeGroupNo,regionName:e.storeGroupName}}),t.addParamMsg.goods=t.checkedGoodsList.map(function(e){return s()({erpGoodsNo:e.goodsNo,goodsName:e.name,unit:e.saleUnitName},e)}),t.isDisabled=!0,t.$http.post(u.a.addOrUpdateQuote,s()({},t.addParamMsg)).then(function(e){if(t.isDisabled=!1,0===e.code)return t.$tip.message("保存成功","success"),void t.saveSuccessHandel("/sale_mgt");throw new Error(e.msg)}).catch(function(e){t.isDisabled=!1,t.$tip.notify(e.message||"","error","系统提示")})}else t.$tip.message("请选择商品","warning")})},vendorNoChange:function(){this.checkedGoodsList=[]},doCancelHandel:function(){this.closePage("/sale_mgt")}}}),v={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"add-form-wraper"},[a("el-form",{ref:"ruleForm",attrs:{model:e.addParamMsg,"label-position":"right","label-width":"160px",rules:e.rules}},[a("el-form-item",{attrs:{label:"供应商",prop:"vendorNo"}},[a("el-select",{staticClass:"add-input",attrs:{placeholder:"选择供应商",size:"small"},on:{change:e.vendorNoChange},model:{value:e.addParamMsg.vendorNo,callback:function(t){e.$set(e.addParamMsg,"vendorNo",t)},expression:"addParamMsg.vendorNo"}},e._l(e.vendors,function(e){return a("el-option",{key:e.vendorNo,attrs:{label:e.vendorName,value:e.vendorNo}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"价格有效起始时间",prop:"startTime"}},[a("el-date-picker",{staticClass:"add-input",attrs:{clearable:!1,type:"datetime",placeholder:"价格有效起始时间",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",size:"small"},model:{value:e.addParamMsg.startTime,callback:function(t){e.$set(e.addParamMsg,"startTime",t)},expression:"addParamMsg.startTime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"价格有效终止时间",prop:"endTime"}},[a("el-date-picker",{staticClass:"add-input",attrs:{clearable:!1,type:"datetime",placeholder:"价格有效终止时间",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",size:"small"},model:{value:e.addParamMsg.endTime,callback:function(t){e.$set(e.addParamMsg,"endTime",t)},expression:"addParamMsg.endTime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"区域",prop:"regionNos"}},[a("el-select",{staticClass:"add-input",attrs:{placeholder:"选择区域",multiple:"",size:"small"},model:{value:e.addParamMsg.regionNos,callback:function(t){e.$set(e.addParamMsg,"regionNos",t)},expression:"addParamMsg.regionNos"}},e._l(e.regionsList,function(e){return a("el-option",{key:e.storeGroupNo,attrs:{label:e.storeGroupName,value:e.storeGroupNo}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"选择商品",required:""}},[a("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-plus"},on:{click:e.showAddGoodsDialog}},[e._v("添加商品")]),e._v(" "),a("bl-table",{attrs:{border:!1,dataSource:e.checkedGoodsList,columns:e.columns,maxHeight:400}})],1),e._v(" "),a("el-form-item",[a("hr",{staticClass:"s-slip-tb"}),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small",disabled:e.isDisabled,loading:e.isDisabled&&0===e.addParamMsg.status},on:{click:function(t){return e.doSaveHandel(0)}}},[e._v("保存")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small",disabled:e.isDisabled,loading:e.isDisabled&&1===e.addParamMsg.status},on:{click:function(t){return e.doSaveHandel(1)}}},[e._v("保存并发布")]),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:e.doCancelHandel}},[e._v("关闭")])],1)],1),e._v(" "),a("choose-goods",{ref:"chooseGoods",on:{confirm:e.confirmHandel}})],1)},staticRenderFns:[]},b=a("VU/8")(p,v,!1,null,null,null);t.default=b.exports},VYwm:function(e,t,a){"use strict";var o=a("Dd8w"),i=a.n(o),n=a("Gu7T"),s=a.n(n),r=a("t0/o"),d={data:function(){return{title:"",visible:!1,loading:!1,pageNum:1,pageSize:10,total:0,searchContent:{vendorNo:"",goodsNo:"",goodsName:"",tradeModeId:9},columns:[{title:"商品条码",dataIndex:"barCode",minWidth:120},{title:"商品编码",dataIndex:"goodsNo",minWidth:100},{title:"商品名称",dataIndex:"name",minWidth:120},{title:"单位",dataIndex:"saleUnitName",minWidth:80},{title:"规格",dataIndex:"spec",minWidth:90}],tableData:[],checkedList:[]}},watch:{"searchContent.vendorNo":function(e,t){e!==t&&this.doSearchHandle(!0)}},methods:{setDefaultMsg:function(e){this.title=e.title||"",this.searchContent.vendorNo=e.vendorNo||"",this.checkedList=e.defaultChecked&&e.defaultChecked.length?[].concat(s()(e.defaultChecked)):[],this.visible=!0},changeSize:function(e){this.pageSize=e,this.doSearchHandle()},changeCurrent:function(e){this.pageNum=e,this.doSearchHandle()},doSearchHandle:function(e){var t=this;this.loading=!0,this.$http.post(r.a.queryContractGoods,i()({},this.searchContent,{pageNum:this.pageNum,pageSize:this.pageSize})).then(function(e){if(t.loading=!1,0===e.code)return t.tableData=e.data&&e.data.result&&e.data.result.length?e.data.result:[],void(t.total=e.data&&e.data.total?e.data.total:0);throw new Error(e.msg)}).catch(function(e){t.loading=!1,utils.openNotification("error","系统提示",e.message)})},selectHandel:function(e){var t=e.selection,a=e.row;if(t.includes(a))this.checkedList.push(a);else{var o=this.checkedList.findIndex(function(e){return e.goodsNo===a.goodsNo});this.checkedList.splice(o,1)}},selectAllHandel:function(e){var t=this;e.selection.length?this.tableData.forEach(function(e){-1===t.checkedList.findIndex(function(t){return t.goodsNo===e.goodsNo})&&t.checkedList.push(e)}):this.tableData.forEach(function(e){var a=t.checkedList.findIndex(function(t){return t.goodsNo===e.goodsNo});-1!==a&&t.checkedList.splice(a,1)})},confirm:function(){this.visible=!1,this.$emit("confirm",this.checkedList)}}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,title:e.title,visible:e.visible,width:"700px"},on:{"update:visible":function(t){e.visible=t}}},[a("div",{staticClass:"search-form-wraper c-g-sfw"},[a("el-form",{attrs:{model:e.searchContent,"label-position":"top"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",[a("el-input",{staticClass:"search-input",attrs:{placeholder:"输入商品编码",size:"small",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.doSearchHandle(!0)}},model:{value:e.searchContent.goodsNo,callback:function(t){e.$set(e.searchContent,"goodsNo","string"==typeof t?t.trim():t)},expression:"searchContent.goodsNo"}})],1),e._v(" "),a("el-form-item",[a("el-input",{staticClass:"search-input",attrs:{placeholder:"输入商品名称",size:"small",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.doSearchHandle(!0)}},model:{value:e.searchContent.goodsName,callback:function(t){e.$set(e.searchContent,"goodsName","string"==typeof t?t.trim():t)},expression:"searchContent.goodsName"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.doSearchHandle(!0)}}},[e._v("搜索")])],1)],1)],1),e._v(" "),a("div",[a("bl-table",{attrs:{loading:e.loading,border:!1,selection:!0,dataSource:e.tableData,columns:e.columns,maxHeight:300,defaultChecked:e.checkedList,uniqueStr:"goodsNo"},on:{select:e.selectHandel,"select-all":e.selectAllHandel}}),e._v(" "),a("bl-pagination",{attrs:{showPagination:e.tableData.length>0,pageNum:e.pageNum,total:e.total},on:{"size-change":e.changeSize,"current-change":e.changeCurrent}})],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.visible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.confirm}},[e._v("确定")])],1)])},staticRenderFns:[]},c=a("VU/8")(d,l,!1,null,null,null);t.a=c.exports},oGZo:function(e,t,a){"use strict";var o=a("Dd8w"),i=a.n(o),n=a("NYxO");t.a={created:function(){this.regionsList&&0!==this.regionsList.length||this.$store.dispatch("regions/GET_REGIONS")},computed:i()({},Object(n.b)({regionsList:"regions/REGIONS"}))}}});
//# sourceMappingURL=17.615456f8082a492d565a.1615898974438.js.map