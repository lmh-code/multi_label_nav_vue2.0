webpackJsonp([146],{YY6e:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("Dd8w"),i=a.n(n),l=a("ssT3"),s=a("oAV5"),o="/foundation/store/userStoreCityList",r="/foundation/store/userStoreList",c="/plateform/p/tv/template/getList",u="/plateform/p/tv/template/delete",d="/plateform/p/tv/template/operate",p="/plateform/p/tv/template/getGoodsFilterKey",m="/plateform/p/tv/template/setGoodsFilterKey",h={data:function(){return{isDisabled:!1,loading:!1,pageNum:1,pageSize:10,total:0,tableData:[],searchContent:{DIFFCITY:!0,templateType:"",templateName:"",cityId:"",storeNo:"",enable:""},templateTypeOptions:[{label:"全部",value:""},{label:"区域模板",value:1},{label:"门店模板",value:2}],enableOptions:[{label:"全部",value:""},{label:"已启用",value:0},{label:"已禁用",value:1}],cityOptions:[],storeOptions:[],goodsSetVisible:!1,formLoading:!1,dynamicTags:[],cityId:"",inputVisible:!1,inputValue:""}},created:function(){var e=l.a.get("searchContent");this.$route.meta.keepAlive&&e&&(this.pageNum=e.pageNum,this.searchContent=e.searchContent),this.doSearchHandel(),l.a.remove("searchContent"),this.getCityList()},methods:{templateTypeFormatter:function(e,t,a){return 1===a?"区域模板":2===a?"门店模板":"--"},displayFormatter:function(e,t,a){return 0===a?"横屏显示":1===a?"竖屏显示":"--"},enableFormatter:function(e,t,a){return 0===a?"已启用":1===a?"已禁用":"--"},timeFormatter:function(e,t,a){return a?s.s(a):""},changeSize:function(e){this.pageSize=e,this.doSearchHandel()},changeCurrent:function(e){this.pageNum=e,this.doSearchHandel()},getCityList:function(){var e=this;this.$http.get(o).then(function(t){if(0!==t.code)throw new Error(t.msg);var a=t.data&&t.data.length?t.data:[];e.cityOptions=a.map(function(e){return{label:e.cityId+"_"+e.cityName,value:e.cityId}})}).catch(function(e){console.log("提示【获取区域列表】：",e.message)})},cityChange:function(e){var t=this,a={DIFFCITY:!0,pageNum:1,pageSize:-1,cityId:e};this.searchContent.storeNo="",this.$http.post(r,i()({},a)).then(function(e){if(0!==e.code)throw new Error(e.msg);var a=e.data&&e.data.result&&e.data.result.length?e.data.result:[];t.storeOptions=a.map(function(e){return{label:e.storeNo+"_"+e.storeName,value:e.storeNo}})}).catch(function(e){t.$notify.error({title:"提示",message:e.message})}),this.doSearchHandel(!0)},addScreenSet:function(){this.$router.push("/sc861816/add")},doSearchHandel:function(e){var t=this;!0===e&&(this.pageNum=1),this.loading=!0,this.$http.post(c,i()({},this.searchContent,{pageNum:this.pageNum,pageSize:this.pageSize})).then(function(e){if(t.loading=!1,0===e.code)return t.tableData=e.data&&e.data.result&&e.data.result.length?e.data.result:[],void(t.total=e.data.total);throw new Error(e.msg)}).catch(function(e){t.loading=!1,t.$notify.error({title:"提示",message:e.message})})},deleteItem:function(e){var t=this,a={DIFFCITY:!0,id:e.id};this.$confirm("确定要删除吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$http.post(u,i()({},a)).then(function(e){if(0===e.code)return t.$message.success("删除成功"),void t.doSearchHandel();throw new Error(e.msg)}).catch(function(e){t.$notify.error({title:"提示",message:e.message})})}).catch(function(){})},operateHandel:function(e){var t=this,a={DIFFCITY:!0,id:e.id},n="";0===e.enable?(n="确定要禁用吗?",a.enable=1):1===e.enable&&(n="一个门店或区域有且仅有一个可生效模板，开启后原模板将被禁用，确定要启用吗?",a.enable=0),this.$confirm(n,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$http.post(d,i()({},a)).then(function(a){if(0===a.code)return 0===e.enable?t.$message.success("禁用成功"):1===e.enable&&t.$message.success("启用成功"),void t.doSearchHandel();throw new Error(a.msg)}).catch(function(e){t.$notify.error({title:"提示",message:e.message})})}).catch(function(){})},editItem:function(e){var t={searchContent:this.searchContent,pageNum:this.pageNum};l.a.set("searchContent",t),this.$router.push("/sc861816/edit/"+e.id)},showSetDialog:function(){var e=l.a.get("cityId")||"";this.cityId=e,this.dynamicTags="",this.getFilterMsg(e),this.goodsSetVisible=!0},areaCityChange:function(e){this.getFilterMsg(e)},handleClose:function(e){this.dynamicTags.splice(this.dynamicTags.indexOf(e),1)},showInput:function(){var e=this;this.inputVisible=!0,this.$nextTick(function(t){e.$refs.saveTagInput.$refs.input.focus()})},handleInputConfirm:function(){var e=this.inputValue;e&&this.dynamicTags.push(e),this.inputVisible=!1,this.inputValue=""},getFilterMsg:function(e){var t=this;this.formLoading=!0,this.$http.post(p,{DIFFCITY:!0,cityId:e}).then(function(e){if(0!==e.code)throw new Error(e.msg);t.formLoading=!1;var a=e.data||[];t.dynamicTags=a}).catch(function(e){t.formLoading=!1,t.$notify.error({title:"提示",message:e.message})})},cancelHandel:function(){var e=this;this.$confirm("取消将不保存编辑的任何内容，确定取消吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.goodsSetVisible=!1}).catch(function(){})},doSaveHandel:function(){var e=this;this.isDisabled=!0,this.$http.post(m,{DIFFCITY:!0,cityId:this.cityId,keyList:this.dynamicTags}).then(function(t){if(0===t.code)return setTimeout(function(){e.isDisabled=!1},500),e.$message.success("保存成功"),void(e.goodsSetVisible=!1);throw new Error(t.msg)}).catch(function(t){setTimeout(function(){e.isDisabled=!1},500),e.$notify.error({title:"提示",message:t.message})})}}},f={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"handel-search-wraper"},[a("div",{staticClass:"handel-wraper"},[a("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-plus"},on:{click:e.addScreenSet}},[e._v("新建模板")]),e._v(" "),e.cityOptions.length>0?a("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-setting"},on:{click:e.showSetDialog}},[e._v("商品名称过滤配置")]):e._e()],1),e._v(" "),a("hr",{staticClass:"s-slip"}),e._v(" "),a("div",{staticClass:"search-form-wraper"},[a("el-form",{attrs:{model:e.searchContent,"label-position":"top"}},[a("el-form-item",{attrs:{label:"模板类型"}},[a("el-select",{staticClass:"search-input",attrs:{placeholder:"请选择模板类型",size:"small",clearable:""},on:{change:function(t){return e.doSearchHandel(!0)}},model:{value:e.searchContent.templateType,callback:function(t){e.$set(e.searchContent,"templateType",t)},expression:"searchContent.templateType"}},e._l(e.templateTypeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"区域"}},[a("el-select",{staticClass:"search-input",attrs:{placeholder:"请选择区域",size:"small",filterable:"",clearable:""},on:{change:e.cityChange},model:{value:e.searchContent.cityId,callback:function(t){e.$set(e.searchContent,"cityId",t)},expression:"searchContent.cityId"}},e._l(e.cityOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"门店"}},[a("el-select",{staticClass:"search-input",attrs:{placeholder:"请选择门店",size:"small",filterable:"",clearable:""},on:{change:function(t){return e.doSearchHandel(!0)}},model:{value:e.searchContent.storeNo,callback:function(t){e.$set(e.searchContent,"storeNo",t)},expression:"searchContent.storeNo"}},e._l(e.storeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"状态"}},[a("el-select",{staticClass:"search-input",attrs:{placeholder:"状态",size:"small",clearable:""},on:{change:function(t){return e.doSearchHandel(!0)}},model:{value:e.searchContent.enable,callback:function(t){e.$set(e.searchContent,"enable",t)},expression:"searchContent.enable"}},e._l(e.enableOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"模板名称"}},[a("el-input",{staticClass:"search-input",attrs:{size:"small",placeholder:"模板名称",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.doSearchHandel(!0)}},model:{value:e.searchContent.templateName,callback:function(t){e.$set(e.searchContent,"templateName",t)},expression:"searchContent.templateName"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.doSearchHandel(!0)}}},[e._v("搜索")])],1)],1)],1)]),e._v(" "),a("div",{staticClass:"table-wraper"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"fixed-height",staticStyle:{width:"100%"},attrs:{data:e.tableData,"empty-text":"没有查询到您想要的数据",size:"small"}},[a("el-table-column",{attrs:{prop:"id",width:"60",label:"ID"}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"120px",prop:"templateName",label:"模板名称"}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"100px",prop:"templateType",label:"模板类型",formatter:e.templateTypeFormatter}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"100px",prop:"display",label:"显示方式",formatter:e.displayFormatter}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"120px",label:"区域/门店"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.templateType?a("div",[e._v(e._s(t.row.cityName))]):a("div",[e._v(e._s(t.row.cityName)+"/"+e._s(t.row.storeName))])]}}])}),e._v(" "),a("el-table-column",{attrs:{"min-width":"80px",prop:"enable",label:"状态",formatter:e.enableFormatter}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"100px",prop:"createSysUserName",label:"创建人"}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"170px",prop:"createTime",label:"创建时间",formatter:e.timeFormatter}}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[1===t.row.enable?a("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-delete"},on:{click:function(a){return e.deleteItem(t.row)}}},[e._v("删除")]):e._e(),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini",icon:0===t.row.enable?"el-icon-error":"el-icon-success"},on:{click:function(a){return e.operateHandel(t.row)}}},[e._v("\n              "+e._s(0===t.row.enable?"禁用":"启用"))])],1),e._v(" "),a("div",[a("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-edit"},on:{click:function(a){return e.editItem(t.row)}}},[e._v("编辑")])],1)]}}])})],1),e._v(" "),e.total>0?a("el-pagination",{staticClass:"tc mt20",attrs:{background:"","current-page":e.pageNum,"page-sizes":[10,50,100,150,200],layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.changeSize,"current-change":e.changeCurrent,"update:currentPage":function(t){e.pageNum=t},"update:current-page":function(t){e.pageNum=t}}}):e._e()],1),e._v(" "),a("div",[a("el-dialog",{attrs:{title:"商品名称过虑配置",visible:e.goodsSetVisible,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,width:"520px"},on:{"update:visible":function(t){e.goodsSetVisible=t}}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.formLoading,expression:"formLoading"}],ref:"form",attrs:{"label-width":"80px"}},[a("div",{staticClass:"form-wrap"},[a("el-form-item",{attrs:{label:"配置区域"}},[a("el-select",{staticClass:"dialog-input",attrs:{placeholder:"配置区域",size:"small",filterable:"",clearable:""},on:{change:e.areaCityChange},model:{value:e.cityId,callback:function(t){e.cityId=t},expression:"cityId"}},e._l(e.cityOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{staticClass:"filter-goods-name-wrap",attrs:{label:"过滤内容"}},[e._l(e.dynamicTags,function(t,n){return a("el-tag",{key:n,attrs:{closable:"","disable-transitions":!1},on:{close:function(a){return e.handleClose(t)}}},[e._v("\n              "+e._s(t)+"\n            ")])}),e._v(" "),e.inputVisible?a("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:e.handleInputConfirm},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirm(t)}},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}}):a("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:e.showInput}},[e._v("+ 添加内容")])],2)],1)]),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:e.cancelHandel}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small",disabled:e.isDisabled},on:{click:e.doSaveHandel}},[e._v("保存")])],1)],1)],1)])},staticRenderFns:[]};var g=a("VU/8")(h,f,!1,function(e){a("mLb5")},"data-v-00e5c276",null);t.default=g.exports},mLb5:function(e,t){}});
//# sourceMappingURL=146.4459d6d6c521c86c3df4.js.map